!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],e):e((t=t||self).fgui=t.fgui||{},t.three)}(this,(function(t,e){"use strict";var i,s,h,r,a,n,o,l,_,d,c,u,g,p,f,m,y,w,x,v;(i=t.ButtonMode||(t.ButtonMode={}))[i.Common=0]="Common",i[i.Check=1]="Check",i[i.Radio=2]="Radio",(s=t.AutoSizeType||(t.AutoSizeType={}))[s.None=0]="None",s[s.Both=1]="Both",s[s.Height=2]="Height",s[s.Shrink=3]="Shrink",(h=t.LoaderFillType||(t.LoaderFillType={}))[h.None=0]="None",h[h.Scale=1]="Scale",h[h.ScaleMatchHeight=2]="ScaleMatchHeight",h[h.ScaleMatchWidth=3]="ScaleMatchWidth",h[h.ScaleFree=4]="ScaleFree",h[h.ScaleNoBorder=5]="ScaleNoBorder",(r=t.ListLayoutType||(t.ListLayoutType={}))[r.SingleColumn=0]="SingleColumn",r[r.SingleRow=1]="SingleRow",r[r.FlowHorizontal=2]="FlowHorizontal",r[r.FlowVertical=3]="FlowVertical",r[r.Pagination=4]="Pagination",(a=t.ListSelectionMode||(t.ListSelectionMode={}))[a.Single=0]="Single",a[a.Multiple=1]="Multiple",a[a.Multiple_SingleClick=2]="Multiple_SingleClick",a[a.None=3]="None",(n=t.OverflowType||(t.OverflowType={}))[n.Visible=0]="Visible",n[n.Hidden=1]="Hidden",n[n.Scroll=2]="Scroll",(o=t.PackageItemType||(t.PackageItemType={}))[o.Image=0]="Image",o[o.MovieClip=1]="MovieClip",o[o.Sound=2]="Sound",o[o.Component=3]="Component",o[o.Atlas=4]="Atlas",o[o.Font=5]="Font",o[o.Swf=6]="Swf",o[o.Misc=7]="Misc",o[o.Unknown=8]="Unknown",(l=t.ObjectType||(t.ObjectType={}))[l.Image=0]="Image",l[l.MovieClip=1]="MovieClip",l[l.Swf=2]="Swf",l[l.Graph=3]="Graph",l[l.Loader=4]="Loader",l[l.Group=5]="Group",l[l.Text=6]="Text",l[l.RichText=7]="RichText",l[l.InputText=8]="InputText",l[l.Component=9]="Component",l[l.List=10]="List",l[l.Label=11]="Label",l[l.Button=12]="Button",l[l.ComboBox=13]="ComboBox",l[l.ProgressBar=14]="ProgressBar",l[l.Slider=15]="Slider",l[l.ScrollBar=16]="ScrollBar",l[l.Tree=17]="Tree",l[l.Loader3D=18]="Loader3D",(_=t.ProgressTitleType||(t.ProgressTitleType={}))[_.Percent=0]="Percent",_[_.ValueAndMax=1]="ValueAndMax",_[_.Value=2]="Value",_[_.Max=3]="Max",(d=t.ScrollBarDisplayType||(t.ScrollBarDisplayType={}))[d.Default=0]="Default",d[d.Visible=1]="Visible",d[d.Auto=2]="Auto",d[d.Hidden=3]="Hidden",(c=t.ScrollType||(t.ScrollType={}))[c.Horizontal=0]="Horizontal",c[c.Vertical=1]="Vertical",c[c.Both=2]="Both",(u=t.FlipType||(t.FlipType={}))[u.None=0]="None",u[u.Horizontal=1]="Horizontal",u[u.Vertical=2]="Vertical",u[u.Both=3]="Both",(g=t.ChildrenRenderOrder||(t.ChildrenRenderOrder={}))[g.Ascent=0]="Ascent",g[g.Descent=1]="Descent",g[g.Arch=2]="Arch",(p=t.GroupLayoutType||(t.GroupLayoutType={}))[p.None=0]="None",p[p.Horizontal=1]="Horizontal",p[p.Vertical=2]="Vertical",(f=t.PopupDirection||(t.PopupDirection={}))[f.Auto=0]="Auto",f[f.Up=1]="Up",f[f.Down=2]="Down",(m=t.RelationType||(t.RelationType={}))[m.Left_Left=0]="Left_Left",m[m.Left_Center=1]="Left_Center",m[m.Left_Right=2]="Left_Right",m[m.Center_Center=3]="Center_Center",m[m.Right_Left=4]="Right_Left",m[m.Right_Center=5]="Right_Center",m[m.Right_Right=6]="Right_Right",m[m.Top_Top=7]="Top_Top",m[m.Top_Middle=8]="Top_Middle",m[m.Top_Bottom=9]="Top_Bottom",m[m.Middle_Middle=10]="Middle_Middle",m[m.Bottom_Top=11]="Bottom_Top",m[m.Bottom_Middle=12]="Bottom_Middle",m[m.Bottom_Bottom=13]="Bottom_Bottom",m[m.Width=14]="Width",m[m.Height=15]="Height",m[m.LeftExt_Left=16]="LeftExt_Left",m[m.LeftExt_Right=17]="LeftExt_Right",m[m.RightExt_Left=18]="RightExt_Left",m[m.RightExt_Right=19]="RightExt_Right",m[m.TopExt_Top=20]="TopExt_Top",m[m.TopExt_Bottom=21]="TopExt_Bottom",m[m.BottomExt_Top=22]="BottomExt_Top",m[m.BottomExt_Bottom=23]="BottomExt_Bottom",m[m.Size=24]="Size",(y=t.FillMethod||(t.FillMethod={}))[y.None=0]="None",y[y.Horizontal=1]="Horizontal",y[y.Vertical=2]="Vertical",y[y.Radial90=3]="Radial90",y[y.Radial180=4]="Radial180",y[y.Radial360=5]="Radial360",(w=t.FillOrigin||(t.FillOrigin={}))[w.Top=0]="Top",w[w.Bottom=1]="Bottom",w[w.Left=2]="Left",w[w.Right=3]="Right",w[w.TopLeft=0]="TopLeft",w[w.TopRight=1]="TopRight",w[w.BottomLeft=2]="BottomLeft",w[w.BottomRight=3]="BottomRight",(x=t.FillOrigin90||(t.FillOrigin90={}))[x.TopLeft=0]="TopLeft",x[x.TopRight=1]="TopRight",x[x.BottomLeft=2]="BottomLeft",x[x.BottomRight=3]="BottomRight",(v=t.ObjectPropID||(t.ObjectPropID={}))[v.Text=0]="Text",v[v.Icon=1]="Icon",v[v.Color=2]="Color",v[v.OutlineColor=3]="OutlineColor",v[v.Playing=4]="Playing",v[v.Frame=5]="Frame",v[v.DeltaTime=6]="DeltaTime",v[v.TimeScale=7]="TimeScale",v[v.FontSize=8]="FontSize",v[v.Selected=9]="Selected";class b{constructor(t,e,i){this.pool=[],this._init=e,this._reset=i,this._ct=t}borrow(...t){let e;return e=this.pool.length>0?this.pool.pop():new this._ct,this._init&&this._init(e,...t),e}returns(t){if(Array.isArray(t)){let e=t.length;for(let i=0;i<e;i++){let e=t[i];this._reset&&this._reset(e),this.pool.push(e)}t.length=0}else this._reset&&this._reset(t),this.pool.push(t)}}var C={x:0,y:0,mouseWheelDelta:0,touchId:0,button:0,clickCount:0,holdTime:0};class S{constructor(){this.data=null,this._callChain=[]}get type(){return this._type}get sender(){return this._sender}get initiator(){return this._initiator}get input(){return C}stopPropagation(){this._stopsPropagation=!0}preventDefault(){this._defaultPrevented=!0}captureTouch(){this._touchCapture=!0}get isDefaultPrevented(){return this._defaultPrevented}}var T=new b(S,t=>{t._stopsPropagation=!1,t._defaultPrevented=!1,t._touchCapture=!1},t=>{t.data=null,t._initiator=null,t._sender=null});class I{constructor(){this._listeners={}}on(t,e,i,s){let h=this._listeners[t];h||(h={dispatching:0,callbacks:[],captures:[]},this._listeners[t]=h);let r=s?h.captures:h.callbacks,a=r.findIndex((t,s,h)=>t==e&&h[s+1]==i);-1!=a?r[a+2]=!1:r.push(e,i,!1)}off(t,e,i,s){let h=this._listeners[t];if(!h)return;let r=s?h.captures:h.callbacks,a=r.findIndex((t,s,h)=>t==e&&h[s+1]==i);-1!=a&&(0!=h.dispatching?(r[a+2]=!0,h.dispatching=2):r.splice(a,3))}offAll(t){if(t){let e=this._listeners[t];e&&(0!=e.dispatching?(e.callbacks.forEach((t,e,i)=>i[e+2]=!0),e.captures.forEach((t,e,i)=>i[e+2]=!0),e.dispatching=2):(e.callbacks.length=0,e.captures.length=0))}else for(var e in this._listeners)delete this._listeners[e]}hasListener(t,e,i,s){let h=this._listeners[t];if(!h)return!1;let r=s?h.captures:h.callbacks;if(!e)return r.length>0;r.findIndex((t,s,h)=>t==e&&h[s+1]==i)}dispatchEvent(t,e){let i=this._listeners[t];if(!i||0==i.callbacks.length&&0==i.captures.length)return;let s=T.borrow(t);return s._type=t,s.data=e,this._dispatch(i,s,!0),this._dispatch(i,s,!1),T.returns(s),s._defaultPrevented}_dispatch(t,e,i){if(0!=t.dispatching)return;t.dispatching=1,e._sender=this;let s=i?t.captures:t.callbacks,h=s.length;for(let t=0;t<h;t+=3)s[t].call(s[t+1],e);if(2==t.dispatching){let t=s.length,e=0;for(;e<t;)s[e+2]?(s.splice(e,3),t-=3):e+=3}t.dispatching=0}}class P{constructor(t,e,i,s){this.x=t||0,this.y=e||0,this.width=i||0,this.height=s||0}set(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s}setMinMax(t,e,i,s){this.x=t,this.y=e,this.width=i-t,this.height=s-e}get position(){return new e.Vector2(this.x,this.y)}get size(){return new e.Vector2(this.width,this.height)}get xMin(){return this.x}set xMin(t){let e=t-this.x;this.x=t,this.width-=e}get xMax(){return this.x+this.width}set xMax(t){this.width=t-this.x}get yMin(){return this.y}set yMin(t){let e=t-this.y;this.y=t,this.height-=e}get yMax(){return this.y+this.height}set yMax(t){this.height=t-this.y}intersection(t){if(0==this.width||0==this.height||0==t.width||0==t.height)return new P(0,0,0,0);let e=this.x>t.x?this.x:t.x,i=this.xMax<t.xMax?this.xMax:t.xMax,s=this.y>t.y?this.y:t.y,h=this.yMax<t.yMax?this.yMax:t.yMax;return e>i||s>h?this.set(0,0,0,0):this.setMinMax(e,s,i,h),this}union(t){if(0==t.width||0==t.height)return this;if(0==this.width||0==this.height)return this.copy(t),this;let e=Math.min(this.x,t.x),i=Math.min(this.y,t.y);return this.setMinMax(e,i,Math.max(this.xMax,t.xMax),Math.max(this.yMax,t.yMax)),this}extend(t,e){this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e}contains(t,i){return t instanceof e.Vector2&&(i=t.y,t=t.x),t>=this.x&&t<this.x+this.width&&i>=this.y&&i<this.y+this.height}copy(t){this.set(t.x,t.y,t.width,t.height)}clone(){return new P(this.x,this.y,this.width,this.height)}}class k{static add(t,e,i,s,h){let r,a=M.findIndex(t=>t.target==s&&t.callback==i);-1!=a?r=M[a]:(r=O.borrow(),r.callback=i,r.target=s,M.push(r)),r.delay=t,r.counter=0,r.repeat=e,r.param=h,r.end=!1}static callLater(t,e,i){this.add(0,1,t,e,i)}static callDelay(t,e,i,s){this.add(t,1,e,i,s)}static addUpdate(t,e,i){this.add(0,0,t,e,i)}static exists(t,e){return-1!=M.findIndex(i=>i.target==e&&i.callback==t)}static remove(t,e){let i=M.findIndex(i=>i.target==e&&i.callback==t);if(-1!=i){let t=M[i];M.splice(i,1),i<z&&z--,L--,O.returns(t)}}}k.deltaTime=0,k.time=0,k.frameCount=0;var M=new Array,O=new b(class{constructor(){this.delay=0,this.counter=0,this.repeat=0}advance(t){return this.counter+=t,this.counter>=this.delay&&(this.counter-=this.delay,this.counter>this.delay&&(this.counter=this.delay),this.repeat>0&&(this.repeat--,0==this.repeat&&(this.end=!0)),!0)}reset(){this.callback=null,this.target=null,this.param=null}},t=>t.reset()),z=0,L=0,B=0;requestAnimationFrame((function t(e){requestAnimationFrame(t),k.frameCount++,k.time=e;let i=e-B;k.deltaTime=i,B=e,z=0,L=M.length;for(;z<L;){var s=M[z];z++,s.advance(i)&&(s.end&&(z--,L--,M.splice(z,1)),s.callback.call(s.target,s.param),s.end&&O.returns(s))}return!1}));var F=1;class j{static init(t,i){!function(t,i){V=t,i&&(null!=i.defaultLayer&&(F=i.defaultLayer),i.screenMode&&(it=i.screenMode));Y=t.domElement,(E=new e.OrthographicCamera(-1,1,1,-1,0,1e3)).layers.set(F),q=function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}(),t instanceof e.WebGLRenderer&&(et=t.getPixelRatio());H=[];for(let t=0;t<5;t++)H.push(new ut);q||(H[0].touchId=0);U=0,G=new e.Vector2,q?(document.addEventListener("touchstart",t=>at(t,0),{passive:!1}),document.addEventListener("touchend",t=>at(t,1),{passive:!1}),document.addEventListener("touchmove",t=>at(t,2),{passive:!1}),document.addEventListener("touchcancel",t=>at(t,3),{passive:!1})):(document.addEventListener("mousedown",t=>ht(t,0),{passive:!1}),document.addEventListener("mouseup",t=>ht(t,1),{passive:!1}),document.addEventListener("mousemove",t=>ht(t,2),{passive:!1}));document.addEventListener("wheel",t=>function(t){K&&K.stage||t.preventDefault();_t.set(t.pageX,t.pageY,0),_t.applyMatrix4(tt),G.set(_t.x,_t.y);let e=H[0];q&&(e.shiftKey=t.shiftKey,e.ctrlKey=t.ctrlKey,e.target=N=ot(G.x,G.y,!0));null!=N&&(e.mouseWheelDelta=t.deltaY,ct(e),pt(N.obj3D,"mouse_wheel"),e.mouseWheelDelta=0)}(t),{passive:!1}),window.addEventListener("resize",st,!1),st()}(t,i)}static set scene(t){W=t}static get scene(){return W}static get domElement(){return Y}static get devicePixelRatio(){return et}static get touchScreen(){return q}static get camera(){return E}static set camera(t){E=t}static get width(){return X}static get height(){return Q}static get touchPos(){return G}static get canvasTransform(){return tt}static get touchTarget(){return N}static get touchCount(){return U}static getTouchPos(t,i){if(i||(i=new e.Vector2),null==t||-1==t)i.copy(G);else{let e=rt(t);e?i.set(e.x,e.y):i.copy(G)}return i}static addTouchMonitor(t,e){let i=rt(t);-1==i.touchMonitors.indexOf(e)&&i.touchMonitors.push(e)}static removeTouchMonitor(t){for(let e=0;e<5;e++){let i=H[e],s=i.touchMonitors.indexOf(t);-1!=s&&(i.touchMonitors[s]=null)}}static cancelClick(t){for(let e=0;e<5;e++){let i=H[e];i.touchId==t&&(i.clickCancelled=!0)}}static update(){this.disableMatrixValidation=!0,function t(e,i,s){let h=e.children,r=h.length,a=e.$owner;a&&(a._clipRect&&(i=a._clipPlanes),s*=a.alpha);for(let e=0;e<r;e++){let r=h[e];a=r.$owner,a&&a.update(i,s),r.children.length>0&&t(r,i,s)}}(W,null,1),this.fontRebuilt&&(W.traverseVisible(t=>{let e=t.$owner;e&&"redraw"in e&&e.redraw()}),this.fontRebuilt=!1),this.disableMatrixValidation=!1}static hitTest(t,e,i){return ot(t,e,i)}static setFocus(t){lt(t)}}j.eventDispatcher=new I;var R=new e.Vector3,A=new e.Vector2;class D{constructor(){this.screenPt=new e.Vector3}get camera(){return this._camera}set camera(t){this._camera=t,this._ray=this._camera.$hitTestRay,this._ray||(this._camera.$hitTestRay=this._ray={origin:new e.Vector3,direction:new e.Vector3}),dt(this._camera,this.screenPt.x,this.screenPt.y,this._ray.origin,this._ray.direction)}get ray(){return this._ray}set ray(t){this._ray=t}getLocal(t){return R.copy(this._ray.origin),t.worldToLocal(R,this._ray.direction),A.set(R.x,R.y),A}}var V,E,W,H,N,G,U,Y,X,Q,q,K,$=[],Z=[],J=new D,tt=new e.Matrix4,et=1,it="none";function st(t){X=Y.clientWidth,Q=Y.clientHeight,function(){let t=0,i=0;var s=Y,h=s.style;h.paddingTop&&(i+=parseInt(h.paddingTop,10)),h.paddingLeft&&(t+=parseInt(h.paddingTop,10));do{t+=s.offsetLeft,i+=s.offsetTop,(h=s.style).borderLeftWidth&&(t+=parseInt(h.borderLeftWidth,10)),h.borderTopWidth&&(i+=parseInt(h.borderTopWidth,10))}while(s=s.offsetParent);if(tt.identity(),"horizontal"==it){if(Q>X){let t=X;X=Q,Q=t,V.setSize(X,Q),Y.style.transformOrigin="0 0",Y.style.transform="translate("+Q+"px,0) rotate(90deg)",tt.multiply((new e.Matrix4).makeTranslation(0,Q,0)).multiply((new e.Matrix4).makeRotationZ(-Math.PI/2))}}else if("vertical"==it){if(X>Q){let t=X;X=Q,Q=t,V.setSize(X,Q),Y.style.transformOrigin="0 0",Y.style.transform="translate(0,"+X+"px) rotate(-90deg)",tt.multiply((new e.Matrix4).makeTranslation(X,0,0)).multiply((new e.Matrix4).makeRotationZ(Math.PI/2))}}else V.setSize(X,Q);tt.multiply((new e.Matrix4).makeTranslation(-t,-i,0))}();let i=X/Q;if(E instanceof e.OrthographicCamera){let t=Q/2;E.left=-t*i,E.right=t*i,E.top=t,E.bottom=-t,E.position.x=t*i,E.position.y=-t,E.position.z=0,E.updateProjectionMatrix()}else E instanceof e.PerspectiveCamera&&(E.aspect=i,E.updateProjectionMatrix());t&&j.eventDispatcher.dispatchEvent("size_changed")}function ht(t,e){K&&K.stage||t.preventDefault(),_t.set(t.pageX,t.pageY,0),_t.applyMatrix4(tt),G.set(_t.x,_t.y);let i=H[0];if(i.shiftKey=t.shiftKey,i.ctrlKey=t.ctrlKey,i.target=N=ot(G.x,G.y,!0),G.x==i.x&&G.y==i.y||(i.x=G.x,i.y=G.y,i.move()),i.lastRollOver!=i.target&&nt(i),0==e)i.began||(U=1,i.begin(),i.button=t.button,lt(i.target),ct(i),i.target&&pt(i.target.obj3D,"touch_begin"));else if(1==e&&i.began){U=0,i.end();let e=i.clickTest();e&&(ct(i),1==t.button||2==t.button?pt(e.obj3D,"right_click"):pt(e.obj3D,"click")),i.button=-1}}function rt(t){for(let e=0;e<5;e++){let i=H[e];if(-1==t&&-1!=i.touchId||-1!=t&&i.touchId==t)return i}return null}function at(t,e){K&&K.stage||t.preventDefault();let i=t.changedTouches;for(let s=0;s<i.length;++s){let h,r,a=i[s];_t.set(a.pageX,a.pageY,0),_t.applyMatrix4(tt),G.set(_t.x,_t.y);for(let t=0;t<5;t++){if(H[t].touchId==a.identifier){h=H[t];break}-1==H[t].touchId&&(r=H[t])}if(!h){if(h=r,!h||0!=e)continue;h.touchId=a.identifier}if(h.shiftKey=t.shiftKey,h.ctrlKey=t.ctrlKey,h.target=N=ot(G.x,G.y,!0),h.x==G.x&&h.y==G.y||(h.x=G.x,h.y=G.y,h.began&&h.move()),h.lastRollOver!=h.target&&nt(h),0==e)h.began||(U++,h.begin(),h.button=0,lt(h.target),ct(h),h.target&&pt(h.target.obj3D,"touch_begin"));else if((1==e||3==e)&&h.began){if(U--,h.end(),3!=e){let t=h.clickTest();null!=t&&(ct(h),pt(t.obj3D,"click"))}h.target=null,nt(h),h.touchId=-1}}}function nt(t){if($.length=0,Z.length=0,t.lastRollOver&&(Z.push(t.lastRollOver),t.lastRollOver.obj3D.traverseAncestors(t=>{let e=t.$owner;e&&Z.push(e)})),t.lastRollOver=t.target,t.target){let e=t.target.obj3D;for(;e;){let t=e.$owner;if(t){let e=Z.indexOf(t);if(-1!=e){Z.splice(e,Z.length-e);break}$.push(t)}e=e.parent}}let e=Z.length;if(e>0){for(let t=0;t<e;t++){let e=Z[t];e.stage&&e.dispatchEvent("roll_out",null)}Z.length=0}if(e=$.length,e>0){for(let t=0;t<e;t++){let e=$[t];e.stage&&e.dispatchEvent("roll_over",null)}$.length=0}}function ot(t,e,i){J||(J=new D),j.disableMatrixValidation=!0,J.screenPt.set(t,e,0),J.camera=E,J.forTouch=null==i||i;let s=It(W,J);return j.disableMatrixValidation=!1,s}function lt(t){if(K!=t){if(K){let t=K;K=null,t.dispatchEvent("focus_out")}t&&t.isInput&&(K=t).dispatchEvent("focus_in")}}var _t=new e.Vector3;function dt(t,e,i,s,h){s.set(e/X*2-1,-i/Q*2+1,0),s.unproject(t),t.isPerspectiveCamera?(_t.setFromMatrixPosition(t.matrixWorld),h.copy(s).sub(_t).normalize(),h.multiplyScalar(-1)):h.set(0,0,1)}function ct(t){C.touchId=t.touchId,C.x=t.x,C.y=t.y,C.clickCount=t.clickCount,C.mouseWheelDelta=t.mouseWheelDelta,C.button=t.button,C.holdTime=t.holdTime,C.ctrlKey=t.ctrlKey,C.shiftKey=t.shiftKey,C.commandKey=t.commandKey}class ut{constructor(){this.downTargets=new Array,this.touchMonitors=new Array,this.reset()}reset(){this.touchId=-1,this.x=0,this.y=0,this.clickCount=0,this.button=-1,this.mouseWheelDelta=0,this.lastClickTime=0,this.began=!1,this.target=null,this.downTargets.length=0,this.lastRollOver=null,this.clickCancelled=!1,this.touchMonitors.length=0}begin(){this.began=!0,this.clickCancelled=!1,this.downX=this.x,this.downY=this.y,this.downTime=performance.now(),this.downFrame=k.frameCount,this.holdTime=0,this.downTargets.length=0,this.target&&(this.downTargets.push(this.target),this.target.obj3D.traverseAncestors(t=>{let e=t.$owner;e&&this.downTargets.push(e)}))}move(){if(this.began&&(this.holdTime=k.frameCount-this.downFrame==1?1/60:performance.now()-this.downTime),ct(this),(Math.abs(this.x-this.downX)>50||Math.abs(this.y-this.downY)>50)&&(this.clickCancelled=!0),this.touchMonitors.length>0){let t=this.touchMonitors.length;for(let e=0;e<t;e++){let t=this.touchMonitors[e];t instanceof ft&&!t.stage&&(this.touchMonitors[e]=null)}pt(null,"touch_move",null,this.touchMonitors)}else j.eventDispatcher.dispatchEvent("touch_move")}end(){this.began=!1;let t=performance.now();0==this.downTargets.length||this.clickCancelled||Math.abs(this.x-this.downX)>10||Math.abs(this.y-this.downY)>10?(this.clickCancelled=!0,this.lastClickTime=0,this.clickCount=1):(t-this.lastClickTime<.35&&Math.abs(this.x-this.lastClickX)<10&&Math.abs(this.y-this.lastClickY)<10&&this.lastClickButton==this.button?2==this.clickCount?this.clickCount=1:this.clickCount++:this.clickCount=1,this.lastClickTime=t,this.lastClickX=this.x,this.lastClickY=this.y,this.lastClickButton=this.button),this.holdTime=k.frameCount-this.downFrame==1?1/60:t-this.downTime,ct(this);let e=this.target?this.target.obj3D:j.scene;if(this.touchMonitors.length>0){let t=this.touchMonitors.length;for(let e=0;e<t;e++){let t=this.touchMonitors[e];t instanceof ft&&!t.stage&&(this.touchMonitors[e]=null)}pt(e,"touch_end",null,this.touchMonitors),this.touchMonitors.length=0}else pt(e,"touch_end")}clickTest(){if(this.clickCancelled)return this.downTargets.length=0,null;let t=this.downTargets[0];if(t.stage)return this.downTargets.length=0,t;for(t=this.target;t;){if(-1!=this.downTargets.indexOf(t)&&t.stage)break;t=t.parent?t.parent.$owner:null}return this.downTargets.length=0,t}}function gt(t,e,i){t=t||j.scene;let s=T.borrow();s._type=e,s.data=i;let h=s._callChain;t.traverseVisible(t=>{let e=t.$owner;e&&h.push(e)}),h.forEach(t=>{let i=t._listeners[e];i&&(i.captures.length>0&&t._dispatch(i,s,!0),i.callbacks.length>0&&t._dispatch(i,s,!1))}),h.length=0,T.returns(s)}function pt(t,e,i,s){t=t||j.scene;let h=T.borrow();h._type=e,h.data=i,h._initiator=t.$owner;let r=h._callChain;h.initiator&&r.push(h.initiator),t.traverseAncestors(t=>{let e=t.$owner;e&&r.push(e)});for(let t=r.length-1;t>=0;t--){let i=r[t],s=i._listeners[e];s&&s.captures.length>0&&(i._dispatch(s,h,!0),h._touchCapture&&(h._touchCapture=!1,"touch_begin"==e&&j.addTouchMonitor(h.input.touchId,i)))}if(!h._stopsPropagation){for(let t=0;t<r.length;t++){let i=r[t],s=i._listeners[e];if(s&&s.callbacks.length>0&&(i._dispatch(s,h,!1),h._touchCapture&&(h._touchCapture=!1,"touch_begin"==e&&j.addTouchMonitor(h.input.touchId,i)),h._stopsPropagation))break}if(s)for(let t=0;t<s.length;t++){let i=s[t];if(i&&-1==r.indexOf(i)){let t=i._listeners[e];t&&(t.captures.length>0&&i._dispatch(t,h,!0),t.callbacks.length>0&&i._dispatch(t,h,!1))}}}r.length=0,T.returns(h)}class ft extends I{constructor(){super(),this._obj3D=new e.Object3D,this._obj3D.isGroup=!0,this._obj3D.$owner=this,this._obj3D.layers.set(F),this._pos=this._obj3D.position,this._rot=this._obj3D.rotation,this._pivot=new e.Vector2,this._pivotOffset=new e.Vector3,this._contentRect=new P,this._alpha=1,this._touchable=!0}get obj3D(){return this._obj3D}get name(){return this._obj3D.name}set name(t){this._obj3D.name=t}get x(){return this._pos.x}set x(t){this.setPosition(t,-this._pos.y,this._pos.z)}get y(){return-this._pos.y}set y(t){this.setPosition(this._pos.x,t,this._pos.z)}get z(){return this._pos.z}set z(t){this.setPosition(this._pos.x,-this._pos.y,t)}setPosition(t,e,i,s){i=i||0,s&&(t-=this._pivotOffset.x,e+=this._pivotOffset.y,i-=this._pivotOffset.z),this._matrixDirty=!0,this._pos.set(t,-e,i)}get width(){return this.ensureSizeCorrect(),this._contentRect.width}set width(t){this._contentRect.width!=t&&(this._contentRect.width=t,this.onSizeChanged())}get height(){return this.ensureSizeCorrect(),this._contentRect.height}set height(t){this._contentRect.height!=t&&(this._contentRect.height=t,this.onSizeChanged())}setSize(t,e){t==this._contentRect.width&&e==this._contentRect.height||(this._contentRect.width=t,this._contentRect.height=e,this.onSizeChanged())}ensureSizeCorrect(){}onSizeChanged(){this.applyPivot(),this._graphics&&this._graphics.setDrawRect(this._contentRect)}get pivotX(){return this._pivot.x}set pivotX(t){this.setPivot(t,this._pivot.y)}get pivotY(){return this._pivot.y}set pivotY(t){this.setPosition(this._pivot.x,t)}setPivot(t,e){if(this._pivot.x!=t||this._pivot.y!=e){let i=(t-this._pivot.x)*this._contentRect.width,s=(this._pivot.y-e)*this._contentRect.height;mt.copy(this._pivotOffset),this._pivot.set(t,e),this.updatePivotOffset(),this._pos.x+=mt.x-this._pivotOffset.x+i,this._pos.y+=mt.y-this._pivotOffset.y+s,this._pos.y+=mt.z-this._pivotOffset.z,this._matrixDirty=!0}}updatePivotOffset(){let t=this._pivot.x*this._contentRect.width,e=this._pivot.y*this._contentRect.height;Ct.setFromEuler(this._rot),bt.compose(yt,Ct,this._obj3D.scale),this._pivotOffset.set(t,-e,0),this._pivotOffset.applyMatrix4(bt)}applyPivot(){0==this._pivot.x&&0==this._pivot.y||(mt.copy(this._pivotOffset),this.updatePivotOffset(),this._pos.x+=mt.x-this._pivotOffset.x,this._pos.y+=mt.y-this._pivotOffset.y,this._matrixDirty=!0)}get scaleX(){return this._obj3D.scale.x}set scaleX(t){this.setScale(t,this._obj3D.scale.y)}get scaleY(){return this._obj3D.scale.y}set scaleY(t){this.setScale(this._obj3D.scale.x,t)}setScale(t,e){this._obj3D.scale.set(t,e,t),this.applyPivot(),this._matrixDirty=!0}get rotationX(){return 180*this._rot.x/Math.PI}set rotationX(t){this._rot.x=t*Math.PI/180,this.applyPivot(),this._matrixDirty=!0}get rotationY(){return 180*this._rot.y/Math.PI}set rotationY(t){this._rot.y=t*Math.PI/180,this.applyPivot(),this._matrixDirty=!0}get rotation(){return 180*-this._rot.z/Math.PI}set rotation(t){this._rot.z=-t*Math.PI/180,this.applyPivot(),this._matrixDirty=!0}get parent(){return this._obj3D.parent}get stage(){let t=this._obj3D;for(;t.parent;)t=t.parent;return t.isScene}get graphics(){return this._graphics}get alpha(){return this._alpha}set alpha(t){this._alpha=t}get touchable(){return this._touchable}set touchable(t){this._touchable=t}get visible(){return this._obj3D.visible}set visible(t){this._obj3D.visible=t}get color(){return this._graphics?this._graphics.color:0}set color(t){this._graphics&&(this._graphics.color=t)}get blendMode(){return this._graphics?this._graphics.material.blending:e.NormalBlending}set blendMode(t){this._graphics&&(this._graphics.material.blending=t)}setLayer(t){this._obj3D.traverse(e=>e.layers.set(t))}validateMatrix(){this._obj3D.traverseAncestors(t=>{let e=t.$owner;e&&e._matrixDirty&&(e._matrixDirty=!1,e._obj3D.updateMatrixWorld(!0))}),this._matrixDirty&&(this._matrixDirty=!1,this._obj3D.updateMatrixWorld(!0))}_getRenderCamera(){let t=this._obj3D;for(;t;){let e=t.$owner;if(e&&e.camera)return e.camera;t=t.parent}return j.camera}worldToLocal(t,e,i){if(i&&this.validateMatrix(),0!=(t=this._obj3D.worldToLocal(t)).z){St.copy(e||Tt),St.applyQuaternion(this._obj3D.getWorldQuaternion(Ct).inverse()).normalize();let i=-t.dot(Tt)/St.dot(Tt);t.add(St.multiplyScalar(i))}return t.y=-t.y,t}localToWorld(t,e){return e&&this.validateMatrix(),t.y=-t.y,t=this._obj3D.localToWorld(t)}globalToLocal(t,i,s){return j.disableMatrixValidation||this.validateMatrix(),dt(this._getRenderCamera(),t,i,mt,St),this.worldToLocal(mt,St),s||(s=new e.Vector2),s.set(mt.x,mt.y),s}localToGlobal(t,i,s){var h,r,a;return j.disableMatrixValidation||this.validateMatrix(),mt.set(t,-i,0),this._obj3D.localToWorld(mt),s||(s=new e.Vector2),h=this._getRenderCamera(),r=mt,a=s,_t.copy(r),_t.project(h),a.set((_t.x+1)/2*X,(1-_t.y)/2*Q),s}getBounds(t,e){return this.ensureSizeCorrect(),e||(e=new P),t==this._obj3D?e.copy(this._contentRect):t==this._obj3D.parent&&0==this._rot.z?e.set(this._pos.x,-this._pos.y,this._contentRect.width*this._obj3D.scale.x,this._contentRect.height*this._obj3D.scale.y):e=this.transformRect(this._contentRect,t,e),e}transformPoint(t,i,s,h){return h||(h=new e.Vector2),s==this._obj3D?h.set(t,i):(j.disableMatrixValidation||this.validateMatrix(),mt.set(t,-i,0),this._obj3D.localToWorld(mt),s&&s.worldToLocal(mt),h.set(mt.x,-mt.y)),h}transformRect(t,e,i){if(i||(i=new P),e==this._obj3D)return i.copy(t),i;if(e&&e==this._obj3D.parent&&0==this._rot.z){let e=this._obj3D.scale;i.set((this._pos.x+t.x)*e.x,(this.y+t.y)*e.y,t.width*e.x,t.height*e.y)}else wt.set(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),j.disableMatrixValidation||this.validateMatrix(),this.transformRectPoint(t.x,t.y,e),this.transformRectPoint(t.xMax,t.y,e),this.transformRectPoint(t.x,t.yMax,e),this.transformRectPoint(t.xMax,t.yMax,e),i.setMinMax(wt.x,wt.y,wt.z,wt.w);return i}transformRectPoint(t,e,i){mt.set(t,e,0),this.localToWorld(mt),i&&i.worldToLocal(mt),wt.x>mt.x&&(wt.x=mt.x),wt.z<mt.x&&(wt.z=mt.x),wt.y>mt.y&&(wt.y=mt.y),wt.w<mt.y&&(wt.w=mt.y)}addChild(t){this.addChildAt(t,Number.POSITIVE_INFINITY)}addChildAt(t,e){if(t._obj3D.parent){let e=t._obj3D.parent.children.indexOf(t._obj3D);t._obj3D.parent.children.splice(e,1)}e>=this._obj3D.children.length?this._obj3D.children.push(t._obj3D):this._obj3D.children.splice(e,0,t._obj3D),t._obj3D.parent=this._obj3D,t._obj3D.layers.mask=this._obj3D.layers.mask,this.stage&&gt(t.obj3D,"added_to_stage")}removeChild(t){let e=this._obj3D.children.indexOf(t._obj3D);if(-1==e)throw"not a child";this.removeChildAt(e)}removeChildAt(t){let e=this._obj3D.children[t];this.stage&&gt(e,"removed_from_stage"),this._obj3D.children.splice(t,1),e.parent=null}setChildIndex(t,e){let i=this._obj3D.children.indexOf(t._obj3D);if(i!=e){if(-1==i)throw"Not a child";this._obj3D.children.splice(i,1),e>=this._obj3D.children.length?this._obj3D.children.push(t._obj3D):this._obj3D.children.splice(e,0,t._obj3D)}}getIndex(t){return this._obj3D.children.indexOf(t._obj3D)}get numChildren(){return this._obj3D.children.length}get clipRect(){return this._clipRect}set clipRect(t){this._clipRect=t}update(t,i){this._clipRect&&(this.transformRect(this._clipRect,null,xt),t&&(vt.setMinMax(-t[0].constant,-t[3].constant,t[1].constant,t[2].constant),xt.intersection(vt)),this._clipPlanes||(this._clipPlanes=[new e.Plane(new e.Vector3(1,0,0)),new e.Plane(new e.Vector3(-1,0,0)),new e.Plane(new e.Vector3(0,-1,0)),new e.Plane(new e.Vector3(0,1,0))]),(t=this._clipPlanes)[0].constant=-xt.x,t[1].constant=xt.xMax,t[2].constant=xt.yMax,t[3].constant=-xt.y),this._graphics&&this._graphics.update(t,this._alpha*i)}hitTest(t){if(0==this._obj3D.scale.x||0==this._obj3D.scale.y)return null;let e,i;this.camera&&(e=t.ray,t.camera=this.camera);let s=t.getLocal(this),h=s.x,r=s.y;if(this.hitArea){if(!this.hitArea.hitTest(this._contentRect,h,r))return null}else if(this._clipRect&&!this._clipRect.contains(h,r))return null;if(this.mask){let e=this.mask.visible?this.mask.hitTest(t):null;if(!this.reversedMask&&!e||this.reversedMask&&e)return null}return i=It(this._obj3D,t,this.mask),!i&&this.opaque&&(this.hitArea||this._contentRect.contains(h,r))&&(i=this),e&&(t.ray=e),i}dispose(){}}var mt=new e.Vector3,yt=new e.Vector3,wt=new e.Vector4,xt=new P,vt=new P,bt=new e.Matrix4,Ct=new e.Quaternion,St=new e.Vector3;const Tt=new e.Vector3(0,0,1);function It(t,e,i){for(let s=t.children.length-1;s>=0;--s){let h=t.children[s];if(!h.visible)continue;let r=h.$owner;if(r){if(r==i||r._touchDisabled)continue;if(!e.forTouch||r._touchable){let t=r.hitTest(e);if(t)return t}}if(h.children.length>0){let t=It(h,e);if(t)return t}}}var Pt;(Pt=t.EaseType||(t.EaseType={}))[Pt.Linear=0]="Linear",Pt[Pt.SineIn=1]="SineIn",Pt[Pt.SineOut=2]="SineOut",Pt[Pt.SineInOut=3]="SineInOut",Pt[Pt.QuadIn=4]="QuadIn",Pt[Pt.QuadOut=5]="QuadOut",Pt[Pt.QuadInOut=6]="QuadInOut",Pt[Pt.CubicIn=7]="CubicIn",Pt[Pt.CubicOut=8]="CubicOut",Pt[Pt.CubicInOut=9]="CubicInOut",Pt[Pt.QuartIn=10]="QuartIn",Pt[Pt.QuartOut=11]="QuartOut",Pt[Pt.QuartInOut=12]="QuartInOut",Pt[Pt.QuintIn=13]="QuintIn",Pt[Pt.QuintOut=14]="QuintOut",Pt[Pt.QuintInOut=15]="QuintInOut",Pt[Pt.ExpoIn=16]="ExpoIn",Pt[Pt.ExpoOut=17]="ExpoOut",Pt[Pt.ExpoInOut=18]="ExpoInOut",Pt[Pt.CircIn=19]="CircIn",Pt[Pt.CircOut=20]="CircOut",Pt[Pt.CircInOut=21]="CircInOut",Pt[Pt.ElasticIn=22]="ElasticIn",Pt[Pt.ElasticOut=23]="ElasticOut",Pt[Pt.ElasticInOut=24]="ElasticInOut",Pt[Pt.BackIn=25]="BackIn",Pt[Pt.BackOut=26]="BackOut",Pt[Pt.BackInOut=27]="BackInOut",Pt[Pt.BounceIn=28]="BounceIn",Pt[Pt.BounceOut=29]="BounceOut",Pt[Pt.BounceInOut=30]="BounceInOut",Pt[Pt.Custom=31]="Custom";class kt{dispose(){this._tweenConfig&&this._tweenConfig._tweener&&(this._tweenConfig._tweener.kill(),this._tweenConfig._tweener=null)}get controller(){return this._controller}set controller(t){t!=this._controller&&(this._controller=t,this._controller&&this.init())}get tweenConfig(){return this._tweenConfig||(this._tweenConfig=new Mt),this._tweenConfig}get allowTween(){return this._tweenConfig&&this._tweenConfig.tween&&0==re.n&&!kt.disableAllTweenEffect}setup(t){var e,i;this._controller=this._owner.parent.getControllerAt(t.readShort()),this.init();var s=t.readShort();if("pages"in this)this.pages=t.readSArray(s);else{for(e=0;e<s;e++)null!=(i=t.readS())&&this.addStatus(i,t);t.readBool()&&this.addStatus(null,t)}if(t.readBool()&&(this._tweenConfig=new Mt,this._tweenConfig.easeType=t.readByte(),this._tweenConfig.duration=t.readFloat(),this._tweenConfig.delay=t.readFloat()),t.version>=2)if("positionsInPercent"in this){if(t.readBool()){for(this.positionsInPercent=!0,e=0;e<s;e++)null!=(i=t.readS())&&this.addExtStatus(i,t);t.readBool()&&this.addExtStatus(null,t)}}else"condition"in this&&(this.condition=t.readByte())}updateFromRelations(t,e){}addStatus(t,e){}init(){}apply(){}updateState(){}}class Mt{constructor(){this.tween=!0,this.easeType=t.EaseType.QuadOut,this.duration=.3,this.delay=0}}class Ot{constructor(){this.x=this.y=this.z=this.w=0}get color(){return(this.w<<24)+(this.x<<16)+(this.y<<8)+this.z}set color(t){this.x=(16711680&t)>>16,this.y=(65280&t)>>8,this.z=255&t,this.w=(4278190080&t)>>24}getField(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("Index out of bounds: "+t)}}setField(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("Index out of bounds: "+t)}}setZero(){this.x=this.y=this.z=this.w=0}}const zt=.5*Math.PI,Lt=2*Math.PI;function Bt(e,i,s,h,r){switch(e){case t.EaseType.Linear:return i/s;case t.EaseType.SineIn:return 1-Math.cos(i/s*zt);case t.EaseType.SineOut:return Math.sin(i/s*zt);case t.EaseType.SineInOut:return-.5*(Math.cos(Math.PI*i/s)-1);case t.EaseType.QuadIn:return(i/=s)*i;case t.EaseType.QuadOut:return-(i/=s)*(i-2);case t.EaseType.QuadInOut:return(i/=.5*s)<1?.5*i*i:-.5*(--i*(i-2)-1);case t.EaseType.CubicIn:return(i/=s)*i*i;case t.EaseType.CubicOut:return(i=i/s-1)*i*i+1;case t.EaseType.CubicInOut:return(i/=.5*s)<1?.5*i*i*i:.5*((i-=2)*i*i+2);case t.EaseType.QuartIn:return(i/=s)*i*i*i;case t.EaseType.QuartOut:return-((i=i/s-1)*i*i*i-1);case t.EaseType.QuartInOut:return(i/=.5*s)<1?.5*i*i*i*i:-.5*((i-=2)*i*i*i-2);case t.EaseType.QuintIn:return(i/=s)*i*i*i*i;case t.EaseType.QuintOut:return(i=i/s-1)*i*i*i*i+1;case t.EaseType.QuintInOut:return(i/=.5*s)<1?.5*i*i*i*i*i:.5*((i-=2)*i*i*i*i+2);case t.EaseType.ExpoIn:return 0==i?0:Math.pow(2,10*(i/s-1));case t.EaseType.ExpoOut:return i==s?1:1-Math.pow(2,-10*i/s);case t.EaseType.ExpoInOut:return 0==i?0:i==s?1:(i/=.5*s)<1?.5*Math.pow(2,10*(i-1)):.5*(2-Math.pow(2,-10*--i));case t.EaseType.CircIn:return-(Math.sqrt(1-(i/=s)*i)-1);case t.EaseType.CircOut:return Math.sqrt(1-(i=i/s-1)*i);case t.EaseType.CircInOut:return(i/=.5*s)<1?-.5*(Math.sqrt(1-i*i)-1):.5*(Math.sqrt(1-(i-=2)*i)+1);case t.EaseType.ElasticIn:var a;return 0==i?0:1==(i/=s)?1:(0==r&&(r=.3*s),h<1?(h=1,a=r/4):a=r/Lt*Math.asin(1/h),-h*Math.pow(2,10*(i-=1))*Math.sin((i*s-a)*Lt/r));case t.EaseType.ElasticOut:var n;return 0==i?0:1==(i/=s)?1:(0==r&&(r=.3*s),h<1?(h=1,n=r/4):n=r/Lt*Math.asin(1/h),h*Math.pow(2,-10*i)*Math.sin((i*s-n)*Lt/r)+1);case t.EaseType.ElasticInOut:var o;return 0==i?0:2==(i/=.5*s)?1:(0==r&&(r=s*(.3*1.5)),h<1?(h=1,o=r/4):o=r/Lt*Math.asin(1/h),i<1?h*Math.pow(2,10*(i-=1))*Math.sin((i*s-o)*Lt/r)*-.5:h*Math.pow(2,-10*(i-=1))*Math.sin((i*s-o)*Lt/r)*.5+1);case t.EaseType.BackIn:return(i/=s)*i*((h+1)*i-h);case t.EaseType.BackOut:return(i=i/s-1)*i*((h+1)*i+h)+1;case t.EaseType.BackInOut:return(i/=.5*s)<1?i*i*((1+(h*=1.525))*i-h)*.5:.5*((i-=2)*i*((1+(h*=1.525))*i+h)+2);case t.EaseType.BounceIn:return Ft(i,s);case t.EaseType.BounceOut:return jt(i,s);case t.EaseType.BounceInOut:return function(t,e){if(t<.5*e)return.5*Ft(2*t,e);return.5*jt(2*t-e,e)+.5}(i,s);default:return-(i/=s)*(i-2)}}function Ft(t,e){return 1-jt(e-t,e)}function jt(t,e){return(t/=e)<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}var Rt=new e.Vector2;class At{constructor(){this._startValue=new Ot,this._endValue=new Ot,this._value=new Ot,this._deltaValue=new Ot,this._reset()}setDelay(t){return this._delay=t,this}get delay(){return this._delay}setDuration(t){return this._duration=t,this}get duration(){return this._duration}setBreakpoint(t){return this._breakpoint=t,this}setEase(t){return this._easeType=t,this}setEasePeriod(t){return this._easePeriod=t,this}setEaseOvershootOrAmplitude(t){return this._easeOvershootOrAmplitude=t,this}setRepeat(t,e){return this._repeat=t,this._yoyo=e,this}get repeat(){return this._repeat}setTimeScale(t){return this._timeScale=t,this}setSnapping(t){return this._snapping=t,this}setTarget(t,e){return this._target=t,this._propType=e,this}get target(){return this._target}setPath(t){return this._path=t,this}setUserData(t){return this._userData=t,this}get userData(){return this._userData}onUpdate(t,e){return this._onUpdate=t,this._onUpdateCaller=e,this}onStart(t,e){return this._onStart=t,this._onStartCaller=e,this}onComplete(t,e){return this._onComplete=t,this._onCompleteCaller=e,this}get startValue(){return this._startValue}get endValue(){return this._endValue}get value(){return this._value}get deltaValue(){return this._deltaValue}get normalizedTime(){return this._normalizedTime}get completed(){return 0!=this._ended}get allCompleted(){return 1==this._ended}setPaused(t){return this._paused=t,this}seek(t){if(!this._killed){if(this._elapsedTime=t,this._elapsedTime<this._delay){if(!this._started)return;this._elapsedTime=this._delay}this.update()}}kill(t){this._killed||(t&&(0==this._ended&&(this._breakpoint>=0?this._elapsedTime=this._delay+this._breakpoint:this._repeat>=0?this._elapsedTime=this._delay+this._duration*(this._repeat+1):this._elapsedTime=this._delay+2*this._duration,this.update()),this.callCompleteCallback()),this._killed=!0)}_to(t,e,i){return this._valueSize=1,this._startValue.x=t,this._endValue.x=e,this._value.x=t,this._duration=i,this}_to2(t,e,i,s,h){return this._valueSize=2,this._startValue.x=t,this._endValue.x=i,this._startValue.y=e,this._endValue.y=s,this._value.x=t,this._value.y=e,this._duration=h,this}_to3(t,e,i,s,h,r,a){return this._valueSize=3,this._startValue.x=t,this._endValue.x=s,this._startValue.y=e,this._endValue.y=h,this._startValue.z=i,this._endValue.z=r,this._value.x=t,this._value.y=e,this._value.z=i,this._duration=a,this}_to4(t,e,i,s,h,r,a,n,o){return this._valueSize=4,this._startValue.x=t,this._endValue.x=h,this._startValue.y=e,this._endValue.y=r,this._startValue.z=i,this._endValue.z=a,this._startValue.w=s,this._endValue.w=n,this._value.x=t,this._value.y=e,this._value.z=i,this._value.w=s,this._duration=o,this}_toColor(t,e,i){return this._valueSize=4,this._startValue.color=t,this._endValue.color=e,this._value.color=t,this._duration=i,this}_shake(t,e,i,s){return this._valueSize=5,this._startValue.x=t,this._startValue.y=e,this._startValue.w=i,this._duration=s,this}_init(){this._delay=0,this._duration=0,this._breakpoint=-1,this._easeType=t.EaseType.QuadOut,this._timeScale=1,this._easePeriod=0,this._easeOvershootOrAmplitude=1.70158,this._snapping=!1,this._repeat=0,this._yoyo=!1,this._valueSize=0,this._started=!1,this._paused=!1,this._killed=!1,this._elapsedTime=0,this._normalizedTime=0,this._ended=0}_reset(){this._target=null,this._propType=null,this._userData=null,this._path=null,this._onStart=this._onUpdate=this._onComplete=null,this._onStartCaller=this._onUpdateCaller=this._onCompleteCaller=null}_update(t){if(1!=this._timeScale&&(t*=this._timeScale),0!=t){if(0!=this._ended)return this.callCompleteCallback(),void(this._killed=!0);this._elapsedTime+=t,this.update(),0!=this._ended&&(this._killed||(this.callCompleteCallback(),this._killed=!0))}}update(){if(this._ended=0,0!=this._valueSize){if(!this._started){if(this._elapsedTime<this._delay)return;if(this._started=!0,this.callStartCallback(),this._killed)return}var t=!1,e=this._elapsedTime-this._delay;if(this._breakpoint>=0&&e>=this._breakpoint&&(e=this._breakpoint,this._ended=2),0!=this._repeat){var i=Math.floor(e/this._duration);e-=this._duration*i,this._yoyo&&(t=i%2==1),this._repeat>0&&this._repeat-i<0&&(this._yoyo&&(t=this._repeat%2==1),e=this._duration,this._ended=1)}else e>=this._duration&&(e=this._duration,this._ended=1);if(this._normalizedTime=Bt(this._easeType,t?this._duration-e:e,this._duration,this._easeOvershootOrAmplitude,this._easePeriod),this._value.setZero(),this._deltaValue.setZero(),5==this._valueSize)if(0==this._ended){var s=this._startValue.w*(1-this._normalizedTime),h=s*(Math.random()>.5?1:-1),r=s*(Math.random()>.5?1:-1);this._deltaValue.x=h,this._deltaValue.y=r,this._value.x=this._startValue.x+h,this._value.y=this._startValue.y+r}else this._value.x=this._startValue.x,this._value.y=this._startValue.y;else if(this._path){let t=this._path.getPointAt(this._normalizedTime,Rt);this._snapping&&(t.x=Math.round(t.x),t.y=Math.round(t.y)),this._deltaValue.x=t.x-this._value.x,this._deltaValue.y=t.y-this._value.y,this._value.x=t.x,this._value.y=t.y}else for(var a=0;a<this._valueSize;a++){var n=this._startValue.getField(a),o=n+(this._endValue.getField(a)-n)*this._normalizedTime;this._snapping&&(o=Math.round(o)),this._deltaValue.setField(a,o-this._value.getField(a)),this._value.setField(a,o)}if(this._target&&this._propType)if(this._propType instanceof Function)switch(this._valueSize){case 1:this._propType.call(this._target,this._value.x);break;case 2:this._propType.call(this._target,this._value.x,this._value.y);break;case 3:this._propType.call(this._target,this._value.x,this._value.y,this._value.z);break;case 4:this._propType.call(this._target,this._value.x,this._value.y,this._value.z,this._value.w);break;case 5:this._propType.call(this._target,this._value.color);break;case 6:this._propType.call(this._target,this._value.x,this._value.y)}else 5==this._valueSize?this._target[this._propType]=this._value.color:this._target[this._propType]=this._value.x;this.callUpdateCallback()}else this._elapsedTime>=this._delay+this._duration&&(this._ended=1)}callStartCallback(){if(this._onStart)try{this._onStart.call(this._onStartCaller,this)}catch(t){console.log("error in start callback > "+t)}}callUpdateCallback(){if(this._onUpdate)try{this._onUpdate.call(this._onUpdateCaller,this)}catch(t){console.log("error in update callback > "+t)}}callCompleteCallback(){if(this._onComplete)try{this._onComplete.call(this._onCompleteCaller,this)}catch(t){console.log("error in complete callback > "+t)}}}class Dt{static createTween(){Ht||(k.addUpdate(Dt.update),Ht=!0);var t=Et.borrow();return Vt[Wt++]=t,t}static isTweening(t,e){if(null==t)return!1;for(var i=!e,s=0;s<Wt;s++){var h=Vt[s];if(h&&h.target==t&&!h._killed&&(i||h._propType==e))return!0}return!1}static killTweens(t,e,i){if(null==t)return!1;for(var s=!1,h=Wt,r=!i,a=0;a<h;a++){var n=Vt[a];!n||n.target!=t||n._killed||!r&&n._propType!=i||(n.kill(e),s=!0)}return s}static getTween(t,e){if(null==t)return null;for(var i=Wt,s=!e,h=0;h<i;h++){var r=Vt[h];if(r&&r.target==t&&!r._killed&&(s||r._propType==e))return r}return null}static update(){for(var t=k.deltaTime/1e3,e=Wt,i=-1,s=0;s<e;s++){var h=Vt[s];null==h?-1==i&&(i=s):h._killed?(Et.returns(h),Vt[s]=null,-1==i&&(i=s)):(h._target&&"isDisposed"in h._target&&h._target.isDisposed?h._killed=!0:h._paused||h._update(t),-1!=i&&(Vt[i]=h,Vt[s]=null,i++))}if(i>=0){if(Wt!=e){var r=e;for(e=Wt-e,s=0;s<e;s++)Vt[i++]=Vt[r++]}Wt=i}}}var Vt=new Array,Et=new b(At,t=>t._init(),t=>t._reset()),Wt=0,Ht=!1;class Nt{static to(t,e,i){return Dt.createTween()._to(t,e,i)}static to2(t,e,i,s,h){return Dt.createTween()._to2(t,e,i,s,h)}static to3(t,e,i,s,h,r,a){return Dt.createTween()._to3(t,e,i,s,h,r,a)}static to4(t,e,i,s,h,r,a,n,o){return Dt.createTween()._to4(t,e,i,s,h,r,a,n,o)}static toColor(t,e,i){return Dt.createTween()._toColor(t,e,i)}static delayedCall(t){return Dt.createTween().setDelay(t)}static shake(t,e,i,s){return Dt.createTween()._shake(t,e,i,s)}static isTweening(t,e){return Dt.isTweening(t,e)}static kill(t,e,i){Dt.killTweens(t,e,i)}static getTween(t,e){return Dt.getTween(t,e)}}Nt.catchCallbackExceptions=!0;class Gt{constructor(t){this._owner=t,this._defs=new Array}get owner(){return this._owner}set target(t){this._target!=t&&(this._target&&this.releaseRefTarget(),this._target=t,this._target&&this.addRefTarget())}get target(){return this._target}add(e,i){if(e==t.RelationType.Size)return this.add(t.RelationType.Width,i),void this.add(t.RelationType.Height,i);for(var s=this._defs.length,h=0;h<s;h++)if(this._defs[h].type==e)return;this.internalAdd(e,i)}internalAdd(e,i){if(e==t.RelationType.Size)return this.internalAdd(t.RelationType.Width,i),void this.internalAdd(t.RelationType.Height,i);var s=new Ut;s.percent=i,s.type=e,s.axis=e<=t.RelationType.Right_Right||e==t.RelationType.Width||e>=t.RelationType.LeftExt_Left&&e<=t.RelationType.RightExt_Right?0:1,this._defs.push(s)}remove(e){if(e==t.RelationType.Size)return this.remove(t.RelationType.Width),void this.remove(t.RelationType.Height);for(var i=this._defs.length,s=0;s<i;s++)if(this._defs[s].type==e){this._defs.splice(s,1);break}}copy(t){this._target=t.target,this._defs.length=0;for(var e=t._defs.length,i=0;i<e;i++){var s=t._defs[i],h=new Ut;h.copy(s),this._defs.push(h)}}dispose(){this._target&&(this.releaseRefTarget(),this._target=null)}get isEmpty(){return 0==this._defs.length}applyOnSelfResized(e,i,s){var h=this._defs.length;if(0!=h){for(var r=this._owner.x,a=this._owner.y,n=0;n<h;n++){switch(this._defs[n].type){case t.RelationType.Center_Center:this._owner.x-=(.5-(s?this._owner.pivotX:0))*e;break;case t.RelationType.Right_Center:case t.RelationType.Right_Left:case t.RelationType.Right_Right:this._owner.x-=(1-(s?this._owner.pivotX:0))*e;break;case t.RelationType.Middle_Middle:this._owner.y-=(.5-(s?this._owner.pivotY:0))*i;break;case t.RelationType.Bottom_Middle:case t.RelationType.Bottom_Top:case t.RelationType.Bottom_Bottom:this._owner.y-=(1-(s?this._owner.pivotY:0))*i}}if((r!=this._owner.x||a!=this._owner.y)&&(r=this._owner.x-r,a=this._owner.y-a,this._owner.updateGearFromRelations(1,r,a),this._owner.parent&&this._owner.parent._transitions.length>0)){h=this._owner.parent._transitions.length;for(var o=0;o<h;o++){this._owner.parent._transitions[o].updateFromRelations(this._owner.id,r,a)}}}}applyOnXYChanged(e,i,s){var h;switch(e.type){case t.RelationType.Left_Left:case t.RelationType.Left_Center:case t.RelationType.Left_Right:case t.RelationType.Center_Center:case t.RelationType.Right_Left:case t.RelationType.Right_Center:case t.RelationType.Right_Right:this._owner.x+=i;break;case t.RelationType.Top_Top:case t.RelationType.Top_Middle:case t.RelationType.Top_Bottom:case t.RelationType.Middle_Middle:case t.RelationType.Bottom_Top:case t.RelationType.Bottom_Middle:case t.RelationType.Bottom_Bottom:this._owner.y+=s;break;case t.RelationType.Width:case t.RelationType.Height:break;case t.RelationType.LeftExt_Left:case t.RelationType.LeftExt_Right:this._owner!=this._target.parent?(h=this._owner.xMin,this._owner.width=this._owner._rawWidth-i,this._owner.xMin=h+i):this._owner.width=this._owner._rawWidth-i;break;case t.RelationType.RightExt_Left:case t.RelationType.RightExt_Right:this._owner!=this._target.parent?(h=this._owner.xMin,this._owner.width=this._owner._rawWidth+i,this._owner.xMin=h):this._owner.width=this._owner._rawWidth+i;break;case t.RelationType.TopExt_Top:case t.RelationType.TopExt_Bottom:this._owner!=this._target.parent?(h=this._owner.yMin,this._owner.height=this._owner._rawHeight-s,this._owner.yMin=h+s):this._owner.height=this._owner._rawHeight-s;break;case t.RelationType.BottomExt_Top:case t.RelationType.BottomExt_Bottom:this._owner!=this._target.parent?(h=this._owner.yMin,this._owner.height=this._owner._rawHeight+s,this._owner.yMin=h):this._owner.height=this._owner._rawHeight+s}}applyOnSizeChanged(e){var i,s,h=0,r=0,a=0;switch(0==e.axis?(this._target!=this._owner.parent&&(h=this._target.x,this._target.pivotAsAnchor&&(r=this._target.pivotX)),e.percent?0!=this._targetWidth&&(a=this._target._width/this._targetWidth):a=this._target._width-this._targetWidth):(this._target!=this._owner.parent&&(h=this._target.y,this._target.pivotAsAnchor&&(r=this._target.pivotY)),e.percent?0!=this._targetHeight&&(a=this._target._height/this._targetHeight):a=this._target._height-this._targetHeight),e.type){case t.RelationType.Left_Left:e.percent?this._owner.xMin=h+(this._owner.xMin-h)*a:0!=r&&(this._owner.x+=a*-r);break;case t.RelationType.Left_Center:e.percent?this._owner.xMin=h+(this._owner.xMin-h)*a:this._owner.x+=a*(.5-r);break;case t.RelationType.Left_Right:e.percent?this._owner.xMin=h+(this._owner.xMin-h)*a:this._owner.x+=a*(1-r);break;case t.RelationType.Center_Center:e.percent?this._owner.xMin=h+(this._owner.xMin+.5*this._owner._rawWidth-h)*a-.5*this._owner._rawWidth:this._owner.x+=a*(.5-r);break;case t.RelationType.Right_Left:e.percent?this._owner.xMin=h+(this._owner.xMin+this._owner._rawWidth-h)*a-this._owner._rawWidth:0!=r&&(this._owner.x+=a*-r);break;case t.RelationType.Right_Center:e.percent?this._owner.xMin=h+(this._owner.xMin+this._owner._rawWidth-h)*a-this._owner._rawWidth:this._owner.x+=a*(.5-r);break;case t.RelationType.Right_Right:e.percent?this._owner.xMin=h+(this._owner.xMin+this._owner._rawWidth-h)*a-this._owner._rawWidth:this._owner.x+=a*(1-r);break;case t.RelationType.Top_Top:e.percent?this._owner.yMin=h+(this._owner.yMin-h)*a:0!=r&&(this._owner.y+=a*-r);break;case t.RelationType.Top_Middle:e.percent?this._owner.yMin=h+(this._owner.yMin-h)*a:this._owner.y+=a*(.5-r);break;case t.RelationType.Top_Bottom:e.percent?this._owner.yMin=h+(this._owner.yMin-h)*a:this._owner.y+=a*(1-r);break;case t.RelationType.Middle_Middle:e.percent?this._owner.yMin=h+(this._owner.yMin+.5*this._owner._rawHeight-h)*a-.5*this._owner._rawHeight:this._owner.y+=a*(.5-r);break;case t.RelationType.Bottom_Top:e.percent?this._owner.yMin=h+(this._owner.yMin+this._owner._rawHeight-h)*a-this._owner._rawHeight:0!=r&&(this._owner.y+=a*-r);break;case t.RelationType.Bottom_Middle:e.percent?this._owner.yMin=h+(this._owner.yMin+this._owner._rawHeight-h)*a-this._owner._rawHeight:this._owner.y+=a*(.5-r);break;case t.RelationType.Bottom_Bottom:e.percent?this._owner.yMin=h+(this._owner.yMin+this._owner._rawHeight-h)*a-this._owner._rawHeight:this._owner.y+=a*(1-r);break;case t.RelationType.Width:i=this._owner._underConstruct&&this._owner==this._target.parent?this._owner.sourceWidth-this._target.initWidth:this._owner._rawWidth-this._targetWidth,e.percent&&(i*=a),this._target==this._owner.parent?this._owner.pivotAsAnchor?(s=this._owner.xMin,this._owner.setSize(this._target._width+i,this._owner._rawHeight,!0),this._owner.xMin=s):this._owner.setSize(this._target._width+i,this._owner._rawHeight,!0):this._owner.width=this._target._width+i;break;case t.RelationType.Height:i=this._owner._underConstruct&&this._owner==this._target.parent?this._owner.sourceHeight-this._target.initHeight:this._owner._rawHeight-this._targetHeight,e.percent&&(i*=a),this._target==this._owner.parent?this._owner.pivotAsAnchor?(s=this._owner.yMin,this._owner.setSize(this._owner._rawWidth,this._target._height+i,!0),this._owner.yMin=s):this._owner.setSize(this._owner._rawWidth,this._target._height+i,!0):this._owner.height=this._target._height+i;break;case t.RelationType.LeftExt_Left:s=this._owner.xMin,i=e.percent?h+(s-h)*a-s:a*-r,this._owner.width=this._owner._rawWidth-i,this._owner.xMin=s+i;break;case t.RelationType.LeftExt_Right:s=this._owner.xMin,i=e.percent?h+(s-h)*a-s:a*(1-r),this._owner.width=this._owner._rawWidth-i,this._owner.xMin=s+i;break;case t.RelationType.RightExt_Left:s=this._owner.xMin,i=e.percent?h+(s+this._owner._rawWidth-h)*a-(s+this._owner._rawWidth):a*-r,this._owner.width=this._owner._rawWidth+i,this._owner.xMin=s;break;case t.RelationType.RightExt_Right:s=this._owner.xMin,e.percent?this._owner==this._target.parent?this._owner._underConstruct?this._owner.width=h+this._target._width-this._target._width*r+(this._owner.sourceWidth-h-this._target.initWidth+this._target.initWidth*r)*a:this._owner.width=h+(this._owner._rawWidth-h)*a:(i=h+(s+this._owner._rawWidth-h)*a-(s+this._owner._rawWidth),this._owner.width=this._owner._rawWidth+i,this._owner.xMin=s):this._owner==this._target.parent?this._owner._underConstruct?this._owner.width=this._owner.sourceWidth+(this._target._width-this._target.initWidth)*(1-r):this._owner.width=this._owner._rawWidth+a*(1-r):(i=a*(1-r),this._owner.width=this._owner._rawWidth+i,this._owner.xMin=s);break;case t.RelationType.TopExt_Top:s=this._owner.yMin,i=e.percent?h+(s-h)*a-s:a*-r,this._owner.height=this._owner._rawHeight-i,this._owner.yMin=s+i;break;case t.RelationType.TopExt_Bottom:s=this._owner.yMin,i=e.percent?h+(s-h)*a-s:a*(1-r),this._owner.height=this._owner._rawHeight-i,this._owner.yMin=s+i;break;case t.RelationType.BottomExt_Top:s=this._owner.yMin,i=e.percent?h+(s+this._owner._rawHeight-h)*a-(s+this._owner._rawHeight):a*-r,this._owner.height=this._owner._rawHeight+i,this._owner.yMin=s;break;case t.RelationType.BottomExt_Bottom:s=this._owner.yMin,e.percent?this._owner==this._target.parent?this._owner._underConstruct?this._owner.height=h+this._target._height-this._target._height*r+(this._owner.sourceHeight-h-this._target.initHeight+this._target.initHeight*r)*a:this._owner.height=h+(this._owner._rawHeight-h)*a:(i=h+(s+this._owner._rawHeight-h)*a-(s+this._owner._rawHeight),this._owner.height=this._owner._rawHeight+i,this._owner.yMin=s):this._owner==this._target.parent?this._owner._underConstruct?this._owner.height=this._owner.sourceHeight+(this._target._height-this._target.initHeight)*(1-r):this._owner.height=this._owner._rawHeight+a*(1-r):(i=a*(1-r),this._owner.height=this._owner._rawHeight+i,this._owner.yMin=s)}}addRefTarget(){this._target!=this._owner.parent&&this._target.on("pos_changed",this.__targetXYChanged,this),this._target.on("size_changed",this.__targetSizeChanged,this),this._targetX=this._target.x,this._targetY=this._target.y,this._targetWidth=this._target._width,this._targetHeight=this._target._height}releaseRefTarget(){null!=this._target.displayObject&&(this._target.off("pos_changed",this.__targetXYChanged,this),this._target.off("size_changed",this.__targetSizeChanged,this))}__targetXYChanged(){if(this._owner.relations.handling||this._owner.group&&this._owner.group._updating)return this._targetX=this._target.x,void(this._targetY=this._target.y);this._owner.relations.handling=this._target;for(var t=this._owner.x,e=this._owner.y,i=this._target.x-this._targetX,s=this._target.y-this._targetY,h=this._defs.length,r=0;r<h;r++)this.applyOnXYChanged(this._defs[r],i,s);if(this._targetX=this._target.x,this._targetY=this._target.y,(t!=this._owner.x||e!=this._owner.y)&&(t=this._owner.x-t,e=this._owner.y-e,this._owner.updateGearFromRelations(1,t,e),this._owner.parent&&this._owner.parent._transitions.length>0)){h=this._owner.parent._transitions.length;for(var a=0;a<h;a++){this._owner.parent._transitions[a].updateFromRelations(this._owner.id,t,e)}}this._owner.relations.handling=null}__targetSizeChanged(){if(this._owner.relations.handling)return this._targetWidth=this._target._width,void(this._targetHeight=this._target._height);this._owner.relations.handling=this._target;for(var t=this._owner.x,e=this._owner.y,i=this._owner._rawWidth,s=this._owner._rawHeight,h=this._defs.length,r=0;r<h;r++)this.applyOnSizeChanged(this._defs[r]);if(this._targetWidth=this._target._width,this._targetHeight=this._target._height,(t!=this._owner.x||e!=this._owner.y)&&(t=this._owner.x-t,e=this._owner.y-e,this._owner.updateGearFromRelations(1,t,e),this._owner.parent&&this._owner.parent._transitions.length>0)){h=this._owner.parent._transitions.length;for(var a=0;a<h;a++){this._owner.parent._transitions[a].updateFromRelations(this._owner.id,t,e)}}i==this._owner._rawWidth&&s==this._owner._rawHeight||(i=this._owner._rawWidth-i,s=this._owner._rawHeight-s,this._owner.updateGearFromRelations(2,i,s)),this._owner.relations.handling=null}}class Ut{constructor(){}copy(t){this.percent=t.percent,this.type=t.type,this.axis=t.axis}}class Yt{constructor(t){this._owner=t,this._items=[]}add(t,e,i){for(var s=this._items.length,h=0;h<s;h++){var r=this._items[h];if(r.target==t)return void r.add(e,i)}var a=new Gt(this._owner);a.target=t,a.add(e,i),this._items.push(a)}remove(t,e){e=e||0;for(var i=this._items.length,s=0;s<i;){var h=this._items[s];h.target==t?(h.remove(e),h.isEmpty?(h.dispose(),this._items.splice(s,1),i--):s++):s++}}contains(t){for(var e=this._items.length,i=0;i<e;i++){if(this._items[i].target==t)return!0}return!1}clearFor(t){for(var e=this._items.length,i=0;i<e;){var s=this._items[i];s.target==t?(s.dispose(),this._items.splice(i,1),e--):i++}}clearAll(){for(var t=this._items.length,e=0;e<t;e++){this._items[e].dispose()}this._items.length=0}copyFrom(t){this.clearAll();for(var e=t._items,i=e.length,s=0;s<i;s++){var h=e[s],r=new Gt(this._owner);r.copy(h),this._items.push(r)}}dispose(){this.clearAll()}onOwnerSizeChanged(t,e,i){if(0!=this._items.length)for(var s=this._items.length,h=0;h<s;h++){this._items[h].applyOnSelfResized(t,e,i)}}get empty(){return 0==this._items.length}setup(t,e){for(var i,s=t.readByte(),h=0;h<s;h++){var r=t.readShort();i=-1==r?this._owner.parent:e?this._owner.getChildAt(r):this._owner.parent.getChildAt(r);var a=new Gt(this._owner);a.target=i,this._items.push(a);for(var n=t.readByte(),o=0;o<n;o++){var l=t.readByte(),_=t.readBool();a.internalAdd(l,_)}}}}class Xt extends e.Color{constructor(t,e){super(t||0),this.a=null!=e?e:1}}class Qt{}Qt.defaultFont="Arial",Qt.modalLayerColor=new Xt(3355443,.2),Qt.buttonSound=null,Qt.buttonSoundVolumeScale=1,Qt.horizontalScrollBar=null,Qt.verticalScrollBar=null,Qt.defaultScrollStep=25,Qt.defaultScrollDecelerationRate=.967,Qt.defaultScrollBarDisplay=t.ScrollBarDisplayType.Visible,Qt.defaultScrollTouchEffect=!0,Qt.defaultScrollBounceEffect=!0,Qt.defaultScrollSnappingThreshold=.1,Qt.defaultScrollPagingThreshold=.3,Qt.popupMenu=null,Qt.popupMenu_seperator=null,Qt.loaderErrorSign=null,Qt.tooltipsWin=null,Qt.defaultComboBoxVisibleItemCount=10,Qt.touchScrollSensitivity=20,Qt.touchDragSensitivity=10,Qt.clickDragSensitivity=2,Qt.bringWindowToFrontOnClick=!0,Qt.frameTimeForAsyncUIConstruction=2,Qt.packageFileExtension="fui";class qt{constructor(){this._x=0,this._y=0,this._z=0,this._alpha=1,this._visible=!0,this._touchable=!0,this._scaleX=1,this._scaleY=1,this._skewX=0,this._skewY=0,this._pivotX=0,this._pivotY=0,this._sortingOrder=0,this._internalVisible=!0,this.minWidth=0,this.minHeight=0,this.maxWidth=0,this.maxHeight=0,this.sourceWidth=0,this.sourceHeight=0,this.initWidth=0,this.initHeight=0,this._width=0,this._height=0,this._rawWidth=0,this._rawHeight=0,this._sizePercentInGroup=0,this._dragStartPos=new e.Vector2,this._dragTesting=!1,this._id=""+he++,this._name="",this.createDisplayObject(),this._displayObject.$owner=this,this._relations=new Yt(this),this._gears=new Array(10)}get id(){return this._id}get name(){return this._name}set name(t){this._name=t}get x(){return this._x}set x(t){this.setPosition(t,this._y)}get y(){return this._y}set y(t){this.setPosition(this._x,t)}get z(){return this._z}set z(t){this.setPosition(this._x,this._y,t)}setPosition(t,e,i){if(this._x!=t||this._y!=e){var s=t-this._x,h=e-this._y;this._x=t,this._y=e,null!=i&&(this._z=i),this.handlePositionChanged(),this instanceof ae&&this.moveChildren(s,h),this.updateGear(1),this._parent&&!("setVirtual"in this._parent)&&(this._parent.setBoundsChangedFlag(),this._group&&this._group.setBoundsChangedFlag(!0),this.dispatchEvent("pos_changed")),qt.draggingObject!=this||$t||this.localToGlobalRect(0,0,this.width,this.height,ee)}}get xMin(){return this._pivotAsAnchor?this._x-this._width*this._pivotX:this._x}set xMin(t){this._pivotAsAnchor?this.setPosition(t+this._width*this._pivotX,this._y):this.setPosition(t,this._y)}get yMin(){return this._pivotAsAnchor?this._y-this._height*this._pivotY:this._y}set yMin(t){this._pivotAsAnchor?this.setPosition(this._x,t+this._height*this._pivotY):this.setPosition(this._x,t)}center(e){var i;i=this._parent?this.parent:se.GRoot.inst,this.setPosition(Math.floor((i.width-this.width)/2),Math.floor((i.height-this.height)/2)),e&&(this.addRelation(i,t.RelationType.Center_Center),this.addRelation(i,t.RelationType.Middle_Middle))}get width(){return this._width}set width(t){this.setSize(t,this._rawHeight)}get height(){return this._height}set height(t){this.setSize(this._rawWidth,t)}setSize(t,e,i){if(this._rawWidth!=t||this._rawHeight!=e){this._rawWidth=t,this._rawHeight=e,t<this.minWidth&&(t=this.minWidth),e<this.minHeight&&(e=this.minHeight),this.maxWidth>0&&t>this.maxWidth&&(t=this.maxWidth),this.maxHeight>0&&e>this.maxHeight&&(e=this.maxHeight);var s=t-this._width,h=e-this._height;this._width=t,this._height=e,this.handleSizeChanged(),0==this._pivotX&&0==this._pivotY||(this._pivotAsAnchor||i?this.handlePositionChanged():this.setPosition(this.x-this._pivotX*s,this.y-this._pivotY*h)),this instanceof ae&&this.resizeChildren(s,h),this.updateGear(2),this._parent&&(this._relations.onOwnerSizeChanged(s,h,this._pivotAsAnchor||!i),this._parent.setBoundsChangedFlag(),this._group&&this._group.setBoundsChangedFlag()),this.dispatchEvent("size_changed")}}setSizeDirectly(t,e){this._rawWidth=t,this._rawHeight=e,t<0&&(t=0),e<0&&(e=0),this._width=t,this._height=e}makeFullScreen(){this.setSize(se.GRoot.inst.width,se.GRoot.inst.height)}get actualWidth(){return this.width*Math.abs(this._scaleX)}get actualHeight(){return this.height*Math.abs(this._scaleY)}get scaleX(){return this._scaleX}set scaleX(t){this.setScale(t,this._scaleY)}get scaleY(){return this._scaleY}set scaleY(t){this.setScale(this._scaleX,t)}setScale(t,e){this._scaleX==t&&this._scaleY==e||(this._scaleX=t,this._scaleY=e,this.handleScaleChanged(),this.updateGear(2))}get skewX(){return this._skewX}set skewX(t){this.setSkew(t,this._skewY)}get skewY(){return this._skewY}set skewY(t){this.setSkew(this._skewX,t)}setSkew(t,e){this._skewX==t&&this._skewY==e||(this._skewX=t,this._skewY=e)}get pivotX(){return this._pivotX}set pivotX(t){this.setPivot(t,this._pivotY)}get pivotY(){return this._pivotY}set pivotY(t){this.setPivot(this._pivotX,t)}setPivot(t,e,i){i=i||!1,this._pivotX==t&&this._pivotY==e&&this._pivotAsAnchor==i||(this._pivotX=t,this._pivotY=e,this._pivotAsAnchor=i,this._displayObject.setPivot(t,e),this.handlePositionChanged())}get pivotAsAnchor(){return this._pivotAsAnchor}get touchable(){return this._touchable}set touchable(t){this._touchable!=t&&(this._touchable=t,this.updateGear(3),this._displayObject.touchable=this._touchable)}get grayed(){return this._grayed}set grayed(t){this._grayed!=t&&(this._grayed=t,this.handleGrayedChanged(),this.updateGear(3))}get enabled(){return!this._grayed&&this._touchable}set enabled(t){this.grayed=!t,this.touchable=t}get rotation(){return this._displayObject.rotation}set rotation(t){this._displayObject.rotation!=t&&(this._displayObject.rotation=t,this.updateGear(3))}get rotationX(){return this._displayObject.rotationX}set rotationX(t){this._displayObject.rotationX=t}get rotationY(){return this._displayObject.rotationY}set rotationY(t){this._displayObject.rotationY=t}get alpha(){return this._alpha}set alpha(t){this._alpha!=t&&(this._alpha=t,this.handleAlphaChanged(),this.updateGear(3))}get visible(){return this._visible}set visible(t){this._visible!=t&&(this._visible=t,this.handleVisibleChanged(),this._parent&&this._parent.setBoundsChangedFlag(),this._group&&this._group.excludeInvisibles&&this._group.setBoundsChangedFlag())}get internalVisible(){return this._internalVisible&&(!this._group||this._group.internalVisible)}get internalVisible2(){return this._visible&&(!this._group||this._group.internalVisible2)}get internalVisible3(){return this._internalVisible&&this._visible}get sortingOrder(){return this._sortingOrder}set sortingOrder(t){if(t<0&&(t=0),this._sortingOrder!=t){var e=this._sortingOrder;this._sortingOrder=t,this._parent&&this._parent.childSortingOrderChanged(this,e,this._sortingOrder)}}get tooltips(){return this._tooltips}set tooltips(t){this._tooltips&&(this.off("roll_over",this.__rollOver,this),this.off("roll_out",this.__rollOut,this)),this._tooltips=t,this._tooltips&&(this.on("roll_over",this.__rollOver,this),this.on("roll_out",this.__rollOut,this))}__rollOver(){k.callDelay(100,this.__doShowTooltips,this)}__doShowTooltips(){se.GRoot.findFor(this).showTooltips(this._tooltips)}__rollOut(){k.remove(this.__doShowTooltips,this),se.GRoot.findFor(this).hideTooltips()}get blendMode(){return this._displayObject.blendMode}set blendMode(t){this._displayObject.blendMode=t}get onStage(){return null!=this._displayObject.stage}get resourceURL(){return this.packageItem?"ui://"+this.packageItem.owner.id+this.packageItem.id:null}set group(t){this._group!=t&&(this._group&&this._group.setBoundsChangedFlag(),this._group=t,this._group&&this._group.setBoundsChangedFlag())}get group(){return this._group}getGear(t){var e=this._gears[t];return null==e&&(this._gears[t]=e=function(t,e){let i=new Kt[e];return i._owner=t,i}(this,t)),e}updateGear(t){if(!this._underConstruct&&!this._gearLocked){var e=this._gears[t];e&&e.controller&&e.updateState()}}checkGearController(t,e){return this._gears[t]&&this._gears[t].controller==e}updateGearFromRelations(t,e,i){this._gears[t]&&this._gears[t].updateFromRelations(e,i)}addDisplayLock(){var t=this._gears[0];if(t&&t.controller){var e=t.addLock();return this.checkGearDisplay(),e}return 0}releaseDisplayLock(t){var e=this._gears[0];e&&e.controller&&(e.releaseLock(t),this.checkGearDisplay())}checkGearDisplay(){if(!this._handlingController){var t=null==this._gears[0]||this._gears[0].connected;this._gears[8]&&(t=this._gears[8].evaluate(t)),t!=this._internalVisible&&(this._internalVisible=t,this._parent&&(this._parent.childStateChanged(this),this._group&&this._group.excludeInvisibles&&this._group.setBoundsChangedFlag()))}}get relations(){return this._relations}addRelation(t,e,i){this._relations.add(t,e,i)}removeRelation(t,e){this._relations.remove(t,e)}get displayObject(){return this._displayObject}get obj3D(){return this._displayObject.obj3D}get parent(){return this._parent}set parent(t){this._parent=t}removeFromParent(){this._parent&&this._parent.removeChild(this)}get asCom(){return this}get text(){return null}set text(t){}get icon(){return null}set icon(t){}get treeNode(){return this._treeNode}get isDisposed(){return null==this._displayObject}dispose(){this.removeFromParent(),this._relations.dispose(),this._displayObject.dispose(),this._displayObject=null;for(var t=0;t<10;t++){var e=this._gears[t];e&&e.dispose()}}on(t,e,i,s){this._displayObject.on(t,e,i,s)}off(t,e,i,s){this._displayObject.off(t,e,i,s)}offAll(t){this._displayObject.offAll(t)}hasListener(t,e,i,s){return this._displayObject.hasListener(t,e,i,s)}dispatchEvent(t,e){return this._displayObject.dispatchEvent(t,e)}onClick(t,e){this.on("click",t,e)}offClick(t,e){this.off("click",t,e)}hasClickListener(){return this.hasListener("click")}get draggable(){return this._draggable}set draggable(t){this._draggable!=t&&(this._draggable=t,this.initDrag())}get dragBounds(){return this._dragBounds}set dragBounds(t){this._dragBounds=t}startDrag(t){null!=this._displayObject.stage&&(null==t&&(t=-1),this.dragBegin(t))}stopDrag(){this.dragEnd()}get dragging(){return qt.draggingObject==this}localToGlobal(t,e,i){return t=t||0,e=e||0,this._pivotAsAnchor&&(t+=this._pivotX*this._width,e+=this._pivotY*this._height),this._displayObject.localToGlobal(t,e,i)}globalToLocal(t,e,i){return t=t||0,e=e||0,i=this._displayObject.globalToLocal(t,e,i),this._pivotAsAnchor&&(i.x-=this._pivotX*this._width,i.y-=this._pivotY*this._height),i}localToRoot(t,e,i){let s=se.GRoot.findFor(this),h=this.localToGlobal(t,e,i);return s.globalToLocal(h.x,h.y,h)}rootToLocal(t,e,i){let s=se.GRoot.findFor(this).localToGlobal(t,e,i);return this.globalToLocal(s.x,s.y,s)}localToGlobalRect(t,e,i,s,h){h||(h=new P);var r=this.localToGlobal(t,e,Zt);return h.x=r.x,h.y=r.y,r=this.localToGlobal(t+i,e+s,Zt),h.width=r.x-h.x,h.height=r.y-h.y,h}globalToLocalRect(t,e,i,s,h){h||(h=new P);var r=this.globalToLocal(t,e,Zt);return h.x=r.x,h.y=r.y,r=this.globalToLocal(t+i,e+s,Zt),h.width=r.x-h.x,h.height=r.y-h.y,h}handleControllerChanged(t){this._handlingController=!0;for(var e=0;e<10;e++){var i=this._gears[e];i&&i.controller==t&&i.apply()}this._handlingController=!1,this.checkGearDisplay()}createDisplayObject(){this._displayObject=new ft}handlePositionChanged(){var t=this._x,e=this._y;this._pivotAsAnchor||(t+=this._pivotX*this._width,e+=this._pivotY*this._height),this._displayObject.setPosition(t,e,this._z,!0)}handleSizeChanged(){this._displayObject.setSize(this._width,this._height)}handleScaleChanged(){this._displayObject.setScale(this._scaleX,this._scaleY)}handleGrayedChanged(){this._displayObject.graphics&&(this._displayObject.graphics.grayed=this._grayed)}handleAlphaChanged(){this._displayObject.alpha=this._alpha}handleVisibleChanged(){this._displayObject.visible=this.internalVisible2}getProp(e){switch(e){case t.ObjectPropID.Text:return this.text;case t.ObjectPropID.Icon:return this.icon;case t.ObjectPropID.Color:case t.ObjectPropID.OutlineColor:return null;case t.ObjectPropID.Playing:return!1;case t.ObjectPropID.Frame:case t.ObjectPropID.DeltaTime:return 0;case t.ObjectPropID.TimeScale:return 1;case t.ObjectPropID.FontSize:return 0;case t.ObjectPropID.Selected:return!1;default:return}}setProp(e,i){switch(e){case t.ObjectPropID.Text:this.text=i;break;case t.ObjectPropID.Icon:this.icon=i}}constructFromResource(){}setup_beforeAdd(t,i){var s,h;t.seek(i,0),t.skip(5),this._id=t.readS(),this._name=t.readS(),s=t.readInt(),h=t.readInt(),this.setPosition(s,h),t.readBool()&&(this.initWidth=t.readInt(),this.initHeight=t.readInt(),this.setSize(this.initWidth,this.initHeight,!0)),t.readBool()&&(this.minWidth=t.readInt(),this.maxWidth=t.readInt(),this.minHeight=t.readInt(),this.maxHeight=t.readInt()),t.readBool()&&(s=t.readFloat(),h=t.readFloat(),this.setScale(s,h)),t.readBool()&&(s=t.readFloat(),h=t.readFloat(),this.setSkew(s,h)),t.readBool()&&(s=t.readFloat(),h=t.readFloat(),this.setPivot(s,h,t.readBool())),1!=(s=t.readFloat())&&(this.alpha=s),0!=(s=t.readFloat())&&(this.rotation=s),t.readBool()||(this.visible=!1),t.readBool()||(this.touchable=!1),t.readBool()&&(this.grayed=!0);var r=t.readByte();this.blendMode=ie[r]||e.NormalBlending;t.readByte();var a=t.readS();null!=a&&(this.data=a)}setup_afterAdd(t,e){t.seek(e,1);var i=t.readS();i&&(this.tooltips=i);var s=t.readShort();s>=0&&(this.group=this.parent.getChildAt(s)),t.seek(e,2);for(var h=t.readShort(),r=0;r<h;r++){var a=t.readShort();a+=t.pos,this.getGear(t.readByte()).setup(t),t.pos=a}}initDrag(){this._draggable?(this.on("touch_begin",this.__touchBegin,this),this.on("touch_move",this.__touchMove,this),this.on("touch_end",this.__touchEnd,this)):(this.off("touch_begin",this.__touchBegin,this),this.off("touch_move",this.__touchMove,this),this.off("touch_end",this.__touchEnd,this))}dragBegin(t){if(qt.draggingObject){let t=qt.draggingObject;qt.draggingObject.stopDrag(),qt.draggingObject=null,t.dispatchEvent("drag_end")}this.on("touch_move",this.__touchMove,this),this.on("touch_end",this.__touchEnd,this),j.getTouchPos(t,te),this.localToGlobalRect(0,0,this.width,this.height,ee),this._dragTesting=!1,qt.draggingObject=this,j.addTouchMonitor(t,this._displayObject)}dragEnd(){qt.draggingObject==this&&(this._dragTesting=!1,qt.draggingObject=null)}__touchBegin(t){null==this._dragStartPos&&(this._dragStartPos=new e.Vector2),this._dragStartPos.set(t.input.x,t.input.y),this._dragTesting=!0,t.captureTouch()}__touchMove(t){if(this._dragTesting&&qt.draggingObject!=this){let e;if(e=j.touchScreen?Qt.touchDragSensitivity:Qt.clickDragSensitivity,this._dragStartPos&&Math.abs(this._dragStartPos.x-t.input.x)<e&&Math.abs(this._dragStartPos.y-t.input.y)<e)return;this._dragTesting=!1,this.dispatchEvent("drag_start",t.input.touchId)||this.dragBegin(t.input.touchId)}if(qt.draggingObject==this){let e=t.input.x-te.x+ee.x,i=t.input.y-te.y+ee.y;if(this._dragBounds){let t=se.GRoot.findFor(this).localToGlobalRect(this._dragBounds.x,this._dragBounds.y,this._dragBounds.width,this._dragBounds.height,Jt);e<t.x?e=t.x:e+ee.width>t.xMax&&(e=t.xMax-ee.width,e<t.x&&(e=t.x)),i<t.y?i=t.y:i+ee.height>t.yMax&&(i=t.yMax-ee.height,i<t.y&&(i=t.y))}let s=this.parent.globalToLocal(e,i,Zt);$t=!0,this.setPosition(Math.round(s.x),Math.round(s.y)),$t=!1,this.dispatchEvent("drag_move")}}__touchEnd(){qt.draggingObject==this&&(qt.draggingObject=null,this.dispatchEvent("drag_end"))}static cast(t){let i;if(t instanceof e.Object3D){if(i=t.$owner,!i)return null}else i=t;return i.$owner}}let Kt=[class extends kt{constructor(){super(...arguments),this.pages=null,this._visible=0,this._displayLockToken=1}init(){this.pages=null}addLock(){return this._visible++,this._displayLockToken}releaseLock(t){t==this._displayLockToken&&this._visible--}get connected(){return null==this._controller||this._visible>0}apply(){this._displayLockToken++,this._displayLockToken<=0&&(this._displayLockToken=1),null==this.pages||0==this.pages.length||-1!=this.pages.indexOf(this._controller.selectedPageId)?this._visible=1:this._visible=0}},class extends kt{init(){this._default={x:this._owner.x,y:this._owner.y,px:this._owner.x/this._owner.parent.width,py:this._owner.y/this._owner.parent.height},this._storage={}}addStatus(t,e){var i;t?(i={},this._storage[t]=i):i=this._default,i.x=e.readInt(),i.y=e.readInt()}addExtStatus(t,e){var i;(i=t?this._storage[t]:this._default).px=e.readFloat(),i.py=e.readFloat()}apply(){var t,e,i=this._storage[this._controller.selectedPageId]||this._default;if(this.positionsInPercent&&this._owner.parent?(t=i.px*this._owner.parent.width,e=i.py*this._owner.parent.height):(t=i.x,e=i.y),this.allowTween){if(this._tweenConfig._tweener){if(this._tweenConfig._tweener.endValue.x==t&&this._tweenConfig._tweener.endValue.y==e)return;this._tweenConfig._tweener.kill(!0),this._tweenConfig._tweener=null}var s=this._owner.x,h=this._owner.y;s==t&&h==e||(this._owner.checkGearController(0,this._controller)&&(this._tweenConfig._displayLockToken=this._owner.addDisplayLock()),this._tweenConfig._tweener=Nt.to2(s,h,t,e,this._tweenConfig.duration).setDelay(this._tweenConfig.delay).setEase(this._tweenConfig.easeType).setTarget(this).onUpdate(this.__tweenUpdate,this).onComplete(this.__tweenComplete,this))}else this._owner._gearLocked=!0,this._owner.setPosition(t,e),this._owner._gearLocked=!1}__tweenUpdate(t){this._owner._gearLocked=!0,this._owner.setPosition(t.value.x,t.value.y),this._owner._gearLocked=!1}__tweenComplete(){0!=this._tweenConfig._displayLockToken&&(this._owner.releaseDisplayLock(this._tweenConfig._displayLockToken),this._tweenConfig._displayLockToken=0),this._tweenConfig._tweener=null}updateState(){var t=this._storage[this._controller.selectedPageId];t||(t={},this._storage[this._controller.selectedPageId]=t),t.x=this._owner.x,t.y=this._owner.y,t.px=this._owner.x/this._owner.parent.width,t.py=this._owner.y/this._owner.parent.height}updateFromRelations(t,e){if(null!=this._controller&&null!=this._storage&&!this.positionsInPercent){for(var i in this._storage){var s=this._storage[i];s.x+=t,s.y+=e}this._default.x+=t,this._default.y+=e,this.updateState()}}},class extends kt{init(){this._default={width:this._owner.width,height:this._owner.height,scaleX:this._owner.scaleX,scaleY:this._owner.scaleY},this._storage={}}addStatus(t,e){var i;t?(i={},this._storage[t]=i):i=this._default,i.width=e.readInt(),i.height=e.readInt(),i.scaleX=e.readFloat(),i.scaleY=e.readFloat()}apply(){var t=this._storage[this._controller.selectedPageId]||this._default;if(this.allowTween){if(this._tweenConfig._tweener){if(this._tweenConfig._tweener.endValue.x==t.width&&this._tweenConfig._tweener.endValue.y==t.height&&this._tweenConfig._tweener.endValue.z==t.scaleX&&this._tweenConfig._tweener.endValue.w==t.scaleY)return;this._tweenConfig._tweener.kill(!0),this._tweenConfig._tweener=null}var e=t.width!=this._owner.width||t.height!=this._owner.height,i=t.scaleX!=this._owner.scaleX||t.scaleY!=this._owner.scaleY;(e||i)&&(this._owner.checkGearController(0,this._controller)&&(this._tweenConfig._displayLockToken=this._owner.addDisplayLock()),this._tweenConfig._tweener=Nt.to4(this._owner.width,this._owner.height,this._owner.scaleX,this._owner.scaleY,t.width,t.height,t.scaleX,t.scaleY,this._tweenConfig.duration).setDelay(this._tweenConfig.delay).setEase(this._tweenConfig.easeType).setUserData((e?1:0)+(i?2:0)).setTarget(this).onUpdate(this.__tweenUpdate,this).onComplete(this.__tweenComplete,this))}else this._owner._gearLocked=!0,this._owner.setSize(t.width,t.height,this._owner.checkGearController(1,this._controller)),this._owner.setScale(t.scaleX,t.scaleY),this._owner._gearLocked=!1}__tweenUpdate(t){var e=t.userData;this._owner._gearLocked=!0,0!=(1&e)&&this._owner.setSize(t.value.x,t.value.y,this._owner.checkGearController(1,this._controller)),0!=(2&e)&&this._owner.setScale(t.value.z,t.value.w),this._owner._gearLocked=!1}__tweenComplete(){0!=this._tweenConfig._displayLockToken&&(this._owner.releaseDisplayLock(this._tweenConfig._displayLockToken),this._tweenConfig._displayLockToken=0),this._tweenConfig._tweener=null}updateState(){var t=this._storage[this._controller.selectedPageId];t||(t={},this._storage[this._controller.selectedPageId]=t),t.width=this._owner.width,t.height=this._owner.height,t.scaleX=this._owner.scaleX,t.scaleY=this._owner.scaleY}updateFromRelations(t,e){if(null!=this._controller&&null!=this._storage){for(var i in this._storage){var s=this._storage[i];s.width+=t,s.height+=e}this._default.width+=t,this._default.height+=e,this.updateState()}}},class extends kt{init(){this._default={alpha:this._owner.alpha,rotation:this._owner.rotation,grayed:this._owner.grayed,touchable:this._owner.touchable},this._storage={}}addStatus(t,e){var i;t?(i={},this._storage[t]=i):i=this._default,i.alpha=e.readFloat(),i.rotation=e.readFloat(),i.grayed=e.readBool(),i.touchable=e.readBool()}apply(){var t=this._storage[this._controller.selectedPageId]||this._default;if(this.allowTween){if(this._owner._gearLocked=!0,this._owner.grayed=t.grayed,this._owner.touchable=t.touchable,this._owner._gearLocked=!1,this._tweenConfig._tweener){if(this._tweenConfig._tweener.endValue.x==t.alpha&&this._tweenConfig._tweener.endValue.y==t.rotation)return;this._tweenConfig._tweener.kill(!0),this._tweenConfig._tweener=null}var e=t.alpha!=this._owner.alpha,i=t.rotation!=this._owner.rotation;(e||i)&&(this._owner.checkGearController(0,this._controller)&&(this._tweenConfig._displayLockToken=this._owner.addDisplayLock()),this._tweenConfig._tweener=Nt.to2(this._owner.alpha,this._owner.rotation,t.alpha,t.rotation,this._tweenConfig.duration).setDelay(this._tweenConfig.delay).setEase(this._tweenConfig.easeType).setUserData((e?1:0)+(i?2:0)).setTarget(this).onUpdate(this.__tweenUpdate,this).onComplete(this.__tweenComplete,this))}else this._owner._gearLocked=!0,this._owner.grayed=t.grayed,this._owner.alpha=t.alpha,this._owner.rotation=t.rotation,this._owner.touchable=t.touchable,this._owner._gearLocked=!1}__tweenUpdate(t){var e=t.userData;this._owner._gearLocked=!0,0!=(1&e)&&(this._owner.alpha=t.value.x),0!=(2&e)&&(this._owner.rotation=t.value.y),this._owner._gearLocked=!1}__tweenComplete(){0!=this._tweenConfig._displayLockToken&&(this._owner.releaseDisplayLock(this._tweenConfig._displayLockToken),this._tweenConfig._displayLockToken=0),this._tweenConfig._tweener=null}updateState(){var t=this._storage[this._controller.selectedPageId];t||(t={},this._storage[this._controller.selectedPageId]=t),t.alpha=this._owner.alpha,t.rotation=this._owner.rotation,t.grayed=this._owner.grayed,t.touchable=this._owner.touchable}},class extends kt{init(){this._default={color:this._owner.getProp(t.ObjectPropID.Color),strokeColor:this._owner.getProp(t.ObjectPropID.OutlineColor)},this._storage={}}addStatus(t,e){var i;t?(i={},this._storage[t]=i):i=this._default,i.color=e.readColor(),i.strokeColor=e.readColor()}apply(){this._owner._gearLocked=!0;var e=this._storage[this._controller.selectedPageId]||this._default;this._owner.setProp(t.ObjectPropID.Color,e.color),this._owner.setProp(t.ObjectPropID.OutlineColor,e.strokeColor),this._owner._gearLocked=!1}updateState(){var e=this._storage[this._controller.selectedPageId];e||(e={},this._storage[this._controller.selectedPageId]=e),e.color=this._owner.getProp(t.ObjectPropID.Color),e.strokeColor=this._owner.getProp(t.ObjectPropID.OutlineColor)}},class extends kt{init(){this._default={playing:this._owner.getProp(t.ObjectPropID.Playing),frame:this._owner.getProp(t.ObjectPropID.Frame)},this._storage={}}addStatus(t,e){var i;t?(i={},this._storage[t]=i):i=this._default,i.playing=e.readBool(),i.frame=e.readInt()}apply(){this._owner._gearLocked=!0;var e=this._storage[this._controller.selectedPageId]||this._default;this._owner.setProp(t.ObjectPropID.Playing,e.playing),this._owner.setProp(t.ObjectPropID.Frame,e.frame),this._owner._gearLocked=!1}updateState(){var e=this._storage[this._controller.selectedPageId];e||(e={},this._storage[this._controller.selectedPageId]=e),e.playing=this._owner.getProp(t.ObjectPropID.Playing),e.frame=this._owner.getProp(t.ObjectPropID.Frame)}},class extends kt{init(){this._default=this._owner.text,this._storage={}}addStatus(t,e){null==t?this._default=e.readS():this._storage[t]=e.readS()}apply(){this._owner._gearLocked=!0;var t=this._storage[this._controller.selectedPageId];this._owner.text=void 0!==t?t:this._default,this._owner._gearLocked=!1}updateState(){this._storage[this._controller.selectedPageId]=this._owner.text}},class extends kt{init(){this._default=this._owner.icon,this._storage={}}addStatus(t,e){t?this._storage[t]=e.readS():this._default=e.readS()}apply(){this._owner._gearLocked=!0;var t=this._storage[this._controller.selectedPageId];this._owner.icon=void 0!==t?t:this._default,this._owner._gearLocked=!1}updateState(){this._storage[this._controller.selectedPageId]=this._owner.icon}},class extends kt{constructor(){super(...arguments),this.pages=null,this.condition=0,this._visible=0}init(){this.pages=null}apply(){null==this.pages||0==this.pages.length||-1!=this.pages.indexOf(this._controller.selectedPageId)?this._visible=1:this._visible=0}evaluate(t){var e=null==this._controller||this._visible>0;return e=0==this.condition?e&&t:e||t}},class extends kt{constructor(){super(...arguments),this._default=0}init(){this._default=this._owner.getProp(t.ObjectPropID.FontSize),this._storage={}}addStatus(t,e){t?this._storage[t]=e.readInt():this._default=e.readInt()}apply(){this._owner._gearLocked=!0;var e=this._storage[this._controller.selectedPageId];void 0!==e?this._owner.setProp(t.ObjectPropID.FontSize,e):this._owner.setProp(t.ObjectPropID.FontSize,this._default),this._owner._gearLocked=!1}updateState(){this._storage[this._controller.selectedPageId]=this._owner.getProp(t.ObjectPropID.FontSize)}}];var $t,Zt=new e.Vector2,Jt=new P,te=new e.Vector2,ee=new P;const ie={0:e.NormalBlending,1:e.NoBlending,2:e.AdditiveBlending,3:e.MultiplyBlending,4:e.SubtractiveBlending};var se={},he=0,re={n:0};class ae extends qt{constructor(){super(),this._layout=0,this._lineGap=0,this._columnGap=0,this._mainGridIndex=-1,this._mainGridMinSize=50,this._mainChildIndex=-1,this._totalSize=0,this._numChildren=0,this._updating=0}dispose(){this._boundsChanged=!1,super.dispose()}get layout(){return this._layout}set layout(t){this._layout!=t&&(this._layout=t,this.setBoundsChangedFlag())}get lineGap(){return this._lineGap}set lineGap(t){this._lineGap!=t&&(this._lineGap=t,this.setBoundsChangedFlag(!0))}get columnGap(){return this._columnGap}set columnGap(t){this._columnGap!=t&&(this._columnGap=t,this.setBoundsChangedFlag(!0))}get excludeInvisibles(){return this._excludeInvisibles}set excludeInvisibles(t){this._excludeInvisibles!=t&&(this._excludeInvisibles=t,this.setBoundsChangedFlag())}get autoSizeDisabled(){return this._autoSizeDisabled}set autoSizeDisabled(t){this._autoSizeDisabled=t}get mainGridMinSize(){return this._mainGridMinSize}set mainGridMinSize(t){this._mainGridMinSize!=t&&(this._mainGridMinSize=t,this.setBoundsChangedFlag())}get mainGridIndex(){return this._mainGridIndex}set mainGridIndex(t){this._mainGridIndex!=t&&(this._mainGridIndex=t,this.setBoundsChangedFlag())}setBoundsChangedFlag(e){0==this._updating&&this._parent&&(e||(this._percentReady=!1),this._boundsChanged||(this._boundsChanged=!0,this._layout!=t.GroupLayoutType.None&&k.callLater(this.ensureBoundsCorrect,this)))}ensureBoundsCorrect(){null!=this._parent&&this._boundsChanged&&(this._boundsChanged=!1,0==this._layout?this.updateBounds():this._autoSizeDisabled?this.resizeChildren(0,0):(this.handleLayout(),this.updateBounds()))}updateBounds(){k.remove(this.ensureBoundsCorrect,this);var t,e,i,s=this._parent.numChildren,h=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY,o=!0;for(t=0;t<s;t++)(e=this._parent.getChildAt(t)).group!=this||this._excludeInvisibles&&!e.internalVisible3||((i=e.xMin)<h&&(h=i),(i=e.yMin)<r&&(r=i),(i=e.xMin+e.width)>a&&(a=i),(i=e.yMin+e.height)>n&&(n=i),o=!1);var l=0,_=0;o||(this._updating|=1,this.setPosition(h,r),this._updating&=2,l=a-h,_=n-r),0==(2&this._updating)?(this._updating|=2,this.setSize(l,_),this._updating&=1):(this._updating&=1,this.resizeChildren(this._width-l,this._height-_))}handleLayout(){var e,i,s;if(this._updating|=1,this._layout==t.GroupLayoutType.Horizontal){var h=this.x;for(s=this._parent.numChildren,i=0;i<s;i++)(e=this._parent.getChildAt(i)).group==this&&(this._excludeInvisibles&&!e.internalVisible3||(e.xMin=h,0!=e.width&&(h+=e.width+this._columnGap)))}else if(this._layout==t.GroupLayoutType.Vertical){var r=this.y;for(s=this._parent.numChildren,i=0;i<s;i++)(e=this._parent.getChildAt(i)).group==this&&(this._excludeInvisibles&&!e.internalVisible3||(e.yMin=r,0!=e.height&&(r+=e.height+this._lineGap)))}this._updating&=2}moveChildren(t,e){if(0==(1&this._updating)&&null!=this._parent){this._updating|=1;var i,s,h=this._parent.numChildren;for(i=0;i<h;i++)(s=this._parent.getChildAt(i)).group==this&&s.setPosition(s.x+t,s.y+e);this._updating&=2}}resizeChildren(e,i){if(this._layout!=t.GroupLayoutType.None&&0==(2&this._updating)&&null!=this._parent)if(this._updating|=2,!this._boundsChanged||(this._boundsChanged=!1,this._autoSizeDisabled)){var s,h,r=this._parent.numChildren;if(!this._percentReady){this._percentReady=!0,this._numChildren=0,this._totalSize=0,this._mainChildIndex=-1;var a=0;for(s=0;s<r;s++)(h=this._parent.getChildAt(s)).group==this&&(this._excludeInvisibles&&!h.internalVisible3||(a==this._mainGridIndex&&(this._mainChildIndex=s),this._numChildren++,1==this._layout?this._totalSize+=h.width:this._totalSize+=h.height),a++);for(-1!=this._mainChildIndex&&(1==this._layout?(h=this._parent.getChildAt(this._mainChildIndex),this._totalSize+=this._mainGridMinSize-h.width,h._sizePercentInGroup=this._mainGridMinSize/this._totalSize):(h=this._parent.getChildAt(this._mainChildIndex),this._totalSize+=this._mainGridMinSize-h.height,h._sizePercentInGroup=this._mainGridMinSize/this._totalSize)),s=0;s<r;s++)(h=this._parent.getChildAt(s)).group==this&&s!=this._mainChildIndex&&(this._totalSize>0?h._sizePercentInGroup=(1==this._layout?h.width:h.height)/this._totalSize:h._sizePercentInGroup=0)}var n=0,o=1,l=!1;if(1==this._layout){n=this.width-(this._numChildren-1)*this._columnGap,-1!=this._mainChildIndex&&n>=this._totalSize&&((h=this._parent.getChildAt(this._mainChildIndex)).setSize(n-(this._totalSize-this._mainGridMinSize),h._rawHeight+i,!0),n-=h.width,o-=h._sizePercentInGroup,l=!0);var _=this.x;for(s=0;s<r;s++)(h=this._parent.getChildAt(s)).group==this&&(!this._excludeInvisibles||h.internalVisible3?(l&&s==this._mainChildIndex||(h.setSize(Math.round(h._sizePercentInGroup/o*n),h._rawHeight+i,!0),o-=h._sizePercentInGroup,n-=h.width),h.xMin=_,0!=h.width&&(_+=h.width+this._columnGap)):h.setSize(h._rawWidth,h._rawHeight+i,!0))}else{n=this.height-(this._numChildren-1)*this._lineGap,-1!=this._mainChildIndex&&n>=this._totalSize&&((h=this._parent.getChildAt(this._mainChildIndex)).setSize(h._rawWidth+e,n-(this._totalSize-this._mainGridMinSize),!0),n-=h.height,o-=h._sizePercentInGroup,l=!0);var d=this.y;for(s=0;s<r;s++)(h=this._parent.getChildAt(s)).group==this&&(!this._excludeInvisibles||h.internalVisible3?(l&&s==this._mainChildIndex||(h.setSize(h._rawWidth+e,Math.round(h._sizePercentInGroup/o*n),!0),o-=h._sizePercentInGroup,n-=h.height),h.yMin=d,0!=h.height&&(d+=h.height+this._lineGap)):h.setSize(h._rawWidth+e,h._rawHeight,!0))}this._updating&=1}else this.updateBounds()}handleAlphaChanged(){if(!this._underConstruct)for(var t=this._parent.numChildren,e=0;e<t;e++){var i=this._parent.getChildAt(e);i.group==this&&(i.alpha=this.alpha)}}handleVisibleChanged(){if(this._parent)for(var t=this._parent.numChildren,e=0;e<t;e++){var i=this._parent.getChildAt(e);i.group==this&&i.handleVisibleChanged()}}setup_beforeAdd(t,e){super.setup_beforeAdd(t,e),t.seek(e,5),this._layout=t.readByte(),this._lineGap=t.readInt(),this._columnGap=t.readInt(),t.version>=2&&(this._excludeInvisibles=t.readBool(),this._autoSizeDisabled=t.readBool(),this._mainGridIndex=t.readShort())}setup_afterAdd(t,e){super.setup_afterAdd(t,e),this.visible||this.handleVisibleChanged()}}function ne(t,e){var i;i=e?(t>>24&255).toString(16):"";var s=(t>>16&255).toString(16),h=(t>>8&255).toString(16),r=(255&t).toString(16);return 1==i.length&&(i="0"+i),1==s.length&&(s="0"+s),1==h.length&&(h="0"+h),1==r.length&&(r="0"+r),"#"+i+s+h+r}function oe(t,e){return t.length<1?0:("#"==t.charAt(0)&&(t=t.substr(1)),8==t.length?(parseInt(t.substr(0,2),16)<<24)+parseInt(t.substr(2),16):e?4278190080+parseInt(t,16):parseInt(t,16))}function le(t,e,i){return t<e?t=e:t>i&&(t=i),t}function _e(t){return isNaN(t)?t=0:t>1?t=1:t<0&&(t=0),t}function de(t,e,i){return t+i*(e-t)}function ce(t,e){return t-Math.floor(t/e)*e}function ue(t,e,i,s){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-s,2))}class ge{constructor(){this.vertices=new Array,this.uvs=new Array,this.colors=new Array,this.triangles=new Array,this.contentRect=new P,this.uvRect=new P,this.textureSize=new e.Vector2,this.vertexColor=new Xt}static begin(t){let e=pe.borrow();return t&&(e.contentRect=t.contentRect,e.uvRect=t.uvRect,e.vertexColor=t.vertexColor,e.textureSize=t.textureSize),e}end(){this.clear(),pe.returns(this)}clear(){this.vertices.length=0,this.colors.length=0,this.uvs.length=0,this.triangles.length=0}get currentVertCount(){return this.vertices.length/3}addVert(t,e,i,s,h,r){e=-e,this.vertices.push(t,e,i||0),"number"==typeof s?this.uvs.push(s,h):(this.uvs.push(de(this.uvRect.x,this.uvRect.xMax,(t-this.contentRect.x)/this.contentRect.width),de(this.uvRect.yMax,this.uvRect.y,(-e-this.contentRect.y)/this.contentRect.height)),s instanceof Xt&&(r=s)),null==r&&(r=this.vertexColor),this.colors.push(r.r,r.g,r.b,r.a)}addQuad(t,e,i){if(fe.length=0,e)if(Array.isArray(e))for(let t=0;t<4;t++)fe.push(e[t].x,e[t].y);else fe.push(e.x,e.y,e.x,e.yMax,e.xMax,e.yMax,e.xMax,e.y);this.addVert(t.x,t.yMax,0,fe[0],fe[1],i),this.addVert(t.x,t.y,0,fe[2],fe[3],i),this.addVert(t.xMax,t.y,0,fe[4],fe[5],i),this.addVert(t.xMax,t.yMax,0,fe[6],fe[7],i)}repeatColors(t,e,i){let s=Math.min(e+i,this.vertices.length/3),h=t.length,r=0;for(let i=e;i<s;i++){let e=t[r++%h];this.colors[i]=e}}addTriangle(t,e,i){this.triangles.push(t),this.triangles.push(e),this.triangles.push(i)}addTriangles(t,e){if(null!=e)if(0!=t){t<0&&(t=this.vertices.length/3+t);let i=e.length;for(let s=0;s<i;s++)this.triangles.push(e[s]+t)}else this.triangles.push.apply(this.triangles,e);else{let e=this.vertices.length/3;null==t?t=0:t<0&&(t=e+t);let i=this.triangles;for(let s=t;s<e;s+=4)i.push(s),i.push(s+2),i.push(s+1),i.push(s+3),i.push(s+2),i.push(s)}}getPosition(t,i){t<0&&(t=this.vertices.length/3+t);let s=i||new e.Vector3;return s.x=this.vertices[3*t],s.y=-this.vertices[3*t+1],s.z=this.vertices[3*t+2],s}append(t){this.vertices.push.apply(this.vertices,t.vertices),this.uvs.push.apply(this.uvs,t.uvs),this.colors.push.apply(this.colors,t.colors),this.triangles.push.apply(this.triangles,t.triangles)}}var pe=new b(ge),fe=new Array(8);class me extends e.ShaderMaterial{constructor(){super();let t=e.UniformsUtils.merge([e.ShaderLib.basic.uniforms,{_ColorMatrix:new e.Uniform(new e.Matrix4)},{_ColorOffset:new e.Uniform(new e.Vector4)}]);this.uniforms=t,this.vertexShader="\n        #include <common>\n        #include <uv_pars_vertex>\n        #include <uv2_pars_vertex>\n        #include <envmap_pars_vertex>\n        varying vec4 vColor;\n        attribute vec4 color;\n        #include <fog_pars_vertex>\n        #include <morphtarget_pars_vertex>\n        #include <skinning_pars_vertex>\n        #include <logdepthbuf_pars_vertex>\n        #include <clipping_planes_pars_vertex>\n        \n        void main() {\n        \n            #include <uv_vertex>\n            #include <uv2_vertex>\n\n            vColor = color;\n\n            #include <skinbase_vertex>\n        \n            #ifdef USE_ENVMAP\n        \n            #include <beginnormal_vertex>\n            #include <morphnormal_vertex>\n            #include <skinnormal_vertex>\n            #include <defaultnormal_vertex>\n        \n            #endif\n        \n            #include <begin_vertex>\n            #include <morphtarget_vertex>\n            #include <skinning_vertex>\n            #include <project_vertex>\n            #include <logdepthbuf_vertex>\n        \n            #include <worldpos_vertex>\n            #include <clipping_planes_vertex>\n            #include <envmap_vertex>\n            #include <fog_vertex>\n        \n        }\n        ",this.fragmentShader="\n        uniform bool grayed;\n        uniform bool filter;\n        uniform mat4 colorMatrix;\n        uniform vec4 colorOffset;\n\n        uniform vec3 diffuse;\n        uniform float opacity;\n        #ifndef FLAT_SHADED\n            varying vec3 vNormal;\n        #endif\n        #include <common>\n        #include <dithering_pars_fragment>\n\n        varying vec4 vColor;\n\n        #include <uv_pars_fragment>\n        #include <uv2_pars_fragment>\n        #include <map_pars_fragment>\n        #include <alphamap_pars_fragment>\n        #include <aomap_pars_fragment>\n        #include <lightmap_pars_fragment>\n        #include <envmap_common_pars_fragment>\n        #include <envmap_pars_fragment>\n        #include <cube_uv_reflection_fragment>\n        #include <fog_pars_fragment>\n        #include <specularmap_pars_fragment>\n        #include <logdepthbuf_pars_fragment>\n        #include <clipping_planes_pars_fragment>\n        void main() {\n            #include <clipping_planes_fragment>\n            vec4 diffuseColor = vec4( diffuse, opacity );\n            #include <logdepthbuf_fragment>\n            #ifdef USE_MAP\n                #ifdef TEXT\n                    vec4 sampleColor = texture2D( map, vUv );\n                    if(vColor.a<0.1)\n                        diffuseColor.a *= sampleColor.r;\n                    else if(vColor.a<0.4)\n                        diffuseColor.a *= sampleColor.g;\n                    else\n                        diffuseColor.a *= sampleColor.b;\n                #else\n                    #include <map_fragment>\n                #endif\n            #endif\n\n            #ifdef TEXT\n            diffuseColor.rgb *= vColor.rgb;\n            #else\n            diffuseColor *= vColor;\n            #endif\n\n            #include <alphamap_fragment>\n            #include <alphatest_fragment>\n            #include <specularmap_fragment>\n            ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n            // accumulation (baked indirect lighting only)\n            #ifdef USE_LIGHTMAP\n                vec4 lightMapTexel= texture2D( lightMap, vUv2 );\n                reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n            #else\n                reflectedLight.indirectDiffuse += vec3( 1.0 );\n            #endif\n            // modulation\n            #include <aomap_fragment>\n            reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n            vec3 outgoingLight = reflectedLight.indirectDiffuse;\n            #include <envmap_fragment>\n            gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n            #include <tonemapping_fragment>\n            #include <encodings_fragment>\n            #include <fog_fragment>\n            #include <premultiplied_alpha_fragment>\n            #include <dithering_fragment>\n\n            #ifdef GRAYED\n            float grey = dot(gl_FragColor.rgb, vec3(0.299, 0.587, 0.114));\n            gl_FragColor.rgb = vec3(grey, grey, grey);\n            #endif\n\n            #ifdef COLOR_FILTER\n            vec4 col = gl_FragColor;\n            gl_FragColor.r = dot(col, _ColorMatrix[0]) + _ColorOffset.x;\n            gl_FragColor.g = dot(col, _ColorMatrix[1]) + _ColorOffset.y;\n            gl_FragColor.b = dot(col, _ColorMatrix[2]) + _ColorOffset.z;\n            gl_FragColor.a = dot(col, _ColorMatrix[3]) + _ColorOffset.w;\n            #endif\n        }\n        ",this.name="ui-material",this.lights=!1,this.transparent=!0,this.depthTest=!1,this.side=e.DoubleSide,this.isMeshBasicMaterial=!0}}class ye{constructor(t){this._flip=0,this._color=16777215,this._contentRect=new P,this._material=new me,this._geometry=new e.BufferGeometry;let i=t;i.geometry=this._geometry,i.material=this._material,i.isMesh=!0,i.drawMode=e.TrianglesDrawMode,delete i.isGroup}get texture(){return this._texture}set texture(t){this._texture!=t&&(this._texture=t,this._meshDirty=!0),this._texture?this._material.map=this._texture.nativeTexture:this._material.map=null}get material(){return this._material}set material(t){this._material=t}get meshFactory(){return this._meshFactory}set meshFactory(t){this._meshFactory!=t&&(this._meshFactory=t,this._meshDirty=!0)}getMeshFactory(t){return this._meshFactory instanceof t||(this._meshFactory=new t,this._meshDirty=!0),this._meshFactory}setDrawRect(t){this._contentRect.copy(t),this._meshDirty=!0}get flip(){return this._flip}set flip(t){this._flip!=t&&(this._flip=t,this._meshDirty=!0)}get color(){return this._color}set color(t){if(this._color!=t&&(this._color=t,!this._meshDirty)){we.setHex(t);let e=this._geometry.attributes.color;if(e){let t=e.array,i=t.length;for(let e=0;e<i;e+=4)t[e]=we.r,t[e+1]=we.g,t[e+2]=we.b,t[e+3]=we.a;e.needsUpdate=!0}}}get grayed(){return this._material.defines.GRAYED}set grayed(t){this.setKeyword("GRAYED",t)}setKeyword(t,e){e?(this._material.defines[t]=e,this._material.needsUpdate=!0):delete this._material.defines[t]}setMeshDirty(){this._meshDirty=!0}updateMesh(){return!!this._meshDirty&&(this.updateMeshNow(),!0)}update(t,e){this._meshDirty&&this.updateMeshNow(),this._material.clippingPlanes=t,this._material.clipping=null!=t,this._material.opacity=e}updateMeshNow(){if(this._meshDirty=!1,!this._texture||!this._meshFactory)return void(this._geometry.drawRange.count>0&&(this._geometry.setDrawRange(0,0),this._geometry.computeBoundingSphere()));let e=ge.begin();if(e.contentRect.copy(this._contentRect),e.uvRect.copy(this._texture.uvRect),this._texture?e.textureSize.set(this._texture.width,this._texture.height):e.textureSize.set(0,0),this._flip!=t.FlipType.None){if(this._flip==t.FlipType.Horizontal||this._flip==t.FlipType.Both){let t=e.uvRect.xMin;e.uvRect.xMin=e.uvRect.xMax,e.uvRect.xMax=t}if(this._flip==t.FlipType.Vertical||this._flip==t.FlipType.Both){let t=e.uvRect.yMin;e.uvRect.yMin=e.uvRect.yMax,e.uvRect.yMax=t}}e.vertexColor.setHex(this._color),this._meshFactory.onPopulateMesh(e);let i=e.currentVertCount;if(0==i)return this._geometry.drawRange.count>0&&(this._geometry.setDrawRange(0,0),this._geometry.computeBoundingSphere()),void e.end();if(this._texture.rotated){let t=this._texture.uvRect.x,s=this._texture.uvRect.y,h=this._texture.uvRect.yMax,r=0;for(let a=0;a<i;a++){let i=e.uvs[r],a=e.uvs[r+1];e.uvs[r+1]=s+i-t,e.uvs[r]=t+h-a}}let s=this._geometry;this.writeAttribute(s,"position",e.vertices,3),this.writeAttribute(s,"uv",e.uvs,2),this.writeAttribute(s,"color",e.colors,4),this.writeIndexAttribute(s,e.triangles),s.setDrawRange(0,e.triangles.length),s.computeBoundingSphere(),e.end()}writeAttribute(t,i,s,h){let r=t.attributes[i];(!r||!r.isBufferAttribute||r.array.length<s.length)&&(r=new e.BufferAttribute(new Float32Array(s.length),h),t.setAttribute(i,r)),r.copyArray(s),r.needsUpdate=!0}writeIndexAttribute(t,i){let s=t.index;(!s||!s.isBufferAttribute||s.array.length<i.length)&&(s=new e.BufferAttribute(new Uint16Array(i.length),1),t.index=s),s.copyArray(i),s.needsUpdate=!0}onPopulateMesh(t){this._texture.getDrawRect(t.contentRect),t.addQuad(t.contentRect,t.uvRect,t.vertexColor),t.addTriangles()}}var we=new Xt,xe=new P;class ve{constructor(){this.lineWidth=1}onPopulateMesh(t){let e=this.drawRect?this.drawRect:t.contentRect,i=this.fillColor?this.fillColor:t.vertexColor,s=this.lineColor?this.lineColor:t.vertexColor;if(0==this.lineWidth)0!=i.a&&t.addQuad(e,null,i);else{let h=xe;h.set(e.x,e.y,this.lineWidth,e.height),t.addQuad(h,null,s),h.set(e.xMax-this.lineWidth,e.y,this.lineWidth,e.height),t.addQuad(h,null,s),h.set(e.x+this.lineWidth,e.y,e.width-2*this.lineWidth,this.lineWidth),t.addQuad(h,null,s),h.set(e.x+this.lineWidth,e.yMax-this.lineWidth,e.width-2*this.lineWidth,this.lineWidth),t.addQuad(h,null,s),0!=i.a&&(h.setMinMax(e.x+this.lineWidth,e.y+this.lineWidth,e.xMax-this.lineWidth,e.yMax-this.lineWidth),h.width>0&&h.height>0&&t.addQuad(h,null,i))}t.addTriangles()}}class be{constructor(t,i,s){i=i||1,s=s||1,this._nativeTexture=t,this._root=this,this.uvRect=new P(0,0,i,s),s<0&&(this.uvRect.y=-s,this.uvRect.height=s),i<0&&(this.uvRect.x=-i,this.uvRect.width=i),this.originalSize=t?new e.Vector2(t.image.width,t.image.height):new e.Vector2(2,2),this.region=new P(0,0,this.originalSize.x,this.originalSize.y),this.offset=new e.Vector2(0,0)}createSubTexture(t,e,i,s){let h=new be;if(h._root=this,h.rotated=e||!1,h.region.copy(t),h.region.x+=this.region.x,h.region.y+=this.region.y,h.uvRect.set(h.region.x*this.uvRect.width/this.width,1-h.region.yMax*this.uvRect.height/this.height,h.region.width*this.uvRect.width/this.width,h.region.height*this.uvRect.height/this.height),e){let t=h.region.width;h.region.width=h.region.height,h.region.height=t,t=h.uvRect.width,h.uvRect.width=h.uvRect.height,h.uvRect.height=t}return s?h.originalSize.copy(s):h.originalSize.set(h.region.width,h.region.height),i&&h.offset.copy(i),h}get width(){return this.region.width}get height(){return this.region.height}get nativeTexture(){return this._root==this?this._nativeTexture:this._root.nativeTexture}getDrawRect(t){if(this.originalSize.x==this.region.width&&this.originalSize.y==this.region.height)return t;let e=t.width/this.originalSize.x,i=t.height/this.originalSize.y;return t.x=this.offset.x*e,t.y=this.offset.y*i,t.width=this.region.width*e,t.height=this.region.height*i,t}getUV(t){if(t[0]=this.uvRect.position,t[1]=new e.Vector2(this.uvRect.x,this.uvRect.yMax),t[2]=new e.Vector2(this.uvRect.xMax,this.uvRect.yMax),t[3]=new e.Vector2(this.uvRect.xMax,this.uvRect.y),this.rotated){let e=this.uvRect.xMin,i=this.uvRect.yMin,s=this.uvRect.yMax;for(let h=0;h<4;h++){let r=t[h],a=r.y;r.y=i+r.x-e,r.x=e+s-a}}}get root(){return this._root}reload(t){if(this._root!=this)throw new Error("Reload is not allow to call on none root NTexture.");this._nativeTexture&&this._nativeTexture!=t&&this._nativeTexture.dispose(),this._nativeTexture=t,this._nativeTexture?this.originalSize.set(t.image.width,t.image.height):this.originalSize.set(0,0),this.region.set(0,0,this.originalSize.x,this.originalSize.y)}dispose(){this._root==this&&this._nativeTexture.dispose()}}const Ce=new be;class Se{constructor(){this.topLeftRadius=0,this.topRightRadius=0,this.bottomLeftRadius=0,this.bottomRightRadius=0,this.lineWidth=1,this.lineColor=new Xt}onPopulateMesh(t){let e=this.drawRect?this.drawRect:t.contentRect,i=this.fillColor?this.fillColor:t.vertexColor,s=this.lineColor,h=e.width/2,r=e.height/2,a=Math.min(h,r),n=h+e.x,o=r+e.y;t.addVert(n,o,0,i);let l=t.currentVertCount;for(let h=0;h<4;h++){let r=0;switch(h){case 0:r=this.bottomRightRadius;break;case 1:r=this.bottomLeftRadius;break;case 2:r=this.topLeftRadius;break;case 3:r=this.topRightRadius}r=Math.min(a,r);let n=e.x,o=e.y;if(0!=h&&3!=h||(n=e.xMax-2*r),0!=h&&1!=h||(o=e.yMax-2*r),0!=r){let e=Math.max(1,Math.ceil(Math.PI*r/8))+1,a=Math.PI/2/e,l=Math.PI/2*h,_=l;for(let h=1;h<=e;h++){h==e&&(l=_+Math.PI/2);let d=n+Math.cos(l)*(r-this.lineWidth)+r,c=o+Math.sin(l)*(r-this.lineWidth)+r;t.addVert(d,c,0,i),0!=this.lineWidth&&(t.addVert(d,c,0,s),t.addVert(n+Math.cos(l)*r+r,o+Math.sin(l)*r+r,0,s)),l+=a}}else{let e=n,r=o;0!=this.lineWidth?(0==h||3==h?n-=this.lineWidth:n+=this.lineWidth,0==h||1==h?o-=this.lineWidth:o+=this.lineWidth,t.addVert(n,o,0,i),t.addVert(n,o,0,s),t.addVert(e,r,0,s)):t.addVert(e,r,0,i)}}if(l=t.currentVertCount-l,this.lineWidth>0)for(let e=0;e<l;e+=3)e!=l-3?(t.addTriangle(0,e+4,e+1),t.addTriangle(e+5,e+3,e+2),t.addTriangle(e+3,e+5,e+6)):(t.addTriangle(0,1,e+1),t.addTriangle(2,e+3,e+2),t.addTriangle(e+3,2,3));else for(let e=0;e<l;e++)t.addTriangle(0,e==l-1?1:e+2,e+1)}hitTest(t,e,i){return this.drawRect?this.drawRect.contains(e,i):t.contains(e,i)}}const Te=[0,4,1,0,3,4,0,2,3,0,8,5,0,7,8,0,6,7,6,5,2,2,1,6];var Ie=new e.Vector3;class Pe{constructor(){this.lineColor=new Xt,this.lineWidth=1,this.startDegree=0,this.endDegreee=360}onPopulateMesh(t){let e=this.drawRect?this.drawRect:t.contentRect,i=this.fillColor?this.fillColor:t.vertexColor,s=this.lineColor,h=le(this.startDegree,0,360),r=le(this.endDegreee,0,360),a=h>0||r<360;h=h*Math.PI/180,r=r*Math.PI/180;let n=this.centerColor?this.centerColor:i,o=e.width/2,l=e.height/2,_=Math.ceil(Math.PI*(o+l)/4);_=le(_,40,800);let d=2*Math.PI/_,c=0,u=0;this.lineWidth>0&&a&&(u=this.lineWidth/Math.max(o,l),h+=u,r-=u);let g=t.currentVertCount,p=e.x+o,f=e.y+l;t.addVert(p,f,0,n);for(let e=0;e<_;e++){c<h?c=h:c>r&&(c=r);let e=Math.cos(c)*(o-this.lineWidth)+p,a=Math.sin(c)*(l-this.lineWidth)+f;t.addVert(e,a,0,i),this.lineWidth>0&&(t.addVert(e,a,0,s),t.addVert(Math.cos(c)*o+p,Math.sin(c)*l+f,0,s)),c+=d}if(this.lineWidth>0){let e=3*_;for(let i=0;i<e;i+=3)i!=e-3?(t.addTriangle(0,i+4,i+1),t.addTriangle(i+5,i+3,i+2),t.addTriangle(i+3,i+5,i+6)):a?(t.addTriangle(0,i+1,i+1),t.addTriangle(i+2,i+3,i+2),t.addTriangle(i+3,i+2,i+3)):(t.addTriangle(0,1,i+1),t.addTriangle(2,i+3,i+2),t.addTriangle(i+3,2,3))}else for(let e=0;e<_;e++)e!=_-1?t.addTriangle(0,e+2,e+1):a?t.addTriangle(0,e+1,e+1):t.addTriangle(0,1,e+1);if(this.lineWidth>0&&a){t.addVert(o,l,0,s);let e=.5*this.lineWidth;h-=u,c=h+.5*u+.5*Math.PI,t.addVert(Math.cos(c)*e+o,Math.sin(c)*e+l,0,s),c-=Math.PI,t.addVert(Math.cos(c)*e+o,Math.sin(c)*e+l,0,s),t.addVert(Math.cos(h)*o+o,Math.sin(h)*l+l,0,s),t.getPosition(g+3,Ie),t.addVert(Ie.x,Ie.y,Ie.z,s),r+=u,c=r-.5*u+.5*Math.PI,t.addVert(Math.cos(c)*e+o,Math.sin(c)*e+l,0,s),c-=Math.PI,t.addVert(Math.cos(c)*e+o,Math.sin(c)*e+l,0,s),t.getPosition(g+3*_,Ie),t.addVert(Ie.x,Ie.y,Ie.z,s),t.addVert(Math.cos(r)*o+o,Math.sin(r)*l+l,0,s),t.addTriangles(3*_+1,Te)}}hitTest(t,e,i){if(!t.contains(e,i))return!1;let s=.5*t.width,h=.5*t.height;if(e=e-s-t.x,i=i-h-t.y,Math.pow(e/s,2)+Math.pow(i/h,2)<1){if(0!=this.startDegree||360!=this.endDegreee){let t=180*Math.atan2(i,e)/Math.PI;return t<0&&(t+=360),t>=this.startDegree&&t<=this.endDegreee}return!0}return!1}}var ke=[],Me=new e.Vector2,Oe=new e.Vector2,ze=new e.Vector2,Le=new e.Vector2,Be=new e.Vector3,Fe=new e.Vector3,je=new e.Vector3,Re=new e.Vector3,Ae=new e.Vector3;class De{constructor(){this.points=new Array,this.texcoords=new Array}add(t,e,i,s){this.points.push(t,e),null!=i&&this.texcoords.push(i,s)}onPopulateMesh(t){let e,i,s=this.points.length/2;if(s<3)return;let h,r,a,n,o,l=null!=this.fillColor?this.fillColor:t.vertexColor,_=t.contentRect.width,d=t.contentRect.height,c=this.texcoords.length>=this.points.length;for(let e=0;e<s;e++){let i=2*e,s=this.points[i],h=this.points[i+1];if(this.usePercentPositions&&(s*=_,h*=d),c){let e=this.texcoords[i],r=this.texcoords[i+1];e=de(t.uvRect.x,t.uvRect.xMax,e),r=de(t.uvRect.y,t.uvRect.yMax,r),t.addVert(s,h,0,e,r,l)}else t.addVert(s,h,0,l)}ke.length=0;for(let t=0;t<s;++t)ke.push(t);for(e=0,i=s;i>3;){if(r=!1,a=ke[e%i],n=ke[(e+1)%i],o=ke[(e+2)%i],Me.set(this.points[2*a],this.points[2*a+1]),Oe.set(this.points[2*n],this.points[2*n+1]),ze.set(this.points[2*o],this.points[2*o+1]),(Me.y-Oe.y)*(ze.x-Oe.x)+(Oe.x-Me.x)*(ze.y-Oe.y)>=0){r=!0;for(let t=3;t<i;++t)if(h=ke[(e+t)%i],Le.set(this.points[2*h],this.points[2*h+1]),this.isPointInTriangle(Le,Me,Oe,ze)){r=!1;break}}if(r)t.addTriangle(a,o,n),ke.splice((e+1)%i,1),i--,e=0;else if(e++,e==i)break}t.addTriangle(ke[0],ke[2],ke[1]),this.lineWidth>0&&this.drawOutline(t)}drawOutline(t){let i=this.points.length/2,s=t.currentVertCount-i,h=t.currentVertCount;for(let r=0;r<i;r++)t.getPosition(s+r,Be),r<i-1?t.getPosition(s+r+1,Fe):t.getPosition(t.vertices[s],Fe),Re.copy(Fe),Re.sub(Be),Ae.copy(Re),Ae.cross(new e.Vector3(0,0,1)),Ae.normalize(),Ae.multiplyScalar(.5*this.lineWidth),je.copy(Be),je.sub(Ae),t.addVert(je.x,je.y,je.z,this.lineColor),je.copy(Be),je.add(Ae),t.addVert(je.x,je.y,je.z,this.lineColor),je.copy(Fe),je.sub(Ae),t.addVert(je.x,je.y,je.z,this.lineColor),je.copy(Fe),je.add(Ae),t.addVert(je.x,je.y,je.z,this.lineColor),h+=4,t.addTriangle(h-4,h-1,h-3),t.addTriangle(h-4,h-2,h-1),0!=r&&(t.addTriangle(h-6,h-3,h-5),t.addTriangle(h-6,h-4,h-3)),r==i-1&&(s+=i,t.addTriangle(h-2,s+1,h-1),t.addTriangle(h-2,s,s+1))}isPointInTriangle(t,e,i,s){let h=s.x-e.x,r=s.y-e.y,a=i.x-e.x,n=i.y-e.y,o=t.x-e.x,l=t.y-e.y,_=h*h+r*r,d=h*a+r*n,c=h*o+r*l,u=a*a+n*n,g=a*o+n*l,p=1/(_*u-d*d),f=(u*c-d*g)*p,m=(_*g-d*c)*p;return f>=0&&m>=0&&f+m<1}hitTest(t,e,i){if(!t.contains(e,i))return!1;let s,h=this.points.length/2,r=h-1,a=!1,n=t.width,o=t.height;for(s=0;s<h;++s){let t=this.points[2*s],h=this.points[2*s+1],l=this.points[2*r],_=this.points[2*r+1];this.usePercentPositions&&(t*=n,h*=o,t*=n,h*=o),(h<i&&_>=i||_<i&&h>=i)&&(t<=e||l<=e)&&t+(i-h)/(_-h)*(l-t)<e&&(a=!a),r=s}return a}}class Ve{constructor(){this.sides=3,this.lineWidth=1,this.lineColor=new Xt}onPopulateMesh(t){if(null!=this.distances&&this.distances.length<this.sides)return void console.error("distances.Length<sides");let e=null!=this.drawRect?this.drawRect:t.contentRect,i=null!=this.fillColor?this.fillColor:t.vertexColor,s=2*Math.PI/this.sides,h=this.rotation*Math.PI/180,r=Math.min(e.width/2,e.height/2),a=r+e.x,n=r+e.y;t.addVert(a,n,0,this.centerColor?this.centerColor:i);for(let e=0;e<this.sides;e++){let o=r;null!=this.distances&&(o*=this.distances[e]);let l=Math.cos(h)*(o-this.lineWidth),_=Math.sin(h)*(o-this.lineWidth);t.addVert(l+a,_+n,0,i),this.lineWidth>0&&(t.addVert(l+a,_+n,0,this.lineColor),l=Math.cos(h)*o+a,_=Math.sin(h)*o+n,t.addVert(l,_,0,this.lineColor)),h+=s}if(this.lineWidth>0){let e=3*this.sides;for(let i=0;i<e;i+=3)i!=e-3?(t.addTriangle(0,i+4,i+1),t.addTriangle(i+5,i+3,i+2),t.addTriangle(i+3,i+5,i+6)):(t.addTriangle(0,1,i+1),t.addTriangle(2,i+3,i+2),t.addTriangle(i+3,2,3))}else for(let e=0;e<this.sides;e++)t.addTriangle(0,e==this.sides-1?1:e+2,e+1)}hitTest(t,e,i){return this.drawRect?this.drawRect.contains(e,i):t.contains(e,i)}}class Ee extends ft{constructor(){super(),this._graphics=new ye(this._obj3D),this._graphics.texture=Ce}drawRect(t,e,i){let s=this._graphics.getMeshFactory(ve);s.lineWidth=t,s.lineColor=e,s.fillColor=i,this._graphics.setMeshDirty(),1==i.a?(s.fillColor=null,this._graphics.color=i.getHex()):this._graphics.color=16777215}drawRoundRect(t,e,i,s,h,r,a){let n=this._graphics.getMeshFactory(Se);n.lineWidth=t,n.lineColor=e,n.fillColor=i,n.topLeftRadius=s,n.topRightRadius=h,n.bottomLeftRadius=r,n.bottomRightRadius=a,this._graphics.setMeshDirty(),1==i.a?(n.fillColor=null,this._graphics.color=i.getHex()):this._graphics.color=16777215}drawEllipse(t,e,i,s,h,r){let a=this._graphics.getMeshFactory(Pe);a.lineWidth=t,a.lineColor=i,a.fillColor=s,e.equals(s)?a.centerColor=null:a.centerColor=e,a.startDegree=h,a.endDegreee=r,this._graphics.setMeshDirty(),1==s.a?(a.fillColor=null,this._graphics.color=s.getHex()):this._graphics.color=16777215}drawPolygon(t,e,i,s){let h=this._graphics.getMeshFactory(De);h.points.length=0,h.points.push.apply(h.points,t),h.fillColor=e,h.lineWidth=i,h.lineColor=s,this._graphics.setMeshDirty(),1==e.a?(h.fillColor=null,this._graphics.color=e.getHex()):this._graphics.color=16777215}drawRegularPolygon(t,e,i,s,h,r,a){let n=this._graphics.getMeshFactory(Ve);n.sides=t,n.lineWidth=e,n.centerColor=i,n.lineColor=s,n.fillColor=h,n.rotation=r,n.distances=a,this._graphics.setMeshDirty(),1==h.a?(n.fillColor=null,this._graphics.color=h.getHex()):this._graphics.color=16777215}clear(){this._graphics.meshFactory=null,this._graphics.setMeshDirty()}hitTest(t){if(!this._graphics.meshFactory)return null;let e=t.getLocal(this),i=this._graphics.meshFactory;return"hitTest"in i?i.hitTest(this._contentRect,e.x,e.y)?this:null:this._contentRect.contains(e)?this:null}}class We extends qt{constructor(){super()}get shape(){return this._shape}get color(){return this._shape.graphics.color}set color(t){this._shape.graphics.color!=t&&(this._shape.graphics.color=t,this.updateGear(4))}createDisplayObject(){this._displayObject=this._shape=new Ee}getProp(e){return e==t.ObjectPropID.Color?this.color:super.getProp(e)}setProp(e,i){e==t.ObjectPropID.Color?this.color=i:super.setProp(e,i)}setup_beforeAdd(t,e){super.setup_beforeAdd(t,e),t.seek(e,5);let i=t.readByte();if(0!=i){let e,s,h,r=t.readInt(),a=t.readFullColor(),n=t.readFullColor(),o=t.readBool();if(o)for(h=[],e=0;e<4;e++)h[e]=t.readFloat();if(1==i)o?this._shape.drawRoundRect(r,a,n,h[0],h[1],h[2],h[3]):this._shape.drawRect(r,a,n);else if(2==i)this._shape.drawEllipse(r,n,a,n,0,360);else if(3==i){s=t.readShort();let i=[];for(i.length=s,e=0;e<s;e++)i[e]=t.readFloat();this._shape.drawPolygon(i,n,r,a)}else if(4==i){let i,h=t.readShort(),o=t.readFloat();if(s=t.readShort(),s>0)for(i=[],e=0;e<s;e++)i[e]=t.readFloat();this._shape.drawRegularPolygon(h,r,n,a,n,o,i)}}}}class He{constructor(){this.origin=0,this.amount=1,this.clockwise=!0}onPopulateMesh(e){let i=_e(this.amount);switch(this.method){case t.FillMethod.Horizontal:!function(e,i,s,h){Ge.copy(i);let r=(i=Ge).width*h;s!=t.FillOrigin.Right&&s!=t.FillOrigin.Bottom||(i.x+=i.width-r);i.width=r,e.addQuad(i),e.addTriangles()}(e,e.contentRect,this.origin,i);break;case t.FillMethod.Vertical:!function(e,i,s,h){Ge.copy(i);let r=(i=Ge).height*h;s!=t.FillOrigin.Right&&s!=t.FillOrigin.Bottom||(i.y+=i.height-r);i.height=r,e.addQuad(i),e.addTriangles()}(e,e.contentRect,this.origin,i);break;case t.FillMethod.Radial90:Ue(e,e.contentRect,this.origin,i,this.clockwise);break;case t.FillMethod.Radial180:Xe(e,e.contentRect,this.origin,i,this.clockwise);break;case t.FillMethod.Radial360:!function(e,i,s,h,r){switch(Qe.copy(i),i=Qe,s){case t.FillOrigin.Top:if(h<.5){i.width/=2,r&&(i.x+=i.width),Xe(e,i,r?t.FillOrigin.Left:t.FillOrigin.Right,h/.5,r);let s=e.getPosition(-8,Ne);Ge.set(s.x,s.y,0,0),e.addQuad(Ge),e.addTriangles(-4)}else i.width/=2,r||(i.x+=i.width),Xe(e,i,r?t.FillOrigin.Right:t.FillOrigin.Left,(h-.5)/.5,r),r?i.x+=i.width:i.x-=i.width,e.addQuad(i),e.addTriangles(-4);break;case t.FillOrigin.Bottom:if(h<.5){i.width/=2,r||(i.x+=i.width),Xe(e,i,r?t.FillOrigin.Right:t.FillOrigin.Left,h/.5,r);let s=e.getPosition(-8,Ne);Ge.set(s.x,s.y,0,0),e.addQuad(Ge),e.addTriangles(-4)}else i.width/=2,r&&(i.x+=i.width),Xe(e,i,r?t.FillOrigin.Left:t.FillOrigin.Right,(h-.5)/.5,r),r?i.x-=i.width:i.x+=i.width,e.addQuad(i),e.addTriangles(-4);break;case t.FillOrigin.Left:if(h<.5){i.height/=2,r||(i.y+=i.height),Xe(e,i,r?t.FillOrigin.Bottom:t.FillOrigin.Top,h/.5,r);let s=e.getPosition(-8,Ne);Ge.set(s.x,s.y,0,0),e.addQuad(Ge),e.addTriangles(-4)}else i.height/=2,r&&(i.y+=i.height),Xe(e,i,r?t.FillOrigin.Top:t.FillOrigin.Bottom,(h-.5)/.5,r),r?i.y-=i.height:i.y+=i.height,e.addQuad(i),e.addTriangles(-4);break;case t.FillOrigin.Right:if(h<.5){i.height/=2,r&&(i.y+=i.height),Xe(e,i,r?t.FillOrigin.Top:t.FillOrigin.Bottom,h/.5,r);let s=e.getPosition(-8,Ne);Ge.set(s.x,s.y,0,0),e.addQuad(Ge),e.addTriangles(-4)}else i.height/=2,r||(i.y+=i.height),Xe(e,i,r?t.FillOrigin.Bottom:t.FillOrigin.Top,(h-.5)/.5,r),r?i.y+=i.height:i.y-=i.height,e.addQuad(i),e.addTriangles(-4)}}(e,e.contentRect,this.origin,i,this.clockwise)}}}var Ne=new e.Vector3,Ge=new P;function Ue(e,i,s,h,r){let a=s==t.FillOrigin.TopRight||s==t.FillOrigin.BottomRight,n=s==t.FillOrigin.BottomLeft||s==t.FillOrigin.BottomRight;a!=n&&(r=!r);let o=r?h:1-h,l=Math.tan(.5*Math.PI*o),_=!1;1!=o&&(_=i.height/i.width-l>0),r||(_=!_);let d=i.x+(0==o?Number.POSITIVE_INFINITY:i.height/l),c=i.y+(1==o?Number.POSITIVE_INFINITY:i.width*l),u=d,g=c;a&&(u=i.width-d),n&&(g=i.height-c);let p=a?i.width-i.x:i.xMin,f=n?i.height-i.y:i.yMin,m=a?-i.x:i.xMax,y=n?-i.y:i.yMax;e.addVert(p,f,0),r&&e.addVert(m,f,0),c>i.yMax?_?e.addVert(u,y,0):e.addVert(m,y,0):e.addVert(m,g,0),d>i.xMax?_?e.addVert(m,g,0):e.addVert(m,y,0):e.addVert(u,y,0),r||e.addVert(p,y,0),a==n?(e.addTriangle(0,2,1),e.addTriangle(0,3,2)):(e.addTriangle(2,0,1),e.addTriangle(3,0,2))}var Ye=new P;function Xe(e,i,s,h,r){switch(Ye.copy(i),i=Ye,s){case t.FillOrigin.Top:if(h<=.5){i.width/=2,r&&(i.x+=i.width),Ue(e,i,r?t.FillOrigin.TopLeft:t.FillOrigin.TopRight,h/.5,r);let s=e.getPosition(-4,Ne);Ge.set(s.x,s.y,0,0),e.addQuad(Ge),e.addTriangles(-4)}else i.width/=2,r||(i.x+=i.width),Ue(e,i,r?t.FillOrigin.TopRight:t.FillOrigin.TopLeft,(h-.5)/.5,r),r?i.x+=i.width:i.x-=i.width,e.addQuad(i),e.addTriangles(-4);break;case t.FillOrigin.Bottom:if(h<=.5){i.width/=2,r||(i.x+=i.width),Ue(e,i,r?t.FillOrigin.BottomRight:t.FillOrigin.BottomLeft,h/.5,r);let s=e.getPosition(-4,Ne);Ge.set(s.x,s.y,0,0),e.addQuad(Ge),e.addTriangles(-4)}else i.width/=2,r&&(i.x+=i.width),Ue(e,i,r?t.FillOrigin.BottomLeft:t.FillOrigin.BottomRight,(h-.5)/.5,r),r?i.x-=i.width:i.x+=i.width,e.addQuad(i),e.addTriangles(-4);break;case t.FillOrigin.Left:if(h<=.5){i.height/=2,r||(i.y+=i.height),Ue(e,i,r?t.FillOrigin.BottomLeft:t.FillOrigin.TopLeft,h/.5,r);let s=e.getPosition(-4,Ne);Ge.set(s.x,s.y,0,0),e.addQuad(Ge),e.addTriangles(-4)}else i.height/=2,r&&(i.y+=i.height),Ue(e,i,r?t.FillOrigin.TopLeft:t.FillOrigin.BottomLeft,(h-.5)/.5,r),r?i.y-=i.height:i.y+=i.height,e.addQuad(i),e.addTriangles(-4);break;case t.FillOrigin.Right:if(h<=.5){i.height/=2,r&&(i.y+=i.height),Ue(e,i,r?t.FillOrigin.TopRight:t.FillOrigin.BottomRight,h/.5,r);let s=e.getPosition(-4,Ne);Ge.set(s.x,s.y,0,0),e.addQuad(Ge),e.addTriangles(-4)}else i.height/=2,r||(i.y+=i.height),Ue(e,i,r?t.FillOrigin.BottomRight:t.FillOrigin.TopRight,(h-.5)/.5,r),r?i.y+=i.height:i.y-=i.height,e.addQuad(i),e.addTriangles(-4)}}var Qe=new P;class qe extends ft{constructor(){super(),this._tileGridIndice=0,this._graphics=new ye(this._obj3D),this._graphics.meshFactory=this,this._textureScale=new e.Vector2(1,1)}get texture(){return this._graphics.texture}set texture(t){this._graphics.texture=t}get textureScale(){return this._textureScale}set textureScale(t){this._textureScale.equals(t)||(this._textureScale.copy(t),this._graphics.setMeshDirty())}get scale9Grid(){return this._scale9Grid}set scale9Grid(t){this._scale9Grid=t,this._graphics.setMeshDirty()}get scaleByTile(){return this._scaleByTile}set scaleByTile(t){this._scaleByTile!=t&&(this._scaleByTile=t,this._graphics.setMeshDirty())}get tileGridIndice(){return this._tileGridIndice}set tileGridIndice(t){this._tileGridIndice!=t&&(this._tileGridIndice=t,this._graphics.setMeshDirty())}get fillMethod(){return this._fillMesh?this._fillMesh.method:t.FillMethod.None}set fillMethod(e){if(!this._fillMesh){if(e==t.FillMethod.None)return;this._fillMesh=new He}this._fillMesh.method!=e&&(this._fillMesh.method=e,this._graphics.setMeshDirty())}get fillOrigin(){return this._fillMesh?this._fillMesh.origin:0}set fillOrigin(t){this._fillMesh||(this._fillMesh=new He),this._fillMesh.origin!=t&&(this._fillMesh.origin=t,this._graphics.setMeshDirty())}get fillClockwise(){return!this._fillMesh||this._fillMesh.clockwise}set fillClockwise(t){this._fillMesh||(this._fillMesh=new He),this._fillMesh.clockwise!=t&&(this._fillMesh.clockwise=t,this._graphics.setMeshDirty())}get fillAmount(){return this._fillMesh?this._fillMesh.amount:0}set fillAmount(t){this._fillMesh||(this._fillMesh=new He),this._fillMesh.amount!=t&&(this._fillMesh.amount=t,this._graphics.setMeshDirty())}onPopulateMesh(e){this._fillMesh&&this._fillMesh.method!=t.FillMethod.None?this._fillMesh.onPopulateMesh(e):this._scaleByTile?(si.copy(e.contentRect),si.width*=this._textureScale.x,si.height*=this._textureScale.y,this.tileFill(e,si,e.uvRect,this._graphics.texture.width,this._graphics.texture.height),e.addTriangles()):this._scale9Grid?this.sliceFill(e):this._graphics.onPopulateMesh(e)}sliceFill(e){let i=this.texture;ii.copy(this._scale9Grid),si.copy(e.contentRect),si.width*=this._textureScale.x,si.height*=this._textureScale.y;let s=e.uvRect,h=i.width,r=i.height,a=this._graphics.flip;a!=t.FlipType.None&&(a!=t.FlipType.Horizontal&&a!=t.FlipType.Both||(ii.x=h-ii.xMax,ii.xMax=ii.x+ii.width),a!=t.FlipType.Vertical&&a!=t.FlipType.Both||(ii.y=r-ii.yMax,ii.yMax=ii.y+ii.height));let n=s.width/h,o=s.height/r,l=s.xMax,_=s.yMax,d=ii.xMax,c=ii.yMax;if(ti[0]=s.x,ti[1]=s.x+ii.x*n,ti[2]=s.x+d*n,ti[3]=l,ei[0]=_,ei[1]=_-ii.y*o,ei[2]=_-c*o,ei[3]=s.y,si.width>=h-ii.width)Ze[1]=ii.x,Ze[2]=si.width-(h-d),Ze[3]=si.width;else{let t=ii.x/(h-d);t=si.width*t/(1+t),Ze[1]=t,Ze[2]=t,Ze[3]=si.width}if(si.height>=r-ii.height)Je[1]=ii.y,Je[2]=si.height-(r-c),Je[3]=si.height;else{let t=ii.y/(r-c);t=si.height*t/(1+t),Je[1]=t,Je[2]=t,Je[3]=si.height}if(0==this._tileGridIndice){for(let t=0;t<4;t++)for(let i=0;i<4;i++)e.addVert(Ze[i]/this._textureScale.x,Je[t]/this._textureScale.y,0,ti[i],ei[t],e.vertexColor);e.addTriangles(0,Ke)}else{let t,i,s;for(let h=0;h<9;h++)i=h%3,t=h/3,s=$e[h],hi.setMinMax(Ze[i],Je[t],Ze[i+1],Je[t+1]),ri.setMinMax(ti[i],ei[t+1],ti[i+1],ei[t]),-1!=s&&0!=(this._tileGridIndice&1<<s)?this.tileFill(e,hi,ri,0==s||1==s||4==s?ii.width:hi.width,2==s||3==s||4==s?ii.height:hi.height):(hi.x/=this._textureScale.x,hi.y/=this._textureScale.y,hi.width/=this._textureScale.x,hi.height/=this._textureScale.y,e.addQuad(hi,ri,e.vertexColor));e.addTriangles()}}tileFill(t,e,i,s,h){let r=Math.ceil(e.width/s),a=Math.ceil(e.height/h),n=e.width-(r-1)*s,o=e.height-(a-1)*h,l=i.xMax,_=i.yMax;for(let d=0;d<r;d++)for(let c=0;c<a;c++)ni.copy(i),d==r-1&&(ni.xMax=de(i.x,l,n/s)),c==a-1&&(ni.yMin=de(i.y,_,1-o/h)),ai.set(e.x+d*s,e.y+c*h,d==r-1?n:s,c==a-1?o:h),ai.x/=this._textureScale.x,ai.y/=this._textureScale.y,ai.width/=this._textureScale.x,ai.height/=this._textureScale.y,t.addQuad(ai,ni,t.vertexColor)}}const Ke=[4,1,0,1,4,5,5,2,1,2,5,6,6,3,2,3,6,7,8,5,4,5,8,9,9,6,5,6,9,10,10,7,6,7,10,11,12,9,8,9,12,13,13,10,9,10,13,14,14,11,10,11,14,15],$e=[-1,0,-1,2,4,3,-1,1,-1];var Ze=[0,0,0,0],Je=[0,0,0,0],ti=[0,0,0,0],ei=[0,0,0,0],ii=new P,si=new P,hi=new P,ri=new P,ai=new P,ni=new P;class oi extends qt{constructor(){super()}get color(){return this._image.graphics.color}set color(t){this._image.graphics.color!=t&&(this._image.graphics.color=t,this.updateGear(4))}get flip(){return this._image.graphics.flip}set flip(t){this._image.graphics.flip=t}get fillMethod(){return this._image.fillMethod}set fillMethod(t){this._image.fillMethod=t}get fillOrigin(){return this._image.fillOrigin}set fillOrigin(t){this._image.fillOrigin=t}get fillClockwise(){return this._image.fillClockwise}set fillClockwise(t){this._image.fillClockwise=t}get fillAmount(){return this._image.fillAmount}set fillAmount(t){this._image.fillAmount=t}createDisplayObject(){this._displayObject=this._image=new qe}handleSizeChanged(){this._image.width=this._width,this._image.height=this._height}constructFromResource(){this._contentItem=this.packageItem.getBranch(),this.sourceWidth=this._contentItem.width,this.sourceHeight=this._contentItem.height,this.initWidth=this.sourceWidth,this.initHeight=this.sourceHeight,this._contentItem=this._contentItem.getHighResolution(),this._contentItem.load(),this._image.scale9Grid=this._contentItem.scale9Grid,this._image.scaleByTile=this._contentItem.scaleByTile,this._image.tileGridIndice=this._contentItem.tileGridIndice,this._image.texture=this._contentItem.texture,this.setSize(this.sourceWidth,this.sourceHeight)}getProp(e){return e==t.ObjectPropID.Color?this.color:super.getProp(e)}setProp(e,i){e==t.ObjectPropID.Color?this.color=i:super.setProp(e,i)}setup_beforeAdd(t,e){super.setup_beforeAdd(t,e),t.seek(e,5),t.readBool()&&(this.color=t.readColor()),this.flip=t.readByte(),this._image.fillMethod=t.readByte(),0!=this._image.fillMethod&&(this._image.fillOrigin=t.readByte(),this._image.fillClockwise=t.readBool(),this._image.fillAmount=t.readFloat())}}class li extends qe{constructor(){super(),this.interval=0,this.swing=!1,this.repeatDelay=0,this.timeScale=1,this._playing=!0,this._frameCount=0,this._frame=0,this._start=0,this._end=0,this._times=0,this._endAt=0,this._status=0,this._frameElapsed=0,this._reversed=!1,this._repeatedCount=0,this.setPlaySettings(),this.on("added_to_stage",this.__addToStage,this),this.on("removed_from_stage",this.__removeFromStage,this)}get frames(){return this._frames}set frames(t){this._frames=t,this._scaleByTile=!1,this._scale9Grid=null,this._frames?(this._frameCount=this._frames.length,(-1==this._end||this._end>this._frameCount-1)&&(this._end=this._frameCount-1),(-1==this._endAt||this._endAt>this._frameCount-1)&&(this._endAt=this._frameCount-1),(this._frame<0||this._frame>this._frameCount-1)&&(this._frame=this._frameCount-1),this._frameElapsed=0,this._repeatedCount=0,this._reversed=!1):this._frameCount=0,this.drawFrame(),this.checkTimer()}get frameCount(){return this._frameCount}get frame(){return this._frame}set frame(t){this._frame!=t&&(this._frames&&t>=this._frameCount&&(t=this._frameCount-1),this._frame=t,this._frameElapsed=0,this.drawFrame())}get playing(){return this._playing}set playing(t){this._playing!=t&&(this._playing=t,this.checkTimer())}rewind(){this._frame=0,this._frameElapsed=0,this._reversed=!1,this._repeatedCount=0,this.drawFrame()}syncStatus(t){this._frame=t._frame,this._frameElapsed=t._frameElapsed,this._reversed=t._reversed,this._repeatedCount=t._repeatedCount,this.drawFrame()}advance(t){for(var e=this._frame,i=this._reversed,s=t;;){var h=this.interval+(this._frames[this._frame].addDelay||0);if(0==this._frame&&this._repeatedCount>0&&(h+=this.repeatDelay),t<h){this._frameElapsed=0;break}if(t-=h,this.swing?this._reversed?(this._frame--,this._frame<=0&&(this._frame=0,this._repeatedCount++,this._reversed=!this._reversed)):(this._frame++,this._frame>this._frameCount-1&&(this._frame=Math.max(0,this._frameCount-2),this._repeatedCount++,this._reversed=!this._reversed)):(this._frame++,this._frame>this._frameCount-1&&(this._frame=0,this._repeatedCount++)),this._frame==e&&this._reversed==i){var r=s-t;t-=Math.floor(t/r)*r}}this.drawFrame()}setPlaySettings(t,e,i,s){this._start=t||0,this._end=e||-1,(-1==this._end||this._end>this._frameCount-1)&&(this._end=this._frameCount-1),this._times=i||0,this._endAt=s||-1,-1==this._endAt&&(this._endAt=this._end),this._status=0,this.frame=this._start}onTimer(){if(this._playing&&0!=this._frameCount&&3!=this._status){var t=k.deltaTime;t>100&&(t=100),1!=this.timeScale&&(t*=this.timeScale),this._frameElapsed+=t;var e=this.interval+(this._frames[this._frame].addDelay||0);0==this._frame&&this._repeatedCount>0&&(e+=this.repeatDelay),this._frameElapsed<e||(this._frameElapsed-=e,this._frameElapsed>this.interval&&(this._frameElapsed=this.interval),this.swing?this._reversed?(this._frame--,this._frame<=0&&(this._frame=0,this._repeatedCount++,this._reversed=!this._reversed)):(this._frame++,this._frame>this._frameCount-1&&(this._frame=Math.max(0,this._frameCount-2),this._repeatedCount++,this._reversed=!this._reversed)):(this._frame++,this._frame>this._frameCount-1&&(this._frame=0,this._repeatedCount++)),1==this._status?(this._frame=this._start,this._frameElapsed=0,this._status=0):2==this._status?(this._frame=this._endAt,this._frameElapsed=0,this._status=3,this.dispatchEvent("play_end")):this._frame==this._end&&(this._times>0?(this._times--,0==this._times?this._status=2:this._status=1):this._status=1),this.drawFrame())}}drawFrame(){if(this._frameCount>0&&this._frame<this._frames.length){var t=this._frames[this._frame];this._graphics.texture=t.texture}else this._graphics.texture=null}checkTimer(){this._playing&&this._frameCount>0&&this.stage?k.addUpdate(this.onTimer,this):k.remove(this.onTimer,this)}__addToStage(){this._playing&&this._frameCount>0&&k.addUpdate(this.onTimer,this)}__removeFromStage(){k.remove(this.onTimer,this)}}class _i extends qt{constructor(){super()}get color(){return this._movieClip.graphics.color}set color(t){this._movieClip.graphics.color=t}createDisplayObject(){this._displayObject=this._movieClip=new li}get playing(){return this._movieClip.playing}set playing(t){this._movieClip.playing!=t&&(this._movieClip.playing=t,this.updateGear(5))}get frame(){return this._movieClip.frame}set frame(t){this._movieClip.frame!=t&&(this._movieClip.frame=t,this.updateGear(5))}get timeScale(){return this._movieClip.timeScale}set timeScale(t){this._movieClip.timeScale=t}rewind(){this._movieClip.rewind()}syncStatus(t){this._movieClip.syncStatus(t._movieClip)}advance(t){this._movieClip.advance(t)}setPlaySettings(t,e,i,s){this._movieClip.setPlaySettings(t,e,i,s)}getProp(e){switch(e){case t.ObjectPropID.Color:return this.color;case t.ObjectPropID.Playing:return this.playing;case t.ObjectPropID.Frame:return this.frame;case t.ObjectPropID.TimeScale:return this.timeScale;default:return super.getProp(e)}}setProp(e,i){switch(e){case t.ObjectPropID.Color:this.color=i;break;case t.ObjectPropID.Playing:this.playing=i;break;case t.ObjectPropID.Frame:this.frame=i;break;case t.ObjectPropID.TimeScale:this.timeScale=i;break;case t.ObjectPropID.DeltaTime:this.advance(i);break;default:super.setProp(e,i)}}constructFromResource(){var t=this.packageItem.getBranch();this.sourceWidth=t.width,this.sourceHeight=t.height,this.initWidth=this.sourceWidth,this.initHeight=this.sourceHeight,this.setSize(this.sourceWidth,this.sourceHeight),(t=t.getHighResolution()).load(),this._movieClip.interval=t.interval,this._movieClip.swing=t.swing,this._movieClip.repeatDelay=t.repeatDelay,this._movieClip.frames=t.frames}setup_beforeAdd(t,e){super.setup_beforeAdd(t,e),t.seek(e,5),t.readBool()&&(this.color=t.readColor()),this._movieClip.graphics.flip=t.readByte(),this._movieClip.frame=t.readInt(),this._movieClip.playing=t.readBool()}}class di{load(t){t.readInt(),this.pixelWidth=t.readInt(),this.scale=1/t.readByte();let e=t.readInt();this.pixels=new Uint8Array(t.data,t.pos,e),t.skip(e)}}class ci{constructor(t,e,i,s,h){this._data=t,this.offsetX=e,this.offsetY=i,this.sourceWidth=s,this.sourceHeight=h}hitTest(t,e,i){if(!t.contains(e,i))return!1;let s=this._data;if(e=Math.floor((e*this.sourceWidth/t.width-this.offsetX)*s.scale),i=Math.floor((i*this.sourceHeight/t.height-this.offsetY)*s.scale),e<0||i<0||e>=s.pixelWidth)return!1;let h=i*s.pixelWidth+e,r=Math.floor(h/8),a=h%8;return r>=0&&r<s.pixels.length&&(s.pixels[r]>>a&1)>0}}var ui,gi,pi=new P,fi=new Xt(16777215,1);class mi{constructor(){this.version=0,this.size=0,this.glyphs={},this._color=new Xt}setFormat(t,e){this.resizable?this._scale=t.size/this.size*e:this._scale=e,this._color.setHex(t.color)}prepareCharacters(t){}getGlyph(t,e){return" "==t?(e.width=Math.round(this.size*this._scale/2),e.height=Math.round(this.size*this._scale),e.baseline=e.height,this._glyph=null,!0):(this._glyph=this.glyphs[t])?(e.width=Math.round(this._glyph.advance*this._scale),e.height=Math.round(this._glyph.lineHeight*this._scale),e.baseline=e.height,!0):(e.width=0,e.height=0,e.baseline=0,!1)}drawGlyph(t,e,i){if(!this._glyph)return 0;let s=t+this._glyph.x*this._scale,h=-e-this._glyph.y*this._scale,r=t+(this._glyph.x+this._glyph.width)*this._scale,a=-e-(this._glyph.y+this._glyph.height)*this._scale;return pi.setMinMax(s,a,r,h),i.addQuad(pi,this._glyph.uv,this.tint?this._color:fi),i.addTriangles(-4),4}drawLine(t,e,i,s,h,r){return 0}getLineHeight(t){for(var e in this.glyphs){let i=this.glyphs[e];return this.resizable?Math.round(i.lineHeight*t/this.size):i.lineHeight}return 0}}class yi{constructor(){this.x=0,this.y=0,this.width=0,this.height=0,this.advance=0,this.lineHeight=0,this.channel=0,this.uv=[new e.Vector2,new e.Vector2,new e.Vector2,new e.Vector2]}}class wi{constructor(t,e,i){this.version=0,e=e||0,null!=i&&-1!=i||(i=t.byteLength-e),this._buffer=t,this._view=new DataView(this._buffer,e,i),this._pos=0,this._length=i}get data(){return this._buffer}get pos(){return this._pos}set pos(t){if(t>this._length)throw"Out of bounds";this._pos=t}get length(){return this._length}skip(t){this._pos+=t}validate(t){if(this._pos+t>this._length)throw"Out of bounds"}readByte(){this.validate(1);let t=this._view.getUint8(this._pos);return this._pos++,t}readBool(){return 1==this.readByte()}readShort(){this.validate(2);let t=this._view.getInt16(this._pos,this.littleEndian);return this._pos+=2,t}readUshort(){this.validate(2);let t=this._view.getUint16(this._pos,this.littleEndian);return this._pos+=2,t}readInt(){this.validate(4);let t=this._view.getInt32(this._pos,this.littleEndian);return this._pos+=4,t}readUint(){this.validate(4);let t=this._view.getUint32(this._pos,this.littleEndian);return this._pos+=4,t}readFloat(){this.validate(4);let t=this._view.getFloat32(this._pos,this.littleEndian);return this._pos+=4,t}readString(t){null==t&&(t=this.readUshort()),this.validate(t);let e=(new TextDecoder).decode(new DataView(this._buffer,this._view.byteOffset+this._pos,t));return this._pos+=t,e}readS(){var t=this.readUshort();return 65534==t?null:65533==t?"":this.stringTable[t]}readSArray(t){for(var e=new Array(t),i=0;i<t;i++)e[i]=this.readS();return e}writeS(t){var e=this.readUshort();65534!=e&&65533!=e&&(this.stringTable[e]=t)}readColor(){var t=this.readByte(),e=this.readByte(),i=this.readByte();return this.readByte(),(t<<16)+(e<<8)+i}readFullColor(){var t=this.readByte(),e=this.readByte(),i=this.readByte(),s=this.readByte();return new Xt((t<<16)+(e<<8)+i,s/255)}readChar(){var t=this.readUshort();return String.fromCharCode(t)}readBuffer(){var t=this.readUint();this.validate(t);var e=new wi(this._buffer,this._view.byteOffset+this._pos,t);return e.stringTable=this.stringTable,e.version=this.version,this._pos+=t,e}seek(t,e){var i,s=this._pos;return this._pos=t,e<this.readByte()?(1==this.readByte()?(this._pos+=2*e,i=this.readUshort()):(this._pos+=4*e,i=this.readUint()),i>0?(this._pos=t+i,!0):(this._pos=s,!1)):(this._pos=s,!1)}}(ui=t.ScaleMode||(t.ScaleMode={}))[ui.ConstantPixelSize=0]="ConstantPixelSize",ui[ui.ScaleWithScreenSize=1]="ScaleWithScreenSize",ui[ui.ConstantPhysicalSize=2]="ConstantPhysicalSize",(gi=t.ScreenMatchMode||(t.ScreenMatchMode={}))[gi.MatchWidthOrHeight=0]="MatchWidthOrHeight",gi[gi.MatchWidth=1]="MatchWidth",gi[gi.MatchHeight=2]="MatchHeight";class xi{static get scaleFactor(){return Ii}static get scaleLevel(){return Pi}static scaleWithScreenSize(e,i,s){Ci=e,Si=i,bi=t.ScaleMode.ScaleWithScreenSize,vi=s||t.ScreenMatchMode.MatchWidthOrHeight,ki()}static setConstant(e){bi=t.ScaleMode.ConstantPixelSize,Ti=e||1,ki()}}var vi,bi=t.ScaleMode.ConstantPixelSize,Ci=1136,Si=640,Ti=1,Ii=1,Pi=0;function ki(){let e=j.width,i=j.height;if(bi==t.ScaleMode.ScaleWithScreenSize){if(0==Ci||0==Si)return;let s=Ci,h=Si;if(e>i&&s<h||e<i&&s>h){let t=s;s=h,h=t}if(vi==t.ScreenMatchMode.MatchWidthOrHeight){let t=e/s,r=i/h;Ii=Math.min(t,r)}else Ii=vi==t.ScreenMatchMode.MatchWidth?e/s:i/h}else bi==t.ScaleMode.ConstantPhysicalSize||(Ii=Ti);Ii>10&&(Ii=10),Pi=Ii>3?3:Ii>2?2:Ii>1?1:0,gt(j.scene,"content_scale_factor_changed")}j.eventDispatcher.on("size_changed",ki);class Mi{constructor(){this.width=0,this.height=0}load(){return this.owner.getItemAsset(this)}getBranch(){if(this.branches&&-1!=this.owner._branchIndex){var t=this.branches[this.owner._branchIndex];if(t)return this.owner.getItemById(t)}return this}getHighResolution(){if(this.highResolution&&xi.scaleLevel>0){var t=this.highResolution[xi.scaleLevel-1];if(t)return this.owner.getItemById(t)}return this}toString(){return this.name}}var Oi=new P;class zi{constructor(){this.version=0,this.isDynamic=!0,this.keepCrisp=!0,this._scale=1,this._glyphs={},this._color=new Xt,this._outlineColor=new Xt,this._packers=[new Li,new Li,new Li],this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d"),this._context.globalCompositeOperation="lighter",this.createTexture(512),this._scale=j.devicePixelRatio}get name(){return this._name}set name(t){this._name=t,this._canvas.id=t}createTexture(t){this._canvas.width=this._canvas.height=t,this.mainTexture?(this._texture.needsUpdate=!0,this.mainTexture.reload(this._texture)):(this._texture=new e.Texture(this._canvas),this._texture.generateMipmaps=!1,this._texture.magFilter=e.LinearFilter,this._texture.minFilter=e.LinearFilter,this.mainTexture=new be(this._texture)),this.clearTexture()}clearTexture(){this._context.fillStyle="black",this._context.clearRect(0,0,this._canvas.width,this._canvas.height),this._context.globalCompositeOperation="lighter";for(let t=0;t<3;t++)this._packers[t].init(this._canvas.width,this._canvas.height)}rebuild(){this._canvas.width<2048?this.createTexture(2*this._canvas.width):this.clearTexture(),this.version++,j.fontRebuilt=!0,console.log("font atlas rebuilt : %s (%d)",this.name,this._canvas.width)}setFormat(t,e){this._format=t;let i=t.size*e;this._size=Math.floor(i),0==this._size&&(this._size=1),this._color.setHex(t.color),this._outlineColor.setHex(t.outlineColor)}prepareCharacters(t){let e=t.length,i=0;for(i=0;i<e;i++){let e=t[i],s=this.getGlyphsOf(e,this._size);this._format.outline>0&&this.prepareOutline(e,s,this._size,this._format.outline),this.prepareChar(e,this._size,s),s.ver=this.version}}getGlyphsOf(t,e){let i=(e<<16)+t.charCodeAt(0),s=this._glyphs[i];return s&&s.ver==this.version||(this.keepCrisp&&(e*=this._scale),this._context.font=e+"px "+this._name,s||(s=this.measureChar(t,e),this._glyphs[i]=s)),s}prepareChar(t,e,i){this.keepCrisp&&(e*=this._scale);let s=i.sourceRect.width,h=i.sourceRect.height;if(0==s)return i;let r=this.addNode(s+2,h+2);return r?(this._context.font=e+"px "+this._name,this._context.textBaseline="alphabetic",this._context.fillStyle=0==r.z?"#FF0000":1==r.z?"#00FF00":"#0000FF",this._context.fillText(t,r.x+i.sourceRect.x,r.y+i.baseline),this._texture.needsUpdate=!0,i.chl=r.z/3,i.uvRect.set(r.x/this.mainTexture.width,1-(r.y+h)/this.mainTexture.height,s/this.mainTexture.width,h/this.mainTexture.height),i):(this.rebuild(),null)}prepareOutline(t,e,i,s){e.outlines||(e.outlines={});let h=e.outlines[s];if(h&&h.ver==this.version||0==e.sourceRect.width)return;h?h.ver=this.version:(h={vertRect:new P,uvRect:new P,ver:this.version},e.outlines[s]=h);let r=s;this.keepCrisp&&(r*=this._scale);let a=e.sourceRect.width+2*r,n=e.sourceRect.height+2*r,o=this.addNode(a+2,n+2);if(!o)return this.rebuild(),null;this.keepCrisp&&(i*=this._scale),this._context.font=i+"px "+this._name,this._context.textBaseline="alphabetic",this._context.strokeStyle=0==o.z?"#FF0000":1==o.z?"#00FF00":"#0000FF",this._context.lineJoin="round",this._context.lineWidth=r,this._context.strokeText(t,o.x+e.sourceRect.x+r,o.y+e.baseline+r),this._texture.needsUpdate=!0,h.chl=o.z/3,h.vertRect.copy(e.vertRect),h.vertRect.extend(s,s),h.uvRect.set(o.x/this.mainTexture.width,1-(o.y+n)/this.mainTexture.height,a/this.mainTexture.width,n/this.mainTexture.height)}measureChar(t,e){let i,s,h,r,a;this._context.textBaseline="alphabetic";let n,o=this._context.measureText(t);if("actualBoundingBoxLeft"in o){this._context.textBaseline="top";let e=this._context.measureText(t);i=o.actualBoundingBoxLeft>0?Math.ceil(o.actualBoundingBoxLeft):0,s=Math.ceil(e.actualBoundingBoxAscent)+1,h=Math.ceil(i+o.actualBoundingBoxRight)+1,r=Math.ceil(o.actualBoundingBoxAscent+o.actualBoundingBoxDescent)+2,a=Math.ceil(o.actualBoundingBoxAscent)}else a=this.getBaseline(t,this._name,e),i=0,"j"==t&&(i=Math.ceil(e/20)),s=0,h=o.width,r=1.25*e+2;return 0==h?n={ver:this.version}:(n={uvRect:new P,vertRect:new P(-i,-a,h,r),advance:o.width,sourceRect:new P(i,s,h,r),baseline:a,ver:this.version},this.keepCrisp&&(n.vertRect.x/=this._scale,n.vertRect.y/=this._scale,n.vertRect.width/=this._scale,n.vertRect.height/=this._scale,n.advance/=this._scale)),n}addNode(t,e){let i;for(let s=0;s<3;s++){let h=this._packers[s];if(!h.full&&(i=h.add(t,e))){i.z=s;break}}return i}getGlyph(t,e){let i=(this._size<<16)+t.charCodeAt(0);return this._glyph=this._glyphs[i],!!this._glyph&&(e.width=this._glyph.advance,e.height=Math.round(1.25*this._size),e.baseline=Math.round(this._size),!0)}drawGlyph(t,e,i){if(!this._glyph.vertRect)return 0;if(this._format.outline>0){if(!this._glyph.outlines)return 0;let s=this._glyph.outlines[this._format.outline];Oi.copy(s.vertRect),Oi.x+=t,Oi.y-=e,this._outlineColor.a=s.chl,i.addQuad(Oi,s.uvRect,this._outlineColor),i.addTriangles(-4)}return Oi.copy(this._glyph.vertRect),Oi.x+=t,Oi.y-=e,this._color.a=this._glyph.chl,i.addQuad(Oi,this._glyph.uvRect,this._color),i.addTriangles(-4),4}drawLine(t,e,i,s,h,r){return 0}getLineHeight(t){return Math.round(1.25*t)}getBaseline(t,e,i){if(!this.eSpan){this.eSpan=document.createElement("span"),this.eBlock=document.createElement("div"),this.eBlock.style.display="inline-block",this.eBlock.style.width="1px",this.eBlock.style.height="0px";var s=document.createElement("div");s.id="measureText",s.style.position="absolute",s.style.visibility="hidden",s.style.left=s.style.top="0px",s.appendChild(this.eSpan),s.appendChild(this.eBlock),document.body.appendChild(s)}let h,r;this.eSpan.innerHTML=t,this.eSpan.style.fontFamily=e,this.eSpan.style.fontSize=i+"px";let a=this.eSpan.offsetTop;return this.eBlock.style.verticalAlign="baseline",h=this.eBlock.offsetTop-a,this.eBlock.style.verticalAlign="bottom",r=this.eBlock.offsetTop-a,h+Math.floor(i-r)}}class Li{init(t,e){this._root={x:0,y:0,w:t,h:e},delete this.full}add(t,e){let i;return(i=this.findNode(this._root,t,e))&&(i=this.splitNode(i,t,e)),i||(this.full=!0),i}findNode(t,e,i){return t.used?this.findNode(t.right,e,i)||this.findNode(t.down,e,i):e<=t.w&&i<=t.h?t:null}splitNode(t,e,i){return t.used=!0,t.down={x:t.x,y:t.y+i,w:t.w,h:t.h-i},t.right={x:t.x+e,y:t.y,w:t.w-e,h:i},t}}class Bi{static registerFont(t){this.fonts[t.name]=t}static unregisterFont(t){this.fonts[t.name]=void 0}static getFont(t){if(this.packageFontGetter&&t.startsWith("ui://")){let e=this.packageFontGetter(t);if(e)return e}let e=this.fonts[t];return e||(e=new zi,e.name=t,this.fonts[t]=e),e}}Bi.fonts={};class Fi{constructor(){this._items=[],this._itemsById={},this._itemsByName={},this._sprites={},this._dependencies=[],this._branches=[],this._branchIndex=-1}static get branch(){return Ai}static set branch(t){for(var e in Ai=t,ji){var i=ji[e];i._branches&&(i._branchIndex=i._branches.indexOf(t))}}static getVar(t){return Di[t]}static setVar(t,e){Di[t]=e}static getById(t){return ji[t]}static getByName(t){return Ri[t]}static loadPackage(i,s){return new Promise(h=>{let r=ji[i];if(r)return void h(r);let a=i;i.endsWith("."+Qt.packageFileExtension)||(a+="."+Qt.packageFileExtension);var n=new e.FileLoader;n.setResponseType("arraybuffer"),n.load(a,e=>{r=new Fi,r._resKey=i,r.loadPackage(new wi(e));let a=[],n=r._items.length;for(var o=0;o<n;o++){var l=r._items[o];l.type==t.PackageItemType.Atlas?a.push(Vi(l,s)):l.type==t.PackageItemType.Sound&&a.push(Ei(l,s))}let _=()=>{ji[r.id]=r,Ri[r.name]=r,Ri[r._resKey]=r,h(r)};a.length>0?Promise.all(a).then(_):_()})})}static removePackage(t){var e=ji[t];if(e||(e=Ri[t]),!e)throw new Error("unknown package: "+t);e.dispose(),delete ji[e.id],delete Ri[e.name],delete ji[e._resKey],null!=e._customId&&delete ji[e._customId]}static createObject(t,e,i){var s=Fi.getByName(t);return s?s.createObject(e,i):null}static createObjectFromURL(t,e){var i=Fi.getItemByURL(t);return i?i.owner.internalCreateObject(i,e):null}static getItemURL(t,e){var i=Fi.getByName(t);if(!i)return null;var s=i._itemsByName[e];return s?"ui://"+i.id+s.id:null}static getItemByURL(t){var e=t.indexOf("//");if(-1==e)return null;var i=t.indexOf("/",e+2);if(-1==i){if(t.length>13){var s=t.substr(5,8),h=Fi.getById(s);if(h){var r=t.substr(13);return h.getItemById(r)}}}else{var a=t.substr(e+2,i-e-2);if(h=Fi.getByName(a)){var n=t.substr(i+1);return h.getItemByName(n)}}return null}static getItemAssetByURL(t){var e=Fi.getItemByURL(t);return null==e?null:e.owner.getItemAsset(e)}static normalizeURL(t){if(null==t)return null;var e=t.indexOf("//");if(-1==e)return null;var i=t.indexOf("/",e+2);if(-1==i)return t;var s=t.substr(e+2,i-e-2),h=t.substr(i+1);return Fi.getItemURL(s,h)}loadPackage(i){if(1179080009!=i.readUint())throw new Error("old package format found in '"+this._resKey+"'");i.version=i.readInt();i.readBool();this._id=i.readString(),this._name=i.readString(),i.skip(20);var s,h,r,a,n,o=i.version>=2,l=i.pos;i.seek(l,4),s=i.readInt();var _,d=[];for(h=0;h<s;h++)d[h]=i.readString();for(i.stringTable=d,i.seek(l,0),s=i.readShort(),h=0;h<s;h++)this._dependencies.push({id:i.readS(),name:i.readS()});o&&((s=i.readShort())>0&&(this._branches=i.readSArray(s),Ai&&(this._branchIndex=this._branches.indexOf(Ai))),n=s>0),i.seek(l,1);var c=this._resKey+"_";for(s=i.readUshort(),h=0;h<s;h++){switch(r=i.readInt(),r+=i.pos,(_=new Mi).owner=this,_.type=i.readByte(),_.id=i.readS(),_.name=i.readS(),i.readS(),(a=i.readS())&&(_.file=a),i.readBool(),_.width=i.readInt(),_.height=i.readInt(),_.type){case t.PackageItemType.Image:_.objectType=t.ObjectType.Image;var u=i.readByte();1==u?(_.scale9Grid=new P,_.scale9Grid.x=i.readInt(),_.scale9Grid.y=i.readInt(),_.scale9Grid.width=i.readInt(),_.scale9Grid.height=i.readInt(),_.tileGridIndice=i.readInt()):2==u&&(_.scaleByTile=!0),_.smoothing=i.readBool();break;case t.PackageItemType.MovieClip:_.smoothing=i.readBool(),_.objectType=t.ObjectType.MovieClip,_.rawData=i.readBuffer();break;case t.PackageItemType.Font:_.rawData=i.readBuffer();break;case t.PackageItemType.Component:var g=i.readByte();_.objectType=g>0?g:t.ObjectType.Component,_.rawData=i.readBuffer(),Wi.UIObjectFactory.resolveExtension(_);break;case t.PackageItemType.Atlas:case t.PackageItemType.Sound:case t.PackageItemType.Misc:_.file=c+_.file}if(o){(a=i.readS())&&(_.name=a+"/"+_.name);var p=i.readByte();p>0&&(n?_.branches=i.readSArray(p):this._itemsById[i.readS()]=_);var f=i.readByte();f>0&&(_.highResolution=i.readSArray(f))}this._items.push(_),this._itemsById[_.id]=_,null!=_.name&&(this._itemsByName[_.name]=_),i.pos=r}for(i.seek(l,2),s=i.readUshort(),h=0;h<s;h++){r=i.readUshort(),r+=i.pos;var m=i.readS();_=this._itemsById[i.readS()];let t=new P;t.x=i.readInt(),t.y=i.readInt(),t.width=i.readInt(),t.height=i.readInt();var y={atlas:_,rect:t,offset:new e.Vector2,originalSize:new e.Vector2};y.rotated=i.readBool(),o&&i.readBool()?(y.offset.x=i.readInt(),y.offset.y=i.readInt(),y.originalSize.x=i.readInt(),y.originalSize.y=i.readInt()):(y.originalSize.x=y.rect.width,y.originalSize.y=y.rect.height),this._sprites[m]=y,i.pos=r}if(i.seek(l,3))for(s=i.readUshort(),h=0;h<s;h++)r=i.readInt(),r+=i.pos,(_=this._itemsById[i.readS()])&&_.type==t.PackageItemType.Image&&(_.pixelHitTestData=new di,_.pixelHitTestData.load(i)),i.pos=r}dispose(){for(var e=this._items.length,i=0;i<e;i++){var s=this._items[i];s.type==t.PackageItemType.Atlas?s.texture&&(s.texture.dispose(),s.texture=null):(s.type,t.PackageItemType.Sound)}}get id(){return this._id}get name(){return this._name}get customId(){return this._customId}set customId(t){null!=this._customId&&delete ji[this._customId],this._customId=t,null!=this._customId&&(ji[this._customId]=this)}createObject(t,e){var i=this._itemsByName[t];return i?this.internalCreateObject(i,e):null}internalCreateObject(t,e){var i=Wi.UIObjectFactory.newObject(t,e);return null==i?null:(re.n++,i.constructFromResource(),re.n--,i)}getItemById(t){return this._itemsById[t]}getItemByName(t){return this._itemsByName[t]}getItemAssetByName(t){var e=this._itemsByName[t];if(null==e)throw"Resource not found -"+t;return this.getItemAsset(e)}getItemAsset(e){switch(e.type){case t.PackageItemType.Image:if(!e.decoded){e.decoded=!0;var i=this._sprites[e.id];if(i){var s=this.getItemAsset(i.atlas);e.texture=s.createSubTexture(i.rect,i.rotated,i.offset,i.originalSize)}else e.texture=null}return e.texture;case t.PackageItemType.Atlas:return e.texture;case t.PackageItemType.Font:return e.decoded||(e.decoded=!0,this.loadFont(e)),e.bitmapFont;case t.PackageItemType.MovieClip:return e.decoded||(e.decoded=!0,this.loadMovieClip(e)),e.frames;case t.PackageItemType.Component:return e.rawData;default:return null}}loadMovieClip(t){var i=t.rawData;i.seek(0,0),t.interval=i.readInt(),t.swing=i.readBool(),t.repeatDelay=i.readInt(),i.seek(0,1);var s,h,r,a,n,o=i.readShort();t.frames=[];for(var l=0;l<o;l++){var _=i.readShort();if(_+=i.pos,h={texture:null},a=i.readInt(),n=i.readInt(),i.readInt(),i.readInt(),h.addDelay=i.readInt(),null!=(s=i.readS())&&null!=(r=this._sprites[s])){var d=this.getItemAsset(r.atlas);h.texture=d.createSubTexture(r.rect,r.rotated,new e.Vector2(a,n),new e.Vector2(t.width,t.height))}t.frames[l]=h,i.pos=_}}loadFont(t){t=t.getBranch();var e=new mi;e.name="ui://"+this._id+t.id,t.bitmapFont=e;var i=t.rawData;i.seek(0,0);let s=i.readBool();e.tint=i.readBool(),e.resizable=i.readBool(),e.hasChannel=i.readBool();var h,r,a,n,o=i.readInt(),l=i.readInt(),_=i.readInt(),d=1,c=1,u=null,g=s?this._sprites[t.id]:null;g&&(d=(u=this.getItemAsset(g.atlas)).root.uvRect.width/u.width,c=u.root.uvRect.height/u.height),i.seek(0,1);for(var p=null,f=i.readInt(),m=0;m<f;m++){var y=i.readShort();y+=i.pos,p=new yi;var w=i.readChar();e.glyphs[w]=p;var x=i.readS(),v=i.readInt(),b=i.readInt();if(h=i.readInt(),r=i.readInt(),a=i.readInt(),n=i.readInt(),p.advance=i.readInt(),p.channel=i.readByte(),1==p.channel?p.channel=2:2==p.channel?p.channel=1:4==p.channel?p.channel=0:8==p.channel&&(p.channel=3),s)g.rotated?(p.uv[0].set((b+n+g.rect.x)*d,1-(g.rect.yMax-v)*c),p.uv[1].set(p.uv[0].x-n*d,p.uv[0].y),p.uv[2].set(p.uv[1].x,p.uv[0].y+a*c),p.uv[3].set(p.uv[0].x,p.uv[2].y)):(p.uv[0].set((v+g.rect.x)*d,1-(b+n+g.rect.y)*c),p.uv[1].set(p.uv[0].x,p.uv[0].y+n*c),p.uv[2].set(p.uv[0].x+a*d,p.uv[1].y),p.uv[3].set(p.uv[2].x,p.uv[0].y)),p.lineHeight=_,p.x=h,p.y=r,p.width=a,p.height=n;else{var C=this._itemsById[x];C&&(a=(C=C.getBranch()).width,n=C.height,C=C.getHighResolution(),this.getItemAsset(C),C.texture.getUV(p.uv),d=a/C.width,c=n/C.height,p.x=h+C.texture.offset.x*d,p.y=r+C.texture.offset.y*c,p.width=C.texture.width*d,p.height=C.texture.height*c,u||(u=C.texture.root)),0==o&&(o=n),0==p.advance&&(p.advance=0==l?h+a:l),p.lineHeight=r<0?n:r+n,p.lineHeight<e.size&&(p.lineHeight=e.size)}i.pos=y}e.size=o,e.mainTexture=u}}var ji={},Ri={},Ai="",Di={};function Vi(t,i){return new Promise((s,h)=>{(new e.TextureLoader).load(t.file,i=>{i.generateMipmaps=!1,i.magFilter=e.LinearFilter,i.minFilter=e.LinearFilter,t.texture=new be(i),s()},i,t=>{h(t.message)})})}function Ei(t,i){return new Promise((s,h)=>{(new e.AudioLoader).load(t.file,e=>{t.audioBuffer=e,s()},i,t=>{h(t.message)})})}Bi.packageFontGetter=t=>Fi.getItemAssetByURL(t);var Wi={};class Hi{constructor(){}run(t,e,i){this.fromPage&&0!=this.fromPage.length&&-1==this.fromPage.indexOf(e)||this.toPage&&0!=this.toPage.length&&-1==this.toPage.indexOf(i)?this.leave(t):this.enter(t)}enter(t){}leave(t){}setup(t){var e,i;for(e=t.readShort(),this.fromPage=[],i=0;i<e;i++)this.fromPage[i]=t.readS();for(e=t.readShort(),this.toPage=[],i=0;i<e;i++)this.toPage[i]=t.readS()}}class Ni extends Hi{constructor(){super(),this.playTimes=1,this.delay=0}enter(t){var e=t.parent.getTransition(this.transitionName);e&&(this._currentTransition&&this._currentTransition.playing?e.changePlayTimes(this.playTimes):e.play(null,this.playTimes,this.delay),this._currentTransition=e)}leave(t){this.stopOnExit&&this._currentTransition&&(this._currentTransition.stop(),this._currentTransition=null)}setup(t){super.setup(t),this.transitionName=t.readS(),this.playTimes=t.readInt(),this.delay=t.readFloat(),this.stopOnExit=t.readBool()}}class Gi extends Hi{constructor(){super()}enter(t){var e;if(this.controllerName&&(e=this.objectId?t.parent.getChildById(this.objectId):t.parent)){var i=e.getController(this.controllerName);i&&i!=t&&!i.changing&&("~1"==this.targetPage?t.selectedIndex<i.pageCount&&(i.selectedIndex=t.selectedIndex):"~2"==this.targetPage?i.selectedPage=t.selectedPage:i.selectedPageId=this.targetPage)}}setup(t){super.setup(t),this.objectId=t.readS(),this.controllerName=t.readS(),this.targetPage=t.readS()}}var Ui=0;class Yi extends I{constructor(){super(),this.changing=!1,this._pageIds=[],this._pageNames=[],this._selectedIndex=-1,this._previousIndex=-1}dispose(){this.offAll()}get selectedIndex(){return this._selectedIndex}set selectedIndex(t){if(this._selectedIndex!=t){if(t>this._pageIds.length-1)throw"index out of bounds: "+t;this.changing=!0,this._previousIndex=this._selectedIndex,this._selectedIndex=t,this.parent.applyController(this),this.dispatchEvent("status_changed"),this.changing=!1}}setSelectedIndex(t){if(this._selectedIndex!=t){if(t>this._pageIds.length-1)throw"index out of bounds: "+t;this.changing=!0,this._previousIndex=this._selectedIndex,this._selectedIndex=t,this.parent.applyController(this),this.changing=!1}}get previsousIndex(){return this._previousIndex}get selectedPage(){return-1==this._selectedIndex?null:this._pageNames[this._selectedIndex]}set selectedPage(t){var e=this._pageNames.indexOf(t);-1==e&&(e=0),this.selectedIndex=e}setSelectedPage(t){var e=this._pageNames.indexOf(t);-1==e&&(e=0),this.setSelectedIndex(e)}get previousPage(){return-1==this._previousIndex?null:this._pageNames[this._previousIndex]}get pageCount(){return this._pageIds.length}getPageName(t){return this._pageNames[t]}addPage(t){t=t||"",this.addPageAt(t,this._pageIds.length)}addPageAt(t,e){t=t||"";var i=""+Ui++;null==e||e==this._pageIds.length?(this._pageIds.push(i),this._pageNames.push(t)):(this._pageIds.splice(e,0,i),this._pageNames.splice(e,0,t))}removePage(t){var e=this._pageNames.indexOf(t);-1!=e&&(this._pageIds.splice(e,1),this._pageNames.splice(e,1),this._selectedIndex>=this._pageIds.length?this.selectedIndex=this._selectedIndex-1:this.parent.applyController(this))}removePageAt(t){this._pageIds.splice(t,1),this._pageNames.splice(t,1),this._selectedIndex>=this._pageIds.length?this.selectedIndex=this._selectedIndex-1:this.parent.applyController(this)}clearPages(){this._pageIds.length=0,this._pageNames.length=0,-1!=this._selectedIndex?this.selectedIndex=-1:this.parent.applyController(this)}hasPage(t){return-1!=this._pageNames.indexOf(t)}getPageIndexById(t){return this._pageIds.indexOf(t)}getPageIdByName(t){var e=this._pageNames.indexOf(t);return-1!=e?this._pageIds[e]:null}getPageNameById(t){var e=this._pageIds.indexOf(t);return-1!=e?this._pageNames[e]:null}getPageId(t){return this._pageIds[t]}get selectedPageId(){return-1==this._selectedIndex?null:this._pageIds[this._selectedIndex]}set selectedPageId(t){var e=this._pageIds.indexOf(t);this.selectedIndex=e}set oppositePageId(t){this._pageIds.indexOf(t)>0?this.selectedIndex=0:this._pageIds.length>1&&(this.selectedIndex=1)}get previousPageId(){return-1==this._previousIndex?null:this._pageIds[this._previousIndex]}runActions(){if(this._actions)for(var t=this._actions.length,e=0;e<t;e++)this._actions[e].run(this,this.previousPageId,this.selectedPageId)}setup(t){var e,i,s=t.pos;t.seek(s,0),this.name=t.readS(),t.readBool()&&(this.autoRadioGroupDepth=!0),t.seek(s,1);var h=t.readShort();for(e=0;e<h;e++)this._pageIds.push(t.readS()),this._pageNames.push(t.readS());var r=0;if(t.version>=2)switch(t.readByte()){case 1:r=t.readShort();break;case 2:-1==(r=this._pageNames.indexOf(Fi.branch))&&(r=0);break;case 3:-1==(r=this._pageNames.indexOf(Fi.getVar(t.readS())))&&(r=0)}if(t.seek(s,2),(h=t.readShort())>0)for(null==this._actions&&(this._actions=[]),e=0;e<h;e++){i=t.readShort(),i+=t.pos;var a=Xi(t.readByte());a.setup(t),this._actions.push(a),t.pos=i}this.parent&&this._pageIds.length>0?this._selectedIndex=r:this._selectedIndex=-1}}function Xi(t){switch(t){case 0:return new Ni;case 1:return new Gi}return null}class Qi{constructor(){this.left=0,this.right=0,this.top=0,this.bottom=0}copy(t){this.top=t.top,this.bottom=t.bottom,this.left=t.left,this.right=t.right}}var qi=new e.Vector2,Ki=new P,$i=new e.Vector2,Zi=new e.Vector2,Ji=0;class ts{constructor(t){this._owner=t,this._maskContainer=new ft,this._owner.displayObject.addChild(this._maskContainer),this._container=this._owner._container,this._container.setPosition(0,0),this._maskContainer.addChild(this._container),this._mouseWheelEnabled=!0,this._xPos=0,this._yPos=0,this._aniFlag=0,this._tweening=0,this._loop=0,this._footerLockedSize=0,this._headerLockedSize=0,this._scrollBarMargin=new Qi,this._viewSize=new e.Vector2,this._contentSize=new e.Vector2,this._pageSize=new e.Vector2(1,1),this._overlapSize=new e.Vector2,this._tweenTime=new e.Vector2,this._tweenStart=new e.Vector2,this._tweenDuration=new e.Vector2,this._tweenChange=new e.Vector2,this._velocity=new e.Vector2,this._containerPos=new e.Vector2,this._beginTouchPos=new e.Vector2,this._lastTouchPos=new e.Vector2,this._lastTouchGlobalPos=new e.Vector2,this._scrollStep=Qt.defaultScrollStep,this._decelerationRate=Qt.defaultScrollDecelerationRate,this._owner.on("touch_begin",this.__touchBegin,this),this._owner.on("touch_move",this.__touchMove,this),this._owner.on("touch_end",this.__touchEnd,this),this._owner.on("mouse_wheel",this.__mouseWheel,this)}setup(e){this._scrollType=e.readByte();var i=e.readByte(),s=e.readInt();e.readBool()&&(this._scrollBarMargin.top=e.readInt(),this._scrollBarMargin.bottom=e.readInt(),this._scrollBarMargin.left=e.readInt(),this._scrollBarMargin.right=e.readInt());var h=e.readS(),r=e.readS(),a=e.readS(),n=e.readS();if(0!=(1&s)&&(this._displayOnLeft=!0),0!=(2&s)&&(this._snapToItem=!0),0!=(4&s)&&(this._displayInDemand=!0),0!=(8&s)&&(this._pageMode=!0),this._touchEffect=!!(16&s)||!(32&s)&&Qt.defaultScrollTouchEffect,this._bouncebackEffect=!!(64&s)||!(128&s)&&Qt.defaultScrollBounceEffect,0!=(256&s)&&(this._inertiaDisabled=!0),0==(512&s)&&(this._maskContainer.clipRect=new P),0!=(1024&s)&&(this._floating=!0),0!=(2048&s)&&(this._dontClipMargin=!0),i==t.ScrollBarDisplayType.Default&&(i=Qt.defaultScrollBarDisplay),i!=t.ScrollBarDisplayType.Hidden){if(this._scrollType==t.ScrollType.Both||this._scrollType==t.ScrollType.Vertical){var o=h||Qt.verticalScrollBar;if(o){if(this._vtScrollBar=Fi.createObjectFromURL(o),!this._vtScrollBar)throw"cannot create scrollbar} from "+o;this._vtScrollBar.setScrollPane(this,!0),this._owner.displayObject.addChild(this._vtScrollBar.displayObject)}}if((this._scrollType==t.ScrollType.Both||this._scrollType==t.ScrollType.Horizontal)&&(o=r||Qt.horizontalScrollBar)){if(this._hzScrollBar=Fi.createObjectFromURL(o),!this._hzScrollBar)throw"cannot create scrollbar} from "+o;this._hzScrollBar.setScrollPane(this,!1),this._owner.displayObject.addChild(this._hzScrollBar.displayObject)}i==t.ScrollBarDisplayType.Auto&&(this._scrollBarDisplayAuto=!0),this._scrollBarDisplayAuto&&(this._vtScrollBar&&(this._vtScrollBar.displayObject.visible=!1),this._hzScrollBar&&(this._hzScrollBar.displayObject.visible=!1))}else this._mouseWheelEnabled=!1;if(a&&(this._header=Fi.createObjectFromURL(a),!this._header))throw new Error("cannot create scrollPane header from "+a);if(n&&(this._footer=Fi.createObjectFromURL(n),!this._footer))throw new Error("cannot create scrollPane footer from "+n);(this._header||this._footer)&&(this._refreshBarAxis=this._scrollType==t.ScrollType.Both||this._scrollType==t.ScrollType.Vertical?"y":"x"),this.setSize(this.owner.width,this.owner.height)}dispose(){0!=this._tweening&&k.remove(this.tweenUpdate,this),delete this._pageController,this._hzScrollBar&&this._hzScrollBar.dispose(),this._vtScrollBar&&this._vtScrollBar.dispose(),this._header&&this._header.dispose(),this._footer&&this._footer.dispose()}get owner(){return this._owner}get hzScrollBar(){return this._hzScrollBar}get vtScrollBar(){return this._vtScrollBar}get header(){return this._header}get footer(){return this._footer}get bouncebackEffect(){return this._bouncebackEffect}set bouncebackEffect(t){this._bouncebackEffect=t}get touchEffect(){return this._touchEffect}set touchEffect(t){this._touchEffect=t}set scrollStep(t){this._scrollStep=t,0==this._scrollStep&&(this._scrollStep=Qt.defaultScrollStep)}get scrollStep(){return this._scrollStep}get snapToItem(){return this._snapToItem}set snapToItem(t){this._snapToItem=t}get mouseWheelEnabled(){return this._mouseWheelEnabled}set mouseWheelEnabled(t){this._mouseWheelEnabled=t}get decelerationRate(){return this._decelerationRate}set decelerationRate(t){this._decelerationRate=t}get isDragged(){return this._dragged}get percX(){return 0==this._overlapSize.x?0:this._xPos/this._overlapSize.x}set percX(t){this.setPercX(t,!1)}setPercX(t,e){this._owner.ensureBoundsCorrect(),this.setPosX(this._overlapSize.x*_e(t),e)}get percY(){return 0==this._overlapSize.y?0:this._yPos/this._overlapSize.y}set percY(t){this.setPercY(t,!1)}setPercY(t,e){this._owner.ensureBoundsCorrect(),this.setPosY(this._overlapSize.y*_e(t),e)}get posX(){return this._xPos}set posX(t){this.setPosX(t,!1)}setPosX(t,e){this._owner.ensureBoundsCorrect(),1==this._loop&&(t=this.loopCheckingNewPos(t,"x")),(t=le(t,0,this._overlapSize.x))!=this._xPos&&(this._xPos=t,this.posChanged(e))}get posY(){return this._yPos}set posY(t){this.setPosY(t,!1)}setPosY(t,e){this._owner.ensureBoundsCorrect(),1==this._loop&&(t=this.loopCheckingNewPos(t,"y")),(t=le(t,0,this._overlapSize.y))!=this._yPos&&(this._yPos=t,this.posChanged(e))}get contentWidth(){return this._contentSize.x}get contentHeight(){return this._contentSize.y}get viewWidth(){return this._viewSize.x}set viewWidth(t){t=t+this._owner.margin.left+this._owner.margin.right,this._vtScrollBar&&!this._floating&&(t+=this._vtScrollBar.width),this._owner.width=t}get viewHeight(){return this._viewSize.y}set viewHeight(t){t=t+this._owner.margin.top+this._owner.margin.bottom,this._hzScrollBar&&!this._floating&&(t+=this._hzScrollBar.height),this._owner.height=t}get currentPageX(){if(!this._pageMode)return 0;var t=Math.floor(this._xPos/this._pageSize.x);return this._xPos-t*this._pageSize.x>.5*this._pageSize.x&&t++,t}set currentPageX(t){this.setCurrentPageX(t,!1)}get currentPageY(){if(!this._pageMode)return 0;var t=Math.floor(this._yPos/this._pageSize.y);return this._yPos-t*this._pageSize.y>.5*this._pageSize.y&&t++,t}set currentPageY(t){this.setCurrentPageY(t,!1)}setCurrentPageX(t,e){this._pageMode&&(this._owner.ensureBoundsCorrect(),this._overlapSize.x>0&&this.setPosX(t*this._pageSize.x,e))}setCurrentPageY(t,e){this._pageMode&&(this._owner.ensureBoundsCorrect(),this._overlapSize.y>0&&this.setPosY(t*this._pageSize.y,e))}get isBottomMost(){return this._yPos==this._overlapSize.y||0==this._overlapSize.y}get isRightMost(){return this._xPos==this._overlapSize.x||0==this._overlapSize.x}get pageController(){return this._pageController}set pageController(t){this._pageController=t}get scrollingPosX(){return le(-this._container.x,0,this._overlapSize.x)}get scrollingPosY(){return le(-this._container.y,0,this._overlapSize.y)}scrollTop(t){this.setPercY(0,t)}scrollBottom(t){this.setPercY(1,t)}scrollUp(t,e){t=t||1,this._pageMode?this.setPosY(this._yPos-this._pageSize.y*t,e):this.setPosY(this._yPos-this._scrollStep*t,e)}scrollDown(t,e){t=t||1,this._pageMode?this.setPosY(this._yPos+this._pageSize.y*t,e):this.setPosY(this._yPos+this._scrollStep*t,e)}scrollLeft(t,e){t=t||1,this._pageMode?this.setPosX(this._xPos-this._pageSize.x*t,e):this.setPosX(this._xPos-this._scrollStep*t,e)}scrollRight(t,e){t=t||1,this._pageMode?this.setPosX(this._xPos+this._pageSize.x*t,e):this.setPosX(this._xPos+this._scrollStep*t,e)}scrollToView(t,e,i){var s;if(this._owner.ensureBoundsCorrect(),this._needRefresh&&this.refresh(),t instanceof qt?t.parent!=this._owner?(t.parent.localToGlobalRect(t.x,t.y,t.width,t.height,Ki),s=this._owner.globalToLocalRect(Ki.x,Ki.y,Ki.width,Ki.height,Ki)):(s=Ki).set(t.x,t.y,t.width,t.height):s=t,this._overlapSize.y>0){var h=this._yPos+this._viewSize.y;i||s.y<=this._yPos||s.height>=this._viewSize.y?this._pageMode?this.setPosY(Math.floor(s.y/this._pageSize.y)*this._pageSize.y,e):this.setPosY(s.y,e):s.y+s.height>h&&(this._pageMode?this.setPosY(Math.floor(s.y/this._pageSize.y)*this._pageSize.y,e):s.height<=this._viewSize.y/2?this.setPosY(s.y+2*s.height-this._viewSize.y,e):this.setPosY(s.y+s.height-this._viewSize.y,e))}if(this._overlapSize.x>0){var r=this._xPos+this._viewSize.x;i||s.x<=this._xPos||s.width>=this._viewSize.x?this._pageMode?this.setPosX(Math.floor(s.x/this._pageSize.x)*this._pageSize.x,e):this.setPosX(s.x,e):s.x+s.width>r&&(this._pageMode?this.setPosX(Math.floor(s.x/this._pageSize.x)*this._pageSize.x,e):s.width<=this._viewSize.x/2?this.setPosX(s.x+2*s.width-this._viewSize.x,e):this.setPosX(s.x+s.width-this._viewSize.x,e))}!e&&this._needRefresh&&this.refresh()}isChildInView(t){if(this._overlapSize.y>0){var e=t.y+this._container.y;if(e<-t.height||e>this._viewSize.y)return!1}return!(this._overlapSize.x>0&&((e=t.x+this._container.x)<-t.width||e>this._viewSize.x))}cancelDragging(){j.removeTouchMonitor(this._owner.displayObject),ts.draggingPane==this&&(ts.draggingPane=null),Ji=0,this._dragged=!1}lockHeader(t){this._headerLockedSize!=t&&(this._headerLockedSize=t,!this._refreshEventDispatching&&this._container[this._refreshBarAxis]>=0&&(this._tweenStart.set(this._container.x,this._container.y),this._tweenChange.set(0,0),this._tweenChange[this._refreshBarAxis]=this._headerLockedSize-this._tweenStart[this._refreshBarAxis],this._tweenDuration.set(.3,.3),this.startTween(2)))}lockFooter(t){if(this._footerLockedSize!=t&&(this._footerLockedSize=t,!this._refreshEventDispatching&&this._container[this._refreshBarAxis]<=-this._overlapSize[this._refreshBarAxis])){this._tweenStart.set(this._container.x,this._container.y),this._tweenChange.set(0,0);var e=this._overlapSize[this._refreshBarAxis];0==e?e=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):e+=this._footerLockedSize,this._tweenChange[this._refreshBarAxis]=-e-this._tweenStart[this._refreshBarAxis],this._tweenDuration.set(.3,.3),this.startTween(2)}}onOwnerSizeChanged(){this.setSize(this._owner.width,this._owner.height),this.posChanged(!1)}handleControllerChanged(e){this._pageController==e&&(this._scrollType==t.ScrollType.Horizontal?this.setCurrentPageX(e.selectedIndex,!0):this.setCurrentPageY(e.selectedIndex,!0))}updatePageController(){var e;if(this._pageController&&!this._pageController.changing&&(e=this._scrollType==t.ScrollType.Horizontal?this.currentPageX:this.currentPageY)<this._pageController.pageCount){var i=this._pageController;this._pageController=null,i.selectedIndex=e,this._pageController=i}}adjustMaskContainer(){var t,e;t=this._displayOnLeft&&this._vtScrollBar&&!this._floating?Math.floor(this._owner.margin.left+this._vtScrollBar.width):Math.floor(this._owner.margin.left),e=Math.floor(this._owner.margin.top),t+=this._owner._alignOffset.x,e+=this._owner._alignOffset.y,this._maskContainer.setPosition(t,e)}setSize(t,e){this.adjustMaskContainer(),this._hzScrollBar&&(this._hzScrollBar.y=e-this._hzScrollBar.height,this._vtScrollBar?(this._hzScrollBar.width=t-this._vtScrollBar.width-this._scrollBarMargin.left-this._scrollBarMargin.right,this._displayOnLeft?this._hzScrollBar.x=this._scrollBarMargin.left+this._vtScrollBar.width:this._hzScrollBar.x=this._scrollBarMargin.left):(this._hzScrollBar.width=t-this._scrollBarMargin.left-this._scrollBarMargin.right,this._hzScrollBar.x=this._scrollBarMargin.left)),this._vtScrollBar&&(this._displayOnLeft||(this._vtScrollBar.x=t-this._vtScrollBar.width),this._hzScrollBar?this._vtScrollBar.height=e-this._hzScrollBar.height-this._scrollBarMargin.top-this._scrollBarMargin.bottom:this._vtScrollBar.height=e-this._scrollBarMargin.top-this._scrollBarMargin.bottom,this._vtScrollBar.y=this._scrollBarMargin.top),this._viewSize.x=t,this._viewSize.y=e,this._hzScrollBar&&!this._floating&&(this._viewSize.y-=this._hzScrollBar.height),this._vtScrollBar&&!this._floating&&(this._viewSize.x-=this._vtScrollBar.width),this._viewSize.x-=this._owner.margin.left+this._owner.margin.right,this._viewSize.y-=this._owner.margin.top+this._owner.margin.bottom,this._viewSize.x=Math.max(1,this._viewSize.x),this._viewSize.y=Math.max(1,this._viewSize.y),this._pageSize.x=this._viewSize.x,this._pageSize.y=this._viewSize.y,this.handleSizeChanged()}setContentSize(t,e){this._contentSize.x==t&&this._contentSize.y==e||(this._contentSize.x=t,this._contentSize.y=e,this.handleSizeChanged())}changeContentSizeOnScrolling(t,e,i,s){var h=this._xPos==this._overlapSize.x,r=this._yPos==this._overlapSize.y;this._contentSize.x+=t,this._contentSize.y+=e,this.handleSizeChanged(),1==this._tweening?(0!=t&&h&&this._tweenChange.x<0&&(this._xPos=this._overlapSize.x,this._tweenChange.x=-this._xPos-this._tweenStart.x),0!=e&&r&&this._tweenChange.y<0&&(this._yPos=this._overlapSize.y,this._tweenChange.y=-this._yPos-this._tweenStart.y)):2==this._tweening?(0!=i&&(this._container.x-=i,this._tweenStart.x-=i,this._xPos=-this._container.x),0!=s&&(this._container.y-=s,this._tweenStart.y-=s,this._yPos=-this._container.y)):this._dragged?(0!=i&&(this._container.x-=i,this._containerPos.x-=i,this._xPos=-this._container.x),0!=s&&(this._container.y-=s,this._containerPos.y-=s,this._yPos=-this._container.y)):(0!=t&&h&&(this._xPos=this._overlapSize.x,this._container.x=-this._xPos),0!=e&&r&&(this._yPos=this._overlapSize.y,this._container.y=-this._yPos)),this._pageMode&&this.updatePageController()}handleSizeChanged(){this._displayInDemand&&(this._vScrollNone=this._contentSize.y<=this._viewSize.y,this._hScrollNone=this._contentSize.x<=this._viewSize.x),this._vtScrollBar&&(0==this._contentSize.y?this._vtScrollBar.setDisplayPerc(0):this._vtScrollBar.setDisplayPerc(Math.min(1,this._viewSize.y/this._contentSize.y))),this._hzScrollBar&&(0==this._contentSize.x?this._hzScrollBar.setDisplayPerc(0):this._hzScrollBar.setDisplayPerc(Math.min(1,this._viewSize.x/this._contentSize.x))),this.updateScrollBarVisible();var e=this._maskContainer.clipRect;if(e&&(e.x=-this._owner._alignOffset.x,e.y=-this._owner._alignOffset.y,e.width=this._viewSize.x,e.height=this._viewSize.y,this._vScrollNone&&this._vtScrollBar&&(e.width+=this._vtScrollBar.width),this._hScrollNone&&this._hzScrollBar&&(e.height+=this._hzScrollBar.height),this._dontClipMargin&&(e.x-=this._owner.margin.left,e.width+=this._owner.margin.left+this._owner.margin.right,e.y-=this._owner.margin.top,e.height+=this._owner.margin.top+this._owner.margin.bottom),this._maskContainer.clipRect=e),this._scrollType==t.ScrollType.Horizontal||this._scrollType==t.ScrollType.Both?this._overlapSize.x=Math.ceil(Math.max(0,this._contentSize.x-this._viewSize.x)):this._overlapSize.x=0,this._scrollType==t.ScrollType.Vertical||this._scrollType==t.ScrollType.Both?this._overlapSize.y=Math.ceil(Math.max(0,this._contentSize.y-this._viewSize.y)):this._overlapSize.y=0,this._xPos=le(this._xPos,0,this._overlapSize.x),this._yPos=le(this._yPos,0,this._overlapSize.y),this._refreshBarAxis){var i=this._overlapSize[this._refreshBarAxis];0==i?i=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):i+=this._footerLockedSize,"x"==this._refreshBarAxis?this._container.setPosition(le(this._container.x,-i,this._headerLockedSize),le(this._container.y,-this._overlapSize.y,0)):this._container.setPosition(le(this._container.x,-this._overlapSize.x,0),le(this._container.y,-i,this._headerLockedSize)),this._header&&("x"==this._refreshBarAxis?this._header.height=this._viewSize.y:this._header.width=this._viewSize.x),this._footer&&("y"==this._refreshBarAxis?this._footer.height=this._viewSize.y:this._footer.width=this._viewSize.x)}else this._container.setPosition(le(this._container.x,-this._overlapSize.x,0),le(this._container.y,-this._overlapSize.y,0));this.updateScrollBarPos(),this._pageMode&&this.updatePageController()}posChanged(t){0==this._aniFlag?this._aniFlag=t?1:-1:1!=this._aniFlag||t||(this._aniFlag=-1),this._needRefresh=!0,k.callLater(this.refresh,this)}refresh(){null!=this._owner.displayObject&&(this._needRefresh=!1,k.remove(this.refresh,this),(this._pageMode||this._snapToItem)&&($i.set(-this._xPos,-this._yPos),this.alignPosition($i,!1),this._xPos=-$i.x,this._yPos=-$i.y),this.refresh2(),this._owner.dispatchEvent("scroll"),this._needRefresh&&(this._needRefresh=!1,k.remove(this.refresh,this),this.refresh2()),this.updateScrollBarPos(),this._aniFlag=0)}refresh2(){var t,e;1!=this._aniFlag||this._dragged?(0!=this._tweening&&this.killTween(),this._container.setPosition(Math.floor(-this._xPos),Math.floor(-this._yPos)),this.loopCheckingCurrent()):(this._overlapSize.x>0?t=-Math.floor(this._xPos):(0!=this._container.x&&(this._container.x=0),t=0),this._overlapSize.y>0?e=-Math.floor(this._yPos):(0!=this._container.y&&(this._container.y=0),e=0),t!=this._container.x||e!=this._container.y?(this._tweenDuration.set(.5,.5),this._tweenStart.set(this._container.x,this._container.y),this._tweenChange.set(t-this._tweenStart.x,e-this._tweenStart.y),this.startTween(1)):0!=this._tweening&&this.killTween());this._pageMode&&this.updatePageController()}__touchBegin(t){if(this._touchEffect&&0==t.input.button){t.captureTouch(),0!=this._tweening?(this.killTween(),j.cancelClick(t.input.touchId),this._dragged=!0):this._dragged=!1;var e=this._owner.globalToLocal(t.input.x,t.input.y,qi);this._containerPos.set(this._container.x,this._container.y),this._beginTouchPos.set(e.x,e.y),this._lastTouchPos.set(e.x,e.y),this._lastTouchGlobalPos.set(t.input.x,t.input.y),this._isHoldAreaDone=!1,this._velocity.set(0,0),this._velocityScale=1,this._lastMoveTime=performance.now()/1e3}}__touchMove(e){if(this._touchEffect&&!this.owner.isDisposed&&!(ts.draggingPane&&ts.draggingPane!=this||qt.draggingObject)){var i,s,h,r=Qt.touchScrollSensitivity,a=this._owner.globalToLocal(e.input.x,e.input.y);if(this._scrollType==t.ScrollType.Vertical){if(!this._isHoldAreaDone){if(Ji|=1,(i=Math.abs(this._beginTouchPos.y-a.y))<r)return;if(0!=(2&Ji)){if(i<Math.abs(this._beginTouchPos.x-a.x))return}}s=!0}else if(this._scrollType==t.ScrollType.Horizontal){if(!this._isHoldAreaDone){if(Ji|=2,(i=Math.abs(this._beginTouchPos.x-a.x))<r)return;if(0!=(1&Ji)){if(i<Math.abs(this._beginTouchPos.y-a.y))return}}h=!0}else{if(Ji=3,!this._isHoldAreaDone&&(i=Math.abs(this._beginTouchPos.y-a.y))<r&&(i=Math.abs(this._beginTouchPos.x-a.x))<r)return;s=h=!0}var n=Math.floor(this._containerPos.x+a.x-this._beginTouchPos.x),o=Math.floor(this._containerPos.y+a.y-this._beginTouchPos.y);s&&(o>0?this._bouncebackEffect?this._header&&0!=this._header.maxHeight?this._container.y=Math.floor(Math.min(.5*o,this._header.maxHeight)):this._container.y=Math.floor(Math.min(.5*o,.5*this._viewSize.y)):this._container.y=0:o<-this._overlapSize.y?this._bouncebackEffect?this._footer&&this._footer.maxHeight>0?this._container.y=Math.floor(Math.max(.5*(o+this._overlapSize.y),-this._footer.maxHeight)-this._overlapSize.y):this._container.y=Math.floor(Math.max(.5*(o+this._overlapSize.y),.5*-this._viewSize.y)-this._overlapSize.y):this._container.y=-this._overlapSize.y:this._container.y=o),h&&(n>0?this._bouncebackEffect?this._header&&0!=this._header.maxWidth?this._container.x=Math.floor(Math.min(.5*n,this._header.maxWidth)):this._container.x=Math.floor(Math.min(.5*n,.5*this._viewSize.x)):this._container.x=0:n<0-this._overlapSize.x?this._bouncebackEffect?this._footer&&this._footer.maxWidth>0?this._container.x=Math.floor(Math.max(.5*(n+this._overlapSize.x),-this._footer.maxWidth)-this._overlapSize.x):this._container.x=Math.floor(Math.max(.5*(n+this._overlapSize.x),.5*-this._viewSize.x)-this._overlapSize.x):this._container.x=-this._overlapSize.x:this._container.x=n);var l=performance.now()/1e3,_=Math.max(l-this._lastMoveTime,1/60),d=a.x-this._lastTouchPos.x,c=a.y-this._lastTouchPos.y;if(h||(d=0),s||(c=0),0!=_){var u=60*_-1;if(u>1){var g=Math.pow(.833,u);this._velocity.x=this._velocity.x*g,this._velocity.y=this._velocity.y*g}this._velocity.x=de(this._velocity.x,60*d/60/_,10*_),this._velocity.y=de(this._velocity.y,60*c/60/_,10*_)}var p=this._lastTouchGlobalPos.x-e.input.x,f=this._lastTouchGlobalPos.y-e.input.y;0!=d?this._velocityScale=Math.abs(p/d):0!=c&&(this._velocityScale=Math.abs(f/c)),this._lastTouchPos.set(a.x,a.y),this._lastTouchGlobalPos.set(e.input.x,e.input.y),this._lastMoveTime=l,this._overlapSize.x>0&&(this._xPos=le(-this._container.x,0,this._overlapSize.x)),this._overlapSize.y>0&&(this._yPos=le(-this._container.y,0,this._overlapSize.y)),0!=this._loop&&(n=this._container.x,o=this._container.y,this.loopCheckingCurrent()&&(this._containerPos.x+=this._container.x-n,this._containerPos.y+=this._container.y-o)),ts.draggingPane=this,this._isHoldAreaDone=!0,this._dragged=!0,this.updateScrollBarPos(),this.updateScrollBarVisible(),this._pageMode&&this.updatePageController(),this._owner.dispatchEvent("scroll")}}__touchEnd(){if(ts.draggingPane==this&&(ts.draggingPane=null),Ji=0,this._dragged&&this._touchEffect){this._dragged=!1,this._tweenStart.set(this._container.x,this._container.y),$i.set(this._tweenStart.x,this._tweenStart.y);var t=!1;if(this._container.x>0?($i.x=0,t=!0):this._container.x<-this._overlapSize.x&&($i.x=-this._overlapSize.x,t=!0),this._container.y>0?($i.y=0,t=!0):this._container.y<-this._overlapSize.y&&($i.y=-this._overlapSize.y,t=!0),t){if(this._tweenChange.set($i.x-this._tweenStart.x,$i.y-this._tweenStart.y),this._tweenChange.x<-Qt.touchDragSensitivity||this._tweenChange.y<-Qt.touchDragSensitivity?(this._refreshEventDispatching=!0,this._owner.dispatchEvent("pull_down_release"),this._refreshEventDispatching=!1):(this._tweenChange.x>Qt.touchDragSensitivity||this._tweenChange.y>Qt.touchDragSensitivity)&&(this._refreshEventDispatching=!0,this._owner.dispatchEvent("pull_up_release"),this._refreshEventDispatching=!1),this._headerLockedSize>0&&0==$i[this._refreshBarAxis])$i[this._refreshBarAxis]=this._headerLockedSize,this._tweenChange.x=$i.x-this._tweenStart.x,this._tweenChange.y=$i.y-this._tweenStart.y;else if(this._footerLockedSize>0&&$i[this._refreshBarAxis]==-this._overlapSize[this._refreshBarAxis]){var e=this._overlapSize[this._refreshBarAxis];0==e?e=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):e+=this._footerLockedSize,$i[this._refreshBarAxis]=-e,this._tweenChange.x=$i.x-this._tweenStart.x,this._tweenChange.y=$i.y-this._tweenStart.y}this._tweenDuration.set(.3,.3)}else{if(this._inertiaDisabled)this._tweenDuration.set(.3,.3);else{var i=60*(performance.now()/1e3-this._lastMoveTime)-1;if(i>1){var s=Math.pow(.833,i);this._velocity.x=this._velocity.x*s,this._velocity.y=this._velocity.y*s}this.updateTargetAndDuration(this._tweenStart,$i)}if(Zi.set($i.x-this._tweenStart.x,$i.y-this._tweenStart.y),this.loopCheckingTarget($i),(this._pageMode||this._snapToItem)&&this.alignPosition($i,!0),this._tweenChange.x=$i.x-this._tweenStart.x,this._tweenChange.y=$i.y-this._tweenStart.y,0==this._tweenChange.x&&0==this._tweenChange.y)return void this.updateScrollBarVisible();(this._pageMode||this._snapToItem)&&(this.fixDuration("x",Zi.x),this.fixDuration("y",Zi.y))}this.startTween(2)}else this._dragged=!1}__mouseWheel(t){if(this._mouseWheelEnabled){var e=t.input.mouseWheelDelta/window.devicePixelRatio;if(this._snapToItem&&Math.abs(e)<1&&(e=Math.sign(e)),this._overlapSize.x>0&&0==this._overlapSize.y){let t=this._pageMode?this._pageSize.x:this._scrollStep;this.setPosX(this._xPos+t*e,!1)}else{let t=this._pageMode?this._pageSize.y:this._scrollStep;this.setPosY(this._yPos+t*e,!1)}}}updateScrollBarPos(){this._vtScrollBar&&this._vtScrollBar.setScrollPerc(0==this._overlapSize.y?0:le(-this._container.y,0,this._overlapSize.y)/this._overlapSize.y),this._hzScrollBar&&this._hzScrollBar.setScrollPerc(0==this._overlapSize.x?0:le(-this._container.x,0,this._overlapSize.x)/this._overlapSize.x),this.checkRefreshBar()}updateScrollBarVisible(){this._vtScrollBar&&(this._viewSize.y<=this._vtScrollBar.minSize||this._vScrollNone?this._vtScrollBar.displayObject.visible=!1:this.updateScrollBarVisible2(this._vtScrollBar)),this._hzScrollBar&&(this._viewSize.x<=this._hzScrollBar.minSize||this._hScrollNone?this._hzScrollBar.displayObject.visible=!1:this.updateScrollBarVisible2(this._hzScrollBar))}updateScrollBarVisible2(t){this._scrollBarDisplayAuto&&Nt.kill(t,!1,"alpha"),!this._scrollBarDisplayAuto||0!=this._tweening||this._dragged||t.gripDragging?(t.alpha=1,t.displayObject.visible=!0):t.displayObject.visible&&Nt.to(1,0,.5).setDelay(.5).onComplete(this.__barTweenComplete,this).setTarget(t,"alpha")}__barTweenComplete(t){var e=t.target;e.alpha=1,e.displayObject.visible=!1}getLoopPartSize(t,e){return(this._contentSize[e]+("x"==e?this._owner.columnGap:this._owner.lineGap))/t}loopCheckingCurrent(){var t=!1;return 1==this._loop&&this._overlapSize.x>0?this._xPos<.001?(this._xPos+=this.getLoopPartSize(2,"x"),t=!0):this._xPos>=this._overlapSize.x&&(this._xPos-=this.getLoopPartSize(2,"x"),t=!0):2==this._loop&&this._overlapSize.y>0&&(this._yPos<.001?(this._yPos+=this.getLoopPartSize(2,"y"),t=!0):this._yPos>=this._overlapSize.y&&(this._yPos-=this.getLoopPartSize(2,"y"),t=!0)),t&&this._container.setPosition(Math.floor(-this._xPos),Math.floor(-this._yPos)),t}loopCheckingTarget(t){1==this._loop&&this.loopCheckingTarget2(t,"x"),2==this._loop&&this.loopCheckingTarget2(t,"y")}loopCheckingTarget2(t,e){var i,s;t[e]>0?(i=this.getLoopPartSize(2,e),(s=this._tweenStart[e]-i)<=0&&s>=-this._overlapSize[e]&&(t[e]-=i,this._tweenStart[e]=s)):t[e]<-this._overlapSize[e]&&(i=this.getLoopPartSize(2,e),(s=this._tweenStart[e]+i)<=0&&s>=-this._overlapSize[e]&&(t[e]+=i,this._tweenStart[e]=s))}loopCheckingNewPos(t,e){if(0==this._overlapSize[e])return t;var i,s="x"==e?this._xPos:this._yPos,h=!1;return t<.001?(t+=this.getLoopPartSize(2,e))>s&&(i=this.getLoopPartSize(6,e),s=le(s+(i=Math.ceil((t-s)/i)*i),0,this._overlapSize[e]),h=!0):t>=this._overlapSize[e]&&(t-=this.getLoopPartSize(2,e))<s&&(i=this.getLoopPartSize(6,e),s=le(s-(i=Math.ceil((s-t)/i)*i),0,this._overlapSize[e]),h=!0),h&&("x"==e?this._container.x=-Math.floor(s):this._container.y=-Math.floor(s)),t}alignPosition(t,e){if(this._pageMode)t.x=this.alignByPage(t.x,"x",e),t.y=this.alignByPage(t.y,"y",e);else if(this._snapToItem){var i=0,s=0;e&&(i=t.x-this._containerPos.x,s=t.y-this._containerPos.y);var h=this._owner.getSnappingPositionWithDir(-t.x,-t.y,i,s,qi);t.x<0&&t.x>-this._overlapSize.x&&(t.x=-h.x),t.y<0&&t.y>-this._overlapSize.y&&(t.y=-h.y)}}alignByPage(t,e,i){var s;if(t>0)s=0;else if(t<-this._overlapSize[e])s=Math.ceil(this._contentSize[e]/this._pageSize[e])-1;else{s=Math.floor(-t/this._pageSize[e]);var h=i?t-this._containerPos[e]:t-this._container[e],r=Math.min(this._pageSize[e],this._contentSize[e]-(s+1)*this._pageSize[e]),a=-t-s*this._pageSize[e];Math.abs(h)>this._pageSize[e]?a>.5*r&&s++:a>r*(h<0?Qt.defaultScrollPagingThreshold:1-Qt.defaultScrollPagingThreshold)&&s++,(t=-s*this._pageSize[e])<-this._overlapSize[e]&&(t=-this._overlapSize[e])}if(i){var n,o=this._tweenStart[e];n=o>0?0:o<-this._overlapSize[e]?Math.ceil(this._contentSize[e]/this._pageSize[e])-1:Math.floor(-o/this._pageSize[e]);var l=Math.floor(-this._containerPos[e]/this._pageSize[e]);Math.abs(s-l)>1&&Math.abs(n-l)<=1&&(t=-(s=s>l?l+1:l-1)*this._pageSize[e])}return t}updateTargetAndDuration(t,e){e.x=this.updateTargetAndDuration2(t.x,"x"),e.y=this.updateTargetAndDuration2(t.y,"y")}updateTargetAndDuration2(t,e){var i=this._velocity[e],s=0;if(t>0)t=0;else if(t<-this._overlapSize[e])t=-this._overlapSize[e];else{var h=Math.abs(i)*this._velocityScale;j.touchScreen&&(h*=1136/Math.max(window.screen.width,window.screen.height));var r=0;if(this._pageMode||!j.touchScreen?h>500&&(r=Math.pow((h-500)/500,2)):h>1e3&&(r=Math.pow((h-1e3)/1e3,2)),0!=r)r>1&&(r=1),h*=r,i*=r,this._velocity[e]=i,s=Math.log(60/h)/Math.log(this._decelerationRate)/60,t+=Math.floor(i*s*.4)}return s<.3&&(s=.3),this._tweenDuration[e]=s,t}fixDuration(t,e){if(!(0==this._tweenChange[t]||Math.abs(this._tweenChange[t])>=Math.abs(e))){var i=Math.abs(this._tweenChange[t]/e)*this._tweenDuration[t];i<.3&&(i=.3),this._tweenDuration[t]=i}}startTween(t){this._tweenTime.set(0,0),this._tweening=t,k.addUpdate(this.tweenUpdate,this),this.updateScrollBarVisible()}killTween(){1==this._tweening&&(this._container.setPosition(this._tweenStart.x+this._tweenChange.x,this._tweenStart.y+this._tweenChange.y),this._owner.dispatchEvent("scroll")),this._tweening=0,k.remove(this.tweenUpdate,this),this.updateScrollBarVisible(),this._owner.dispatchEvent("scroll_end")}checkRefreshBar(){if(null!=this._header||null!=this._footer){var t=this._container[this._refreshBarAxis];if(this._header)if(t>0){null==this._header.displayObject.parent&&this._maskContainer.addChildAt(this._header.displayObject,0);var e=qi;e.set(this._header.width,this._header.height),e[this._refreshBarAxis]=t,this._header.setSize(e.x,e.y)}else this._header.displayObject.parent&&this._maskContainer.removeChild(this._header.displayObject);if(this._footer){var i=this._overlapSize[this._refreshBarAxis];t<-i||0==i&&this._footerLockedSize>0?(null==this._footer.displayObject.parent&&this._maskContainer.addChildAt(this._footer.displayObject,0),(e=qi).set(this._footer.x,this._footer.y),e[this._refreshBarAxis]=i>0?t+this._contentSize[this._refreshBarAxis]:Math.max(Math.min(t+this._viewSize[this._refreshBarAxis],this._viewSize[this._refreshBarAxis]-this._footerLockedSize),this._viewSize[this._refreshBarAxis]-this._contentSize[this._refreshBarAxis]),this._footer.setPosition(e.x,e.y),e.set(this._footer.width,this._footer.height),e[this._refreshBarAxis]=i>0?-i-t:this._viewSize[this._refreshBarAxis]-this._footer[this._refreshBarAxis],this._footer.setSize(e.x,e.y)):this._footer.displayObject.parent&&this._maskContainer.removeChild(this._footer.displayObject)}}}tweenUpdate(){var t=this.runTween("x"),e=this.runTween("y");this._container.setPosition(t,e),2==this._tweening&&(this._overlapSize.x>0&&(this._xPos=le(-t,0,this._overlapSize.x)),this._overlapSize.y>0&&(this._yPos=le(-e,0,this._overlapSize.y)),this._pageMode&&this.updatePageController()),0==this._tweenChange.x&&0==this._tweenChange.y?(this._tweening=0,k.remove(this.tweenUpdate,this),this.loopCheckingCurrent(),this.updateScrollBarPos(),this.updateScrollBarVisible(),this._owner.dispatchEvent("scroll"),this._owner.dispatchEvent("scroll_end")):(this.updateScrollBarPos(),this._owner.dispatchEvent("scroll"))}runTween(t){var e,i,s;if(0!=this._tweenChange[t]){if(this._tweenTime[t]+=k.deltaTime/1e3,this._tweenTime[t]>=this._tweenDuration[t])e=this._tweenStart[t]+this._tweenChange[t],this._tweenChange[t]=0;else{var h=(i=this._tweenTime[t],s=this._tweenDuration[t],(i=i/s-1)*i*i+1);e=this._tweenStart[t]+Math.floor(this._tweenChange[t]*h)}var r=0,a=-this._overlapSize[t];if(this._headerLockedSize>0&&this._refreshBarAxis==t&&(r=this._headerLockedSize),this._footerLockedSize>0&&this._refreshBarAxis==t){var n=this._overlapSize[this._refreshBarAxis];0==n?n=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):n+=this._footerLockedSize,a=-n}2==this._tweening&&this._bouncebackEffect?e>20+r&&this._tweenChange[t]>0||e>r&&0==this._tweenChange[t]?(this._tweenTime[t]=0,this._tweenDuration[t]=.3,this._tweenChange[t]=-e+r,this._tweenStart[t]=e):(e<a-20&&this._tweenChange[t]<0||e<a&&0==this._tweenChange[t])&&(this._tweenTime[t]=0,this._tweenDuration[t]=.3,this._tweenChange[t]=a-e,this._tweenStart[t]=e):e>r?(e=r,this._tweenChange[t]=0):e<a&&(e=a,this._tweenChange[t]=0)}else e=this._container[t];return e}}var es;!function(t){t[t.CRSpline=0]="CRSpline",t[t.Bezier=1]="Bezier",t[t.CubicBezier=2]="CubicBezier",t[t.Straight=3]="Straight"}(es||(es={}));class is{constructor(){this.x=0,this.y=0,this.control1_x=0,this.control1_y=0,this.control2_x=0,this.control2_y=0,this.curveType=0}static newPoint(t,e,i){var s=new is;return s.x=t||0,s.y=e||0,s.control1_x=0,s.control1_y=0,s.control2_x=0,s.control2_y=0,s.curveType=i||es.CRSpline,s}static newBezierPoint(t,e,i,s){var h=new is;return h.x=t||0,h.y=e||0,h.control1_x=i||0,h.control1_y=s||0,h.control2_x=0,h.control2_y=0,h.curveType=es.Bezier,h}static newCubicBezierPoint(t,e,i,s,h,r){var a=new is;return a.x=t||0,a.y=e||0,a.control1_x=i||0,a.control1_y=s||0,a.control2_x=h||0,a.control2_y=r||0,a.curveType=es.CubicBezier,a}clone(){var t=new is;return t.x=this.x,t.y=this.y,t.control1_x=this.control1_x,t.control1_y=this.control1_y,t.control2_x=this.control2_x,t.control2_y=this.control2_y,t.curveType=this.curveType,t}}class ss{constructor(){this._segments=new Array,this._points=new Array}get length(){return this._fullLength}create2(t,e,i,s){var h=new Array;h.push(t),h.push(e),i&&h.push(i),s&&h.push(s),this.create(h)}create(t){this._segments.length=0,this._points.length=0,this._fullLength=0;var i=t.length;if(0!=i){var s=[],h=t[0];h.curveType==es.CRSpline&&s.push(new e.Vector2(h.x,h.y));for(var r=1;r<i;r++){var a=t[r];if(h.curveType!=es.CRSpline){var n={};n.type=h.curveType,n.ptStart=this._points.length,h.curveType==es.Straight?(n.ptCount=2,this._points.push(new e.Vector2(h.x,h.y)),this._points.push(new e.Vector2(a.x,a.y))):h.curveType==es.Bezier?(n.ptCount=3,this._points.push(new e.Vector2(h.x,h.y)),this._points.push(new e.Vector2(a.x,a.y)),this._points.push(new e.Vector2(h.control1_x,h.control1_y))):h.curveType==es.CubicBezier&&(n.ptCount=4,this._points.push(new e.Vector2(h.x,h.y)),this._points.push(new e.Vector2(a.x,a.y)),this._points.push(new e.Vector2(h.control1_x,h.control1_y)),this._points.push(new e.Vector2(h.control2_x,h.control2_y))),n.length=ue(h.x,h.y,a.x,a.y),this._fullLength+=n.length,this._segments.push(n)}a.curveType!=es.CRSpline?s.length>0&&(s.push(new e.Vector2(a.x,a.y)),this.createSplineSegment(s)):s.push(new e.Vector2(a.x,a.y)),h=a}s.length>1&&this.createSplineSegment(s)}}createSplineSegment(t){var e=t.length;t.splice(0,0,t[0]),t.push(t[e]),t.push(t[e]),e+=3;var i={};i.type=es.CRSpline,i.ptStart=this._points.length,i.ptCount=e,this._points=this._points.concat(t),i.length=0;for(var s=1;s<e;s++)i.length+=ue(t[s-1].x,t[s-1].y,t[s].x,t[s].y);this._fullLength+=i.length,this._segments.push(i),t.length=0}clear(){this._segments.length=0,this._points.length=0}getPointAt(t,i){i?i.set(0,0):i=new e.Vector2,t=_e(t);var s,h=this._segments.length;if(0==h)return i;if(1==t)return(s=this._segments[h-1]).type==es.Straight?(i.x=de(this._points[s.ptStart].x,this._points[s.ptStart+1].x,t),i.y=de(this._points[s.ptStart].y,this._points[s.ptStart+1].y,t),i):s.type==es.Bezier||s.type==es.CubicBezier?this.onBezierCurve(s.ptStart,s.ptCount,t,i):this.onCRSplineCurve(s.ptStart,s.ptCount,t,i);for(var r=t*this._fullLength,a=0;a<h;a++)if((r-=(s=this._segments[a]).length)<0){t=1+r/s.length,s.type==es.Straight?(i.x=de(this._points[s.ptStart].x,this._points[s.ptStart+1].x,t),i.y=de(this._points[s.ptStart].y,this._points[s.ptStart+1].y,t)):i=s.type==es.Bezier||s.type==es.CubicBezier?this.onBezierCurve(s.ptStart,s.ptCount,t,i):this.onCRSplineCurve(s.ptStart,s.ptCount,t,i);break}return i}get segmentCount(){return this._segments.length}getAnchorsInSegment(t,i){null==i&&(i=new Array);for(var s=this._segments[t],h=0;h<s.ptCount;h++)i.push(new e.Vector2(this._points[s.ptStart+h].x,this._points[s.ptStart+h].y));return i}getPointsInSegment(t,i,s,h,r,a){null==h&&(h=new Array),a&&!isNaN(a)||(a=.1),r&&r.push(i);var n=this._segments[t];if(n.type==es.Straight)h.push(new e.Vector2(de(this._points[n.ptStart].x,this._points[n.ptStart+1].x,i),de(this._points[n.ptStart].y,this._points[n.ptStart+1].y,i))),h.push(new e.Vector2(de(this._points[n.ptStart].x,this._points[n.ptStart+1].x,s),de(this._points[n.ptStart].y,this._points[n.ptStart+1].y,s)));else{var o;o=n.type==es.Bezier||n.type==es.CubicBezier?this.onBezierCurve:this.onCRSplineCurve,h.push(o.call(this,n.ptStart,n.ptCount,i,new e.Vector2));for(var l=Math.min(n.length*a,50),_=0;_<=l;_++){var d=_/l;d>i&&d<s&&(h.push(o.call(this,n.ptStart,n.ptCount,d,new e.Vector2)),r&&r.push(d))}h.push(o.call(this,n.ptStart,n.ptCount,s,new e.Vector2))}return r&&r.push(s),h}getAllPoints(t,e,i){null==t&&(t=new Array),i&&!isNaN(i)||(i=.1);for(var s=this._segments.length,h=0;h<s;h++)this.getPointsInSegment(h,0,1,t,e,i);return t}onCRSplineCurve(t,e,i,s){var h=Math.floor(i*(e-4))+t,r=this._points[h].x,a=this._points[h].y,n=this._points[h+1].x,o=this._points[h+1].y,l=this._points[h+2].x,_=this._points[h+2].y,d=this._points[h+3].x,c=this._points[h+3].y,u=1==i?1:ce(i*(e-4),1),g=((2-u)*u-1)*u*.5,p=.5*((3*u-5)*u*u+2),f=((-3*u+4)*u+1)*u*.5,m=(u-1)*u*u*.5;return s.x=r*g+n*p+l*f+d*m,s.y=a*g+o*p+_*f+c*m,s}onBezierCurve(t,e,i,s){var h=1-i,r=this._points[t].x,a=this._points[t].y,n=this._points[t+1].x,o=this._points[t+1].y,l=this._points[t+2].x,_=this._points[t+2].y;if(4==e){var d=this._points[t+3].x,c=this._points[t+3].y;s.x=h*h*h*r+3*h*h*i*l+3*h*i*i*d+i*i*i*n,s.y=h*h*h*a+3*h*h*i*_+3*h*i*i*c+i*i*i*o}else s.x=h*h*r+2*h*i*l+i*i*n,s.y=h*h*a+2*h*i*_+i*i*o;return s}}class hs{constructor(t){this._owner=t,this._items=new Array,this._totalDuration=0,this._autoPlayTimes=1,this._autoPlayDelay=0,this._timeScale=1,this._startTime=0,this._endTime=0}play(t,e,i,s,h){this._play(t,e,i,s,h,!1)}playReverse(t,e,i,s,h){this._play(t,e,i,s,h,!0)}changePlayTimes(t){this._totalTimes=t}setAutoPlay(t,e,i){this._autoPlay!=t&&(this._autoPlay=t,this._autoPlayTimes=e||1,this._autoPlayDelay=i||0,this._autoPlay?this._owner.onStage&&this.play(null,null,this._autoPlayTimes,this._autoPlayDelay):this._owner.onStage||this.stop(!1,!0))}_play(t,e,i,s,h,r){this.stop(!0,!0),i=i||0,this._totalTimes=e||1,this._reversed=r,this._startTime=s||0,this._endTime=h||-1,this._playing=!0,this._paused=!1,this._onComplete=t;for(var a=this._items.length,n=0;n<a;n++){var o=this._items[n];if(null==o.target?o.targetId?o.target=this._owner.getChildById(o.targetId):o.target=this._owner:o.target!=this._owner&&o.target.parent!=this._owner&&(o.target=null),o.target&&o.type==rs.Transition){var l=o.target.getTransition(o.value.transName);if(l==this&&(l=null),l)if(0==o.value.playTimes){var _;for(_=n-1;_>=0;_--){var d=this._items[_];if(d.type==rs.Transition&&d.value.trans==l){d.value.stopTime=o.time-d.time;break}}_<0?o.value.stopTime=0:l=null}else o.value.stopTime=-1;o.value.trans=l}}0==i?this.onDelayedPlay():Nt.delayedCall(i).setTarget(this).onComplete(this.onDelayedPlay,this)}stop(t,e){if(this._playing){null==t&&(t=!0),this._playing=!1,this._totalTasks=0,this._totalTimes=0;var i=this._onComplete;this._onComplete=null,Nt.kill(this);var s=this._items.length;if(this._reversed)for(var h=s-1;h>=0;h--){var r=this._items[h];null!=r.target&&this.stopItem(r,t)}else for(h=0;h<s;h++)null!=(r=this._items[h]).target&&this.stopItem(r,t);e&&i&&i()}}stopItem(t,e){if(0!=t.displayLockToken&&(t.target.releaseDisplayLock(t.displayLockToken),t.displayLockToken=0),t.tweener&&(t.tweener.kill(e),t.tweener=null,t.type!=rs.Shake||e||(t.target._gearLocked=!0,t.target.setPosition(t.target.x-t.value.lastOffsetX,t.target.y-t.value.lastOffsetY),t.target._gearLocked=!1)),t.type==rs.Transition){var i=t.value.trans;i&&i.stop(e,!1)}}setPaused(e){if(this._playing&&this._paused!=e){this._paused=e;var i=Nt.getTween(this);i&&i.setPaused(e);for(var s=this._items.length,h=0;h<s;h++){var r=this._items[h];null!=r.target&&(r.type==rs.Transition?r.value.trans&&r.value.trans.setPaused(e):r.type==rs.Animation&&(e?(r.value.flag=r.target.getProp(t.ObjectPropID.Playing),r.target.setProp(t.ObjectPropID.Playing,!1)):r.target.setProp(t.ObjectPropID.Playing,r.value.flag)),r.tweener&&r.tweener.setPaused(e))}}}dispose(){this._playing&&Nt.kill(this);for(var t=this._items.length,e=0;e<t;e++){var i=this._items[e];i.tweener&&(i.tweener.kill(),i.tweener=null),i.target=null,i.hook=null,i.tweenConfig&&(i.tweenConfig.endHook=null)}this._items.length=0,this._playing=!1,this._onComplete=null}get playing(){return this._playing}setValue(t,...e){for(var i,s=this._items.length,h=!1,r=0;r<s;r++){var a=this._items[r];if(a.label==t)i=a.tweenConfig?a.tweenConfig.startValue:a.value,h=!0;else{if(!a.tweenConfig||a.tweenConfig.endLabel!=t)continue;i=a.tweenConfig.endValue,h=!0}switch(a.type){case rs.XY:case rs.Size:case rs.Pivot:case rs.Scale:case rs.Skew:i.b1=!0,i.b2=!0,i.f1=parseFloat(e[0]),i.f2=parseFloat(e[1]);break;case rs.Alpha:case rs.Rotation:case rs.Color:i.f1=parseFloat(e[0]);break;case rs.Animation:i.frame=parseInt(e[0]),e.length>1&&(i.playing=e[1]);break;case rs.Visible:i.visible=e[0];break;case rs.Sound:i.sound=e[0],e.length>1&&(i.volume=parseFloat(e[1]));break;case rs.Transition:i.transName=e[0],e.length>1&&(i.playTimes=parseInt(e[1]));break;case rs.Shake:i.amplitude=parseFloat(e[0]),e.length>1&&(i.duration=parseFloat(e[1]));break;case rs.ColorFilter:i.f1=parseFloat(e[0]),i.f2=parseFloat(e[1]),i.f3=parseFloat(e[2]),i.f4=parseFloat(e[3]);break;case rs.Text:case rs.Icon:i.text=e[0]}}if(!h)throw new Error("this.label not exists")}setHook(t,e){for(var i=this._items.length,s=!1,h=0;h<i;h++){var r=this._items[h];if(r.label==t){r.hook=e,s=!0;break}if(r.tweenConfig&&r.tweenConfig.endLabel==t){r.tweenConfig.endHook=e,s=!0;break}}if(!s)throw new Error("this.label not exists")}clearHooks(){for(var t=this._items.length,e=0;e<t;e++){var i=this._items[e];i.hook=null,i.tweenConfig&&(i.tweenConfig.endHook=null)}}setTarget(t,e){for(var i=this._items.length,s=!1,h=0;h<i;h++){var r=this._items[h];r.label==t&&(r.targetId=e==this._owner||null==e?"":e.id,this._playing?r.targetId.length>0?r.target=this._owner.getChildById(r.targetId):r.target=this._owner:r.target=null,s=!0)}if(!s)throw new Error("this.label not exists")}setDuration(t,e){for(var i=this._items.length,s=!1,h=0;h<i;h++){var r=this._items[h];r.tweenConfig&&r.label==t&&(r.tweenConfig.duration=e,s=!0)}if(!s)throw new Error("this.label not exists")}getLabelTime(t){for(var e=this._items.length,i=0;i<e;i++){var s=this._items[i];if(s.label==t)return s.time;if(s.tweenConfig&&s.tweenConfig.endLabel==t)return s.time+s.tweenConfig.duration}return NaN}get timeScale(){return this._timeScale}set timeScale(e){if(this._timeScale!=e&&(this._timeScale=e,this._playing))for(var i=this._items.length,s=0;s<i;s++){var h=this._items[s];h.tweener?h.tweener.setTimeScale(e):h.type==rs.Transition?h.value.trans&&(h.value.trans.timeScale=e):h.type==rs.Animation&&h.target&&h.target.setProp(t.ObjectPropID.TimeScale,e)}}updateFromRelations(t,e,i){var s=this._items.length;if(0!=s)for(var h=0;h<s;h++){var r=this._items[h];r.type==rs.XY&&r.targetId==t&&(r.tweenConfig?(r.tweenConfig.startValue.b3||(r.tweenConfig.startValue.f1+=e,r.tweenConfig.startValue.f2+=i),r.tweenConfig.endValue.b3||(r.tweenConfig.endValue.f1+=e,r.tweenConfig.endValue.f2+=i)):r.value.b3||(r.value.f1+=e,r.value.f2+=i))}}onOwnerAddedToStage(){this._autoPlay&&!this._playing&&this.play(null,this._autoPlayTimes,this._autoPlayDelay)}onOwnerRemovedFromStage(){0==(2&this._options)&&this.stop(0!=(4&this._options),!1)}onDelayedPlay(){if(this.internalPlay(),this._playing=this._totalTasks>0,this._playing){if(0!=(1&this._options))for(var t=this._items.length,e=0;e<t;e++){var i=this._items[e];i.target&&i.target!=this._owner&&(i.displayLockToken=i.target.addDisplayLock())}}else if(this._onComplete){var s=this._onComplete;this._onComplete=null,s()}}internalPlay(){this._ownerBaseX=this._owner.x,this._ownerBaseY=this._owner.y,this._totalTasks=1;var t,e=this._items.length,i=!1;if(this._reversed)for(s=e-1;s>=0;s--)null!=(t=this._items[s]).target&&this.playItem(t);else for(var s=0;s<e;s++)null!=(t=this._items[s]).target&&(t.type==rs.Animation&&0!=this._startTime&&t.time<=this._startTime?(i=!0,t.value.flag=!1):this.playItem(t));i&&this.skipAnimations(),this._totalTasks--}playItem(t){var e;if(t.tweenConfig){if(e=this._reversed?this._totalDuration-t.time-t.tweenConfig.duration:t.time,-1==this._endTime||e<=this._endTime){var i,s;switch(this._reversed?(i=t.tweenConfig.endValue,s=t.tweenConfig.startValue):(i=t.tweenConfig.startValue,s=t.tweenConfig.endValue),t.value.b1=i.b1||s.b1,t.value.b2=i.b2||s.b2,t.type){case rs.XY:case rs.Size:case rs.Scale:case rs.Skew:t.tweener=Nt.to2(i.f1,i.f2,s.f1,s.f2,t.tweenConfig.duration);break;case rs.Alpha:case rs.Rotation:t.tweener=Nt.to(i.f1,s.f1,t.tweenConfig.duration);break;case rs.Color:t.tweener=Nt.toColor(i.f1,s.f1,t.tweenConfig.duration);break;case rs.ColorFilter:t.tweener=Nt.to4(i.f1,i.f2,i.f3,i.f4,s.f1,s.f2,s.f3,s.f4,t.tweenConfig.duration)}t.tweener.setDelay(e).setEase(t.tweenConfig.easeType).setRepeat(t.tweenConfig.repeat,t.tweenConfig.yoyo).setTimeScale(this._timeScale).setTarget(t).onStart(this.onTweenStart,this).onUpdate(this.onTweenUpdate,this).onComplete(this.onTweenComplete,this),this._endTime>=0&&t.tweener.setBreakpoint(this._endTime-e),this._totalTasks++}}else t.type==rs.Shake?(e=this._reversed?this._totalDuration-t.time-t.value.duration:t.time,t.value.offsetX=t.value.offsetY=0,t.value.lastOffsetX=t.value.lastOffsetY=0,t.tweener=Nt.shake(0,0,t.value.amplitude,t.value.duration).setDelay(e).setTimeScale(this._timeScale).setTarget(t).onUpdate(this.onTweenUpdate,this).onComplete(this.onTweenComplete,this),this._endTime>=0&&t.tweener.setBreakpoint(this._endTime-t.time),this._totalTasks++):(e=this._reversed?this._totalDuration-t.time:t.time)<=this._startTime?(this.applyValue(t),this.callHook(t,!1)):(-1==this._endTime||e<=this._endTime)&&(this._totalTasks++,t.tweener=Nt.delayedCall(e).setTimeScale(this._timeScale).setTarget(t).onComplete(this.onDelayedPlayItem,this));t.tweener&&t.tweener.seek(this._startTime)}skipAnimations(){for(var e,i,s,h,r,a,n=this._items.length,o=0;o<n;o++)if(!((a=this._items[o]).type!=rs.Animation||a.time>this._startTime||(h=a.value).flag)){e=(r=a.target).getProp(t.ObjectPropID.Frame),i=r.getProp(t.ObjectPropID.Playing)?0:-1,s=0;for(var l=o;l<n;l++)(a=this._items[l]).type!=rs.Animation||a.target!=r||a.time>this._startTime||((h=a.value).flag=!0,-1!=h.frame?(e=h.frame,i=h.playing?a.time:-1,s=0):h.playing?i<0&&(i=a.time):(i>=0&&(s+=a.time-i),i=-1),this.callHook(a,!1));i>=0&&(s+=this._startTime-i),r.setProp(t.ObjectPropID.Playing,i>=0),r.setProp(t.ObjectPropID.Frame,e),s>0&&r.setProp(t.ObjectPropID.DeltaTime,1e3*s)}}onDelayedPlayItem(t){var e=t.target;e.tweener=null,this._totalTasks--,this.applyValue(e),this.callHook(e,!1),this.checkAllComplete()}onTweenStart(t){var e,i,s=t.target;s.type!=rs.XY&&s.type!=rs.Size||(this._reversed?(e=s.tweenConfig.endValue,i=s.tweenConfig.startValue):(e=s.tweenConfig.startValue,i=s.tweenConfig.endValue),s.type==rs.XY?s.target!=this._owner?(e.b1?e.b3&&(t.startValue.x=e.f1*this._owner.width):t.startValue.x=s.target.x,e.b2?e.b3&&(t.startValue.y=e.f2*this._owner.height):t.startValue.y=s.target.y,i.b1?i.b3&&(t.endValue.x=i.f1*this._owner.width):t.endValue.x=t.startValue.x,i.b2?i.b3&&(t.endValue.y=i.f2*this._owner.height):t.endValue.y=t.startValue.y):(e.b1||(t.startValue.x=s.target.x-this._ownerBaseX),e.b2||(t.startValue.y=s.target.y-this._ownerBaseY),i.b1||(t.endValue.x=t.startValue.x),i.b2||(t.endValue.y=t.startValue.y)):(e.b1||(t.startValue.x=s.target.width),e.b2||(t.startValue.y=s.target.height),i.b1||(t.endValue.x=t.startValue.x),i.b2||(t.endValue.y=t.startValue.y)),s.tweenConfig.path&&(s.value.b1=s.value.b2=!0,t.setPath(s.tweenConfig.path)));this.callHook(s,!1)}onTweenUpdate(t){var e=t.target;switch(e.type){case rs.XY:case rs.Size:case rs.Scale:case rs.Skew:e.value.f1=t.value.x,e.value.f2=t.value.y,e.tweenConfig.path&&(e.value.f1+=t.startValue.x,e.value.f2+=t.startValue.y);break;case rs.Alpha:case rs.Rotation:e.value.f1=t.value.x;break;case rs.Color:e.value.f1=t.value.color;break;case rs.ColorFilter:e.value.f1=t.value.x,e.value.f2=t.value.y,e.value.f3=t.value.z,e.value.f4=t.value.w;break;case rs.Shake:e.value.offsetX=t.deltaValue.x,e.value.offsetY=t.deltaValue.y}this.applyValue(e)}onTweenComplete(t){var e=t.target;e.tweener=null,this._totalTasks--,t.allCompleted&&this.callHook(e,!0),this.checkAllComplete()}onPlayTransCompleted(t){this._totalTasks--,this.checkAllComplete()}callHook(t,e){e?t.tweenConfig&&t.tweenConfig.endHook&&t.tweenConfig.endHook():t.time>=this._startTime&&t.hook&&t.hook()}checkAllComplete(){if(this._playing&&0==this._totalTasks)if(this._totalTimes<0)this.internalPlay(),0==this._totalTasks&&Nt.delayedCall(0).setTarget(this).onComplete(this.checkAllComplete,this);else if(this._totalTimes--,this._totalTimes>0)this.internalPlay(),0==this._totalTasks&&Nt.delayedCall(0).setTarget(this).onComplete(this.checkAllComplete,this);else{this._playing=!1;for(var t=this._items.length,e=0;e<t;e++){var i=this._items[e];i.target&&0!=i.displayLockToken&&(i.target.releaseDisplayLock(i.displayLockToken),i.displayLockToken=0)}if(this._onComplete){var s=this._onComplete;this._onComplete=null,s()}}}applyValue(e){e.target._gearLocked=!0;var i=e.value;switch(e.type){case rs.XY:e.target==this._owner?i.b1&&i.b2?e.target.setPosition(i.f1+this._ownerBaseX,i.f2+this._ownerBaseY):i.b1?e.target.x=i.f1+this._ownerBaseX:e.target.y=i.f2+this._ownerBaseY:i.b3?i.b1&&i.b2?e.target.setPosition(i.f1*this._owner.width,i.f2*this._owner.height):i.b1?e.target.x=i.f1*this._owner.width:i.b2&&(e.target.y=i.f2*this._owner.height):i.b1&&i.b2?e.target.setPosition(i.f1,i.f2):i.b1?e.target.x=i.f1:i.b2&&(e.target.y=i.f2);break;case rs.Size:i.b1||(i.f1=e.target.width),i.b2||(i.f2=e.target.height),e.target.setSize(i.f1,i.f2);break;case rs.Pivot:e.target.setPivot(i.f1,i.f2,e.target.pivotAsAnchor);break;case rs.Alpha:e.target.alpha=i.f1;break;case rs.Rotation:e.target.rotation=i.f1;break;case rs.Scale:e.target.setScale(i.f1,i.f2);break;case rs.Skew:e.target.setSkew(i.f1,i.f2);break;case rs.Color:e.target.setProp(t.ObjectPropID.Color,i.f1);break;case rs.Animation:i.frame>=0&&e.target.setProp(t.ObjectPropID.Frame,i.frame),e.target.setProp(t.ObjectPropID.Playing,i.playing),e.target.setProp(t.ObjectPropID.TimeScale,this._timeScale);break;case rs.Visible:e.target.visible=i.visible;break;case rs.Transition:if(this._playing){var s=i.trans;if(s){this._totalTasks++;var h=this._startTime>e.time?this._startTime-e.time:0,r=this._endTime>=0?this._endTime-e.time:-1;i.stopTime>=0&&(r<0||r>i.stopTime)&&(r=i.stopTime),s.timeScale=this._timeScale,s._play(this.onPlayTransCompleted.bind(this,e),i.playTimes,0,h,r,this._reversed)}}break;case rs.Sound:if(this._playing&&e.time>=this._startTime){if(null==i.audioClip){var a=Fi.getItemByURL(i.sound);i.audioClip=a?a.file:i.sound}i.audioClip&&se.GRoot.inst.playOneShotSound(i.audioClip,i.volume)}break;case rs.Shake:e.target.setPosition(e.target.x-i.lastOffsetX+i.offsetX,e.target.y-i.lastOffsetY+i.offsetY),i.lastOffsetX=i.offsetX,i.lastOffsetY=i.offsetY;break;case rs.ColorFilter:break;case rs.Text:e.target.text=i.text;break;case rs.Icon:e.target.icon=i.text}e.target._gearLocked=!1}setup(t){this.name=t.readS(),this._options=t.readInt(),this._autoPlay=t.readBool(),this._autoPlayTimes=t.readInt(),this._autoPlayDelay=t.readFloat();for(var e=t.readShort(),i=0;i<e;i++){var s=t.readShort(),h=t.pos;t.seek(h,0);var r=new as(t.readByte());this._items[i]=r,r.time=t.readFloat();var a=t.readShort();if(r.targetId=a<0?"":this._owner.getChildAt(a).id,r.label=t.readS(),t.readBool()){if(t.seek(h,1),r.tweenConfig=new ns,r.tweenConfig.duration=t.readFloat(),r.time+r.tweenConfig.duration>this._totalDuration&&(this._totalDuration=r.time+r.tweenConfig.duration),r.tweenConfig.easeType=t.readByte(),r.tweenConfig.repeat=t.readInt(),r.tweenConfig.yoyo=t.readBool(),r.tweenConfig.endLabel=t.readS(),t.seek(h,2),this.decodeValue(r,t,r.tweenConfig.startValue),t.seek(h,3),this.decodeValue(r,t,r.tweenConfig.endValue),t.version>=2){var n=t.readInt();if(n>0){r.tweenConfig.path=new ss;for(var o=new Array,l=0;l<n;l++){var _=t.readByte();switch(_){case es.Bezier:o.push(is.newBezierPoint(t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat()));break;case es.CubicBezier:o.push(is.newCubicBezierPoint(t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat()));break;default:o.push(is.newPoint(t.readFloat(),t.readFloat(),_))}}r.tweenConfig.path.create(o)}}}else r.time>this._totalDuration&&(this._totalDuration=r.time),t.seek(h,2),this.decodeValue(r,t,r.value);t.pos=h+s}}decodeValue(t,e,i){switch(t.type){case rs.XY:case rs.Size:case rs.Pivot:case rs.Skew:i.b1=e.readBool(),i.b2=e.readBool(),i.f1=e.readFloat(),i.f2=e.readFloat(),e.version>=2&&t.type==rs.XY&&(i.b3=e.readBool());break;case rs.Alpha:case rs.Rotation:i.b1=i.b2=!0,i.f1=e.readFloat();break;case rs.Scale:i.b1=i.b2=!0,i.f1=e.readFloat(),i.f2=e.readFloat();break;case rs.Color:i.b1=i.b2=!0,i.f1=e.readColor();break;case rs.Animation:i.playing=e.readBool(),i.frame=e.readInt();break;case rs.Visible:i.visible=e.readBool();break;case rs.Sound:i.sound=e.readS(),i.volume=e.readFloat();break;case rs.Transition:i.transName=e.readS(),i.playTimes=e.readInt();break;case rs.Shake:i.amplitude=e.readFloat(),i.duration=e.readFloat();break;case rs.ColorFilter:i.b1=i.b2=!0,i.f1=e.readFloat(),i.f2=e.readFloat(),i.f3=e.readFloat(),i.f4=e.readFloat();break;case rs.Text:case rs.Icon:i.text=e.readS()}}}var rs;!function(t){t[t.XY=0]="XY",t[t.Size=1]="Size",t[t.Scale=2]="Scale",t[t.Pivot=3]="Pivot",t[t.Alpha=4]="Alpha",t[t.Rotation=5]="Rotation",t[t.Color=6]="Color",t[t.Animation=7]="Animation",t[t.Visible=8]="Visible",t[t.Sound=9]="Sound",t[t.Transition=10]="Transition",t[t.Shake=11]="Shake",t[t.ColorFilter=12]="ColorFilter",t[t.Skew=13]="Skew",t[t.Text=14]="Text",t[t.Icon=15]="Icon",t[t.Unknown=16]="Unknown"}(rs||(rs={}));class as{constructor(t){this.type=t,this.value={},this.displayLockToken=0}}class ns{constructor(){this.easeType=t.EaseType.QuadOut,this.startValue={b1:!0,b2:!0},this.endValue={b1:!0,b2:!0}}}class os{constructor(){}static loadFromXML(t){let e={};os.strings=e,t.elements("string").forEach(t=>{let i=t.getAttrString("name"),s=t.text,h=i.indexOf("-");if(-1==h)return;let r=i.substr(0,h),a=i.substr(h+1),n=e[r];n||(n={},e[r]=n),n[a]=s})}static translateComponent(e){if(null!=os.strings){var i=os.strings[e.owner.id+e.id];if(i){var s,h,r,a,n,o,l,_,d,c=e.rawData;c.seek(0,2);var u=c.readShort();for(n=0;n<u;n++){l=c.readShort(),_=c.pos,c.seek(_,0);var g=c.readByte(),p=g;c.skip(4),s=c.readS(),p==t.ObjectType.Component&&c.seek(_,6)&&(p=c.readByte()),c.seek(_,1),null!=(h=i[s+"-tips"])&&c.writeS(h),c.seek(_,2);var f=c.readShort();for(o=0;o<f;o++){if(r=c.readShort(),r+=c.pos,6==c.readByte()){for(c.skip(2),d=c.readShort(),y=0;y<d;y++)null!=c.readS()&&(null!=(h=i[s+"-texts_"+y])?c.writeS(h):c.skip(2));c.readBool()&&null!=(h=i[s+"-texts_def"])&&c.writeS(h)}c.pos=r}if(g==t.ObjectType.Component&&c.version>=2){c.seek(_,4),c.skip(2),c.skip(4*c.readUshort());for(var m=c.readUshort(),y=0;y<m;y++){var w=c.readS();0==c.readUshort()&&null!=(h=i[s+"-cp-"+w])?c.writeS(h):c.skip(2)}}switch(p){case t.ObjectType.Text:case t.ObjectType.RichText:case t.ObjectType.InputText:null!=(h=i[s])&&(c.seek(_,6),c.writeS(h)),null!=(h=i[s+"-prompt"])&&(c.seek(_,4),c.writeS(h));break;case t.ObjectType.List:case t.ObjectType.Tree:for(c.seek(_,8),c.skip(2),a=c.readUshort(),o=0;o<a;o++){if(r=c.readUshort(),r+=c.pos,c.skip(2),p==t.ObjectType.Tree&&c.skip(2),null!=(h=i[s+"-"+o])?c.writeS(h):c.skip(2),null!=(h=i[s+"-"+o+"-0"])?c.writeS(h):c.skip(2),c.version>=2){c.skip(6),c.skip(4*c.readUshort());for(m=c.readUshort(),y=0;y<m;y++){w=c.readS();0==c.readUshort()&&null!=(h=i[s+"-"+o+"-"+w])?c.writeS(h):c.skip(2)}}c.pos=r}break;case t.ObjectType.Label:c.seek(_,6)&&c.readByte()==p&&(null!=(h=i[s])?c.writeS(h):c.skip(2),c.skip(2),c.readBool()&&c.skip(4),c.skip(4),c.readBool()&&null!=(h=i[s+"-prompt"])&&c.writeS(h));break;case t.ObjectType.Button:c.seek(_,6)&&c.readByte()==p&&(null!=(h=i[s])?c.writeS(h):c.skip(2),null!=(h=i[s+"-0"])&&c.writeS(h));break;case t.ObjectType.ComboBox:if(c.seek(_,6)&&c.readByte()==p){for(a=c.readShort(),o=0;o<a;o++)r=c.readShort(),r+=c.pos,null!=(h=i[s+"-"+o])&&c.writeS(h),c.pos=r;null!=(h=i[s])&&c.writeS(h)}}c.pos=_+l}}}}}var ls,_s,ds=new e.Vector2;class cs{constructor(t){this.shape=t}hitTest(t,e,i){if(!this.shape.graphics)return!1;if(this.shape.parent){let t=this.shape.parent.$owner;t&&(t.transformPoint(e,i,this.shape.obj3D,ds),e=ds.x,i=ds.y)}let s=this.shape.graphics.meshFactory;return"hitTest"in s&&s.hitTest(t,e,i)}}class us extends qt{constructor(){super(),this._sortingChildCount=0,this._children=[],this._controllers=[],this._transitions=[],this._margin=new Qi,this._alignOffset=new e.Vector2,this._childrenRenderOrder=0,this._apexIndex=0}createDisplayObject(){super.createDisplayObject(),this._container=new ft,this._displayObject=this._container}dispose(){var t,e;for(e=this._transitions.length,t=0;t<e;++t){this._transitions[t].dispose()}for(e=this._controllers.length,t=0;t<e;++t){this._controllers[t].dispose()}for(this.scrollPane&&this.scrollPane.dispose(),t=(e=this._children.length)-1;t>=0;--t){var i=this._children[t];i.parent=null,i.dispose()}this._boundsChanged=!1,super.dispose()}get displayListContainer(){return this._container}addChild(t){return this.addChildAt(t,this._children.length),t}addChildAt(t,e){if(!t)throw"child is null";if(e>=0&&e<=this._children.length){if(t.parent==this)this.setChildIndex(t,e);else{t.removeFromParent(),t.parent=this;var i=this._children.length;0!=t.sortingOrder?(this._sortingChildCount++,e=this.getInsertPosForSortingChild(t)):this._sortingChildCount>0&&e>i-this._sortingChildCount&&(e=i-this._sortingChildCount),e==i?this._children.push(t):this._children.splice(e,0,t),this.childStateChanged(t),this.setBoundsChangedFlag()}return t}throw"Invalid child index"}getInsertPosForSortingChild(t){for(var e=this._children.length,i=0;i<e;i++){var s=this._children[i];if(s!=t&&t.sortingOrder<s.sortingOrder)break}return i}removeChild(t,e){var i=this._children.indexOf(t);return-1!=i&&this.removeChildAt(i,e),t}removeChildAt(e,i){if(e>=0&&e<this._children.length){var s=this._children[e];return s.parent=null,0!=s.sortingOrder&&this._sortingChildCount--,this._children.splice(e,1),s.group=null,s.displayObject.parent&&(this._container.removeChild(s.displayObject),this._childrenRenderOrder==t.ChildrenRenderOrder.Arch&&k.callLater(this.buildNativeDisplayList,this)),i&&s.dispose(),this.setBoundsChangedFlag(),s}throw"Invalid child index"}removeChildren(t,e,i){t=t||0,null==e&&(e=-1),(e<0||e>=this._children.length)&&(e=this._children.length-1);for(var s=t;s<=e;++s)this.removeChildAt(t,i)}getChildAt(t){if(t>=0&&t<this._children.length)return this._children[t];throw"Invalid child index"}getChild(t){for(var e=this._children.length,i=0;i<e;++i)if(this._children[i].name==t)return this._children[i];return null}getChildByPath(t){for(var e,i=t.split("."),s=i.length,h=this,r=0;r<s&&(e=h.getChild(i[r]));++r)if(r!=s-1){if(!(e instanceof us)){e=null;break}h=e}return e}getVisibleChild(t){for(var e=this._children.length,i=0;i<e;++i){var s=this._children[i];if(s.internalVisible&&s.internalVisible2&&s.name==t)return s}return null}getChildInGroup(t,e){for(var i=this._children.length,s=0;s<i;++s){var h=this._children[s];if(h.group==e&&h.name==t)return h}return null}getChildById(t){for(var e=this._children.length,i=0;i<e;++i)if(this._children[i]._id==t)return this._children[i];return null}getChildIndex(t){return this._children.indexOf(t)}setChildIndex(t,e){var i=this._children.indexOf(t);if(-1==i)throw"Not a child of this container";if(0==t.sortingOrder){var s=this._children.length;this._sortingChildCount>0&&e>s-this._sortingChildCount-1&&(e=s-this._sortingChildCount-1),this._setChildIndex(t,i,e)}}setChildIndexBefore(t,e){var i=this._children.indexOf(t);if(-1==i)throw"Not a child of this container";if(0!=t.sortingOrder)return i;var s=this._children.length;return this._sortingChildCount>0&&e>s-this._sortingChildCount-1&&(e=s-this._sortingChildCount-1),i<e?this._setChildIndex(t,i,e-1):this._setChildIndex(t,i,e)}_setChildIndex(e,i,s){var h=this._children.length;if(s>h&&(s=h),i==s)return i;if(this._children.splice(i,1),this._children.splice(s,0,e),e.displayObject.parent){var r,a=0;if(this._childrenRenderOrder==t.ChildrenRenderOrder.Ascent){for(r=0;r<s;r++)this._children[r].displayObject.parent&&a++;a==this._container.numChildren&&a--,this._container.setChildIndex(e.displayObject,a)}else if(this._childrenRenderOrder==t.ChildrenRenderOrder.Descent){for(r=h-1;r>s;r--)this._children[r].displayObject.parent&&a++;a==this._container.numChildren&&a--,this._container.setChildIndex(e.displayObject,a)}else k.callLater(this.buildNativeDisplayList,this);this.setBoundsChangedFlag()}return s}swapChildren(t,e){var i=this._children.indexOf(t),s=this._children.indexOf(e);if(-1==i||-1==s)throw"Not a child of this container";this.swapChildrenAt(i,s)}swapChildrenAt(t,e){var i=this._children[t],s=this._children[e];this.setChildIndex(i,e),this.setChildIndex(s,t)}get numChildren(){return this._children.length}isAncestorOf(t){if(null==t)return!1;for(var e=t.parent;e;){if(e==this)return!0;e=e.parent}return!1}addController(t){this._controllers.push(t),t.parent=this,this.applyController(t)}getControllerAt(t){return this._controllers[t]}getController(t){for(var e=this._controllers.length,i=0;i<e;++i){var s=this._controllers[i];if(s.name==t)return s}return null}removeController(t){var e=this._controllers.indexOf(t);if(-1==e)throw new Error("controller not exists");t.parent=null,this._controllers.splice(e,1);for(var i=this._children.length,s=0;s<i;s++){this._children[s].handleControllerChanged(t)}}get controllers(){return this._controllers}childStateChanged(e){if(!this._buildingDisplayList){var i=this._children.length;if(e instanceof ae)for(let t=0;t<i;t++){let i=this._children[t];i.group==e&&this.childStateChanged(i)}else if(e.internalVisible){if(!e.displayObject.parent){var s=0;if(this._childrenRenderOrder==t.ChildrenRenderOrder.Ascent){for(let t=0;t<i;t++){let i=this._children[t];if(i==e)break;i.displayObject.parent&&s++}this._container.addChildAt(e.displayObject,s)}else if(this._childrenRenderOrder==t.ChildrenRenderOrder.Descent){for(let t=i-1;t>=0;t--){let i=this._children[t];if(i==e)break;i.displayObject.parent&&s++}this._container.addChildAt(e.displayObject,s)}else this._container.addChild(e.displayObject),k.callLater(this.buildNativeDisplayList,this)}}else e.displayObject.parent&&(this._container.removeChild(e.displayObject),this._childrenRenderOrder==t.ChildrenRenderOrder.Arch&&k.callLater(this.buildNativeDisplayList,this))}}buildNativeDisplayList(){if(this._displayObject){var e=this._children.length;if(0!=e)switch(this._childrenRenderOrder){case t.ChildrenRenderOrder.Ascent:for(let t=0;t<e;t++){let e=this._children[t];e.internalVisible&&this._container.addChild(e.displayObject)}break;case t.ChildrenRenderOrder.Descent:for(let t=e-1;t>=0;t--){let e=this._children[t];e.internalVisible&&this._container.addChild(e.displayObject)}break;case t.ChildrenRenderOrder.Arch:var i=le(this._apexIndex,0,e);for(let t=0;t<i;t++){let e=this._children[t];e.internalVisible&&this._container.addChild(e.displayObject)}for(let t=e-1;t>=i;t--){let e=this._children[t];e.internalVisible&&this._container.addChild(e.displayObject)}}}}applyController(t){this._applyingController=t;for(var e=this._children.length,i=0;i<e;i++)this._children[i].handleControllerChanged(t);this._applyingController=null,t.runActions()}applyAllControllers(){for(var t=this._controllers.length,e=0;e<t;++e)this.applyController(this._controllers[e])}adjustRadioGroupDepth(t,e){var i=this._children.length,s=-1,h=-1;for(let r=0;r<i;r++){let i=this._children[r];i==t?s=r:"relatedController"in i&&i.relatedController==e&&r>h&&(h=r)}s<h&&(this._applyingController&&this._children[h].handleControllerChanged(this._applyingController),this.swapChildrenAt(s,h))}getTransitionAt(t){return this._transitions[t]}getTransition(t){for(var e=this._transitions.length,i=0;i<e;++i){var s=this._transitions[i];if(s.name==t)return s}return null}isChildInView(t){return this._displayObject.clipRect?t.x+t.width>=0&&t.x<=this.width&&t.y+t.height>=0&&t.y<=this.height:!this._scrollPane||this._scrollPane.isChildInView(t)}getFirstChildInView(){for(var t=this._children.length,e=0;e<t;++e){var i=this._children[e];if(this.isChildInView(i))return e}return-1}get scrollPane(){return this._scrollPane}get opaque(){return this._displayObject.opaque}set opaque(t){this._displayObject.opaque=t}get margin(){return this._margin}set margin(t){this._margin.copy(t),this._displayObject.clipRect&&this._container.setPosition(this._margin.left+this._alignOffset.x,this._margin.top+this._alignOffset.y),this.handleSizeChanged()}get childrenRenderOrder(){return this._childrenRenderOrder}set childrenRenderOrder(t){this._childrenRenderOrder!=t&&(this._childrenRenderOrder=t,this.buildNativeDisplayList())}get apexIndex(){return this._apexIndex}set apexIndex(e){this._apexIndex!=e&&(this._apexIndex=e,this._childrenRenderOrder==t.ChildrenRenderOrder.Arch&&this.buildNativeDisplayList())}get baseUserData(){var t=this.packageItem.rawData;return t.seek(0,4),t.readS()}updateMask(){var t=this._displayObject.clipRect;null==t&&(t=new P),t.x=this._margin.left,t.y=this._margin.top,t.width=this._width-this._margin.right,t.height=this._height-this._margin.bottom,this._displayObject.clipRect=t}setupScroll(t){this._displayObject==this._container&&(this._container=new ft,this._displayObject.addChild(this._container)),this._scrollPane=new ts(this),this._scrollPane.setup(t)}setupOverflow(e){e==t.OverflowType.Hidden?(this._displayObject==this._container&&(this._container=new ft,this._displayObject.addChild(this._container)),this.updateMask(),this._container.setPosition(this._margin.left,this._margin.top)):0==this._margin.left&&0==this._margin.top||(this._displayObject==this._container&&(this._container=new ft,this._displayObject.addChild(this._container)),this._container.setPosition(this._margin.left,this._margin.top))}handleSizeChanged(){super.handleSizeChanged(),this._scrollPane?this._scrollPane.onOwnerSizeChanged():this._displayObject.clipRect&&this.updateMask()}handleGrayedChanged(){var t=this.getController("grayed");if(t)t.selectedIndex=this.grayed?1:0;else for(var e=this.grayed,i=this._children.length,s=0;s<i;++s)this._children[s].grayed=e}handleControllerChanged(t){super.handleControllerChanged(t),this._scrollPane&&this._scrollPane.handleControllerChanged(t)}setBoundsChangedFlag(){(this._scrollPane||this._trackBounds)&&(this._boundsChanged||(this._boundsChanged=!0,k.callLater(this.__render,this)))}__render(){this._boundsChanged&&this.updateBounds()}ensureBoundsCorrect(){this._boundsChanged&&this.updateBounds()}updateBounds(){var t=0,e=0,i=0,s=0,h=this._children.length;if(h>0){t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY;var r=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY,n=0,o=0;for(o=0;o<h;o++){var l=this._children[o];(n=l.x)<t&&(t=n),(n=l.y)<e&&(e=n),(n=l.x+l.actualWidth)>r&&(r=n),(n=l.y+l.actualHeight)>a&&(a=n)}i=r-t,s=a-e}this.setBounds(t,e,i,s)}setBounds(t,e,i,s){this._boundsChanged=!1,this._scrollPane&&this._scrollPane.setContentSize(Math.round(t+i),Math.round(e+s))}get viewWidth(){return this._scrollPane?this._scrollPane.viewWidth:this.width-this._margin.left-this._margin.right}set viewWidth(t){this._scrollPane?this._scrollPane.viewWidth=t:this.width=t+this._margin.left+this._margin.right}get viewHeight(){return this._scrollPane?this._scrollPane.viewHeight:this.height-this._margin.top-this._margin.bottom}set viewHeight(t){this._scrollPane?this._scrollPane.viewHeight=t:this.height=t+this._margin.top+this._margin.bottom}getSnappingPosition(t,e,i){return this.getSnappingPositionWithDir(t,e,0,0,i)}getSnappingPositionWithDir(t,i,s,h,r){r||(r=new e.Vector2);var a=this._children.length;if(0==a)return r.x=0,r.y=0,r;this.ensureBoundsCorrect();var n=null,o=null,l=0;if(0!=i){for(;l<a;l++)if(i<(n=this._children[l]).y){if(0==l){i=0;break}i=i<(o=this._children[l-1]).y+o.actualHeight/2?o.y:n.y;break}l==a&&(i=n.y)}if(0!=t){for(l>0&&l--;l<a;l++)if(t<(n=this._children[l]).x){if(0==l){t=0;break}t=t<(o=this._children[l-1]).x+o.actualWidth/2?o.x:n.x;break}l==a&&(t=n.x)}return r.x=t,r.y=i,r}childSortingOrderChanged(t,e,i){if(0==i)this._sortingChildCount--,this.setChildIndex(t,this._children.length);else{0==e&&this._sortingChildCount++;var s=this._children.indexOf(t),h=this.getInsertPosForSortingChild(t);s<h?this._setChildIndex(t,s,h-1):this._setChildIndex(t,s,h)}}constructFromResource(){this.constructFromResource2(null,0)}constructFromResource2(e,i){var s,h,r,a,n,o,l,_,d=this.packageItem.getBranch();d.decoded||(d.decoded=!0,os.translateComponent(d));var c=d.rawData;c.seek(0,0),this._underConstruct=!0,this.sourceWidth=c.readInt(),this.sourceHeight=c.readInt(),this.initWidth=this.sourceWidth,this.initHeight=this.sourceHeight,this.setSize(this.sourceWidth,this.sourceHeight),c.readBool()&&(this.minWidth=c.readInt(),this.maxWidth=c.readInt(),this.minHeight=c.readInt(),this.maxHeight=c.readInt()),c.readBool()&&(n=c.readFloat(),o=c.readFloat(),this.setPivot(n,o,c.readBool())),c.readBool()&&(this._margin.top=c.readInt(),this._margin.bottom=c.readInt(),this._margin.left=c.readInt(),this._margin.right=c.readInt());var u=c.readByte();if(u==t.OverflowType.Scroll){var g=c.pos;c.seek(0,7),this.setupScroll(c),c.pos=g}else this.setupOverflow(u);c.readBool()&&c.skip(8),this._buildingDisplayList=!0,c.seek(0,1);var p,f=c.readShort();for(s=0;s<f;s++){a=c.readShort(),a+=c.pos;var m=new Yi;this._controllers.push(m),m.parent=this,m.setup(c),c.pos=a}c.seek(0,2);var y=c.readShort();for(s=0;s<y;s++){if(h=c.readShort(),r=c.pos,e)p=e[i+s];else{c.seek(r,0);var w,x,v=c.readByte(),b=c.readS(),C=c.readS();if(b)w=(x=C?Fi.getById(C):d.owner)?x.getItemById(b):null;else w=null;w?(p=Wi.UIObjectFactory.newObject(w)).constructFromResource():p=Wi.UIObjectFactory.newObject(v)}p._underConstruct=!0,p.setup_beforeAdd(c,r),p.parent=this,this._children.push(p),c.pos=r+h}for(c.seek(0,3),this.relations.setup(c,!0),c.seek(0,2),c.skip(2),s=0;s<y;s++)a=c.readShort(),a+=c.pos,c.seek(c.pos,3),this._children[s].relations.setup(c,!1),c.pos=a;for(c.seek(0,2),c.skip(2),s=0;s<y;s++)a=c.readShort(),a+=c.pos,(p=this._children[s]).setup_afterAdd(c,c.pos),p._underConstruct=!1,c.pos=a;c.seek(0,4),c.skip(2),this.opaque=c.readBool(),-1!=c.readShort()&&c.readBool();var S=c.readS();l=c.readInt(),_=c.readInt(),S?(w=d.owner.getItemById(S))&&w.pixelHitTestData&&(this._displayObject.hitArea=new ci(w.pixelHitTestData,l,_,this.sourceWidth,this.sourceHeight)):0!=l&&-1!=_&&(this._displayObject.hitArea=new cs(this.getChildAt(_).displayObject)),c.seek(0,5);var T=c.readShort();for(s=0;s<T;s++){a=c.readShort(),a+=c.pos;var I=new hs(this);I.setup(c),this._transitions.push(I),c.pos=a}this._transitions.length>0&&(this.on("added_to_stage",()=>{this._transitions.forEach(t=>t.onOwnerAddedToStage())}),this.on("removed_from_stage",()=>{this._transitions.forEach(t=>t.onOwnerRemovedFromStage())})),this.applyAllControllers(),this._buildingDisplayList=!1,this._underConstruct=!1,this.buildNativeDisplayList(),this.setBoundsChangedFlag(),d.objectType!=t.ObjectType.Component&&this.constructExtension(c),this.onConstruct()}constructExtension(t){}onConstruct(){}setup_afterAdd(t,e){super.setup_afterAdd(t,e),t.seek(e,4);var i,s,h=t.readShort();for(-1!=h&&this._scrollPane&&(this._scrollPane.pageController=this._parent.getControllerAt(h)),i=t.readShort(),s=0;s<i;s++){var r=this.getController(t.readS()),a=t.readS();r&&(r.selectedPageId=a)}if(t.version>=2)for(i=t.readShort(),s=0;s<i;s++){var n=t.readS(),o=t.readShort(),l=t.readS(),_=this.getChildByPath(n);_&&_.setProp(o,l)}}}class gs extends us{constructor(){super(),this._requestingCmd=0,this._uiSources=[],this.bringToFontOnClick=Qt.bringWindowToFrontOnClick,this.on("added_to_stage",this.__onShown,this),this.on("removed_from_stage",this.__onHidden,this),this.on("touch_begin",this.__winTouchBegin,this)}addUISource(t){this._uiSources.push(t)}set contentPane(e){this._contentPane!=e&&(this._contentPane&&this.removeChild(this._contentPane),this._contentPane=e,this._contentPane&&(this.addChild(this._contentPane),this.setSize(this._contentPane.width,this._contentPane.height),this._contentPane.addRelation(this,t.RelationType.Size),this._frame=this._contentPane.getChild("frame"),this._frame&&(this.closeButton=this._frame.getChild("closeButton"),this.dragArea=this._frame.getChild("dragArea"),this.contentArea=this._frame.getChild("contentArea"))))}get contentPane(){return this._contentPane}get frame(){return this._frame}get closeButton(){return this._closeButton}set closeButton(t){this._closeButton&&this._closeButton.offClick(this.closeEventHandler,this),this._closeButton=t,this._closeButton&&this._closeButton.onClick(this.closeEventHandler,this)}get dragArea(){return this._dragArea}set dragArea(t){this._dragArea!=t&&(this._dragArea&&(this._dragArea.draggable=!1,this._dragArea.off("drag_start",this.__dragStart,this)),this._dragArea=t,this._dragArea&&(this._dragArea instanceof We&&this._dragArea.shape.drawRect(0,new Xt(0,0),new Xt(0,0)),this._dragArea.draggable=!0,this._dragArea.on("drag_start",this.__dragStart,this)))}get contentArea(){return this._contentArea}set contentArea(t){this._contentArea=t}show(){ps.inst.showWindow(this)}showOn(t){t.showWindow(this)}hide(){this.isShowing&&this.doHideAnimation()}hideImmediately(){ps.findFor(this.parent).hideWindowImmediately(this)}centerOn(e,i){this.setPosition(Math.round((e.width-this.width)/2),Math.round((e.height-this.height)/2)),i&&(this.addRelation(e,t.RelationType.Center_Center),this.addRelation(e,t.RelationType.Middle_Middle))}toggleStatus(){this.isTop?this.hide():this.show()}get isShowing(){return null!=this.parent}get isTop(){return this.parent&&this.parent.getChildIndex(this)==this.parent.numChildren-1}get modal(){return this._modal}set modal(t){this._modal=t}bringToFront(){ps.findFor(this).bringToFront(this)}showModalWait(t){null!=t&&(this._requestingCmd=t),Qt.windowModalWaiting&&(this._modalWaitPane||(this._modalWaitPane=Fi.createObjectFromURL(Qt.windowModalWaiting)),this.layoutModalWaitPane(),this.addChild(this._modalWaitPane))}layoutModalWaitPane(){if(this._contentArea){var t=this._frame.localToGlobal();t=this.globalToLocal(t.x,t.y,t),this._modalWaitPane.setPosition(t.x+this._contentArea.x,t.y+this._contentArea.y),this._modalWaitPane.setSize(this._contentArea.width,this._contentArea.height)}else this._modalWaitPane.setSize(this.width,this.height)}closeModalWait(t){return(null==t||this._requestingCmd==t)&&(this._requestingCmd=0,this.modalWaiting&&this.removeChild(this._modalWaitPane),!0)}get modalWaiting(){return null!=this._modalWaitPane&&null!=this._modalWaitPane.parent}init(){if(!this._inited&&!this._loading)if(this._uiSources.length>0){this._loading=!1;for(var t=this._uiSources.length,e=0;e<t;e++){var i=this._uiSources[e];i.loaded||(i.load(this.__uiLoadComplete,this),this._loading=!0)}this._loading||this._init()}else this._init()}onInit(){}onShown(){}onHide(){}doShowAnimation(){this.onShown()}doHideAnimation(){this.hideImmediately()}__uiLoadComplete(){for(var t=this._uiSources.length,e=0;e<t;e++){if(!this._uiSources[e].loaded)return}this._loading=!1,this._init()}_init(){this._inited=!0,this.onInit(),this.isShowing&&this.doShowAnimation()}dispose(){this.parent&&this.hideImmediately(),super.dispose()}closeEventHandler(){this.hide()}__onShown(){this._inited?this.doShowAnimation():this.init()}__onHidden(){this.closeModalWait(),this.onHide()}__winTouchBegin(){this.isShowing&&this.bringToFontOnClick&&this.bringToFront()}__dragStart(t){t.preventDefault(),this.startDrag()}}class ps extends us{constructor(){super(),ls||(ls=this),this.opaque=!1,this._popupStack=[],this._justClosedPopups=[],this.on("touch_begin",this.__stageTouchBegin,this,!0),this._modalLayer=new We,this._modalLayer.setSize(this.width,this.height),this._modalLayer.shape.drawRect(0,new Xt(0,0),Qt.modalLayerColor),this._modalLayer.addRelation(this,t.RelationType.Size),this.applyScaleFactor(),this.on("content_scale_factor_changed",this.applyScaleFactor,this)}static get inst(){return ls||(ls=new ps,j.scene.add(ls.displayObject.obj3D)),ls}static findFor(t){if(t instanceof ps)return t;if(!t)return ls;for(var e=t._parent;e;){if(e instanceof ps)return e;e=e.parent}return ls}applyScaleFactor(){this.setSize(Math.ceil(j.width/xi.scaleFactor),Math.ceil(j.height/xi.scaleFactor)),this.setScale(xi.scaleFactor,xi.scaleFactor)}showWindow(t){this.addChild(t),t.x>this.width?t.x=this.width-t.width:t.x+t.width<0&&(t.x=0),t.y>this.height?t.y=this.height-t.height:t.y+t.height<0&&(t.y=0),this.adjustModalLayer()}hideWindow(t){t.hide()}hideWindowImmediately(t){t.parent==this&&this.removeChild(t),this.adjustModalLayer()}bringToFront(t){var e,i=this.numChildren;for(e=this._modalLayer.parent&&!t.modal?this.getChildIndex(this._modalLayer)-1:i-1;e>=0;e--){var s=this.getChildAt(e);if(s==t)return;if(s instanceof gs)break}e>=0&&this.setChildIndex(t,e)}showModalWait(e){Qt.globalModalWaiting&&(null==this._modalWaitPane&&(this._modalWaitPane=Fi.createObjectFromURL(Qt.globalModalWaiting)),this._modalWaitPane.setSize(this.width,this.height),this._modalWaitPane.addRelation(this,t.RelationType.Size),this.addChild(this._modalWaitPane),this._modalWaitPane.text=e||"")}closeModalWait(){this._modalWaitPane&&this._modalWaitPane.parent&&this.removeChild(this._modalWaitPane)}closeAllExceptModals(){for(var t=this._children.slice(),e=t.length,i=0;i<e;i++){var s=t[i];s instanceof gs&&!s.modal&&s.hide()}}closeAllWindows(){for(var t=this._children.slice(),e=t.length,i=0;i<e;i++){var s=t[i];s instanceof gs&&s.hide()}}getTopWindow(){for(var t=this.numChildren-1;t>=0;t--){var e=this.getChildAt(t);if(e instanceof gs)return e}return null}get modalLayer(){return this._modalLayer}get hasModalWindow(){return null!=this._modalLayer.parent}get modalWaiting(){return this._modalWaitPane&&this._modalWaitPane.onStage}showPopup(e,i,s){if(this._popupStack.length>0){var h=this._popupStack.indexOf(e);if(-1!=h)for(var r=this._popupStack.length-1;r>=h;r--)this.removeChild(this._popupStack.pop())}if(this._popupStack.push(e),i)for(var a=i;a;){if(a.parent==this){e.sortingOrder<a.sortingOrder&&(e.sortingOrder=a.sortingOrder);break}a=a.parent}var n;this.addChild(e),this.adjustModalLayer();var o,l,_=0,d=0;if(i){n=i.localToRoot(0,0);let t=i.localToRoot(i.width,i.height);_=t.x-n.x,d=t.y-n.y}else n=j.getTouchPos(),n=this.globalToLocal(n.x,n.y);(o=n.x)+e.width>this.width&&(o=o+_-e.width),l=n.y+d,((void 0===s||s===t.PopupDirection.Auto)&&l+e.height>this.height||s===t.PopupDirection.Up)&&(l=n.y-e.height-1)<0&&(l=0,o+=_/2),e.setPosition(o,l)}togglePopup(t,e,i){-1==this._justClosedPopups.indexOf(t)&&this.showPopup(t,e,i)}hidePopup(t){if(t){var e=this._popupStack.indexOf(t);if(-1!=e)for(var i=this._popupStack.length-1;i>=e;i--)this.closePopup(this._popupStack.pop())}else{for(i=this._popupStack.length-1;i>=0;i--)this.closePopup(this._popupStack[i]);this._popupStack.length=0}}get hasAnyPopup(){return 0!=this._popupStack.length}closePopup(t){t.parent&&(t instanceof gs?t.hide():this.removeChild(t))}showTooltips(t){if(null==this._defaultTooltipWin){var e=Qt.tooltipsWin;if(!e)return void console.warn("UIConfig.tooltipsWin not defined");this._defaultTooltipWin=Fi.createObjectFromURL(e)}this._defaultTooltipWin.text=t,this.showTooltipsWin(this._defaultTooltipWin)}showTooltipsWin(t,e,i){this.hideTooltips(),this._tooltipWin=t,null!=e&&null!=i||(e=j.touchPos.x+10,i=j.touchPos.y+20);var s=this.globalToLocal(e,i);e=s.x,i=s.y,e+this._tooltipWin.width>this.width&&(e=e-this._tooltipWin.width-1)<0&&(e=10),i+this._tooltipWin.height>this.height&&(i=i-this._tooltipWin.height-1,e-this._tooltipWin.width-1>0&&(e=e-this._tooltipWin.width-1),i<0&&(i=10)),this._tooltipWin.x=e,this._tooltipWin.y=i,this.addChild(this._tooltipWin)}hideTooltips(){this._tooltipWin&&(this._tooltipWin.parent&&this.removeChild(this._tooltipWin),this._tooltipWin=null)}playOneShotSound(t,i){if(!j.audioListener)return;null==i&&(i=1);let s=Fi.getItemByURL(t);s&&s.audioBuffer&&(s.sound||(s.sound=new e.Audio(j.audioListener),s.sound.setBuffer(s.audioBuffer),s.sound.setLoop(!1)),s.sound.setVolume(i),s.sound.play())}adjustModalLayer(){var t=this.numChildren;this._modalWaitPane&&this._modalWaitPane.parent&&this.setChildIndex(this._modalWaitPane,t-1);for(var e=t-1;e>=0;e--){var i=this.getChildAt(e);if(i instanceof gs&&i.modal)return void(null==this._modalLayer.parent?this.addChildAt(this._modalLayer,e):this.setChildIndexBefore(this._modalLayer,e))}this._modalLayer.parent&&this.removeChild(this._modalLayer)}checkPopups(){if(this._justClosedPopups.length=0,this._popupStack.length>0){let t=j.touchTarget,e=!1;for(;t;){let i=qt.cast(t);if(i){let t=this._popupStack.indexOf(i);if(-1!=t){for(let e=this._popupStack.length-1;e>t;e--){let t=this._popupStack.length-1,e=this._popupStack[t];this.closePopup(e),this._justClosedPopups.push(e),this._popupStack.splice(t,1)}e=!0;break}}t=t.parent}if(!e)for(let t=this._popupStack.length-1;t>=0;t--){let e=this._popupStack[t];this.closePopup(e),this._justClosedPopups.push(e),this._popupStack.splice(t,1)}}}__stageTouchBegin(){this._tooltipWin&&this.hideTooltips(),this.checkPopups()}}se.GRoot=ps;class fs{constructor(){this.size=0,this.color=0,this.lineSpacing=0,this.letterSpacing=0,this.outline=0,this.outlineColor=0,this.shadowOffset=new e.Vector2,this.shadowColor=0}copy(t){this.size=t.size,this.font=t.font,this.color=t.color,this.lineSpacing=t.lineSpacing,this.letterSpacing=t.letterSpacing,this.bold=t.bold,this.underline=t.underline,this.italic=t.italic,this.strikethrough=t.strikethrough,this.align=t.align,this.outline=t.outline,this.outlineColor=t.outlineColor,this.shadowOffset.copy(t.shadowOffset),this.shadowColor=t.shadowColor}equalStyle(t){return this.size==t.size&&this.color==t.color&&this.bold==t.bold&&this.underline==t.underline&&this.italic==t.italic&&this.strikethrough==t.strikethrough&&this.align==t.align}}class ms{static decodeString(t){let e=t.length,i="",s=0,h=0;for(;;){if(h=t.indexOf("&",s),-1==h){i+=t.substr(s);break}i+=t.substr(s,h-s),s=h+1,h=s;let r=Math.min(e,h+10);for(;h<r&&";"!=t[h];h++);if(h<r&&h>s){let e=t.substr(s,h-s),r=0;if("#"==e[0])e.length>1?(r="x"==e[1]?parseInt(e.substr(2),16):parseInt(e.substr(1)),i+=String.fromCharCode(r),s=h+1):i+="&";else{switch(e){case"amp":r=38;break;case"apos":r=39;break;case"gt":r=62;break;case"lt":r=60;break;case"nbsp":r=32;break;case"quot":r=34}r>0?(i+=String.fromCharCode(r),s=h+1):i+="&"}}else i+="&"}return i}static encodeString(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")}static getString(t,e,i){if(null==t)return null==i?null:i;let s=t[e];return null!=s?""+s:null==i?null:i}static getInt(t,e,i){let s=this.getString(t,e);if(null==s||0==s.length)return null==i?0:i;if("%"==s[s.length-1]){let t=parseInt(s.substring(0,s.length-1));return Math.ceil(t/100*i)}return parseInt(s)}static getFloat(t,e,i){let s=this.getString(t,e);if(null==s||0==s.length)return null==i?0:i;let h=parseFloat(s);return isNaN(h)?null==i?0:i:h}static getBool(t,e,i){let s=this.getString(t,e);return null==s||0==s.length?null!=i&&i:"true"==s||"1"==s||"false"!=s&&"0"!=s&&(null!=i&&i)}static getColor(t,e,i){let s=this.getString(t,e);return null==s||0==s.length?null==i?0:i:oe(s)}}!function(t){t[t.Start=0]="Start",t[t.End=1]="End",t[t.Void=2]="Void",t[t.CDATA=3]="CDATA",t[t.Comment=4]="Comment",t[t.Instruction=5]="Instruction"}(_s||(_s={}));class ys{static begin(t,e){ys.source=t,ys.lowerCaseName=e,this.sourceLen=t.length,this.parsePos=0,this.lastTagEnd=0,this.tagPos=0,this.tagLength=0,this.tagName=null}static nextTag(){let t,e,i="";for(this.tagType=_s.Start,this.lastTagEnd=this.parsePos,this.attrParsed=!1,this.lastTagName=this.tagName;-1!=(t=this.source.indexOf("<",this.parsePos))&&(this.parsePos=t,t++,t!=this.sourceLen);){if(e=this.source[t],"!"==e){if(this.sourceLen>t+7&&"<![CDATA["==this.source.substr(t-1,9))return t=this.source.indexOf("]]>",t),this.tagType=_s.CDATA,this.tagName="",this.tagPos=this.parsePos,this.tagLength=-1==t?this.sourceLen-this.parsePos:t+3-this.parsePos,this.parsePos+=this.tagLength,!0;if(this.sourceLen>t+2&&"\x3c!--"==this.source.substr(t-1,4))return t=this.source.indexOf("--\x3e",t),this.tagType=_s.Comment,this.tagName="",this.tagPos=this.parsePos,this.tagLength=-1==t?this.sourceLen-this.parsePos:t+3-this.parsePos,this.parsePos+=this.tagLength,!0;t++,this.tagType=_s.Instruction}else"/"==e?(t++,this.tagType=_s.End):"?"==e&&(t++,this.tagType=_s.Instruction);for(;t<this.sourceLen&&(e=this.source[t],-1==" \t\n\r\v".indexOf(e)&&">"!=e&&"/"!=e);t++);if(t==this.sourceLen)break;i+=this.source.substr(this.parsePos+1,t-this.parsePos-1),i.length>0&&"/"==i[0]&&(i=i.substr(1));let s=!1,h=!1,r=-1;for(;t<this.sourceLen;t++)if(e=this.source[t],'"'==e?s||(h=!h):"'"==e&&(h||(s=!s)),">"==e){if(!s&&!h){r=-1;break}r=t}else if("<"==e)break;if(-1!=r&&(t=r),t==this.sourceLen)break;return"/"==this.source[t-1]&&(this.tagType=_s.Void),this.tagName=i,this.lowerCaseName&&(this.tagName=this.tagName.toLowerCase()),this.tagPos=this.parsePos,this.tagLength=t+1-this.parsePos,this.parsePos+=this.tagLength,!0}return this.tagPos=this.sourceLen,this.tagLength=0,this.tagName=null,!1}static getTagSource(){return this.source.substr(this.tagPos,this.tagLength)}static getRawText(t){if(this.lastTagEnd==this.tagPos)return"";if(t){let t=this.lastTagEnd;for(;t<this.tagPos;t++){let e=this.source[t];if(-1==" \t\n\r\v".indexOf(e))break}return t==this.tagPos?"":this.source.substr(t,this.tagPos-t).trim()}return this.source.substr(this.lastTagEnd,this.tagPos-this.lastTagEnd)}static getText(t){if(this.lastTagEnd==this.tagPos)return"";if(t){let t=this.lastTagEnd;for(;t<this.tagPos;t++){let e=this.source[t];if(-1==" \t\n\r\v".indexOf(e))break}return t==this.tagPos?"":ms.decodeString(this.source.substr(t,this.tagPos-t)).trimRight()}return ms.decodeString(this.source.substr(this.lastTagEnd,this.tagPos-this.lastTagEnd))}static getAttribute(t){if(!this.attrParsed){for(var e in this.attributes)delete this.attributes[e];this.parseAttributes(this.attributes),this.attrParsed=!0}return this.attributes[t]}static getAttributes(t){if(null==t&&(t={}),this.attrParsed)for(let e in this.attributes)t[e]=this.attributes[e];else this.parseAttributes(t);return t}static parseAttributes(t){let e,i=0,s=0,h=!1,r=0,a="",n=this.tagPos,o=this.tagPos+this.tagLength;if(n<o&&"<"==this.source[n])for(;n<o;n++){let t=this.source[n];if(-1!=" \t\n\r\v".indexOf(t)||">"==t||"/"==t)break}for(;n<o;n++){let l=this.source[n];if("="==l){i=-1,s=-1,r=0;for(let t=n+1;t<o;t++){let e=this.source[t];if(-1!=" \t\n\r\v".indexOf(e)){if(-1!=i&&0==r){s=t-1;break}}else if(">"==e){if(0==r){s=t-1;break}}else if('"'==e)if(-1!=i){if(1!=r){s=t-1;break}}else r=2,i=t+1;else if("'"==e)if(-1!=i){if(2!=r){s=t-1;break}}else r=1,i=t+1;else-1==i&&(i=t)}if(-1==i||-1==s)break;e=a,this.lowerCaseName&&(e=e.toLowerCase()),a="",t[e]=ms.decodeString(this.source.substr(i,s-i+1)),n=s+1}else-1==" \t\n\r\v".indexOf(l)?((h||"/"==l||">"==l)&&(a.length>0&&(e=a,this.lowerCaseName&&(e=e.toLowerCase()),t[e]="",a=""),h=!1),"/"!=l&&">"!=l&&(a+=l)):a.length>0&&(h=!0)}}}var ws;ys.attributes={},function(t){t[t.Text=0]="Text",t[t.Link=1]="Link",t[t.Image=2]="Image",t[t.Input=3]="Input",t[t.Select=4]="Select",t[t.Object=5]="Object",t[t.LinkEnd=6]="LinkEnd"}(ws||(ws={}));var xs=new b(class{constructor(){this.format=new fs,this.position=new e.Vector2}getAttr(t){return null==this._attributes?null:this._attributes[t]}setAttr(t,e){null==this._attributes&&(this._attributes={}),this._attributes[t]=e}getAttrString(t,e){return ms.getString(this._attributes,t,e)}getAttrInt(t,e){return ms.getInt(this._attributes,t,e)}getAttrFloat(t,e){return ms.getFloat(this._attributes,t,e)}getAttrBool(t,e){return ms.getBool(this._attributes,t,e)}getAttrColor(t,e){return ms.getColor(this._attributes,t,e)}fetchAttributes(){this._attributes=ys.getAttributes(this._attributes)}get isEntity(){return this.type==ws.Image||this.type==ws.Select||this.type==ws.Input||this.type==ws.Object}reset(){this.name=null,this.text=null,this.htmlObject=null,this.status=0,this._attributes=null}},(t,...e)=>{t.type=e[0],t.type!=ws.Text&&null==t._attributes&&(t._attributes={})},t=>t.reset());class vs{constructor(){this.linkUnderline=vs.defaultLinkUnderline,this.linkColor=vs.defaultLinkColor}}vs.defaultLinkUnderline=!0,vs.defaultLinkColor=3827660;var bs=new Array,Cs=new Array;var Ss=new class{constructor(){this._textFormatStack=new Array,this._format=new fs,this._defaultOptions=new vs}parse(t,e,i,s){null==s&&(s=this._defaultOptions),this._elements=i,this._textFormatStackTop=0,this._format.copy(e),this._format.colorChanged=!1;let h,r=0,a=s.ignoreWhiteSpace,n=!1;for(ys.begin(t,!0);ys.nextTag();)switch(0==r&&(h=ys.getText(a),h.length>0&&(n&&"\n"==h[0]&&(h=h.substr(1)),this.appendText(h))),n=!1,ys.tagName){case"b":ys.tagType==_s.Start?(this.pushTextFormat(),this._format.bold=!0):this.popTextFormat();break;case"i":ys.tagType==_s.Start?(this.pushTextFormat(),this._format.italic=!0):this.popTextFormat();break;case"u":ys.tagType==_s.Start?(this.pushTextFormat(),this._format.underline=!0):this.popTextFormat();break;case"strike":ys.tagType==_s.Start?(this.pushTextFormat(),this._format.strikethrough=!0):this.popTextFormat();break;case"font":if(ys.tagType==_s.Start){this.pushTextFormat(),this._format.size=ms.getInt(ys.attributes,"size",this._format.size);let t=ys.getAttribute("color");null!=t&&(this._format.color=oe(t))}else ys.tagType==_s.End&&this.popTextFormat();break;case"br":this.appendText("\n");break;case"img":if(ys.tagType==_s.Start||ys.tagType==_s.Void){let t=xs.borrow(ws.Image);t.fetchAttributes(),t.name=t.getAttrString("name"),t.format.align=this._format.align,this._elements.push(t)}break;case"a":if(ys.tagType==_s.Start){this.pushTextFormat(),this._format.underline=this._format.underline||s.linkUnderline,this._format.colorChanged||(this._format.color=s.linkColor);let t=xs.borrow(ws.Link);t.fetchAttributes(),t.name=t.getAttrString("name"),t.format.align=this._format.align,this._elements.push(t)}else if(ys.tagType==_s.End){this.popTextFormat();let t=xs.borrow(ws.LinkEnd);this._elements.push(t)}break;case"input":{let t=xs.borrow(ws.Input);t.fetchAttributes(),t.name=t.getAttrString("name"),t.format.copy(this._format),this._elements.push(t)}break;case"select":if(ys.tagType==_s.Start||ys.tagType==_s.Void){let t=xs.borrow(ws.Select);if(t.fetchAttributes(),ys.tagType==_s.Start){for(bs.length=0,Cs.length=0;ys.nextTag()&&"select"!=ys.tagName;)"option"==ys.tagName&&(ys.tagType==_s.Start||ys.tagType==_s.Void?Cs.push(ms.getString(ys.attributes,"value","")):bs.push(ys.getText()));t.setAttr("items",bs.slice()),t.setAttr("values",Cs.slice())}t.name=t.getAttrString("name"),t.format.copy(this._format),this._elements.push(t)}break;case"p":ys.tagType==_s.Start?(this.pushTextFormat(),this._format.align=ys.getAttribute("align"),this.isNewLine()||this.appendText("\n")):ys.tagType==_s.End&&(this.appendText("\n"),n=!0,this.popTextFormat());break;case"ui":case"div":case"li":ys.tagType==_s.Start?this.isNewLine()||this.appendText("\n"):(this.appendText("\n"),n=!0);break;case"html":case"body":a=!0;break;case"head":case"style":case"script":case"form":ys.tagType==_s.Start?r++:ys.tagType==_s.End&&r--}0==r&&(h=ys.getText(a),h.length>0&&(n&&"\n"==h[0]&&(h=h.substr(1)),this.appendText(h))),this._elements=null}pushTextFormat(){let t;this._textFormatStack.length<=this._textFormatStackTop?(t=new fs,this._textFormatStack.push(t)):t=this._textFormatStack[this._textFormatStackTop],t.copy(this._format),t.colorChanged=this._format.colorChanged,this._textFormatStackTop++}popTextFormat(){if(this._textFormatStackTop>0){let t=this._textFormatStack[this._textFormatStackTop-1];this._format.copy(t),this._format.colorChanged=t.colorChanged,this._textFormatStackTop--}}isNewLine(){if(this._elements.length>0){let t=this._elements[this._elements.length-1];return!(!t||t.type!=ws.Text)&&t.text.endsWith("\n")}return!0}appendText(t){let e;this._elements.length>0&&(e=this._elements[this._elements.length-1],e.type==ws.Text&&e.format.equalStyle(this._format))?e.text+=t:(e=xs.borrow(ws.Text),e.text=t,e.format.copy(this._format),this._elements.push(e))}};class Ts extends ft{constructor(){super(),this._touchDisabled=!0,this._graphics=new ye(this.obj3D),this._graphics.meshFactory=this,this._textFormat=new fs,this._fontSizeScale=1,this._wordWrap=!1,this._text="",this._parsedText="",this._elements=new Array,this._lines=new Array}get textFormat(){return this._textFormat}applyFormat(){let t=this._textFormat.font;t||(t=Qt.defaultFont);let e=Bi.getFont(t);this._font!=e&&(this._font=e,this._fontVersion=this._font.version,this._graphics.texture=this._font.mainTexture,this._graphics.setKeyword("TEXT",this._font.isDynamic)),this._text&&(this._textChanged=!0)}get align(){return this._textFormat.align}set align(t){this._textFormat.align!=t&&(this._textFormat.align=t,this._text&&(this._textChanged=!0))}get verticalAlign(){return this._verticalAlign}set verticalAlign(t){this._verticalAlign!=t&&(this._verticalAlign=t,this._textChanged||this.applyVertAlign())}get text(){return this._text}set text(t){(this._text!=t||this._html)&&(this._text=t,this._textChanged=!0,this._html=!1)}get htmlText(){return this._text}set htmlText(t){this._text==t&&this._html||(this._text=t,this._textChanged=!0,this._html=!0)}get parsedText(){return this._parsedText}get autoSize(){return this._autoSize}set autoSize(t){this._autoSize!=t&&(this._autoSize=t,this._textChanged=!0)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!=t&&(this._wordWrap=t,this._textChanged=!0)}get singleLine(){return this._singleLine}set singleLine(t){this._singleLine!=t&&(this._singleLine=t,this._textChanged=!0)}get textWidth(){return this._textChanged&&this.buildLines(),this._textWidth}get textHeight(){return this._textChanged&&this.buildLines(),this._textHeight}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!=t&&(this._maxWidth=t,this._textChanged=!0)}get htmlElements(){return this._textChanged&&this.buildLines(),this._elements}get lines(){return this._textChanged&&this.buildLines(),this._lines}get charPositions(){return this._textChanged&&this.buildLines(),this._graphics.updateMesh(),this._charPositions}redraw(){return this._font||this.applyFormat(),this._font.version!=this._fontVersion&&(this._fontVersion=this._font.version,this._graphics.texture=this._font.mainTexture,this._textChanged=!0),this._textChanged&&this.buildLines(),this._graphics.updateMesh()}getLinesShape(t,e,i,s,h,r){let a=this._lines[t],n=this._lines[i];if(t==i){let t=new P;t.setMinMax(e,a.y,s,a.y+a.height),h?r.push(t.intersection(this._contentRect)):r.push(t)}else if(t==i-1){let t=new P;t.setMinMax(e,a.y,Is+a.width,a.y+a.height),h?r.push(t.intersection(this._contentRect)):r.push(t),t=new P,t.setMinMax(Is,a.y+a.height,s,n.y+n.height),h?r.push(t.intersection(this._contentRect)):r.push(t)}else{let o=new P;o.setMinMax(e,a.y,Is+a.width,a.y+a.height),h?r.push(o.intersection(this._contentRect)):r.push(o);for(let e=t+1;e<i;e++){let t=this._lines[e];o=new P,o.setMinMax(Is,o.yMax,Is+t.width,t.y+t.height),h?r.push(o.intersection(this._contentRect)):r.push(o)}o=new P,o.setMinMax(Is,o.yMax,s,n.y+n.height),h?r.push(o.intersection(this._contentRect)):r.push(o)}}onSizeChanged(){this._updatingSize||(this._autoSize==t.AutoSizeType.Shrink||this._wordWrap?this._textChanged=!0:this._autoSize!=t.AutoSizeType.None&&this._graphics.setMeshDirty(),"top"!=this._verticalAlign&&this.applyVertAlign()),super.onSizeChanged()}ensureSizeCorrect(){this._textChanged&&this._autoSize!=t.AutoSizeType.None&&this.buildLines()}update(t,e){this.redraw(),super.update(t,e)}requestText(){if(this._html){let t=this._elements.length;for(let e=0;e<t;e++){let t=this._elements[e];t.type==ws.Text&&(this._font.setFormat(t.format,this._fontSizeScale),this._font.prepareCharacters(t.text))}}else this._font.setFormat(this._textFormat,this._fontSizeScale),this._font.prepareCharacters(this._parsedText)}buildLines(){if(this._font||this.applyFormat(),this._textChanged=!1,this._graphics.setMeshDirty(),this._fontSizeScale=1,this.cleanup(),0==this._text.length){let t=Os.borrow();t.width=0,t.height=this._font.getLineHeight(this._textFormat.size),t.charIndex=t.charCount=0,t.y=t.y2=Ps,this._lines.push(t),this._textWidth=this._textHeight=0}else this.parseText(),this.buildLines2(),this._autoSize==t.AutoSizeType.Shrink&&this.doShrink();if(this._autoSize==t.AutoSizeType.Both){if(this._updatingSize=!0,this.isInput){let t=Math.max(this._textFormat.size,this._textWidth),e=Math.max(this._font.getLineHeight(this._textFormat.size)+2*Ps,this._textHeight);this.setSize(t,e)}else this.setSize(this._textWidth,this._textHeight);this._updatingSize=!1}else this._autoSize==t.AutoSizeType.Height&&(this._updatingSize=!0,this.isInput?this.height=Math.max(this._font.getLineHeight(this._textFormat.size)+2*Ps,this._textHeight):this.height=this._textHeight,this._updatingSize=!1);this._yOffset=0,this.applyVertAlign()}parseText(){this._html?(Ss.parse(this._text,this._textFormat,this._elements,this.isRich?this.htmlParseOptions:null),this._parsedText=""):this._parsedText=this._text;let t=this._elements.length;if(0==t)this.isInput&&(this._parsedText=this._parsedText.replace(/\r\n/g,"\n").replace(/\r/g,"\n"));else{let e=0;for(;e<t;){let t=this._elements[e];t.charIndex=this._parsedText.length,t.type==ws.Text?this.isInput?this._parsedText+=t.text.replace(/\r\n/g,"\n").replace(/\r/g,"\n"):this._parsedText+=t.text:t.isEntity&&(this._parsedText+=" "),e++}}}buildLines2(){let t=this._textFormat.letterSpacing*this._fontSizeScale,e=(this._textFormat.lineSpacing-1)*this._fontSizeScale,i=this._contentRect.width-2*Is,s=0,h=!1,r=0,a=this._textFormat;this._font.setFormat(a,this._fontSizeScale);let n=this._wordWrap&&!this._singleLine;this._maxWidth>0&&(n=!0,i=this._maxWidth-2*Is),this._textWidth=this._textHeight=0,this.requestText();let o=this._elements.length,l=0,_=null;o>0&&(_=this._elements[l]);let d=this._parsedText.length,c=Os.borrow();this._lines.push(c),c.y=c.y2=Ps;let u=Ms;u.length=0;let g={width:0,height:0,baseline:0};for(let p=0;p<d;p++){let d=this._parsedText[p];for(g.width=g.height=g.baseline=0;_&&_.charIndex==p;){if(_.type==ws.Text)a=_.format,this._font.setFormat(a,this._fontSizeScale);else{let t=_.htmlObject;this.isRich&&!t&&(_.space=i-c.width-4,t=this.htmlPageContext.createObject(this,_),_.htmlObject=t),t&&(g.width=t.width+2,g.height=t.height,g.baseline=g.height*ks),_.isEntity&&(d="")}l++,_=l<o?this._elements[l]:null}if(0==d.length||"\n"==d?h=!1:this._font.getGlyph("\t"==d?" ":d,g)?("\t"==d&&(g.width*=4),h?-1!=" \t\n\r\v".indexOf(d)?s=0:d>="a"&&d<="z"||d>="A"&&d<="Z"||d>="0"&&d<="9"||"."==d||'"'==d||"'"==d?s++:h=!1:-1!=" \t\n\r\v".indexOf(d)?(s=0,h=!0):h=!1):h=!1,u.push(g.width,g.height,g.baseline),0!=g.width&&(0!=r&&(r+=t),r+=g.width),"\n"!=d||this._singleLine){if(n&&r>i){let i,a=u.length/3;i=h&&s<20&&a>2?s:1!=a?1:0,this.updateLineInfo(c,t,a-i);let n=Os.borrow();if(this._lines.push(n),n.y=c.y+(c.height+e),n.y<Ps&&(n.y=Ps),n.y2=n.y,n.charIndex=c.charIndex+c.charCount,r=0,0!=i){for(let e=c.charCount;e<a;e++)0!=r&&(r+=t),r+=u[3*e];for(let t=0;t<3*c.charCount;t++)u.shift()}else u.length=0;h=!1,c=n}}else{this.updateLineInfo(c,t,u.length/3);let i=Os.borrow();this._lines.push(i),i.y=c.y+(c.height+e),i.y<Ps&&(i.y=Ps),i.y2=i.y,i.charIndex=c.charIndex+c.charCount,u.length=0,h=!1,r=0,c=i}}this.updateLineInfo(c,t,u.length/3),this._textWidth>0&&(this._textWidth+=2*Is),this._textHeight=c.y+c.height+Ps,this._textWidth=Math.round(this._textWidth),this._textHeight=Math.round(this._textHeight)}updateLineInfo(t,e,i){let s=Ms;for(let h=0;h<3*i;h+=3){let i=s[h],r=s[h+1],a=s[h+2];a>t.baseline&&(t.height+=a-t.baseline,t.baseline=a),r-a>t.height-t.baseline&&(t.height+=r-a-(t.height-t.baseline)),i>0&&(0!=t.width&&(t.width+=e),t.width+=i)}0==t.height&&(1==this._lines.length?t.height=this._textFormat.size:t.height=this._lines[this._lines.length-2].height),t.width>this._textWidth&&(this._textWidth=t.width),t.charCount=i}doShrink(){if(this._lines.length>1&&this._textHeight>this._contentRect.height){let t=0,e=this._textFormat.size;this._fontSizeScale=Math.sqrt(this._contentRect.height/this._textHeight);let i=Math.floor(this._fontSizeScale*this._textFormat.size);for(;Os.returns(this._lines),this.buildLines2(),this._textWidth>this._contentRect.width||this._textHeight>this._contentRect.height?e=i:t=i,e-t>1||e!=t&&i==e;)i=t+(e-t)/2,this._fontSizeScale=i/this._textFormat.size}else if(this._textWidth>this._contentRect.width&&(this._fontSizeScale=this._contentRect.width/this._textWidth,Os.returns(this._lines),this.buildLines2(),this._textWidth>this._contentRect.width)){let t=Math.floor(this._textFormat.size*this._fontSizeScale);t--,this._fontSizeScale=t/this._textFormat.size,Os.returns(this._lines),this.buildLines2()}}onPopulateMesh(i){if(0==this._textWidth&&1==this._lines.length)return this._charPositions&&(zs.returns(this._charPositions),this._charPositions.push(zs.borrow())),void this.refreshObjects();let s=this._textFormat.letterSpacing*this._fontSizeScale,h=this._textFormat;this._font.setFormat(h,this._fontSizeScale);let r=this._contentRect.width>0?this._contentRect.width-2*Is:0,a=this._contentRect.height>0?Math.max(this._contentRect.height,this._font.getLineHeight(h.size)):0;this._charPositions&&zs.returns(this._charPositions);let n,o,l,_,d,c,u,g,p=null,f=0,m=0,y=0,w=!this.isInput&&this._autoSize==t.AutoSizeType.None,x=0,v=this._elements.length,b=null;v>0&&(b=this._elements[x]);let C={width:0,height:0,baseline:0},S=this._lines.length;for(let t=0;t<S;++t){let S=this._lines[t];if(0==S.charCount)continue;o=w&&0!=t&&S.y+S.height>a,l=h.align,l=b&&b.charIndex==S.charIndex?b.format.align:h.align,n="center"==l?Math.floor((r-S.width)/2):"right"==l?r-S.width:0,n<0&&(n=0),y=Is+n;let T=S.charCount;d=y,c=y,u=g=h.size;for(let a=0;a<T;a++){let l=S.charIndex+a,T=this._parsedText[l];for(;b&&l==b.charIndex;){if(b.type==ws.Text){if(_=0,h.underline!=b.format.underline)if(h.underline){if(!o){let t=d-(w?le(y,Is,Is+r):y);t>0&&(_+=this._font.drawLine(d<y?d:y,-(S.y+S.baseline),t,g,0,i))}g=0}else d=y;if(h.strikethrough!=b.format.strikethrough)if(h.strikethrough){if(!o){let t=c-(w?le(y,Is,Is+r):y);t>0&&(_+=this._font.drawLine(c<y?c:y,-(S.y+S.baseline),t,u,1,i))}u=Number.POSITIVE_INFINITY}else c=y;if(_>0&&this._charPositions){let t=this._charPositions[this._charPositions.length-1];t.vertCount+=_,this._charPositions[this._charPositions.length-1]=t}h=b.format,u=Math.min(u,h.size),g=Math.max(g,h.size),this._font.setFormat(h,this._fontSizeScale)}else if(b.type==ws.Link)p=b.htmlObject,p&&(b.position.set(0,0),p.setPosition(0,0),f=y,m=t);else if(b.type==ws.LinkEnd)p&&(p.setArea(m,f,t,y),p=null);else{let i=b.htmlObject;if(i){if(this._charPositions){let e=zs.borrow();e.lineIndex=t,e.charIndex=this._charPositions.length,e.imgIndex=x+1,e.offsetX=y,e.width=i.width,this._charPositions.push(e)}o||w&&(y<Is||y>Is&&y+i.width>this._contentRect.width-Is)?b.status|=1:b.status&=254,b.position=new e.Vector2(y+1,S.y+S.baseline-i.height*ks),i.setPosition(b.position.x,b.position.y),y+=i.width+s+2}}b.isEntity&&(T="\0"),x++,b=x<v?this._elements[x]:null}if("\0"!=T)if(this._font.getGlyph("\t"==T?" ":T,C)){if("\t"==T&&(C.width*=4),o||w&&(r<7||y!=Is+n)&&y+C.width>this._contentRect.width-Is+.5){y+=s+C.width;continue}if(_=this._font.drawGlyph(y,-(S.y+S.baseline),i),this._charPositions){let e=zs.borrow();e.lineIndex=t,e.charIndex=this._charPositions.length,e.vertCount=_,e.offsetX=y,e.width=C.width,this._charPositions.push(e)}y+=s+C.width}else{if(this._charPositions){let e=zs.borrow();e.lineIndex=t,e.charIndex=this._charPositions.length,e.offsetX=y,this._charPositions.push(e)}y+=s}}if(!o){if(_=0,h.underline){let t=d-(w?le(y,Is,Is+r):y);t>0&&(_+=this._font.drawLine(d<y?d:y,-(S.y+S.baseline),t,g,0,i))}if(h.strikethrough){let t=c-(w?le(y,Is,Is+r):y);t>0&&(_+=this._font.drawLine(c<y?c:y,-(S.y+S.baseline),t,u,1,i))}if(_>0&&this._charPositions){this._charPositions[this._charPositions.length-1].vertCount+=_}}}if(b&&b.type==ws.LinkEnd&&p&&p.setArea(m,f,S-1,y),this._charPositions){let t=zs.borrow();t.lineIndex=S-1,t.charIndex=this._charPositions.length,t.offsetX=y,this._charPositions.push(t)}this.refreshObjects()}cleanup(){this.cleanupObjects(),xs.returns(this._elements),Os.returns(this._lines),this._textWidth=0,this._textHeight=0,this._parsedText="",this._charPositions&&zs.returns(this._charPositions)}applyVertAlign(){let e=this._yOffset;if(this._autoSize==t.AutoSizeType.Both||this._autoSize==t.AutoSizeType.Height||"top"==this._verticalAlign)this._yOffset=0;else{let t;t=0==this._textHeight&&this._lines.length>0?this._contentRect.height-this._lines[0].height:this._contentRect.height-this._textHeight,t<0&&(t=0),"middle"==this._verticalAlign?this._yOffset=Math.floor(t/2):this._yOffset=t}if(e!=this._yOffset){let t=this._lines.length;for(let e=0;e<t;e++)this._lines[e].y=this._lines[e].y2+this._yOffset;this._graphics.setMeshDirty()}}refreshObjects(){}cleanupObjects(){}}const Is=2,Ps=2,ks=.8;var Ms=new Array;var Os=new b(class{},t=>{t.width=t.height=t.baseline=t.y=t.y2=t.charIndex=t.charCount=0});var zs=new b(class{});class Ls{constructor(){this._readPos=0,this.defaultImgWidth=0,this.defaultImgHeight=0,this._handlers={},this._handlers.url=this.onTag_URL,this._handlers.img=this.onTag_IMG,this._handlers.b=this.onTag_B,this._handlers.i=this.onTag_I,this._handlers.u=this.onTag_U,this._handlers.sup=this.onTag_Simple,this._handlers.sub=this.onTag_Simple,this._handlers.color=this.onTag_COLOR,this._handlers.font=this.onTag_FONT,this._handlers.size=this.onTag_SIZE}onTag_URL(t,e,i){return e?"</a>":null!=i?'<a href="'+i+'">':'<a href="'+this.getTagText()+'">'}onTag_IMG(t,e,i){if(e)return null;var s=this.getTagText(!0);return s?this.defaultImgWidth?'<img src="'+s+'" width="'+this.defaultImgWidth+'" height="'+this.defaultImgHeight+'"/>':'<img src="'+s+'"/>':null}onTag_B(t,e,i){return e?"</b>":"<b>"}onTag_I(t,e,i){return e?"</i>":"<i>"}onTag_U(t,e,i){return e?"</u>":"<u>"}onTag_Simple(t,e,i){return e?"</"+t+">":"<"+t+">"}onTag_COLOR(t,e,i){return e?"</font>":(this.lastColor=i,'<font color="'+i+'">')}onTag_FONT(t,e,i){return e?"</font>":'<font face="'+i+'">'}onTag_SIZE(t,e,i){return e?"</font>":(this.lastSize=i,'<font size="'+i+'">')}getTagText(t){for(var e,i=this._readPos,s="";-1!=(e=this._text.indexOf("[",i));){if(92!=this._text.charCodeAt(e-1)){s+=this._text.substring(i,e);break}s+=this._text.substring(i,e-1),s+="[",i=e+1}return-1==e?null:(t&&(this._readPos=e),s)}parse(t,e){this._text=t,this.lastColor=null,this.lastSize=null;for(var i,s,h,r,a,n,o,l=0,_="";-1!=(i=this._text.indexOf("[",l));)if(i>0&&92==this._text.charCodeAt(i-1))_+=this._text.substring(l,i-1),_+="[",l=i+1;else{if(_+=this._text.substring(l,i),l=i,-1==(i=this._text.indexOf("]",l)))break;h="/"==this._text.charAt(l+1),r=this._text.substring(h?l+2:l+1,i),this._readPos=i+1,a=null,n=null,-1!=(s=r.indexOf("="))&&(a=r.substring(s+1),r=r.substring(0,s)),r=r.toLowerCase(),null!=(o=this._handlers[r])?e||null!=(n=o.call(this,r,h,a))&&(_+=n):_+=this._text.substring(l,this._readPos),l=this._readPos}return l<this._text.length&&(_+=this._text.substr(l)),this._text=null,_}}var Bs=new Ls;class Fs extends Ts{constructor(){super(),this._touchDisabled=!1,this.opaque=!0,this.isInput=!0,this._text2="",this.maxLength=0,this.editable=!0,this._borderColor=new Xt,this._backgroundColor=new Xt(16777215,0),this.on("focus_in",this.__focusIn,this,!0),this.on("focus_out",this.__focusOut,this,!0),this.on("removed_from_stage",this.__removed,this)}get text(){return this._editing&&(this._text2=this._element.value),this._text2}set text(t){this._text2=t,this.updateText()}get promptText(){return this._promptText}set promptText(t){this._promptText=t,this._decodedPromptText=Bs.parse(t),this.updateText()}get password(){return this._password}set password(t){this._password=t}updateText(){this._editing?this._element.value=this._text2:0==this._text2.length&&this._promptText?super.htmlText=this._decodedPromptText:this._password?super.text="*".repeat(this._text2.length):super.text=this._text2}onSizeChanged(){super.onSizeChanged(),this._clipRect||(this._clipRect=new P),this._clipRect.copy(this._contentRect),this._clipRect.x+=Is,this._clipRect.y+=Ps,this._clipRect.width-=2*Is,this._clipRect.height-=2*Ps}applyFormat(){super.applyFormat(),this._element&&this.setFormat()}createElement(){let t;this.singleLine?t=this._element=document.createElement("input"):(t=this._element=document.createElement("textarea"),t.style.resize="none",t.style.overflow="scroll"),t.id="InputText",t.style.outline="none",t.style.borderWidth="0px",t.style.padding="0px",t.style.margin="0px",t.style.position="absolute",t.style.display="none",t.style.background="transparent",t.style.transformOrigin=t.style.WebkitTransformOrigin="0 0 0",j.domElement.parentNode.appendChild(t),t.onblur=()=>{j.setFocus(null)},this.setFormat()}setFormat(){let t=this._element;t.style.font=this._textFormat.size+"px "+this._font.name,t.style.color=ne(this._textFormat.color),t.style.webkitTextStroke=this._textFormat.outline+"px "+ne(this._textFormat.outlineColor),t.style.textAlign=this._textFormat.align}dispose(){super.dispose(),this._element&&(this._element.style.display="none",this._element.parentNode&&this._element.parentNode.removeChild(this._element),this._element=null)}__focusIn(){if(!this.editable||this._editing)return;this._font||this.applyFormat(),this._element||this.createElement();let t=this._element;t.style.display="inline-block",this.locateInputElement(),t.value=this._text2,t.focus(),this._editing=!0,this._graphics.material.visible=!1,this.dispatchEvent("focus_in")}locateInputElement(){this.localToGlobal(0,0,js),this.localToGlobal(1,1,Rs),Rs.sub(js),As.getInverse(j.canvasTransform),Ds.set(js.x,js.y,0),Ds.applyMatrix4(As),js.set(Ds.x,Ds.y);let t=0;As.elements[1]>0?t=90:As.elements[1]<0&&(t=-90);let e=this._element.style;e.width=this.width.toFixed(2)+"px",e.height=this.height.toFixed(2)+"px",e.left=js.x+2+"px",e.top=js.y+"px",e.transform=e.webkitTransform="scale("+Rs.x.toFixed(3)+","+Rs.y.toFixed(3)+") rotate("+t+"deg)"}__focusOut(){this._editing&&(this._element.style.display="none",this._element.blur(),this._text2=this._element.value,this._editing=!1,this.updateText(),this._graphics.material.visible=!0,this.stage&&this.dispatchEvent("focus_out"))}__removed(){this._editing&&j.setFocus(null)}}var js=new e.Vector2,Rs=new e.Vector2,As=new e.Matrix4,Ds=new e.Vector3;class Vs extends qt{constructor(){super();let e=this._textField.textFormat;e.font=Qt.defaultFont,e.size=12,e.lineSpacing=3,this._textField.applyFormat(),this._text="",this._textField.autoSize=t.AutoSizeType.Both,this._textField.wordWrap=!1}createDisplayObject(){this._displayObject=this._textField=new Ts}get text(){return this._displayObject instanceof Fs&&(this._text=this._textField.text),this._text}set text(t){null==t&&(t=""),this._text=t,this.setText(),this.updateSize(),this.updateGear(6)}setText(){let t=this._text;this._template&&(t=this.parseTemplate(t)),this._textField.maxWidth=this.maxWidth,this._ubbEnabled?this._textField.htmlText=Bs.parse(ms.encodeString(t)):this._textField.text=t}get textTemplate(){return this._template}set textTemplate(t){(this._template||t)&&(this._template=t,this.flushVars())}setVar(t,e){return this._template||(this._template={}),this._template[t]=e,this}flushVars(){this.setText(),this.updateSize()}get textFormat(){return this._textField.textFormat}applyFormat(){this._textField.applyFormat(),this._underConstruct||this.updateSize()}get align(){return this._textField.align}set align(t){this._textField.align=t}get verticalAlign(){return this._textField.verticalAlign}set verticalAlign(t){this._textField.verticalAlign=t}get singleLine(){return this._textField.singleLine}set singleLine(t){this._textField.singleLine=t}set ubbEnabled(t){this._ubbEnabled=t}get ubbEnabled(){return this._ubbEnabled}get autoSize(){return this._textField.autoSize}set autoSize(e){this._textField.autoSize=e,e==t.AutoSizeType.Both?(this._textField.wordWrap=!1,this._underConstruct||this.setSize(this._textField.textWidth,this._textField.textHeight)):(this._textField.wordWrap=!0,e==t.AutoSizeType.Height?this._underConstruct||(this._textField.width=this.width,this.height=this._textField.textHeight):this._textField.setSize(this.width,this.height))}get textWidth(){return this._textField.textWidth}get textHeight(){return this._textField.textHeight}get color(){return this._textField.textFormat.color}set color(t){this._textField.textFormat.color!=t&&(this._textField.textFormat.color=t,this._textField.applyFormat(),this.updateGear(4))}getProp(e){switch(e){case t.ObjectPropID.Color:return this.color;case t.ObjectPropID.OutlineColor:return this._textField.textFormat.outlineColor;case t.ObjectPropID.FontSize:return this._textField.textFormat.size;default:return super.getProp(e)}}setProp(e,i){switch(e){case t.ObjectPropID.Color:this.color=i;break;case t.ObjectPropID.OutlineColor:this._textField.textFormat.outlineColor=i,this._textField.applyFormat();break;case t.ObjectPropID.FontSize:this._textField.textFormat.size=i,this._textField.applyFormat();break;default:super.setProp(e,i)}}updateSize(){this._updatingSize||(this._updatingSize=!0,this._textField.autoSize==t.AutoSizeType.Both?this.setSize(this._textField.width,this._textField.height):this._textField.autoSize==t.AutoSizeType.Height&&(this.height=this._textField.height),this._updatingSize=!1)}handleSizeChanged(){this._updatingSize||(this._underConstruct?this._textField.setSize(this.width,this.height):this._textField.autoSize!=t.AutoSizeType.Both&&(this._textField.autoSize==t.AutoSizeType.Height?(this._textField.width=this.width,""!=this._text&&this.setSizeDirectly(this.width,this._textField.height)):this._textField.setSize(this.width,this.height)))}setup_beforeAdd(t,e){super.setup_beforeAdd(t,e),t.seek(e,5);let i=this._textField.textFormat;i.font=t.readS(),i.size=t.readShort(),i.color=t.readColor();let s=t.readByte();if(this.align=0==s?"left":1==s?"center":"right",s=t.readByte(),this.verticalAlign=0==s?"top":1==s?"middle":"bottom",i.lineSpacing=t.readShort(),i.letterSpacing=t.readShort(),this.ubbEnabled=t.readBool(),this.autoSize=t.readByte(),i.underline=t.readBool(),i.italic=t.readBool(),i.bold=t.readBool(),this.singleLine=t.readBool(),t.readBool()&&(i.outlineColor=t.readColor(),i.outline=t.readFloat()+1),t.readBool()){i.shadowColor=t.readColor();let e=t.readFloat(),s=t.readFloat();i.shadowOffset.set(e,s)}t.readBool()&&(this._template={}),t.version>=3&&(i.strikethrough=t.readBool()),this._textField.applyFormat()}setup_afterAdd(t,e){super.setup_afterAdd(t,e),t.seek(e,6);var i=t.readS();null!=i&&(this.text=i)}parseTemplate(t){for(var e,i,s,h,r=0,a="";-1!=(e=t.indexOf("{",r));)if(e>0&&92==t.charCodeAt(e-1))a+=t.substring(r,e-1),a+="{",r=e+1;else{if(a+=t.substring(r,e),r=e,-1==(e=t.indexOf("}",r)))break;e!=r+1?(-1!=(i=(s=t.substring(r+1,e)).indexOf("="))?a+=null==(h=this._template[s.substring(0,i)])?s.substring(i+1):h:null!=(h=this._template[s])&&(a+=h),r=e+1):(a+=t.substr(r,2),r=e+1)}return r<t.length&&(a+=t.substr(r)),a}}class Es{constructor(){this.loader=Wi.UIObjectFactory.newObject(t.ObjectType.Loader),this.loader.fill=t.LoaderFillType.ScaleFree,this.loader.touchable=!1}get displayObject(){return this.loader.displayObject}get element(){return this._element}get width(){return this.loader.width}get height(){return this.loader.height}create(t,e){this._owner=t,this._element=e;let i=0,s=0,h=e.getAttrString("src");if(null!=h){let t=Fi.getItemByURL(h);t&&(i=t.width,s=t.height)}this.loader.url=h;let r=e.getAttrInt("width",i),a=e.getAttrInt("height",s);0==r&&(r=5),0==a&&(a=10),this.loader.setSize(r,a)}setPosition(t,e){this.loader.setPosition(t,e)}add(){this._owner.addChild(this.loader.displayObject)}remove(){this.loader.displayObject.parent&&this._owner.removeChild(this.loader.displayObject)}release(){this.loader.offAll(),this.loader.url=null,this._owner=null,this._element=null}dispose(){this.loader.dispose()}}var Ws=new P;class Hs extends ft{constructor(){super(),this.rects=new Array,this._graphics=new ye(this._obj3D),this._graphics.texture=Ce}refresh(){let t=this.rects.length;if(t>0){Ws.copy(this.rects[0]);for(let e=1;e<t;e++)Ws.union(this.rects[e]);this.setSize(Ws.xMax,Ws.yMax)}else this.setSize(0,0);this.graphics.setMeshDirty()}clear(){this.rects.length=0,this.graphics.setMeshDirty()}onPopulateMesh(t){let e=this.rects.length;if(0!=e){for(let i=0;i<e;i++)t.addQuad(this.rects[i]);t.addTriangles()}}hitTest(t){let e=t.getLocal(this);if(this._contentRect.contains(e)){let t=this.rects.length;for(let i=0;i<t;i++)if(this.rects[i].contains(e))return this}return null}}class Ns{constructor(){this._shape=new Hs,this._shape.on("click",()=>{pt(this._owner.obj3D,"click_link",this._element.getAttrString("href"))})}get displayObject(){return this._shape}get element(){return this._element}get width(){return 0}get height(){return 0}create(t,e){this._owner=t,this._element=e}setArea(t,e,i,s){if(t==i&&e>s){let t=e;e=s,s=t}this._shape.rects.length=0,this._owner.getLinesShape(t,e,i,s,!0,this._shape.rects),this._shape.refresh()}setPosition(t,e){this._shape.setPosition(t,e)}add(){this._owner.addChild(this._shape)}remove(){this._shape.parent&&this._owner.removeChild(this._shape)}release(){this._shape.offAll(),this._owner=null,this._element=null}dispose(){this._shape.dispose()}}var Gs=new class{constructor(){this._imagePool=new b(Es),this._linkPool=new b(Ns)}createObject(t,e){let i=null;return e.type==ws.Image?i=this._imagePool.borrow():e.type==ws.Link&&(i=this._linkPool.borrow()),i&&i.create(t,e),i}freeObject(t){t.release(),t instanceof Es?this._imagePool.returns(t):t instanceof Ns&&this._linkPool.returns(t)}};class Us extends Ts{constructor(){super(),this._touchDisabled=!1,this.opaque=!0,this.isRich=!0,this.htmlPageContext=Gs,this.htmlParseOptions=new vs}getHtmlElement(t){let e=this.htmlElements,i=e.length;for(let s=0;s<i;s++){let i=e[s];if(t==i.name)return i}return null}showHtmlObject(t,e){let i=this.htmlElements[t];i.htmlObject&&i.type!=ws.Link&&(e?i.status&=253:i.status|=2,0==(3&i.status)?0==(4&i.status)&&(i.status|=4,i.htmlObject.add()):0!=(4&i.status)&&(i.status&=251,i.htmlObject.remove()))}dispose(){this.cleanupObjects(),super.dispose()}cleanupObjects(){let t=this.htmlElements,e=t.length;for(let i=0;i<e;i++){let e=t[i];e.htmlObject&&(e.htmlObject.remove(),this.htmlPageContext.freeObject(e.htmlObject))}}refreshObjects(){let t=this.htmlElements,e=t.length;for(let i=0;i<e;i++){let e=t[i];e.htmlObject&&(0==(3&e.status)?0==(4&e.status)&&(e.status|=4,e.htmlObject.add()):0!=(4&e.status)&&(e.status&=251,e.htmlObject.remove()))}}}class Ys extends Vs{constructor(){super()}createDisplayObject(){this._displayObject=this._textField=new Us}setText(){let t=this._text;this._template&&(t=this.parseTemplate(t)),this._textField.maxWidth=this.maxWidth,this._ubbEnabled?this._textField.htmlText=Bs.parse(t):this._textField.htmlText=t}}class Xs extends Vs{constructor(){super()}createDisplayObject(){this._displayObject=this._textField=new Fs}get password(){return this._textField.password}set password(t){this._textField.password=t}get keyboardType(){return this._textField.keyboardType}set keyboardType(t){this._textField.keyboardType=t}set editable(t){this._textField.editable=t}get editable(){return this._textField.editable}set maxLength(t){this._textField.maxLength=t}get maxLength(){return this._textField.maxLength}set promptText(t){this._textField.promptText=t}get promptText(){return this._textField.promptText}set restrict(t){this._textField.restrict=t}get restrict(){return this._textField.restrict}requestFocus(){}setup_beforeAdd(t,e){super.setup_beforeAdd(t,e),t.seek(e,4);var i=t.readS();null!=i&&(this.promptText=i),null!=(i=t.readS())&&(this.restrict=i);var s=t.readInt();0!=s&&(this.maxLength=s),0!=(s=t.readInt())&&(4==s?this.keyboardType="number":3==s&&(this.keyboardType="url")),t.readBool()&&(this.password=!0)}}class Qs extends qt{constructor(){super(),this._url="",this._fill=t.LoaderFillType.None,this._align="left",this._valign="top"}createDisplayObject(){this._displayObject=new ft,this._content=new li,this._displayObject.addChild(this._content)}dispose(){this._contentItem&&this._content.texture&&this.freeExternal(this._content.texture),this._content2&&this._content2.dispose(),super.dispose()}get url(){return this._url}set url(t){this._url!=t&&(this._url=t,this.loadContent(),this.updateGear(7))}get icon(){return this._url}set icon(t){this.url=t}get align(){return this._align}set align(t){this._align!=t&&(this._align=t,this.updateLayout())}get verticalAlign(){return this._valign}set verticalAlign(t){this._valign!=t&&(this._valign=t,this.updateLayout())}get fill(){return this._fill}set fill(t){this._fill!=t&&(this._fill=t,this.updateLayout())}get shrinkOnly(){return this._shrinkOnly}set shrinkOnly(t){this._shrinkOnly!=t&&(this._shrinkOnly=t,this.updateLayout())}get autoSize(){return this._autoSize}set autoSize(t){this._autoSize!=t&&(this._autoSize=t,this.updateLayout())}get playing(){return this._content.playing}set playing(t){this._content.playing!=t&&(this._content.playing=t,this.updateGear(5))}get frame(){return this._content.frame}set frame(t){this._content.frame!=t&&(this._content.frame=t,this.updateGear(5))}get color(){return this._content.graphics.color}set color(t){this._content.graphics.color!=t&&(this._content.graphics.color=t,this.updateGear(4))}get fillMethod(){return this._content.fillMethod}set fillMethod(t){this._content.fillMethod=t}get fillOrigin(){return this._content.fillOrigin}set fillOrigin(t){this._content.fillOrigin=t}get fillClockwise(){return this._content.fillClockwise}set fillClockwise(t){this._content.fillClockwise=t}get fillAmount(){return this._content.fillAmount}set fillAmount(t){this._content.fillAmount=t}get content(){return this._content}get component(){return this._content2}loadContent(){this.clearContent(),this._url&&(this._url.startsWith("ui://")?this.loadFromPackage(this._url):this.loadExternal())}loadFromPackage(e){if(this._contentItem=Fi.getItemByURL(e),this._contentItem)if(this._contentItem=this._contentItem.getBranch(),this.sourceWidth=this._contentItem.width,this.sourceHeight=this._contentItem.height,this._contentItem=this._contentItem.getHighResolution(),this._contentItem.load(),this._autoSize&&this.setSize(this.sourceWidth,this.sourceHeight),this._contentItem.type==t.PackageItemType.Image)null==this._contentItem.texture?this.setErrorState():(this._content.texture=this._contentItem.texture,this._content.scale9Grid=this._contentItem.scale9Grid,this._content.scaleByTile=this._contentItem.scaleByTile,this._content.tileGridIndice=this._contentItem.tileGridIndice,this.sourceWidth=this._contentItem.width,this.sourceHeight=this._contentItem.height,this.updateLayout());else if(this._contentItem.type==t.PackageItemType.MovieClip)this.sourceWidth=this._contentItem.width,this.sourceHeight=this._contentItem.height,this._content.interval=this._contentItem.interval,this._content.swing=this._contentItem.swing,this._content.repeatDelay=this._contentItem.repeatDelay,this._content.frames=this._contentItem.frames,this.updateLayout();else if(this._contentItem.type==t.PackageItemType.Component){var i=Fi.createObjectFromURL(e);i?i instanceof us?(this._content2=i,this._displayObject.addChild(this._content2.displayObject),this.updateLayout()):(i.dispose(),this.setErrorState()):this.setErrorState()}else this.setErrorState();else this.setErrorState()}loadExternal(){let t=this._url;(new e.TextureLoader).load(this._url,e=>{t==this._url&&this.onExternalLoadSuccess(new be(e))})}freeExternal(t){}onExternalLoadSuccess(t){this._content.texture=t,this._content.scale9Grid=null,this._content.scaleByTile=!1,this.sourceWidth=t.width,this.sourceHeight=t.height,this.updateLayout()}onExternalLoadFailed(){this.setErrorState()}setErrorState(){}clearErrorState(){}updateLayout(){if(!this._content2&&!this._content.texture&&!this._content.frames)return void(this._autoSize&&(this._updatingLayout=!0,this.setSize(50,30),this._updatingLayout=!1));let e=this.sourceWidth,i=this.sourceHeight;if(this._autoSize&&(this._updatingLayout=!0,0==e&&(e=50),0==i&&(i=30),this.setSize(e,i),this._updatingLayout=!1,e==this._width&&i==this._height))this._content2?(this._content2.setPosition(0,0),this._content2.setScale(1,1)):(this._content.setSize(e,i),this._content.setPosition(0,0));else{var s,h,r=1,a=1;this._fill!=t.LoaderFillType.None&&(r=this.width/this.sourceWidth,a=this.height/this.sourceHeight,1==r&&1==a||(this._fill==t.LoaderFillType.ScaleMatchHeight?r=a:this._fill==t.LoaderFillType.ScaleMatchWidth?a=r:this._fill==t.LoaderFillType.Scale?r>a?r=a:a=r:this._fill==t.LoaderFillType.ScaleNoBorder&&(r>a?a=r:r=a),this._shrinkOnly&&(r>1&&(r=1),a>1&&(a=1)),e=this.sourceWidth*r,i=this.sourceHeight*a)),this._content2?this._content2.setScale(r,a):this._content.setSize(e,i),s="center"==this._align?Math.floor((this.width-e)/2):"right"==this._align?this.width-e:0,h="middle"==this._valign?Math.floor((this.height-i)/2):"bottom"==this._valign?this.height-i:0,this._content2?this._content2.setPosition(s,h):this._content.setPosition(s,h)}}clearContent(){this.clearErrorState(),!this._contentItem&&this._content.texture&&this.freeExternal(this._content.texture),this._content.texture=null,this._content.frames=null,this._content2&&(this._content2.dispose(),this._content2=null),this._contentItem=null}handleSizeChanged(){super.handleSizeChanged(),this._updatingLayout||this.updateLayout()}getProp(e){switch(e){case t.ObjectPropID.Color:return this.color;case t.ObjectPropID.Playing:return this.playing;case t.ObjectPropID.Frame:return this.frame;case t.ObjectPropID.TimeScale:return this._content.timeScale;default:return super.getProp(e)}}setProp(e,i){switch(e){case t.ObjectPropID.Color:this.color=i;break;case t.ObjectPropID.Playing:this.playing=i;break;case t.ObjectPropID.Frame:this.frame=i;break;case t.ObjectPropID.TimeScale:this._content.timeScale=i;break;case t.ObjectPropID.DeltaTime:this._content.advance(i);break;default:super.setProp(e,i)}}setup_beforeAdd(t,e){var i;super.setup_beforeAdd(t,e),t.seek(e,5),this._url=t.readS(),i=t.readByte(),this._align=0==i?"left":1==i?"center":"right",i=t.readByte(),this._valign=0==i?"top":1==i?"middle":"bottom",this._fill=t.readByte(),this._shrinkOnly=t.readBool(),this._autoSize=t.readBool(),t.readBool(),this._content.playing=t.readBool(),this._content.frame=t.readInt(),t.readBool()&&(this.color=t.readColor()),this._content.fillMethod=t.readByte(),0!=this._content.fillMethod&&(this._content.fillOrigin=t.readByte(),this._content.fillClockwise=t.readBool(),this._content.fillAmount=t.readFloat()),this._url&&this.loadContent()}}class qs extends qt{}class Ks extends us{constructor(){super()}get icon(){return this._iconObject?this._iconObject.icon:null}set icon(t){this._iconObject&&(this._iconObject.icon=t),this.updateGear(7)}get title(){return this._titleObject?this._titleObject.text:null}set title(t){this._titleObject&&(this._titleObject.text=t),this.updateGear(6)}get text(){return this.title}set text(t){this.title=t}get titleColor(){var t=this.getTextField();return t?t.color:0}set titleColor(t){var e=this.getTextField();e&&(e.color=t),this.updateGear(4)}get titleFontSize(){var t=this.getTextField();return t?t.textFormat.size:0}set titleFontSize(t){var e=this.getTextField();e&&(e.textFormat.size=t,e.applyFormat())}get color(){return this.titleColor}set color(t){this.titleColor=t}set editable(t){this._titleObject instanceof Xs&&(this._titleObject.editable=t)}get editable(){return this._titleObject instanceof Xs&&this._titleObject.editable}getTextField(){return this._titleObject instanceof Vs?this._titleObject:"getTextField"in this._titleObject?this._titleObject.getTextField():null}getProp(e){switch(e){case t.ObjectPropID.Color:return this.titleColor;case t.ObjectPropID.OutlineColor:var i=this.getTextField();return i?i.textFormat.outlineColor:0;case t.ObjectPropID.FontSize:return this.titleFontSize;default:return super.getProp(e)}}setProp(e,i){switch(e){case t.ObjectPropID.Color:this.titleColor=i;break;case t.ObjectPropID.OutlineColor:var s=this.getTextField();s&&(s.textFormat.outlineColor=i,s.applyFormat());break;case t.ObjectPropID.FontSize:this.titleFontSize=i;break;default:super.setProp(e,i)}}constructExtension(t){this._titleObject=this.getChild("title"),this._iconObject=this.getChild("icon")}setup_afterAdd(t,e){if(super.setup_afterAdd(t,e),t.seek(e,6)&&t.readByte()==this.packageItem.objectType){var i;null!=(i=t.readS())&&(this.title=i),null!=(i=t.readS())&&(this.icon=i),t.readBool()&&(this.titleColor=t.readColor());var s=t.readInt();if(0!=s&&(this.titleFontSize=s),t.readBool()){var h=this.getTextField();h instanceof Xs?(null!=(i=t.readS())&&(h.promptText=i),null!=(i=t.readS())&&(h.restrict=i),0!=(s=t.readInt())&&(h.maxLength=s),0!=(s=t.readInt())&&(4==s?h.keyboardType="number":3==s&&(h.keyboardType="url")),t.readBool()&&(h.password=!0)):t.skip(13)}}}}class $s extends us{constructor(){super(),this._soundVolumeScale=0,this._downEffect=0,this._downEffectValue=0,this._downScaled=!1,this._mode=t.ButtonMode.Common,this._title="",this._icon="",this._sound=Qt.buttonSound,this._soundVolumeScale=Qt.buttonSoundVolumeScale,this._changeStateOnClick=!0,this._downEffectValue=.8}get icon(){return this._icon}set icon(t){this._icon=t,t=this._selected&&this._selectedIcon?this._selectedIcon:this._icon,this._iconObject&&(this._iconObject.icon=t),this.updateGear(7)}get selectedIcon(){return this._selectedIcon}set selectedIcon(t){this._selectedIcon=t,t=this._selected&&this._selectedIcon?this._selectedIcon:this._icon,this._iconObject&&(this._iconObject.icon=t)}get title(){return this._title}set title(t){this._title=t,this._titleObject&&(this._titleObject.text=this._selected&&this._selectedTitle?this._selectedTitle:this._title),this.updateGear(6)}get text(){return this.title}set text(t){this.title=t}get selectedTitle(){return this._selectedTitle}set selectedTitle(t){this._selectedTitle=t,this._titleObject&&(this._titleObject.text=this._selected&&this._selectedTitle?this._selectedTitle:this._title)}get titleColor(){var t=this.getTextField();return t?t.color:0}set titleColor(t){var e=this.getTextField();e&&(e.color=t),this.updateGear(4)}get titleFontSize(){var t=this.getTextField();return t?t.textFormat.size:0}set titleFontSize(t){var e=this.getTextField();e&&(e.textFormat.size=t,e.applyFormat())}get sound(){return this._sound}set sound(t){this._sound=t}get soundVolumeScale(){return this._soundVolumeScale}set soundVolumeScale(t){this._soundVolumeScale=t}set selected(e){if(this._mode!=t.ButtonMode.Common&&this._selected!=e){if(this._selected=e,this.setCurrentState(),this._selectedTitle&&this._titleObject&&(this._titleObject.text=this._selected?this._selectedTitle:this._title),this._selectedIcon){var i=this._selected?this._selectedIcon:this._icon;this._iconObject&&(this._iconObject.icon=i)}this._relatedController&&this._parent&&!this._parent._buildingDisplayList&&(this._selected?(this._relatedController.selectedPageId=this._relatedPageId,this._relatedController.autoRadioGroupDepth&&this._parent.adjustRadioGroupDepth(this,this._relatedController)):this._mode==t.ButtonMode.Check&&this._relatedController.selectedPageId==this._relatedPageId&&(this._relatedController.oppositePageId=this._relatedPageId))}}get selected(){return this._selected}get mode(){return this._mode}set mode(e){this._mode!=e&&(e==t.ButtonMode.Common&&(this.selected=!1),this._mode=e)}get relatedController(){return this._relatedController}set relatedController(t){t!=this._relatedController&&(this._relatedController=t,this._relatedPageId=null)}get relatedPageId(){return this._relatedPageId}set relatedPageId(t){this._relatedPageId=t}get changeStateOnClick(){return this._changeStateOnClick}set changeStateOnClick(t){this._changeStateOnClick=t}get linkedPopup(){return this._linkedPopup}set linkedPopup(t){this._linkedPopup=t}getTextField(){return this._titleObject instanceof Vs?this._titleObject:"getTextField"in this._titleObject?this._titleObject.getTextField():null}fireClick(e,i){(e=e||!1)&&this._mode==t.ButtonMode.Common&&(this.setState("over"),k.add(100,1,this.setState,this,"down"),k.add(200,1,this.setState,this,()=>{this.setState("up"),i&&this.dispatchEvent("click")}))}setState(e){if(this._buttonController&&(this._buttonController.selectedPage=e),1==this._downEffect){var i=this.numChildren;if("down"==e||"selectedOver"==e||"selectedDisabled"==e)for(var s=255*this._downEffectValue,h=(s<<16)+(s<<8)+s,r=0;r<i;r++){var a=this.getChildAt(r);a instanceof Vs||a.setProp(t.ObjectPropID.Color,h)}else for(r=0;r<i;r++)(a=this.getChildAt(r))instanceof Vs||a.setProp(t.ObjectPropID.Color,16777215)}else 2==this._downEffect&&("down"==e||"selectedOver"==e||"selectedDisabled"==e?this._downScaled||(this.setScale(this.scaleX*this._downEffectValue,this.scaleY*this._downEffectValue),this._downScaled=!0):this._downScaled&&(this.setScale(this.scaleX/this._downEffectValue,this.scaleY/this._downEffectValue),this._downScaled=!1))}setCurrentState(){this.grayed&&this._buttonController&&this._buttonController.hasPage("disabled")?this._selected?this.setState("selectedDisabled"):this.setState("disabled"):this._selected?this.setState(this._over?"selectedOver":"down"):this.setState(this._over?"over":"up")}handleControllerChanged(t){super.handleControllerChanged(t),this._relatedController==t&&(this.selected=this._relatedPageId==t.selectedPageId)}handleGrayedChanged(){this._buttonController&&this._buttonController.hasPage("disabled")?this.grayed?this._selected&&this._buttonController.hasPage("selectedDisabled")?this.setState("selectedDisabled"):this.setState("disabled"):this._selected?this.setState("down"):this.setState("up"):super.handleGrayedChanged()}getProp(e){switch(e){case t.ObjectPropID.Color:return this.titleColor;case t.ObjectPropID.OutlineColor:var i=this.getTextField();return i?i.textFormat.outlineColor:0;case t.ObjectPropID.FontSize:return this.titleFontSize;case t.ObjectPropID.Selected:return this.selected;default:return super.getProp(e)}}setProp(e,i){switch(e){case t.ObjectPropID.Color:this.titleColor=i;break;case t.ObjectPropID.OutlineColor:var s=this.getTextField();s&&(s.textFormat.outlineColor=i,s.applyFormat());break;case t.ObjectPropID.FontSize:this.titleFontSize=i;break;case t.ObjectPropID.Selected:this.selected=i;break;default:super.setProp(e,i)}}constructExtension(e){e.seek(0,6),this._mode=e.readByte();var i=e.readS();i&&(this._sound=i),this._soundVolumeScale=e.readFloat(),this._downEffect=e.readByte(),this._downEffectValue=e.readFloat(),2==this._downEffect&&this.setPivot(.5,.5,this.pivotAsAnchor),this._buttonController=this.getController("button"),this._titleObject=this.getChild("title"),this._iconObject=this.getChild("icon"),this._titleObject&&(this._title=this._titleObject.text),this._iconObject&&(this._icon=this._iconObject.icon),this._mode==t.ButtonMode.Common&&this.setState("up"),this.on("roll_over",this.__rollover,this),this.on("roll_out",this.__rollout,this),this.on("touch_begin",this.__btnTouchBegin,this),this.on("touch_end",this.__btnTouchEnd,this),this.on("click",this.__click,this),this.on("removed_from_stage",this.__removeFromStage,this)}setup_afterAdd(t,e){var i,s;(super.setup_afterAdd(t,e),t.seek(e,6))&&(t.readByte()==this.packageItem.objectType&&(null!=(i=t.readS())&&(this.title=i),null!=(i=t.readS())&&(this.selectedTitle=i),null!=(i=t.readS())&&(this.icon=i),null!=(i=t.readS())&&(this.selectedIcon=i),t.readBool()&&(this.titleColor=t.readColor()),0!=(s=t.readInt())&&(this.titleFontSize=s),(s=t.readShort())>=0&&(this._relatedController=this.parent.getControllerAt(s)),this._relatedPageId=t.readS(),null!=(i=t.readS())&&(this._sound=i),t.readBool()&&(this._soundVolumeScale=t.readFloat()),this.selected=t.readBool()))}__rollover(){this._buttonController&&this._buttonController.hasPage("over")&&(this._over=!0,this._down||this.grayed&&this._buttonController.hasPage("disabled")||this.setState(this._selected?"selectedOver":"over"))}__rollout(){this._buttonController&&this._buttonController.hasPage("over")&&(this._over=!1,this._down||this.grayed&&this._buttonController.hasPage("disabled")||this.setState(this._selected?"down":"up"))}__btnTouchBegin(e){0==e.input.button&&(this._down=!0,e.captureTouch(),this._mode==t.ButtonMode.Common&&(this.grayed&&this._buttonController&&this._buttonController.hasPage("disabled")?this.setState("selectedDisabled"):this.setState("down")),this._linkedPopup&&(this._linkedPopup instanceof gs?this._linkedPopup.toggleStatus():ps.findFor(this).togglePopup(this._linkedPopup,this)))}__btnTouchEnd(e){this._down&&(this._down=!1,this._mode==t.ButtonMode.Common?this.grayed&&this._buttonController&&this._buttonController.hasPage("disabled")?this.setState("disabled"):this._over?this.setState("over"):this.setState("up"):this._over||!this._buttonController||"over"!=this._buttonController.selectedPage&&"selectedOver"!=this._buttonController.selectedPage||this.setCurrentState())}__removeFromStage(){this._over&&this.__rollout()}__click(e){if(this._sound){var i=Fi.getItemByURL(this._sound);i?ps.inst.playOneShotSound(i.file):ps.inst.playOneShotSound(this._sound)}this._mode==t.ButtonMode.Check?this._changeStateOnClick&&(this.selected=!this._selected,this.dispatchEvent("status_changed")):this._mode==t.ButtonMode.Radio?this._changeStateOnClick&&!this._selected&&(this.selected=!0,this.dispatchEvent("status_changed")):this._relatedController&&(this._relatedController.selectedPageId=this._relatedPageId)}}class Zs extends us{constructor(){super(),this.visibleItemCount=Qt.defaultComboBoxVisibleItemCount,this.popupDirection=t.PopupDirection.Auto,this._itemsUpdated=!0,this._selectedIndex=-1,this._items=[],this._values=[]}get text(){return this._titleObject?this._titleObject.text:null}set text(t){this._titleObject&&(this._titleObject.text=t),this.updateGear(6)}get titleColor(){var t=this.getTextField();return t?t.color:0}set titleColor(t){var e=this.getTextField();e&&(e.color=t),this.updateGear(4)}get titleFontSize(){var t=this.getTextField();return t?t.textFormat.size:0}set titleFontSize(t){var e=this.getTextField();e&&(e.textFormat.size=t,e.applyFormat())}get icon(){return this._iconObject?this._iconObject.icon:null}set icon(t){this._iconObject&&(this._iconObject.icon=t),this.updateGear(7)}get items(){return this._items}set items(t){t?this._items=t.concat():this._items.length=0,this._items.length>0?(this._selectedIndex>=this._items.length?this._selectedIndex=this._items.length-1:-1==this._selectedIndex&&(this._selectedIndex=0),this.text=this._items[this._selectedIndex],this._icons&&this._selectedIndex<this._icons.length&&(this.icon=this._icons[this._selectedIndex])):(this.text="",this._icons&&(this.icon=null),this._selectedIndex=-1),this._itemsUpdated=!0}get icons(){return this._icons}set icons(t){this._icons=t,this._icons&&-1!=this._selectedIndex&&this._selectedIndex<this._icons.length&&(this.icon=this._icons[this._selectedIndex])}get values(){return this._values}set values(t){t?this._values=t.concat():this._values.length=0}get selectedIndex(){return this._selectedIndex}set selectedIndex(t){this._selectedIndex!=t&&(this._selectedIndex=t,this._selectedIndex>=0&&this._selectedIndex<this._items.length?(this.text=this._items[this._selectedIndex],this._icons&&this._selectedIndex<this._icons.length&&(this.icon=this._icons[this._selectedIndex])):(this.text="",this._icons&&(this.icon=null)),this.updateSelectionController())}get value(){return this._values[this._selectedIndex]}set value(t){var e=this._values.indexOf(t);-1==e&&null==t&&(e=this._values.indexOf("")),this.selectedIndex=e}getTextField(){return this._titleObject instanceof Vs?this._titleObject:"getTextField"in this._titleObject?this._titleObject.getTextField():null}setState(t){this._buttonController&&(this._buttonController.selectedPage=t)}setCurrentState(){this.grayed&&this._buttonController&&this._buttonController.hasPage("disabled")?this.setState("disabled"):this.dropdown&&this.dropdown.parent?this.setState("down"):this.setState(this._over?"over":"up")}get selectionController(){return this._selectionController}set selectionController(t){this._selectionController=t}handleControllerChanged(t){super.handleControllerChanged(t),this._selectionController==t&&(this.selectedIndex=t.selectedIndex)}updateSelectionController(){if(this._selectionController&&!this._selectionController.changing&&this._selectedIndex<this._selectionController.pageCount){var t=this._selectionController;this._selectionController=null,t.selectedIndex=this._selectedIndex,this._selectionController=t}}dispose(){this.dropdown&&(this.dropdown.dispose(),this.dropdown=null),this._selectionController=null,super.dispose()}getProp(e){switch(e){case t.ObjectPropID.Color:return this.titleColor;case t.ObjectPropID.OutlineColor:var i=this.getTextField();return i?i.textFormat.outlineColor:0;case t.ObjectPropID.FontSize:return(i=this.getTextField())?i.textFormat.size:0;default:return super.getProp(e)}}setProp(e,i){switch(e){case t.ObjectPropID.Color:this.titleColor=i;break;case t.ObjectPropID.OutlineColor:var s=this.getTextField();s&&(s.textFormat.outlineColor=i,s.applyFormat());break;case t.ObjectPropID.FontSize:(s=this.getTextField())&&(s.textFormat.size=i,s.applyFormat());break;default:super.setProp(e,i)}}constructExtension(e){this._buttonController=this.getController("button"),this._titleObject=this.getChild("title"),this._iconObject=this.getChild("icon");let i=e.readS();if(i){let e=Fi.createObjectFromURL(i);if(!(e instanceof us))return void console.warn(this.resourceURL+" should be a component.");if(this.dropdown=e,this._list=this.dropdown.getChild("list"),null==this._list)return void console.warn(this.resourceURL+": should container a list component named list.");this._list.on("click_item",this.__clickItem,this),this._list.addRelation(this.dropdown,t.RelationType.Width),this._list.removeRelation(this.dropdown,t.RelationType.Height),this.dropdown.addRelation(this._list,t.RelationType.Height),this.dropdown.removeRelation(this._list,t.RelationType.Width),this.dropdown.on("removed_from_stage",this.__popupWinClosed,this)}this.on("roll_over",this.__rollover,this),this.on("roll_out",this.__rollout,this),this.on("touch_begin",this.__mousedown,this),this.on("touch_end",this.__mouseup,this)}setup_afterAdd(t,e){if(super.setup_afterAdd(t,e),t.seek(e,6)&&t.readByte()==this.packageItem.objectType){var i,s,h,r,a=t.readShort();for(i=0;i<a;i++)h=t.readShort(),h+=t.pos,this._items[i]=t.readS(),this._values[i]=t.readS(),null!=(r=t.readS())&&(null==this._icons&&(this._icons=[]),this._icons[i]=r),t.pos=h;null!=(r=t.readS())?(this.text=r,this._selectedIndex=this._items.indexOf(r)):this._items.length>0?(this._selectedIndex=0,this.text=this._items[0]):this._selectedIndex=-1,null!=(r=t.readS())&&(this.icon=r),t.readBool()&&(this.titleColor=t.readColor()),(s=t.readInt())>0&&(this.visibleItemCount=s),this.popupDirection=t.readByte(),(s=t.readShort())>=0&&(this._selectionController=this.parent.getControllerAt(s))}}showDropdown(){if(this._itemsUpdated){this._itemsUpdated=!1,this._list.removeChildrenToPool();for(var t=this._items.length,e=0;e<t;e++){var i=this._list.addItemFromPool();i.name=e<this._values.length?this._values[e]:"",i.text=this._items[e],i.icon=this._icons&&e<this._icons.length?this._icons[e]:null}this._list.resizeToFit(this.visibleItemCount)}this._list.selectedIndex=-1,this.dropdown.width=this.width,this._list.ensureBoundsCorrect(),ps.findFor(this).togglePopup(this.dropdown,this,this.popupDirection),this.dropdown.parent&&this.setState("down")}__popupWinClosed(){this.setCurrentState()}__clickItem(t){this.dropdown.parent instanceof ps&&this.dropdown.parent.hidePopup(),this._selectedIndex=-1,this.selectedIndex=this._list.getChildIndex(t.data),this.dispatchEvent("status_changed")}__rollover(){this._over=!0,this._down||this.dropdown&&this.dropdown.parent||this.setCurrentState()}__rollout(){this._over=!1,this._down||this.dropdown&&this.dropdown.parent||this.setCurrentState()}__mousedown(t){t.initiator instanceof Fs||(this._down=!0,this.dropdown&&this.showDropdown(),t.captureTouch())}__mouseup(){this._down&&(this._down=!1,this.setCurrentState())}}let Js=new e.Vector2;class th extends us{constructor(){super(),this.changeOnClick=!0,this.canDrag=!0,this._min=0,this._max=0,this._value=0,this._barMaxWidth=0,this._barMaxHeight=0,this._barMaxWidthDelta=0,this._barMaxHeightDelta=0,this._clickPercent=0,this._barStartX=0,this._barStartY=0,this._titleType=t.ProgressTitleType.Percent,this._value=50,this._max=100,this._clickPos=new e.Vector2}get titleType(){return this._titleType}set titleType(t){this._titleType=t}get wholeNumbers(){return this._wholeNumbers}set wholeNumbers(t){this._wholeNumbers!=t&&(this._wholeNumbers=t,this.update())}get min(){return this._min}set min(t){this._min!=t&&(this._min=t,this.update())}get max(){return this._max}set max(t){this._max!=t&&(this._max=t,this.update())}get value(){return this._value}set value(t){this._value!=t&&(this._value=t,this.update())}update(){this.updateWithPercent((this._value-this._min)/(this._max-this._min),!1)}updateWithPercent(e,i){if(e=_e(e),i){var s=le(this._min+(this._max-this._min)*e,this._min,this._max);if(this._wholeNumbers&&(e=_e(((s=Math.round(s))-this._min)/(this._max-this._min))),s!=this._value&&(this._value=s,this.dispatchEvent("status_changed")))return}if(this._titleObject)switch(this._titleType){case t.ProgressTitleType.Percent:this._titleObject.text=Math.floor(100*e)+"%";break;case t.ProgressTitleType.ValueAndMax:this._titleObject.text=this._value+"/"+this._max;break;case t.ProgressTitleType.Value:this._titleObject.text=""+this._value;break;case t.ProgressTitleType.Max:this._titleObject.text=""+this._max}var h=this.width-this._barMaxWidthDelta,r=this.height-this._barMaxHeightDelta;this._reverse?(this._barObjectH&&(this._barObjectH.width=Math.round(h*e),this._barObjectH.x=this._barStartX+(h-this._barObjectH.width)),this._barObjectV&&(this._barObjectV.height=Math.round(r*e),this._barObjectV.y=this._barStartY+(r-this._barObjectV.height))):(this._barObjectH&&(this._barObjectH.width=Math.round(h*e)),this._barObjectV&&(this._barObjectV.height=Math.round(r*e)))}constructExtension(t){t.seek(0,6),this._titleType=t.readByte(),this._reverse=t.readBool(),t.version>=2&&(this._wholeNumbers=t.readBool(),this.changeOnClick=t.readBool()),this._titleObject=this.getChild("title"),this._barObjectH=this.getChild("bar"),this._barObjectV=this.getChild("bar_v"),this._gripObject=this.getChild("grip"),this._barObjectH&&(this._barMaxWidth=this._barObjectH.width,this._barMaxWidthDelta=this.width-this._barMaxWidth,this._barStartX=this._barObjectH.x),this._barObjectV&&(this._barMaxHeight=this._barObjectV.height,this._barMaxHeightDelta=this.height-this._barMaxHeight,this._barStartY=this._barObjectV.y),this._gripObject&&(this._gripObject.on("touch_begin",this.__gripTouchBegin,this),this._gripObject.on("touch_move",this.__gripTouchMove,this)),this.on("touch_begin",this.__barTouchBegin,this)}handleSizeChanged(){super.handleSizeChanged(),this._barObjectH&&(this._barMaxWidth=this.width-this._barMaxWidthDelta),this._barObjectV&&(this._barMaxHeight=this.height-this._barMaxHeightDelta),this._underConstruct||this.update()}setup_afterAdd(t,e){super.setup_afterAdd(t,e),t.seek(e,6)&&t.readByte()==this.packageItem.objectType?(this._value=t.readInt(),this._max=t.readInt(),t.version>=2&&(this._min=t.readInt()),this.update()):this.update()}__gripTouchBegin(t){0==t.input.button&&(this.canDrag=!0,t.stopPropagation(),t.captureTouch(),this.globalToLocal(t.input.x,t.input.y,this._clickPos),this._clickPercent=_e((this._value-this._min)/(this._max-this._min)))}__gripTouchMove(t){if(this.canDrag){var e,i=this.globalToLocal(t.input.x,t.input.y,Js),s=i.x-this._clickPos.x,h=i.y-this._clickPos.y;this._reverse&&(s=-s,h=-h),e=this._barObjectH?this._clickPercent+s/this._barMaxWidth:this._clickPercent+h/this._barMaxHeight,this.updateWithPercent(e,!0)}}__barTouchBegin(t){if(this.changeOnClick){var e=this._gripObject.globalToLocal(t.input.x,t.input.y,Js),i=_e((this._value-this._min)/(this._max-this._min)),s=0;this._barObjectH&&(s=(e.x-this._gripObject.width/2)/this._barMaxWidth),this._barObjectV&&(s=(e.y-this._gripObject.height/2)/this._barMaxHeight),this._reverse?i-=s:i+=s,this.updateWithPercent(i,!0)}}}class eh extends us{constructor(){super(),this._min=0,this._max=0,this._value=0,this._barMaxWidth=0,this._barMaxHeight=0,this._barMaxWidthDelta=0,this._barMaxHeightDelta=0,this._barStartX=0,this._barStartY=0,this._titleType=t.ProgressTitleType.Percent,this._value=50,this._max=100}get titleType(){return this._titleType}set titleType(t){this._titleType!=t&&(this._titleType=t,this.update(t))}get min(){return this._min}set min(t){this._min!=t&&(this._min=t,this.update(this._value))}get max(){return this._max}set max(t){this._max!=t&&(this._max=t,this.update(this._value))}get value(){return this._value}set value(t){this._value!=t&&(Nt.kill(this,!1,this.update),this._value=t,this.update(t))}tweenValue(e,i){var s,h=Nt.getTween(this,this.update);return h?(s=h.value.x,h.kill()):s=this._value,this._value=e,Nt.to(s,this._value,i).setTarget(this,this.update).setEase(t.EaseType.Linear)}update(e){var i=_e((e-this._min)/(this._max-this._min));if(this._titleObject)switch(this._titleType){case t.ProgressTitleType.Percent:this._titleObject.text=Math.floor(100*i)+"%";break;case t.ProgressTitleType.ValueAndMax:this._titleObject.text=Math.floor(e)+"/"+Math.floor(this._max);break;case t.ProgressTitleType.Value:this._titleObject.text=""+Math.floor(e);break;case t.ProgressTitleType.Max:this._titleObject.text=""+Math.floor(this._max)}var s=this.width-this._barMaxWidthDelta,h=this.height-this._barMaxHeightDelta;this._reverse?(this._barObjectH&&(this.setFillAmount(this._barObjectH,1-i)||(this._barObjectH.width=Math.round(s*i),this._barObjectH.x=this._barStartX+(s-this._barObjectH.width))),this._barObjectV&&(this.setFillAmount(this._barObjectV,1-i)||(this._barObjectV.height=Math.round(h*i),this._barObjectV.y=this._barStartY+(h-this._barObjectV.height)))):(this._barObjectH&&(this.setFillAmount(this._barObjectH,i)||(this._barObjectH.width=Math.round(s*i))),this._barObjectV&&(this.setFillAmount(this._barObjectV,i)||(this._barObjectV.height=Math.round(h*i)))),this._aniObject&&this._aniObject.setProp(t.ObjectPropID.Frame,Math.floor(100*i))}setFillAmount(e,i){return(e instanceof oi||e instanceof Qs)&&e.fillMethod!=t.FillMethod.None&&(e.fillAmount=i,!0)}constructExtension(t){t.seek(0,6),this._titleType=t.readByte(),this._reverse=t.readBool(),this._titleObject=this.getChild("title"),this._barObjectH=this.getChild("bar"),this._barObjectV=this.getChild("bar_v"),this._aniObject=this.getChild("ani"),this._barObjectH&&(this._barMaxWidth=this._barObjectH.width,this._barMaxWidthDelta=this.width-this._barMaxWidth,this._barStartX=this._barObjectH.x),this._barObjectV&&(this._barMaxHeight=this._barObjectV.height,this._barMaxHeightDelta=this.height-this._barMaxHeight,this._barStartY=this._barObjectV.y)}handleSizeChanged(){super.handleSizeChanged(),this._barObjectH&&(this._barMaxWidth=this.width-this._barMaxWidthDelta),this._barObjectV&&(this._barMaxHeight=this.height-this._barMaxHeightDelta),this._underConstruct||this.update(this._value)}setup_afterAdd(t,e){super.setup_afterAdd(t,e),t.seek(e,6)&&t.readByte()==this.packageItem.objectType?(this._value=t.readInt(),this._max=t.readInt(),t.version>=2&&(this._min=t.readInt()),this.update(this._value)):this.update(this._value)}}var ih=new e.Vector2;class sh extends us{constructor(){super(),this._dragOffset=new e.Vector2,this._scrollPerc=0}setScrollPane(t,e){this._target=t,this._vertical=e}setDisplayPerc(t){this._vertical?(this._fixedGripSize||(this._grip.height=Math.floor(t*this._bar.height)),this._grip.y=this._bar.y+(this._bar.height-this._grip.height)*this._scrollPerc):(this._fixedGripSize||(this._grip.width=Math.floor(t*this._bar.width)),this._grip.x=this._bar.x+(this._bar.width-this._grip.width)*this._scrollPerc),this._grip.visible=0!=t&&1!=t}setScrollPerc(t){this._scrollPerc=t,this._vertical?this._grip.y=this._bar.y+(this._bar.height-this._grip.height)*this._scrollPerc:this._grip.x=this._bar.x+(this._bar.width-this._grip.width)*this._scrollPerc}get minSize(){return this._vertical?(this._arrowButton1?this._arrowButton1.height:0)+(this._arrowButton2?this._arrowButton2.height:0):(this._arrowButton1?this._arrowButton1.width:0)+(this._arrowButton2?this._arrowButton2.width:0)}get gripDragging(){return this._gripDragging}constructExtension(t){t.seek(0,6),this._fixedGripSize=t.readBool(),this._grip=this.getChild("grip"),this._grip?(this._bar=this.getChild("bar"),this._bar?(this._arrowButton1=this.getChild("arrow1"),this._arrowButton2=this.getChild("arrow2"),this._grip.on("touch_begin",this.__gripTouchBegin,this),this._grip.on("touch_move",this.__gripTouchMove,this),this._grip.on("touch_end",this.__gripTouchEnd,this),this.on("touch_begin",this.__barTouchBegin,this),this._arrowButton1&&this._arrowButton1.on("touch_begin",this.__arrowButton1Click,this),this._arrowButton2&&this._arrowButton2.on("touch_begin",this.__arrowButton2Click,this)):console.warn("需要定义bar")):console.warn("需要定义grip")}__gripTouchBegin(t){null!=this._bar&&(t.stopPropagation(),this._gripDragging=!0,this._target.updateScrollBarVisible(),this.globalToLocal(t.input.x,t.input.y,this._dragOffset),this._dragOffset.x-=this._grip.x,this._dragOffset.y-=this._grip.y)}__gripTouchMove(t){if(this.onStage){var e=this.globalToLocal(t.input.x,t.input.y,ih);if(this._vertical){let t=e.y-this._dragOffset.y,i=this._bar.height-this._grip.height;this._target.percY=0==i?0:(t-this._bar.y)/i}else{let t=e.x-this._dragOffset.x,i=this._bar.width-this._grip.width;this._target.percX=0==i?0:(t-this._bar.x)/(this._bar.width-this._grip.width)}}}__gripTouchEnd(t){this._gripDragging=!1,this._target.updateScrollBarVisible()}__arrowButton1Click(t){t.stopPropagation(),this._vertical?this._target.scrollUp():this._target.scrollLeft()}__arrowButton2Click(t){t.stopPropagation(),this._vertical?this._target.scrollDown():this._target.scrollRight()}__barTouchBegin(t){t.stopPropagation();var e=this._grip.globalToLocal(t.input.x,t.input.y,ih);this._vertical?e.y<0?this._target.scrollUp(4):this._target.scrollDown(4):e.x<0?this._target.scrollLeft(4):this._target.scrollRight(4)}}class hh{constructor(){this._count=0,this._pool={}}clear(){for(var t in this._pool){this._pool[t].forEach(t=>t.dispose())}this._pool={},this._count=0}get count(){return this._count}getObject(t){if(null==(t=Fi.normalizeURL(t)))return null;var e=this._pool[t];return e&&e.length>0?(this._count--,e.shift()):Fi.createObjectFromURL(t)}returnObject(t){var e=t.resourceURL;if(e){var i=this._pool[e];i||(i=[],this._pool[e]=i),this._count++,i.push(t)}}}class rh extends us{constructor(){super(),this._lineCount=0,this._columnCount=0,this._lineGap=0,this._columnGap=0,this._lastSelectedIndex=0,this._numItems=0,this._firstIndex=0,this._curLineItemCount=0,this._virtualListChanged=0,this.itemInfoVer=0,this._trackBounds=!0,this._pool=new hh,this._layout=t.ListLayoutType.SingleColumn,this._autoResizeItem=!0,this._lastSelectedIndex=-1,this._selectionMode=t.ListSelectionMode.Single,this.opaque=!0,this.scrollItemToViewOnClick=!0,this._align="left",this._valign="top",this._container=new ft,this._displayObject.addChild(this._container)}dispose(){this._pool.clear(),super.dispose()}get layout(){return this._layout}set layout(t){this._layout!=t&&(this._layout=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}get lineCount(){return this._lineCount}set lineCount(e){this._lineCount!=e&&(this._lineCount=e,this._layout!=t.ListLayoutType.FlowVertical&&this._layout!=t.ListLayoutType.Pagination||(this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0)))}get columnCount(){return this._columnCount}set columnCount(e){this._columnCount!=e&&(this._columnCount=e,this._layout!=t.ListLayoutType.FlowHorizontal&&this._layout!=t.ListLayoutType.Pagination||(this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0)))}get lineGap(){return this._lineGap}set lineGap(t){this._lineGap!=t&&(this._lineGap=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}get columnGap(){return this._columnGap}set columnGap(t){this._columnGap!=t&&(this._columnGap=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}get align(){return this._align}set align(t){this._align!=t&&(this._align=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}get verticalAlign(){return this._valign}set verticalAlign(t){this._valign!=t&&(this._valign=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}get virtualItemSize(){return this._itemSize}set virtualItemSize(t){this._virtual&&(null==this._itemSize&&(this._itemSize=new e.Vector2),this._itemSize.set(t.x,t.y),this.setVirtualListChangedFlag(!0))}get defaultItem(){return this._defaultItem}set defaultItem(t){this._defaultItem=t}get autoResizeItem(){return this._autoResizeItem}set autoResizeItem(t){this._autoResizeItem!=t&&(this._autoResizeItem=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}get selectionMode(){return this._selectionMode}set selectionMode(t){this._selectionMode=t}get selectionController(){return this._selectionController}set selectionController(t){this._selectionController=t}get itemPool(){return this._pool}getFromPool(t){t||(t=this._defaultItem);var e=this._pool.getObject(t);return e&&(e.visible=!0),e}returnToPool(t){this._pool.returnObject(t)}addChildAt(t,e){return super.addChildAt(t,e),t instanceof $s&&(t.selected=!1,t.changeStateOnClick=!1),t.on("click",this.__clickItem,this),t}addItem(t){return t||(t=this._defaultItem),this.addChild(Fi.createObjectFromURL(t))}addItemFromPool(t){return this.addChild(this.getFromPool(t))}removeChildAt(t,e){var i=super.removeChildAt(t);return e?i.dispose():i.off("click",this.__clickItem,this),i}removeChildToPoolAt(t){var e=super.removeChildAt(t);this.returnToPool(e)}removeChildToPool(t){super.removeChild(t),this.returnToPool(t)}removeChildrenToPool(t,e){t=t||0,null==e&&(e=-1),(e<0||e>=this._children.length)&&(e=this._children.length-1);for(var i=t;i<=e;++i)this.removeChildToPoolAt(t)}get selectedIndex(){var t;if(this._virtual)for(t=0;t<this._realNumItems;t++){var e=this._virtualItems[t];if(e.obj instanceof $s&&e.obj.selected||null==e.obj&&e.selected)return this._loop?t%this._numItems:t}else{var i=this._children.length;for(t=0;t<i;t++){var s=this._children[t];if(s instanceof $s&&s.selected)return t}}return-1}set selectedIndex(e){e>=0&&e<this.numItems?(this._selectionMode!=t.ListSelectionMode.Single&&this.clearSelection(),this.addSelection(e)):this.clearSelection()}getSelection(t){var e;if(t||(t=new Array),this._virtual)for(e=0;e<this._realNumItems;e++){var i=this._virtualItems[e];if(i.obj instanceof $s&&i.obj.selected||null==i.obj&&i.selected){var s=e;if(this._loop&&(s=e%this._numItems,-1!=t.indexOf(s)))continue;t.push(s)}}else{var h=this._children.length;for(e=0;e<h;e++){var r=this._children[e];r instanceof $s&&r.selected&&t.push(e)}}return t}addSelection(e,i){if(this._selectionMode!=t.ListSelectionMode.None){var s;if(this.checkVirtualList(),this._selectionMode==t.ListSelectionMode.Single&&this.clearSelection(),i&&this.scrollToView(e),this._lastSelectedIndex=e,this._virtual){var h=this._virtualItems[e];h.obj&&(s=h.obj),h.selected=!0}else s=this.getChildAt(e);s instanceof $s&&!s.selected&&(s.selected=!0,this.updateSelectionController(e))}}removeSelection(e){if(this._selectionMode!=t.ListSelectionMode.None){var i;if(this._virtual){var s=this._virtualItems[e];s.obj&&(i=s.obj),s.selected=!1}else i=this.getChildAt(e);i instanceof $s&&(i.selected=!1)}}clearSelection(){var t;if(this._virtual)for(t=0;t<this._realNumItems;t++){var e=this._virtualItems[t];e.obj instanceof $s&&(e.obj.selected=!1),e.selected=!1}else{var i=this._children.length;for(t=0;t<i;t++){var s=this._children[t];s instanceof $s&&(s.selected=!1)}}}clearSelectionExcept(t){var e;if(this._virtual)for(e=0;e<this._realNumItems;e++){var i=this._virtualItems[e];i.obj!=t&&(i.obj instanceof $s&&(i.obj.selected=!1),i.selected=!1)}else{var s=this._children.length;for(e=0;e<s;e++){var h=this._children[e];h instanceof $s&&h!=t&&(h.selected=!1)}}}selectAll(){this.checkVirtualList();var t,e=-1;if(this._virtual)for(t=0;t<this._realNumItems;t++){var i=this._virtualItems[t];i.obj instanceof $s&&!i.obj.selected&&(i.obj.selected=!0,e=t),i.selected=!0}else{var s=this._children.length;for(t=0;t<s;t++){var h=this._children[t];h instanceof $s&&!h.selected&&(h.selected=!0,e=t)}}-1!=e&&this.updateSelectionController(e)}selectNone(){this.clearSelection()}selectReverse(){this.checkVirtualList();var t,e=-1;if(this._virtual)for(t=0;t<this._realNumItems;t++){var i=this._virtualItems[t];i.obj instanceof $s&&(i.obj.selected=!i.obj.selected,i.obj.selected&&(e=t)),i.selected=!i.selected}else{var s=this._children.length;for(t=0;t<s;t++){var h=this._children[t];h instanceof $s&&(h.selected=!h.selected,h.selected&&(e=t))}}-1!=e&&this.updateSelectionController(e)}handleArrowKey(e){var i=this.selectedIndex;if(-1!=i)switch(e){case 1:if(this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowVertical)--i>=0&&(this.clearSelection(),this.addSelection(i,!0));else if(this._layout==t.ListLayoutType.FlowHorizontal||this._layout==t.ListLayoutType.Pagination){for(var s=this._children[i],h=0,r=i-1;r>=0;r--){var a=this._children[r];if(a.y!=s.y){s=a;break}h++}for(;r>=0;r--)if((a=this._children[r]).y!=s.y){this.clearSelection(),this.addSelection(r+h+1,!0);break}}break;case 3:if(this._layout==t.ListLayoutType.SingleRow||this._layout==t.ListLayoutType.FlowHorizontal||this._layout==t.ListLayoutType.Pagination)++i<this.numItems&&(this.clearSelection(),this.addSelection(i,!0));else if(this._layout==t.ListLayoutType.FlowVertical){s=this._children[i],h=0;var n=this._children.length;for(r=i+1;r<n;r++){if((a=this._children[r]).x!=s.x){s=a;break}h++}for(;r<n;r++)if((a=this._children[r]).x!=s.x){this.clearSelection(),this.addSelection(r-h-1,!0);break}}break;case 5:if(this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowVertical)++i<this.numItems&&(this.clearSelection(),this.addSelection(i,!0));else if(this._layout==t.ListLayoutType.FlowHorizontal||this._layout==t.ListLayoutType.Pagination){for(s=this._children[i],h=0,n=this._children.length,r=i+1;r<n;r++){if((a=this._children[r]).y!=s.y){s=a;break}h++}for(;r<n;r++)if((a=this._children[r]).y!=s.y){this.clearSelection(),this.addSelection(r-h-1,!0);break}}break;case 7:if(this._layout==t.ListLayoutType.SingleRow||this._layout==t.ListLayoutType.FlowHorizontal||this._layout==t.ListLayoutType.Pagination)--i>=0&&(this.clearSelection(),this.addSelection(i,!0));else if(this._layout==t.ListLayoutType.FlowVertical){for(s=this._children[i],h=0,r=i-1;r>=0;r--){if((a=this._children[r]).x!=s.x){s=a;break}h++}for(;r>=0;r--)if((a=this._children[r]).x!=s.x){this.clearSelection(),this.addSelection(r+h+1,!0);break}}}}__clickItem(t){if(!this._scrollPane||!this._scrollPane.isDragged){var e=qt.cast(t.sender);this.setSelectionOnEvent(e,t),this._scrollPane&&this.scrollItemToViewOnClick&&this._scrollPane.scrollToView(e,!0),this.dispatchItemEvent(e,t)}}dispatchItemEvent(t,e){this.dispatchEvent("click_item",t)}setSelectionOnEvent(e,i){if(e instanceof $s&&this._selectionMode!=t.ListSelectionMode.None){var s=!1,h=this.childIndexToItemIndex(this.getChildIndex(e));if(this._selectionMode==t.ListSelectionMode.Single)e.selected||(this.clearSelectionExcept(e),e.selected=!0);else if(i.input.shiftKey){if(!e.selected)if(-1!=this._lastSelectedIndex){var r,a=Math.min(this._lastSelectedIndex,h),n=Math.max(this._lastSelectedIndex,h);if(n=Math.min(n,this.numItems-1),this._virtual)for(r=a;r<=n;r++){var o=this._virtualItems[r];o.obj instanceof $s&&(o.obj.selected=!0),o.selected=!0}else for(r=a;r<=n;r++){var l=this.getChildAt(r);l instanceof $s&&(l.selected=!0)}s=!0}else e.selected=!0}else i.input.ctrlKey||i.input.commandKey||this._selectionMode==t.ListSelectionMode.Multiple_SingleClick?e.selected=!e.selected:e.selected?this.clearSelectionExcept(e):(this.clearSelectionExcept(e),e.selected=!0);s||(this._lastSelectedIndex=h),e.selected&&this.updateSelectionController(h)}}resizeToFit(e,i){this.ensureBoundsCorrect();var s=this.numItems;if((null==e||e>s)&&(e=s),i=i||0,this._virtual){var h=Math.ceil(e/this._curLineItemCount);this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal?this.viewHeight=h*this._itemSize.y+Math.max(0,h-1)*this._lineGap:this.viewWidth=h*this._itemSize.x+Math.max(0,h-1)*this._columnGap}else if(0==e)this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal?this.viewHeight=i:this.viewWidth=i;else{for(var r=e-1,a=null;r>=0&&(a=this.getChildAt(r),this.foldInvisibleItems&&!a.visible);)r--;if(r<0)this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal?this.viewHeight=i:this.viewWidth=i;else{var n=0;this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal?((n=a.y+a.height)<i&&(n=i),this.viewHeight=n):((n=a.x+a.width)<i&&(n=i),this.viewWidth=n)}}}getMaxItemWidth(){for(var t=this._children.length,e=0,i=0;i<t;i++){var s=this.getChildAt(i);s.width>e&&(e=s.width)}return e}handleSizeChanged(){super.handleSizeChanged(),this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0)}handleControllerChanged(t){super.handleControllerChanged(t),this._selectionController==t&&(this.selectedIndex=t.selectedIndex)}updateSelectionController(t){if(this._selectionController&&!this._selectionController.changing&&t<this._selectionController.pageCount){var e=this._selectionController;this._selectionController=null,e.selectedIndex=t,this._selectionController=e}}shouldSnapToNext(t,e,i){return t<0&&e>Qt.defaultScrollSnappingThreshold*i||t>0&&e>(1-Qt.defaultScrollSnappingThreshold)*i||0==t&&e>i/2}getSnappingPositionWithDir(i,s,h,r,a){var n,o,l;return this._virtual?(a||(a=new e.Vector2),this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal?(n=s,ah=s,o=this.getIndexOnPos1(!1),s=ah,o<this._virtualItems.length&&o<this._realNumItems&&(l=this._virtualItems[o].height,this.shouldSnapToNext(r,n-s,l)&&(s+=l+this._lineGap))):this._layout==t.ListLayoutType.SingleRow||this._layout==t.ListLayoutType.FlowVertical?(n=i,ah=i,o=this.getIndexOnPos2(!1),i=ah,o<this._virtualItems.length&&o<this._realNumItems&&(l=this._virtualItems[o].width,this.shouldSnapToNext(h,n-i,l)&&(i+=l+this._columnGap))):(n=i,ah=i,o=this.getIndexOnPos3(!1),i=ah,o<this._virtualItems.length&&o<this._realNumItems&&(l=this._virtualItems[o].width,this.shouldSnapToNext(h,n-i,l)&&(i+=l+this._columnGap))),a.x=i,a.y=s,a):super.getSnappingPositionWithDir(i,s,h,r,a)}scrollToView(e,i,s){if(this._virtual){if(0==this._numItems)return;if(this.checkVirtualList(),e>=this._virtualItems.length)throw new Error("Invalid child index: "+e+">"+this._virtualItems.length);var h;this._loop&&(e=Math.floor(this._firstIndex/this._numItems)*this._numItems+e);var r,a=this._virtualItems[e],n=0;if(this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal){for(r=this._curLineItemCount-1;r<e;r+=this._curLineItemCount)n+=this._virtualItems[r].height+this._lineGap;h=new P(0,n,this._itemSize.x,a.height)}else if(this._layout==t.ListLayoutType.SingleRow||this._layout==t.ListLayoutType.FlowVertical){for(r=this._curLineItemCount-1;r<e;r+=this._curLineItemCount)n+=this._virtualItems[r].width+this._columnGap;h=new P(n,0,a.width,this._itemSize.y)}else{var o=e/(this._curLineItemCount*this._curLineItemCount2);h=new P(o*this.viewWidth+e%this._curLineItemCount*(a.width+this._columnGap),e/this._curLineItemCount%this._curLineItemCount2*(a.height+this._lineGap),a.width,a.height)}s=!0,this._scrollPane&&this._scrollPane.scrollToView(h,i,s)}else{var l=this.getChildAt(e);this._scrollPane?this._scrollPane.scrollToView(l,i,s):this._parent&&this._parent.scrollPane&&this._parent.scrollPane.scrollToView(l,i,s)}}getFirstChildInView(){return this.childIndexToItemIndex(super.getFirstChildInView())}childIndexToItemIndex(e){if(!this._virtual)return e;if(this._layout==t.ListLayoutType.Pagination){for(var i=this._firstIndex;i<this._realNumItems;i++)if(this._virtualItems[i].obj&&--e<0)return i;return e}return e+=this._firstIndex,this._loop&&this._numItems>0&&(e%=this._numItems),e}itemIndexToChildIndex(e){if(!this._virtual)return e;if(this._layout==t.ListLayoutType.Pagination)return this.getChildIndex(this._virtualItems[e].obj);if(this._loop&&this._numItems>0){var i=this._firstIndex%this._numItems;e>=i?e-=i:e=this._numItems-i+e}else e-=this._firstIndex;return e}setVirtual(){this._setVirtual(!1)}setVirtualAndLoop(){this._setVirtual(!0)}_setVirtual(i){if(!this._virtual){if(null==this._scrollPane)throw new Error("Virtual list must be scrollable!");if(i){if(this._layout==t.ListLayoutType.FlowHorizontal||this._layout==t.ListLayoutType.FlowVertical)throw new Error("Loop list instanceof not supported for FlowHorizontal or FlowVertical this.layout!");this._scrollPane.bouncebackEffect=!1}if(this._virtual=!0,this._loop=i,this._virtualItems=new Array,this.removeChildrenToPool(),null==this._itemSize){this._itemSize=new e.Vector2;var s=this.getFromPool(null);if(null==s)throw new Error("Virtual List must have a default list item resource.");this._itemSize.x=s.width,this._itemSize.y=s.height,this.returnToPool(s)}this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal?(this._scrollPane.scrollStep=this._itemSize.y,this._loop&&(this._scrollPane._loop=2)):(this._scrollPane.scrollStep=this._itemSize.x,this._loop&&(this._scrollPane._loop=1)),this.on("scroll",this.__scrolled,this),this.setVirtualListChangedFlag(!0)}}get numItems(){return this._virtual?this._numItems:this._children.length}set numItems(t){var e;if(this._virtual){if(null==this.itemRenderer)throw new Error("set itemRenderer first!");this._numItems=t,this._loop?this._realNumItems=6*this._numItems:this._realNumItems=this._numItems;var i=this._virtualItems.length;if(this._realNumItems>i)for(e=i;e<this._realNumItems;e++){var s={width:0,height:0,flag:0};s.width=this._itemSize.x,s.height=this._itemSize.y,this._virtualItems.push(s)}else for(e=this._realNumItems;e<i;e++)this._virtualItems[e].selected=!1;0!=this._virtualListChanged&&k.remove(this._refreshVirtualList,this),this._refreshVirtualList()}else{var h=this._children.length;if(t>h)for(e=h;e<t;e++)null==this.itemProvider?this.addItemFromPool():this.addItemFromPool(this.itemProvider(e));else this.removeChildrenToPool(t,h);if(this.itemRenderer)for(e=0;e<t;e++)this.itemRenderer(e,this.getChildAt(e))}}refreshVirtualList(){this.setVirtualListChangedFlag(!1)}checkVirtualList(){0!=this._virtualListChanged&&(this._refreshVirtualList(),k.remove(this._refreshVirtualList,this))}setVirtualListChangedFlag(t){t?this._virtualListChanged=2:0==this._virtualListChanged&&(this._virtualListChanged=1),k.callLater(this._refreshVirtualList,this)}_refreshVirtualList(){if(this._displayObject){var e=2==this._virtualListChanged;this._virtualListChanged=0,this._eventLocked=!0,e&&(this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.SingleRow?this._curLineItemCount=1:this._layout==t.ListLayoutType.FlowHorizontal?this._columnCount>0?this._curLineItemCount=this._columnCount:(this._curLineItemCount=Math.floor((this._scrollPane.viewWidth+this._columnGap)/(this._itemSize.x+this._columnGap)),this._curLineItemCount<=0&&(this._curLineItemCount=1)):this._layout==t.ListLayoutType.FlowVertical?this._lineCount>0?this._curLineItemCount=this._lineCount:(this._curLineItemCount=Math.floor((this._scrollPane.viewHeight+this._lineGap)/(this._itemSize.y+this._lineGap)),this._curLineItemCount<=0&&(this._curLineItemCount=1)):(this._columnCount>0?this._curLineItemCount=this._columnCount:(this._curLineItemCount=Math.floor((this._scrollPane.viewWidth+this._columnGap)/(this._itemSize.x+this._columnGap)),this._curLineItemCount<=0&&(this._curLineItemCount=1)),this._lineCount>0?this._curLineItemCount2=this._lineCount:(this._curLineItemCount2=Math.floor((this._scrollPane.viewHeight+this._lineGap)/(this._itemSize.y+this._lineGap)),this._curLineItemCount2<=0&&(this._curLineItemCount2=1))));var i=0,s=0;if(this._realNumItems>0){var h,r=Math.ceil(this._realNumItems/this._curLineItemCount)*this._curLineItemCount,a=Math.min(this._curLineItemCount,this._realNumItems);if(this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal){for(h=0;h<r;h+=this._curLineItemCount)i+=this._virtualItems[h].height+this._lineGap;if(i>0&&(i-=this._lineGap),this._autoResizeItem)s=this._scrollPane.viewWidth;else{for(h=0;h<a;h++)s+=this._virtualItems[h].width+this._columnGap;s>0&&(s-=this._columnGap)}}else if(this._layout==t.ListLayoutType.SingleRow||this._layout==t.ListLayoutType.FlowVertical){for(h=0;h<r;h+=this._curLineItemCount)s+=this._virtualItems[h].width+this._columnGap;if(s>0&&(s-=this._columnGap),this._autoResizeItem)i=this._scrollPane.viewHeight;else{for(h=0;h<a;h++)i+=this._virtualItems[h].height+this._lineGap;i>0&&(i-=this._lineGap)}}else{s=Math.ceil(r/(this._curLineItemCount*this._curLineItemCount2))*this.viewWidth,i=this.viewHeight}}this.handleAlign(s,i),this._scrollPane.setContentSize(s,i),this._eventLocked=!1,this.handleScroll(!0)}}__scrolled(){this.handleScroll(!1)}getIndexOnPos1(t){if(this._realNumItems<this._curLineItemCount)return ah=0,0;var e,i,s;if(this.numChildren>0&&!t){if((i=this.getChildAt(0).y)>ah){for(e=this._firstIndex-this._curLineItemCount;e>=0;e-=this._curLineItemCount)if((i-=this._virtualItems[e].height+this._lineGap)<=ah)return ah=i,e;return ah=0,0}for(e=this._firstIndex;e<this._realNumItems;e+=this._curLineItemCount){if((s=i+this._virtualItems[e].height+this._lineGap)>ah)return ah=i,e;i=s}return ah=i,this._realNumItems-this._curLineItemCount}for(i=0,e=0;e<this._realNumItems;e+=this._curLineItemCount){if((s=i+this._virtualItems[e].height+this._lineGap)>ah)return ah=i,e;i=s}return ah=i,this._realNumItems-this._curLineItemCount}getIndexOnPos2(t){if(this._realNumItems<this._curLineItemCount)return ah=0,0;var e,i,s;if(this.numChildren>0&&!t){if((i=this.getChildAt(0).x)>ah){for(e=this._firstIndex-this._curLineItemCount;e>=0;e-=this._curLineItemCount)if((i-=this._virtualItems[e].width+this._columnGap)<=ah)return ah=i,e;return ah=0,0}for(e=this._firstIndex;e<this._realNumItems;e+=this._curLineItemCount){if((s=i+this._virtualItems[e].width+this._columnGap)>ah)return ah=i,e;i=s}return ah=i,this._realNumItems-this._curLineItemCount}for(i=0,e=0;e<this._realNumItems;e+=this._curLineItemCount){if((s=i+this._virtualItems[e].width+this._columnGap)>ah)return ah=i,e;i=s}return ah=i,this._realNumItems-this._curLineItemCount}getIndexOnPos3(t){if(this._realNumItems<this._curLineItemCount)return ah=0,0;var e,i,s=this.viewWidth,h=Math.floor(ah/s),r=h*(this._curLineItemCount*this._curLineItemCount2),a=h*s;for(e=0;e<this._curLineItemCount;e++){if((i=a+this._virtualItems[r+e].width+this._columnGap)>ah)return ah=a,r+e;a=i}return ah=a,r+this._curLineItemCount-1}handleScroll(e){if(!this._eventLocked){if(this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal){for(var i=0;this.handleScroll1(e);)if(e=!1,++i>20){console.log("list will never be <the> filled item renderer function always returns a different size.");break}this.handleArchOrder1()}else if(this._layout==t.ListLayoutType.SingleRow||this._layout==t.ListLayoutType.FlowVertical){for(i=0;this.handleScroll2(e);)if(e=!1,++i>20){console.log("list will never be <the> filled item renderer function always returns a different size.");break}this.handleArchOrder2()}else this.handleScroll3(e);this._boundsChanged=!1}}handleScroll1(e){var i=this._scrollPane.scrollingPosY,s=i+this._scrollPane.viewHeight,h=s==this._scrollPane.contentHeight;ah=i;var r=this.getIndexOnPos1(e);if(i=ah,r==this._firstIndex&&!e)return!1;var a=this._firstIndex;this._firstIndex=r;var n,o,l,_,d,c=r,u=a>r,g=this.numChildren,p=a+g-1,f=u?p:a,m=0,y=i,w=0,x=0,v=this.defaultItem,b=(this._scrollPane.viewWidth-this._columnGap*(this._curLineItemCount-1))/this._curLineItemCount;for(this.itemInfoVer++;c<this._realNumItems&&(h||y<s);){if((null==(o=this._virtualItems[c]).obj||e)&&(this.itemProvider&&(null==(v=this.itemProvider(c%this._numItems))&&(v=this._defaultItem),v=Fi.normalizeURL(v)),o.obj&&o.obj.resourceURL!=v&&(o.obj instanceof $s&&(o.selected=o.obj.selected),this.removeChildToPool(o.obj),o.obj=null)),null==o.obj){if(u){for(d=f;d>=a;d--)if((l=this._virtualItems[d]).obj&&l.flag!=this.itemInfoVer&&l.obj.resourceURL==v){l.obj instanceof $s&&(l.selected=l.obj.selected),o.obj=l.obj,l.obj=null,d==f&&f--;break}}else for(d=f;d<=p;d++)if((l=this._virtualItems[d]).obj&&l.flag!=this.itemInfoVer&&l.obj.resourceURL==v){l.obj instanceof $s&&(l.selected=l.obj.selected),o.obj=l.obj,l.obj=null,d==f&&f++;break}o.obj?this.setChildIndex(o.obj,u?c-r:this.numChildren):(o.obj=this._pool.getObject(v),u?this.addChildAt(o.obj,c-r):this.addChild(o.obj)),o.obj instanceof $s&&(o.obj.selected=o.selected),n=!0}else n=e;n&&(this._autoResizeItem&&(this._layout==t.ListLayoutType.SingleColumn||this._columnCount>0)&&o.obj.setSize(b,o.obj.height,!0),this.itemRenderer(c%this._numItems,o.obj),c%this._curLineItemCount==0&&(w+=Math.ceil(o.obj.height)-o.height,c==r&&a>r&&(x=Math.ceil(o.obj.height)-o.height)),o.width=Math.ceil(o.obj.width),o.height=Math.ceil(o.obj.height)),o.flag=this.itemInfoVer,o.obj.setPosition(m,y),c==r&&(s+=o.height),m+=o.width+this._columnGap,c%this._curLineItemCount==this._curLineItemCount-1&&(m=0,y+=o.height+this._lineGap),c++}for(_=0;_<g;_++)(o=this._virtualItems[a+_]).flag!=this.itemInfoVer&&o.obj&&(o.obj instanceof $s&&(o.selected=o.obj.selected),this.removeChildToPool(o.obj),o.obj=null);for(g=this._children.length,_=0;_<g;_++){var C=this._virtualItems[r+_].obj;this._children[_]!=C&&this.setChildIndex(C,_)}return 0==w&&0==x||this._scrollPane.changeContentSizeOnScrolling(0,w,0,x),c>0&&this.numChildren>0&&this._container.y<=0&&this.getChildAt(0).y>-this._container.y}handleScroll2(e){var i=this._scrollPane.scrollingPosX,s=i+this._scrollPane.viewWidth,h=i==this._scrollPane.contentWidth;ah=i;var r=this.getIndexOnPos2(e);if(i=ah,r==this._firstIndex&&!e)return!1;var a=this._firstIndex;this._firstIndex=r;var n,o,l,_,d,c=r,u=a>r,g=this.numChildren,p=a+g-1,f=u?p:a,m=i,y=0,w=0,x=0,v=this.defaultItem,b=(this._scrollPane.viewHeight-this._lineGap*(this._curLineItemCount-1))/this._curLineItemCount;for(this.itemInfoVer++;c<this._realNumItems&&(h||m<s);){if((null==(o=this._virtualItems[c]).obj||e)&&(this.itemProvider&&(null==(v=this.itemProvider(c%this._numItems))&&(v=this._defaultItem),v=Fi.normalizeURL(v)),o.obj&&o.obj.resourceURL!=v&&(o.obj instanceof $s&&(o.selected=o.obj.selected),this.removeChildToPool(o.obj),o.obj=null)),null==o.obj){if(u){for(d=f;d>=a;d--)if((l=this._virtualItems[d]).obj&&l.flag!=this.itemInfoVer&&l.obj.resourceURL==v){l.obj instanceof $s&&(l.selected=l.obj.selected),o.obj=l.obj,l.obj=null,d==f&&f--;break}}else for(d=f;d<=p;d++)if((l=this._virtualItems[d]).obj&&l.flag!=this.itemInfoVer&&l.obj.resourceURL==v){l.obj instanceof $s&&(l.selected=l.obj.selected),o.obj=l.obj,l.obj=null,d==f&&f++;break}o.obj?this.setChildIndex(o.obj,u?c-r:this.numChildren):(o.obj=this._pool.getObject(v),u?this.addChildAt(o.obj,c-r):this.addChild(o.obj)),o.obj instanceof $s&&(o.obj.selected=o.selected),n=!0}else n=e;n&&(this._autoResizeItem&&(this._layout==t.ListLayoutType.SingleRow||this._lineCount>0)&&o.obj.setSize(o.obj.width,b,!0),this.itemRenderer(c%this._numItems,o.obj),c%this._curLineItemCount==0&&(w+=Math.ceil(o.obj.width)-o.width,c==r&&a>r&&(x=Math.ceil(o.obj.width)-o.width)),o.width=Math.ceil(o.obj.width),o.height=Math.ceil(o.obj.height)),o.flag=this.itemInfoVer,o.obj.setPosition(m,y),c==r&&(s+=o.width),y+=o.height+this._lineGap,c%this._curLineItemCount==this._curLineItemCount-1&&(y=0,m+=o.width+this._columnGap),c++}for(_=0;_<g;_++)(o=this._virtualItems[a+_]).flag!=this.itemInfoVer&&o.obj&&(o.obj instanceof $s&&(o.selected=o.obj.selected),this.removeChildToPool(o.obj),o.obj=null);for(g=this._children.length,_=0;_<g;_++){var C=this._virtualItems[r+_].obj;this._children[_]!=C&&this.setChildIndex(C,_)}return 0==w&&0==x||this._scrollPane.changeContentSizeOnScrolling(w,0,x,0),c>0&&this.numChildren>0&&this._container.x<=0&&this.getChildAt(0).x>-this._container.x}handleScroll3(t){var e=this._scrollPane.scrollingPosX;ah=e;var i=this.getIndexOnPos3(t);if(e=ah,i!=this._firstIndex||t){var s=this._firstIndex;this._firstIndex=i;var h,r,a,n,o,l=s,_=this._virtualItems.length,d=this._curLineItemCount*this._curLineItemCount2,c=i%this._curLineItemCount,u=this.viewWidth,g=Math.floor(i/d)*d,p=g+2*d,f=this._defaultItem,m=(this._scrollPane.viewWidth-this._columnGap*(this._curLineItemCount-1))/this._curLineItemCount,y=(this._scrollPane.viewHeight-this._lineGap*(this._curLineItemCount2-1))/this._curLineItemCount2;for(this.itemInfoVer++,r=g;r<p;r++)if(!(r>=this._realNumItems)){if(o=r%this._curLineItemCount,r-g<d){if(o<c)continue}else if(o>c)continue;(a=this._virtualItems[r]).flag=this.itemInfoVer}var w=null,x=0;for(r=g;r<p;r++)if(!(r>=this._realNumItems)&&(a=this._virtualItems[r]).flag==this.itemInfoVer){if(null==a.obj){for(;l<_;){if((n=this._virtualItems[l]).obj&&n.flag!=this.itemInfoVer){n.obj instanceof $s&&(n.selected=n.obj.selected),a.obj=n.obj,n.obj=null;break}l++}-1==x&&(x=this.getChildIndex(w)+1),null==a.obj?(this.itemProvider&&(null==(f=this.itemProvider(r%this._numItems))&&(f=this._defaultItem),f=Fi.normalizeURL(f)),a.obj=this._pool.getObject(f),this.addChildAt(a.obj,x)):x=this.setChildIndexBefore(a.obj,x),x++,a.obj instanceof $s&&(a.obj.selected=a.selected),h=!0}else h=t,x=-1,w=a.obj;h&&(this._autoResizeItem&&(this._curLineItemCount==this._columnCount&&this._curLineItemCount2==this._lineCount?a.obj.setSize(m,y,!0):this._curLineItemCount==this._columnCount?a.obj.setSize(m,a.obj.height,!0):this._curLineItemCount2==this._lineCount&&a.obj.setSize(a.obj.width,y,!0)),this.itemRenderer(r%this._numItems,a.obj),a.width=Math.ceil(a.obj.width),a.height=Math.ceil(a.obj.height))}var v=g/d*u,b=v,C=0,S=0;for(r=g;r<p;r++)r>=this._realNumItems||((a=this._virtualItems[r]).flag==this.itemInfoVer&&a.obj.setPosition(b,C),a.height>S&&(S=a.height),r%this._curLineItemCount==this._curLineItemCount-1?(b=v,C+=S+this._lineGap,S=0,r==g+d-1&&(b=v+=u,C=0)):b+=a.width+this._columnGap);for(r=l;r<_;r++)(a=this._virtualItems[r]).flag!=this.itemInfoVer&&a.obj&&(a.obj instanceof $s&&(a.selected=a.obj.selected),this.removeChildToPool(a.obj),a.obj=null)}}handleArchOrder1(){if(this.childrenRenderOrder==t.ChildrenRenderOrder.Arch){for(var e=this._scrollPane.posY+this.viewHeight/2,i=Number.POSITIVE_INFINITY,s=0,h=0,r=this.numChildren,a=0;a<r;a++){var n=this.getChildAt(a);this.foldInvisibleItems&&!n.visible||(s=Math.abs(e-n.y-n.height/2))<i&&(i=s,h=a)}this.apexIndex=h}}handleArchOrder2(){if(this.childrenRenderOrder==t.ChildrenRenderOrder.Arch){for(var e=this._scrollPane.posX+this.viewWidth/2,i=Number.POSITIVE_INFINITY,s=0,h=0,r=this.numChildren,a=0;a<r;a++){var n=this.getChildAt(a);this.foldInvisibleItems&&!n.visible||(s=Math.abs(e-n.x-n.width/2))<i&&(i=s,h=a)}this.apexIndex=h}}handleAlign(t,e){var i=0,s=0;e<this.viewHeight&&("middle"==this._valign?s=Math.floor((this.viewHeight-e)/2):"bottom"==this._valign&&(s=this.viewHeight-e)),t<this.viewWidth&&("center"==this._align?i=Math.floor((this.viewWidth-t)/2):"right"==this._align&&(i=this.viewWidth-t)),i==this._alignOffset.x&&s==this._alignOffset.y||(this._alignOffset.set(i,s),this._scrollPane?this._scrollPane.adjustMaskContainer():this._container.setPosition(this._margin.left+this._alignOffset.x,this._margin.top+this._alignOffset.y))}updateBounds(){if(!this._virtual){var e,i,s,h,r,a=0,n=0,o=0,l=0,_=0,d=0,c=0,u=this._children.length,g=this.viewWidth,p=this.viewHeight,f=0,m=0;if(this._layout==t.ListLayoutType.SingleColumn){for(e=0;e<u;e++)i=this.getChildAt(e),this.foldInvisibleItems&&!i.visible||(0!=n&&(n+=this._lineGap),i.y=n,this._autoResizeItem&&i.setSize(g,i.height,!0),n+=Math.ceil(i.height),i.width>o&&(o=i.width));if((h=n)<=p&&this._autoResizeItem&&this._scrollPane&&this._scrollPane._displayInDemand&&this._scrollPane.vtScrollBar)for(g+=this._scrollPane.vtScrollBar.width,e=0;e<u;e++)i=this.getChildAt(e),this.foldInvisibleItems&&!i.visible||(i.setSize(g,i.height,!0),i.width>o&&(o=i.width));s=Math.ceil(o)}else if(this._layout==t.ListLayoutType.SingleRow){for(e=0;e<u;e++)i=this.getChildAt(e),this.foldInvisibleItems&&!i.visible||(0!=a&&(a+=this._columnGap),i.x=a,this._autoResizeItem&&i.setSize(i.width,p,!0),a+=Math.ceil(i.width),i.height>l&&(l=i.height));if((s=a)<=g&&this._autoResizeItem&&this._scrollPane&&this._scrollPane._displayInDemand&&this._scrollPane.hzScrollBar)for(p+=this._scrollPane.hzScrollBar.height,e=0;e<u;e++)i=this.getChildAt(e),this.foldInvisibleItems&&!i.visible||(i.setSize(i.width,p,!0),i.height>l&&(l=i.height));h=Math.ceil(l)}else if(this._layout==t.ListLayoutType.FlowHorizontal)if(this._autoResizeItem&&this._columnCount>0){for(e=0;e<u;e++)if(i=this.getChildAt(e),(!this.foldInvisibleItems||i.visible)&&(f+=i.sourceWidth,++_==this._columnCount||e==u-1)){for(r=(g-f-(_-1)*this._columnGap)/f,a=0,_=m;_<=e;_++)i=this.getChildAt(_),this.foldInvisibleItems&&!i.visible||(i.setPosition(a,n),_<e?(i.setSize(i.sourceWidth+Math.round(i.sourceWidth*r),i.height,!0),a+=Math.ceil(i.width)+this._columnGap):i.setSize(g-a,i.height,!0),i.height>l&&(l=i.height));n+=Math.ceil(l)+this._lineGap,l=0,_=0,m=e+1,f=0}h=n+Math.ceil(l),s=g}else{for(e=0;e<u;e++)i=this.getChildAt(e),this.foldInvisibleItems&&!i.visible||(0!=a&&(a+=this._columnGap),(0!=this._columnCount&&_>=this._columnCount||0==this._columnCount&&a+i.width>g&&0!=l)&&(a=0,n+=Math.ceil(l)+this._lineGap,l=0,_=0),i.setPosition(a,n),(a+=Math.ceil(i.width))>o&&(o=a),i.height>l&&(l=i.height),_++);h=n+Math.ceil(l),s=Math.ceil(o)}else if(this._layout==t.ListLayoutType.FlowVertical)if(this._autoResizeItem&&this._lineCount>0){for(e=0;e<u;e++)if(i=this.getChildAt(e),(!this.foldInvisibleItems||i.visible)&&(f+=i.sourceHeight,++_==this._lineCount||e==u-1)){for(r=(p-f-(_-1)*this._lineGap)/f,n=0,_=m;_<=e;_++)i=this.getChildAt(_),this.foldInvisibleItems&&!i.visible||(i.setPosition(a,n),_<e?(i.setSize(i.width,i.sourceHeight+Math.round(i.sourceHeight*r),!0),n+=Math.ceil(i.height)+this._lineGap):i.setSize(i.width,p-n,!0),i.width>o&&(o=i.width));a+=Math.ceil(o)+this._columnGap,o=0,_=0,m=e+1,f=0}s=a+Math.ceil(o),h=p}else{for(e=0;e<u;e++)i=this.getChildAt(e),this.foldInvisibleItems&&!i.visible||(0!=n&&(n+=this._lineGap),(0!=this._lineCount&&_>=this._lineCount||0==this._lineCount&&n+i.height>p&&0!=o)&&(n=0,a+=Math.ceil(o)+this._columnGap,o=0,_=0),i.setPosition(a,n),(n+=Math.ceil(i.height))>l&&(l=n),i.width>o&&(o=i.width),_++);s=a+Math.ceil(o),h=Math.ceil(l)}else{var y;if(this._autoResizeItem&&this._lineCount>0&&(y=Math.floor((p-(this._lineCount-1)*this._lineGap)/this._lineCount)),this._autoResizeItem&&this._columnCount>0){for(e=0;e<u;e++)if(i=this.getChildAt(e),(!this.foldInvisibleItems||i.visible)&&(0==_&&(0!=this._lineCount&&c>=this._lineCount||0==this._lineCount&&n+i.height>p)&&(d++,n=0,c=0),f+=i.sourceWidth,++_==this._columnCount||e==u-1)){for(r=(g-f-(_-1)*this._columnGap)/f,a=0,_=m;_<=e;_++)i=this.getChildAt(_),this.foldInvisibleItems&&!i.visible||(i.setPosition(d*g+a,n),_<e?(i.setSize(i.sourceWidth+Math.round(i.sourceWidth*r),this._lineCount>0?y:i.height,!0),a+=Math.ceil(i.width)+this._columnGap):i.setSize(g-a,this._lineCount>0?y:i.height,!0),i.height>l&&(l=i.height));n+=Math.ceil(l)+this._lineGap,l=0,_=0,m=e+1,f=0,c++}}else for(e=0;e<u;e++)i=this.getChildAt(e),this.foldInvisibleItems&&!i.visible||(0!=a&&(a+=this._columnGap),this._autoResizeItem&&this._lineCount>0&&i.setSize(i.width,y,!0),(0!=this._columnCount&&_>=this._columnCount||0==this._columnCount&&a+i.width>g&&0!=l)&&(a=0,n+=Math.ceil(l)+this._lineGap,l=0,_=0,c++,(0!=this._lineCount&&c>=this._lineCount||0==this._lineCount&&n+i.height>p&&0!=o)&&(d++,n=0,c=0)),i.setPosition(d*g+a,n),(a+=Math.ceil(i.width))>o&&(o=a),i.height>l&&(l=i.height),_++);h=d>0?p:n+Math.ceil(l),s=(d+1)*g}this.handleAlign(s,h),this.setBounds(0,0,s,h)}}setup_beforeAdd(e,i){var s;super.setup_beforeAdd(e,i),e.seek(i,5),this._layout=e.readByte(),this._selectionMode=e.readByte(),s=e.readByte(),this._align=0==s?"left":1==s?"center":"right",s=e.readByte(),this._valign=0==s?"top":1==s?"middle":"bottom",this._lineGap=e.readShort(),this._columnGap=e.readShort(),this._lineCount=e.readShort(),this._columnCount=e.readShort(),this._autoResizeItem=e.readBool(),this._childrenRenderOrder=e.readByte(),this._apexIndex=e.readShort(),e.readBool()&&(this._margin.top=e.readInt(),this._margin.bottom=e.readInt(),this._margin.left=e.readInt(),this._margin.right=e.readInt());var h=e.readByte();if(h==t.OverflowType.Scroll){var r=e.pos;e.seek(i,7),this.setupScroll(e),e.pos=r}else this.setupOverflow(h);e.readBool()&&e.skip(8),e.version>=2&&(this.scrollItemToViewOnClick=e.readBool(),this.foldInvisibleItems=e.readBool()),e.seek(i,8),this._defaultItem=e.readS(),this.readItems(e)}readItems(t){var e,i,s,h;for(e=t.readShort(),i=0;i<e;i++)if(s=t.readShort(),s+=t.pos,null!=(h=t.readS())||(h=this.defaultItem)){var r=this.getFromPool(h);r&&(this.addChild(r),this.setupItem(t,r)),t.pos=s}else t.pos=s}setupItem(t,e){var i,s,h;if(null!=(i=t.readS())&&(e.text=i),null!=(i=t.readS())&&e instanceof $s&&(e.selectedTitle=i),null!=(i=t.readS())&&(e.icon=i),null!=(i=t.readS())&&e instanceof $s&&(e.selectedIcon=i),null!=(i=t.readS())&&(e.name=i),e instanceof us){for(s=t.readShort(),h=0;h<s;h++){var r=e.getController(t.readS());i=t.readS(),r&&(r.selectedPageId=i)}if(t.version>=2)for(s=t.readShort(),h=0;h<s;h++){var a=t.readS(),n=t.readShort(),o=t.readS(),l=e.getChildByPath(a);l&&l.setProp(n,o)}}}setup_afterAdd(t,e){super.setup_afterAdd(t,e),t.seek(e,6);var i=t.readShort();-1!=i&&(this._selectionController=this._parent.getControllerAt(i))}}var ah=0;class nh{constructor(t,e){this._expanded=!1,this._level=0,this._resURL=e,t&&(this._children=new Array)}set expanded(t){null!=this._children&&this._expanded!=t&&(this._expanded=t,this._tree&&(this._expanded?this._tree._afterExpanded(this):this._tree._afterCollapsed(this)))}get expanded(){return this._expanded}get isFolder(){return null!=this._children}get parent(){return this._parent}get text(){return this._cell?this._cell.text:null}set text(t){this._cell&&(this._cell.text=t)}get icon(){return this._cell?this._cell.icon:null}set icon(t){this._cell&&(this._cell.icon=t)}get cell(){return this._cell}get level(){return this._level}_setLevel(t){this._level=t}addChild(t){return this.addChildAt(t,this._children.length),t}addChildAt(t,e){if(!t)throw new Error("child is null");var i=this._children.length;if(e>=0&&e<=i){if(t._parent==this)this.setChildIndex(t,e);else t._parent&&t._parent.removeChild(t),e==this._children.length?this._children.push(t):this._children.splice(e,0,t),t._parent=this,t._level=this._level+1,t._setTree(this._tree),(this._tree&&this==this._tree.rootNode||this._cell&&this._cell.parent&&this._expanded)&&this._tree._afterInserted(t);return t}throw new RangeError("Invalid child index")}removeChild(t){var e=this._children.indexOf(t);return-1!=e&&this.removeChildAt(e),t}removeChildAt(t){if(t>=0&&t<this.numChildren){var e=this._children[t];return this._children.splice(t,1),e._parent=null,this._tree&&(e._setTree(null),this._tree._afterRemoved(e)),e}throw"Invalid child index"}removeChildren(t,e){t=t||0,null==e&&(e=-1),(e<0||e>=this.numChildren)&&(e=this.numChildren-1);for(var i=t;i<=e;++i)this.removeChildAt(t)}getChildAt(t){if(t>=0&&t<this.numChildren)return this._children[t];throw"Invalid child index"}getChildIndex(t){return this._children.indexOf(t)}getPrevSibling(){if(null==this._parent)return null;var t=this._parent._children.indexOf(this);return t<=0?null:this._parent._children[t-1]}getNextSibling(){if(null==this._parent)return null;var t=this._parent._children.indexOf(this);return t<0||t>=this._parent._children.length-1?null:this._parent._children[t+1]}setChildIndex(t,e){var i=this._children.indexOf(t);if(-1==i)throw"Not a child of this container";var s=this._children.length;e<0?e=0:e>s&&(e=s),i!=e&&(this._children.splice(i,1),this._children.splice(e,0,t),(this._tree&&this==this._tree.rootNode||this._cell&&this._cell.parent&&this._expanded)&&this._tree._afterMoved(t))}swapChildren(t,e){var i=this._children.indexOf(t),s=this._children.indexOf(e);if(-1==i||-1==s)throw"Not a child of this container";this.swapChildrenAt(i,s)}swapChildrenAt(t,e){var i=this._children[t],s=this._children[e];this.setChildIndex(i,e),this.setChildIndex(s,t)}get numChildren(){return this._children.length}expandToRoot(){for(var t=this;t;)t.expanded=!0,t=t.parent}get tree(){return this._tree}_setTree(t){if(this._tree=t,this._tree&&this._tree.treeNodeWillExpand&&this._expanded&&this._tree.treeNodeWillExpand(this,!0),this._children)for(var e=this._children.length,i=0;i<e;i++){var s=this._children[i];s._level=this._level+1,s._setTree(t)}}}var oh,lh=new Array;class _h extends rh{constructor(){super(),this._indent=15,this._rootNode=new nh(!0),this._rootNode._setTree(this),this._rootNode.expanded=!0}get rootNode(){return this._rootNode}get indent(){return this._indent}set indent(t){this._indent=t}get clickToExpand(){return this._clickToExpand}set clickToExpand(t){this._clickToExpand=t}getSelectedNode(){return-1!=this.selectedIndex?this.getChildAt(this.selectedIndex)._treeNode:null}getSelectedNodes(t){t||(t=new Array),lh.length=0,super.getSelection(lh);for(var e=lh.length,i=new Array,s=0;s<e;s++){var h=this.getChildAt(lh[s])._treeNode;i.push(h)}return i}selectNode(t,e){for(var i=t.parent;i&&i!=this._rootNode;)i.expanded=!0,i=i.parent;t._cell&&this.addSelection(this.getChildIndex(t._cell),e)}unselectNode(t){t._cell&&this.removeSelection(this.getChildIndex(t._cell))}expandAll(t){t||(t=this._rootNode),t.expanded=!0;for(var e=t.numChildren,i=0;i<e;i++){var s=t.getChildAt(i);s.isFolder&&this.expandAll(s)}}collapseAll(t){t||(t=this._rootNode),t!=this._rootNode&&(t.expanded=!1);for(var e=t.numChildren,i=0;i<e;i++){var s=t.getChildAt(i);s.isFolder&&this.collapseAll(s)}}createCell(t){var e=this.getFromPool(t._resURL?t._resURL:this.defaultItem);if(!e)throw new Error("cannot create tree node object.");e._treeNode=t,t._cell=e;var i,s=e.getChild("indent");s&&(s.width=(t.level-1)*this._indent),(i=e.getController("expanded"))&&(i.on("status_changed",this.__expandedStateChanged,this),i.selectedIndex=t.expanded?1:0),(i=e.getController("leaf"))&&(i.selectedIndex=t.isFolder?0:1),t.isFolder&&e.on("touch_begin",this.__cellMouseDown,this),this.treeNodeRender&&this.treeNodeRender(t,e)}_afterInserted(t){t._cell||this.createCell(t);var e=this.getInsertIndexForNode(t);this.addChildAt(t._cell,e),this.treeNodeRender&&this.treeNodeRender(t,t._cell),t.isFolder&&t.expanded&&this.checkChildren(t,e)}getInsertIndexForNode(t){var e=t.getPrevSibling();null==e&&(e=t.parent);for(var i=this.getChildIndex(e._cell)+1,s=t.level,h=this.numChildren,r=i;r<h;r++){if(this.getChildAt(r)._treeNode.level<=s)break;i++}return i}_afterRemoved(t){this.removeNode(t)}_afterExpanded(t){if(t!=this._rootNode){if(this.treeNodeWillExpand&&this.treeNodeWillExpand(t,!0),null!=t._cell){this.treeNodeRender&&this.treeNodeRender(t,t._cell);var e=t._cell.getController("expanded");e&&(e.selectedIndex=1),t._cell.parent&&this.checkChildren(t,this.getChildIndex(t._cell))}}else this.checkChildren(this._rootNode,0)}_afterCollapsed(t){if(t!=this._rootNode){if(this.treeNodeWillExpand&&this.treeNodeWillExpand(t,!1),null!=t._cell){this.treeNodeRender&&this.treeNodeRender(t,t._cell);var e=t._cell.getController("expanded");e&&(e.selectedIndex=0),t._cell.parent&&this.hideFolderNode(t)}}else this.checkChildren(this._rootNode,0)}_afterMoved(t){var e,i=this.getChildIndex(t._cell);e=t.isFolder?this.getFolderEndIndex(i,t.level):i+1;var s,h,r=this.getInsertIndexForNode(t),a=e-i;if(r<i)for(s=0;s<a;s++)h=this.getChildAt(i+s),this.setChildIndex(h,r+s);else for(s=0;s<a;s++)h=this.getChildAt(i),this.setChildIndex(h,r)}getFolderEndIndex(t,e){for(var i=this.numChildren,s=t+1;s<i;s++){if(this.getChildAt(s)._treeNode.level<=e)return s}return i}checkChildren(t,e){for(var i=t.numChildren,s=0;s<i;s++){e++;var h=t.getChildAt(s);null==h._cell&&this.createCell(h),h._cell.parent||this.addChildAt(h._cell,e),h.isFolder&&h.expanded&&(e=this.checkChildren(h,e))}return e}hideFolderNode(t){for(var e=t.numChildren,i=0;i<e;i++){var s=t.getChildAt(i);s._cell&&this.removeChild(s._cell),s.isFolder&&s.expanded&&this.hideFolderNode(s)}}removeNode(t){if(t._cell&&(t._cell.parent&&this.removeChild(t._cell),this.returnToPool(t._cell),t._cell._treeNode=null,t._cell=null),t.isFolder)for(var e=t.numChildren,i=0;i<e;i++){var s=t.getChildAt(i);this.removeNode(s)}}__cellMouseDown(t){var e=qt.cast(t.sender)._treeNode;this._expandedStatusInEvt=e.expanded}__expandedStateChanged(t){let e=t.sender;e.parent._treeNode.expanded=1==e.selectedIndex}dispatchItemEvent(t,e){if(0!=this._clickToExpand){var i=t._treeNode;i&&i.isFolder&&this._expandedStatusInEvt==i.expanded&&(2==this._clickToExpand?2==e.input.clickCount&&(i.expanded=!i.expanded):i.expanded=!i.expanded)}super.dispatchItemEvent(t,e)}setup_beforeAdd(t,e){super.setup_beforeAdd(t,e),t.seek(e,9),this._indent=t.readInt(),this._clickToExpand=t.readByte()}readItems(t){var e,i,s,h,r,a,n,o=0;for(e=t.readShort(),i=0;i<e;i++)if(s=t.readShort(),s+=t.pos,null!=(h=t.readS())||(h=this.defaultItem)){r=t.readBool(),n=t.readByte();var l=new nh(r,h);if(l.expanded=!0,0==i)this._rootNode.addChild(l);else if(n>o)a.addChild(l);else if(n<o){for(var _=n;_<=o;_++)a=a.parent;a.addChild(l)}else a.parent.addChild(l);a=l,o=n,this.setupItem(t,l.cell),t.pos=s}else t.pos=s}}class dh{static setExtension(t,e){if(null==t)throw new Error("Invaild url: "+t);var i=Fi.getItemByURL(t);i&&(i.extensionType=e),dh.extensions[t]=e}static setLoaderExtension(t){dh.loaderType=t}static resolveExtension(t){var e=dh.extensions["ui://"+t.owner.id+t.id];e||(e=dh.extensions["ui://"+t.owner.name+"/"+t.name]),e&&(t.extensionType=e)}static newObject(e,i){var s;if("number"==typeof e)switch(e){case t.ObjectType.Image:return new oi;case t.ObjectType.MovieClip:return new _i;case t.ObjectType.Component:return new us;case t.ObjectType.Text:return new Vs;case t.ObjectType.RichText:return new Ys;case t.ObjectType.InputText:return new Xs;case t.ObjectType.Group:return new ae;case t.ObjectType.List:return new rh;case t.ObjectType.Graph:return new We;case t.ObjectType.Loader:return dh.loaderType?new dh.loaderType:new Qs;case t.ObjectType.Button:return new $s;case t.ObjectType.Label:return new Ks;case t.ObjectType.ProgressBar:return new eh;case t.ObjectType.Slider:return new th;case t.ObjectType.ScrollBar:return new sh;case t.ObjectType.ComboBox:return new Zs;case t.ObjectType.Tree:return new _h;case t.ObjectType.Loader3D:return new qs;default:return null}else(s=e.type==t.PackageItemType.Component?i?new i:e.extensionType?new e.extensionType:dh.newObject(e.objectType):dh.newObject(e.objectType))&&(s.packageItem=e);return s}}dh.extensions={},Wi.UIObjectFactory=dh;class ch{constructor(){let t=this._agent=new Qs;t.draggable=!0,t.touchable=!1,t.setSize(100,100),t.setPivot(.5,.5,!0),t.align="center",t.verticalAlign="middle",t.sortingOrder=1e6,t.on("drag_end",this.__dragEnd,this)}static get inst(){return oh||(oh=new ch),oh}get dragAgent(){return this._agent}get dragging(){return null!=this._agent.parent}startDrag(t,e,i){if(!this._agent.parent){this._sourceData=e,this._agent.url=t,ps.inst.addChild(this._agent);var s=ps.inst.globalToLocal(j.touchPos.x,j.touchPos.y);this._agent.setPosition(s.x,s.y),this._agent.startDrag(null!=i?i:-1)}}cancel(){this._agent.parent&&(this._agent.stopDrag(),ps.inst.removeChild(this._agent),this._sourceData=null)}__dragEnd(t){if(null!=this._agent.parent){ps.inst.removeChild(this._agent);var e=this._sourceData;this._sourceData=null;for(var i=qt.cast(j.touchTarget);i;){if(i.hasListener("drop"))return void i.dispatchEvent("drop",e);i=i.parent}}}}class uh{constructor(t,e){this.packageItem=t,this.type=e}}t.AsyncOperation=class{constructor(){this._itemList=new Array,this._objectPool=[]}createObject(t,e){var i=Fi.getByName(t);if(!i)throw new Error("package not found: "+t);var s=i.getItemByName(e);if(!s)throw new Error("resource not found: "+e);this.internalCreateObject(s)}createObjectFromURL(t){var e=Fi.getItemByURL(t);if(!e)throw new Error("resource not found: "+t);this.internalCreateObject(e)}cancel(){if(k.remove(this.run,this),this._itemList.length=0,this._objectPool.length>0){for(var t=this._objectPool.length,e=0;e<t;e++)this._objectPool[e].dispose();this._objectPool.length=0}}internalCreateObject(e){this._itemList.length=0,this._objectPool.length=0;var i=new uh(e,t.ObjectType.Component);i.childCount=this.collectComponentChildren(e),this._itemList.push(i),this._index=0,k.addUpdate(this.run,this)}collectComponentChildren(e){var i,s,h,r,a,n,o=e.rawData;o.seek(0,2);var l=o.readShort();for(h=0;h<l;h++){r=o.readShort(),a=o.pos,o.seek(a,0);var _=o.readByte(),d=o.readS(),c=o.readS();o.pos=a,null!=d?(s=null!=(n=null!=c?Fi.getById(c):e.owner)?n.getItemById(d):null,i=new uh(s,_),null!=s&&s.type==t.PackageItemType.Component&&(i.childCount=this.collectComponentChildren(s))):(i=new uh(null,_),_==t.ObjectType.List&&(i.listItemCount=this.collectListChildren(o))),this._itemList.push(i),o.pos=a+r}return l}collectListChildren(e){e.seek(e.pos,8);var i,s,h,r,a,n=0,o=e.readS(),l=e.readShort();for(i=0;i<l;i++)s=e.readShort(),s+=e.pos,null==(h=e.readS())&&(h=o),h&&null!=(r=Fi.getItemByURL(h))&&(a=new uh(r,r.objectType),r.type==t.PackageItemType.Component&&(a.childCount=this.collectComponentChildren(r)),this._itemList.push(a),n++),e.pos=s;return n}run(){for(var e,i,s,h,r=performance.now(),a=Qt.frameTimeForAsyncUIConstruction,n=this._itemList.length;this._index<n;){if(null!=(i=this._itemList[this._index]).packageItem)e=dh.newObject(i.packageItem),this._objectPool.push(e),re.n++,i.packageItem.type==t.PackageItemType.Component?(s=this._objectPool.length-i.childCount-1,e.constructFromResource2(this._objectPool,s),this._objectPool.splice(s,i.childCount)):e.constructFromResource(),re.n--;else if(e=dh.newObject(i.type),this._objectPool.push(e),i.type==t.ObjectType.List&&i.listItemCount>0){for(s=this._objectPool.length-i.listItemCount-1,h=0;h<i.listItemCount;h++)e.itemPool.returnObject(this._objectPool[h+s]);this._objectPool.splice(s,i.listItemCount)}if(this._index++,this._index%5==0&&performance.now()-r>=a)return}k.remove(this.run,this);var o=this._objectPool[0];this._itemList.length=0,this._objectPool.length=0,null!=this.callback&&this.callback(o)}},t.ByteBuffer=wi,t.Color4=Xt,t.Controller=Yi,t.DisplayObject=ft,t.DragDropManager=ch,t.DynamicFont=zi,t.Event=S,t.EventDispatcher=I,t.FontManager=Bi,t.GButton=$s,t.GComboBox=Zs,t.GComponent=us,t.GGraph=We,t.GGroup=ae,t.GImage=oi,t.GLabel=Ks,t.GList=rh,t.GLoader=Qs,t.GLoader3D=qs,t.GMovieClip=_i,t.GObject=qt,t.GObjectPool=hh,t.GProgressBar=eh,t.GRichTextField=Ys,t.GRoot=ps,t.GScrollBar=sh,t.GSlider=th,t.GTextField=Vs,t.GTextInput=Xs,t.GTree=_h,t.GTreeNode=nh,t.GTween=Nt,t.GTweener=At,t.Image=qe,t.InputTextField=Fs,t.MovieClip=li,t.NGraphics=ye,t.NMaterial=me,t.NTexture=be,t.PackageItem=Mi,t.PopupMenu=class{constructor(e){if(!e&&!(e=Qt.popupMenu))throw"UIConfig.popupMenu not defined";this._contentPane=Fi.createObjectFromURL(e),this._contentPane.on("added_to_stage",this.__addedToStage,this),this._list=this._contentPane.getChild("list"),this._list.removeChildrenToPool(),this._list.addRelation(this._contentPane,t.RelationType.Width),this._list.removeRelation(this._contentPane,t.RelationType.Height),this._contentPane.addRelation(this._list,t.RelationType.Height),this._list.on("click_item",this.__clickItem,this)}dispose(){this._contentPane.dispose()}addItem(t,e){var i=this._list.addItemFromPool();i.title=t,i.data=e,i.grayed=!1;var s=i.getController("checked");return s&&(s.selectedIndex=0),i}addItemAt(t,e,i){var s=this._list.getFromPool();this._list.addChildAt(s,e),s.title=t,s.data=i,s.grayed=!1;var h=s.getController("checked");return h&&(h.selectedIndex=0),s}addSeperator(){if(null==Qt.popupMenu_seperator)throw"UIConfig.popupMenu_seperator not defined";this.list.addItemFromPool(Qt.popupMenu_seperator)}getItemName(t){return this._list.getChildAt(t).name}setItemText(t,e){this._list.getChild(t).title=e}setItemVisible(t,e){var i=this._list.getChild(t);i.visible!=e&&(i.visible=e,this._list.setBoundsChangedFlag())}setItemGrayed(t,e){this._list.getChild(t).grayed=e}setItemCheckable(t,e){var i=this._list.getChild(t).getController("checked");i&&(e?0==i.selectedIndex&&(i.selectedIndex=1):i.selectedIndex=0)}setItemChecked(t,e){var i=this._list.getChild(t).getController("checked");i&&(i.selectedIndex=e?2:1)}isItemChecked(t){var e=this._list.getChild(t).getController("checked");return!!e&&2==e.selectedIndex}removeItem(t){var e=this._list.getChild(t);if(e){var i=this._list.getChildIndex(e);return this._list.removeChildToPoolAt(i),!0}return!1}clearItems(){this._list.removeChildrenToPool()}get itemCount(){return this._list.numChildren}get contentPane(){return this._contentPane}get list(){return this._list}show(t,e){ps.findFor(t).showPopup(this.contentPane,t instanceof ps?null:t,e)}__clickItem(t){let e=t.data;if(e instanceof $s)if(e.grayed)this._list.selectedIndex=-1;else{var i=e.getController("checked");i&&0!=i.selectedIndex&&(1==i.selectedIndex?i.selectedIndex=2:i.selectedIndex=1),this._contentPane.parent.hidePopup(this.contentPane),e.data&&e.data()}}__addedToStage(){this._list.selectedIndex=-1,this._list.resizeToFit(1e5,10)}},t.Rect=P,t.RichTextField=Us,t.ScrollPane=ts,t.Shape=Ee,t.Stage=j,t.TextField=Ts,t.TextFormat=fs,t.Timers=k,t.Transition=hs,t.TranslationHelper=os,t.UBBParser=Ls,t.UIConfig=Qt,t.UIContentScaler=xi,t.UIObjectFactory=dh,t.UIPackage=Fi,t.Window=gs,t.clamp=le,t.clamp01=_e,t.convertFromHtmlColor=oe,t.convertToHtmlColor=ne,t.distance=ue,t.lerp=de,t.repeat=ce,Object.defineProperty(t,"__esModule",{value:!0})}));