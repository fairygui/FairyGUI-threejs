"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _get(t,e,i){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var s=_superPropBase(t,e);if(s){var n=Object.getOwnPropertyDescriptor(s,e);return n.get?n.get.call(i):n.value}})(t,e,i||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(t){var e=_isNativeReflectConstruct();return function(){var i,s=_getPrototypeOf(t);if(e){var n=_getPrototypeOf(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}window.fgui={},window.THREE=require("three"),function(t){var e=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"run",value:function(t,e,i){this.fromPage&&0!=this.fromPage.length&&-1==this.fromPage.indexOf(e)||this.toPage&&0!=this.toPage.length&&-1==this.toPage.indexOf(i)?this.leave(t):this.enter(t)}},{key:"enter",value:function(t){}},{key:"leave",value:function(t){}},{key:"setup",value:function(t){var e,i;for(e=t.readShort(),this.fromPage=[],i=0;i<e;i++)this.fromPage[i]=t.readS();for(e=t.readShort(),this.toPage=[],i=0;i<e;i++)this.toPage[i]=t.readS()}}]),t}();t.ControllerAction=e}(fgui||(fgui={})),function(t){var e=function(t){_inherits(i,t);var e=_createSuper(i);function i(){return _classCallCheck(this,i),e.call(this)}return _createClass(i,[{key:"enter",value:function(t){var e;if(this.controllerName&&(e=this.objectId?t.parent.getChildById(this.objectId):t.parent)){var i=e.getController(this.controllerName);i&&i!=t&&!i.changing&&("~1"==this.targetPage?t.selectedIndex<i.pageCount&&(i.selectedIndex=t.selectedIndex):"~2"==this.targetPage?i.selectedPage=t.selectedPage:i.selectedPageId=this.targetPage)}}},{key:"setup",value:function(t){_get(_getPrototypeOf(i.prototype),"setup",this).call(this,t),this.objectId=t.readS(),this.controllerName=t.readS(),this.targetPage=t.readS()}}]),i}(t.ControllerAction);t.ChangePageAction=e}(fgui||(fgui={})),function(t){var e=function(t){_inherits(i,t);var e=_createSuper(i);function i(){var t;return _classCallCheck(this,i),(t=e.call(this)).playTimes=1,t.delay=0,t}return _createClass(i,[{key:"enter",value:function(t){var e=t.parent.getTransition(this.transitionName);e&&(this._currentTransition&&this._currentTransition.playing?e.changePlayTimes(this.playTimes):e.play(null,this.playTimes,this.delay),this._currentTransition=e)}},{key:"leave",value:function(t){this.stopOnExit&&this._currentTransition&&(this._currentTransition.stop(),this._currentTransition=null)}},{key:"setup",value:function(t){_get(_getPrototypeOf(i.prototype),"setup",this).call(this,t),this.transitionName=t.readS(),this.playTimes=t.readInt(),this.delay=t.readFloat(),this.stopOnExit=t.readBool()}}]),i}(t.ControllerAction);t.PlayTransitionAction=e}(fgui||(fgui={})),function(t){t.Decls={}}(fgui||(fgui={})),function(t){var e=function(){function e(){_classCallCheck(this,e),this._listeners={}}return _createClass(e,[{key:"on",value:function(t,e,i,s){var n=this._listeners[t];n||(n={dispatching:0,callbacks:[],captures:[]},this._listeners[t]=n);var r=s?n.captures:n.callbacks,a=r.findIndex((function(t,s,n){return t==e&&n[s+1]==i}));-1!=a?r[a+2]=!1:r.push(e,i,!1)}},{key:"off",value:function(t,e,i,s){var n=this._listeners[t];if(n){var r=s?n.captures:n.callbacks,a=r.findIndex((function(t,s,n){return t==e&&n[s+1]==i}));-1!=a&&(0!=n.dispatching?(r[a+2]=!0,n.dispatching=2):r.splice(a,3))}}},{key:"offAll",value:function(t){if(t){var e=this._listeners[t];e&&(0!=e.dispatching?(e.callbacks.forEach((function(t,e,i){return i[e+2]=!0})),e.captures.forEach((function(t,e,i){return i[e+2]=!0})),e.dispatching=2):(e.callbacks.length=0,e.captures.length=0))}else for(var i in this._listeners)delete this._listeners[i]}},{key:"hasListener",value:function(t,e,i,s){var n=this._listeners[t];if(!n)return!1;var r=s?n.captures:n.callbacks;if(!e)return r.length>0;r.findIndex((function(t,s,n){return t==e&&n[s+1]==i}))}},{key:"dispatchEvent",value:function(e,i){var s=this._listeners[e];if(s&&(0!=s.callbacks.length||0!=s.captures.length)){var n=t.EventPool.borrow(e);return n._type=e,n.data=i,this._dispatch(s,n,!0),this._dispatch(s,n,!1),t.EventPool.returns(n),n._defaultPrevented}}},{key:"_dispatch",value:function(t,e,i){if(0==t.dispatching){t.dispatching=1,e._sender=this;for(var s=i?t.captures:t.callbacks,n=s.length,r=0;r<n;r+=3)s[r].call(s[r+1],e);if(2==t.dispatching)for(var a=s.length,o=0;o<a;)s[o+2]?(s.splice(o,3),a-=3):o+=3;t.dispatching=0}}}]),e}();t.EventDispatcher=e}(fgui||(fgui={})),function(t){var e=function(){function t(e,i,s,n){_classCallCheck(this,t),this.x=e||0,this.y=i||0,this.width=s||0,this.height=n||0}return _createClass(t,[{key:"set",value:function(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s}},{key:"setMinMax",value:function(t,e,i,s){this.x=t,this.y=e,this.width=i-t,this.height=s-e}},{key:"intersection",value:function(e){if(0==this.width||0==this.height||0==e.width||0==e.height)return new t(0,0,0,0);var i=this.x>e.x?this.x:e.x,s=this.xMax<e.xMax?this.xMax:e.xMax,n=this.y>e.y?this.y:e.y,r=this.yMax<e.yMax?this.yMax:e.yMax;return i>s||n>r?this.set(0,0,0,0):this.setMinMax(i,n,s,r),this}},{key:"union",value:function(t){if(0==t.width||0==t.height)return this;if(0==this.width||0==this.height)return this.copy(t),this;var e=Math.min(this.x,t.x),i=Math.min(this.y,t.y);return this.setMinMax(e,i,Math.max(this.xMax,t.xMax),Math.max(this.yMax,t.yMax)),this}},{key:"extend",value:function(t,e){this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e}},{key:"contains",value:function(t,e){return t&&t.isVector2&&(e=t.y,t=t.x),t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}},{key:"copy",value:function(t){this.set(t.x,t.y,t.width,t.height)}},{key:"clone",value:function(){return new t(this.x,this.y,this.width,this.height)}},{key:"position",get:function(){return new THREE.Vector2(this.x,this.y)}},{key:"size",get:function(){return new THREE.Vector2(this.width,this.height)}},{key:"xMin",get:function(){return this.x},set:function(t){var e=t-this.x;this.x=t,this.width-=e}},{key:"xMax",get:function(){return this.x+this.width},set:function(t){this.width=t-this.x}},{key:"yMin",get:function(){return this.y},set:function(t){var e=t-this.y;this.y=t,this.height-=e}},{key:"yMax",get:function(){return this.y+this.height},set:function(t){this.height=t-this.y}}]),t}();t.Rect=e}(fgui||(fgui={})),function(t){var e=function(e){_inherits(d,e);var _=_createSuper(d);function d(){var e;return _classCallCheck(this,d),(e=_.call(this))._obj3D=new THREE.Object3D,e._obj3D.isGroup=!0,e._obj3D.$owner=_assertThisInitialized(e),e._obj3D.layers.set(t.UILayer),e._pos=e._obj3D.position,e._rot=e._obj3D.rotation,e._pivot=new THREE.Vector2,e._pivotOffset=new THREE.Vector3,e._contentRect=new t.Rect,e._alpha=1,e._touchable=!0,e}return _createClass(d,[{key:"setPosition",value:function(t,e,i,s){i=i||0,s&&(t-=this._pivotOffset.x,e+=this._pivotOffset.y,i-=this._pivotOffset.z),this._matrixDirty=!0,this._pos.set(t,-e,i)}},{key:"setSize",value:function(t,e){t==this._contentRect.width&&e==this._contentRect.height||(this._contentRect.width=t,this._contentRect.height=e,this.onSizeChanged())}},{key:"ensureSizeCorrect",value:function(){}},{key:"onSizeChanged",value:function(){this.applyPivot(),this._graphics&&this._graphics.setDrawRect(this._contentRect)}},{key:"setPivot",value:function(t,e){if(this._pivot.x!=t||this._pivot.y!=e){var s=(t-this._pivot.x)*this._contentRect.width,n=(this._pivot.y-e)*this._contentRect.height;i.copy(this._pivotOffset),this._pivot.set(t,e),this.updatePivotOffset(),this._pos.x+=i.x-this._pivotOffset.x+s,this._pos.y+=i.y-this._pivotOffset.y+n,this._pos.y+=i.z-this._pivotOffset.z,this._matrixDirty=!0}}},{key:"updatePivotOffset",value:function(){var t=this._pivot.x*this._contentRect.width,e=this._pivot.y*this._contentRect.height;h.setFromEuler(this._rot),o.compose(s,h,this._obj3D.scale),this._pivotOffset.set(t,-e,0),this._pivotOffset.applyMatrix4(o)}},{key:"applyPivot",value:function(){0==this._pivot.x&&0==this._pivot.y||(i.copy(this._pivotOffset),this.updatePivotOffset(),this._pos.x+=i.x-this._pivotOffset.x,this._pos.y+=i.y-this._pivotOffset.y,this._matrixDirty=!0)}},{key:"setScale",value:function(t,e){this._obj3D.scale.set(t,e,t),this.applyPivot(),this._matrixDirty=!0}},{key:"setLayer",value:function(t){this._obj3D.traverse((function(e){return e.layers.set(t)}))}},{key:"validateMatrix",value:function(){this._obj3D.traverseAncestors((function(t){var e=t.$owner;e&&e._matrixDirty&&(e._matrixDirty=!1,e._obj3D.updateMatrixWorld(!0))})),this._matrixDirty&&(this._matrixDirty=!1,this._obj3D.updateMatrixWorld(!0))}},{key:"_getRenderCamera",value:function(){for(var e=this._obj3D;e;){var i=e.$owner;if(i&&i.camera)return i.camera;e=e.parent}return t.Stage.camera}},{key:"worldToLocal",value:function(t,e,i){if(i&&this.validateMatrix(),0!=(t=this._obj3D.worldToLocal(t)).z){l.copy(e||u),l.applyQuaternion(this._obj3D.getWorldQuaternion(h).inverse()).normalize();var s=-t.dot(u)/l.dot(u);t.add(l.multiplyScalar(s))}return t.y=-t.y,t}},{key:"localToWorld",value:function(t,e){return e&&this.validateMatrix(),t.y=-t.y,t=this._obj3D.localToWorld(t)}},{key:"globalToLocal",value:function(e,s,n){return t.Stage.disableMatrixValidation||this.validateMatrix(),t.screenToWorld(this._getRenderCamera(),e,s,i,l),this.worldToLocal(i,l),n||(n=new THREE.Vector2),n.set(i.x,i.y),n}},{key:"localToGlobal",value:function(e,s,n){return t.Stage.disableMatrixValidation||this.validateMatrix(),i.set(e,-s,0),this._obj3D.localToWorld(i),n||(n=new THREE.Vector2),t.worldToScreen(this._getRenderCamera(),i,n),n}},{key:"getBounds",value:function(e,i){return this.ensureSizeCorrect(),i||(i=new t.Rect),e==this._obj3D?i.copy(this._contentRect):e==this._obj3D.parent&&0==this._rot.z?i.set(this._pos.x,-this._pos.y,this._contentRect.width*this._obj3D.scale.x,this._contentRect.height*this._obj3D.scale.y):i=this.transformRect(this._contentRect,e,i),i}},{key:"transformPoint",value:function(e,s,n,r){return r||(r=new THREE.Vector2),n==this._obj3D?r.set(e,s):(t.Stage.disableMatrixValidation||this.validateMatrix(),i.set(e,-s,0),this._obj3D.localToWorld(i),n&&n.worldToLocal(i),r.set(i.x,-i.y)),r}},{key:"transformRect",value:function(e,i,s){if(s||(s=new t.Rect),i==this._obj3D)return s.copy(e),s;if(i&&i==this._obj3D.parent&&0==this._rot.z){var r=this._obj3D.scale;s.set((this._pos.x+e.x)*r.x,(this.y+e.y)*r.y,e.width*r.x,e.height*r.y)}else n.set(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),t.Stage.disableMatrixValidation||this.validateMatrix(),this.transformRectPoint(e.x,e.y,i),this.transformRectPoint(e.xMax,e.y,i),this.transformRectPoint(e.x,e.yMax,i),this.transformRectPoint(e.xMax,e.yMax,i),s.setMinMax(n.x,n.y,n.z,n.w);return s}},{key:"transformRectPoint",value:function(t,e,s){i.set(t,e,0),this.localToWorld(i),s&&s.worldToLocal(i),n.x>i.x&&(n.x=i.x),n.z<i.x&&(n.z=i.x),n.y>i.y&&(n.y=i.y),n.w<i.y&&(n.w=i.y)}},{key:"addChild",value:function(t){this.addChildAt(t,Number.POSITIVE_INFINITY)}},{key:"addChildAt",value:function(e,i){if(e._obj3D.parent){var s=e._obj3D.parent.children.indexOf(e._obj3D);e._obj3D.parent.children.splice(s,1)}i>=this._obj3D.children.length?this._obj3D.children.push(e._obj3D):this._obj3D.children.splice(i,0,e._obj3D),e._obj3D.parent=this._obj3D,e._obj3D.layers.mask=this._obj3D.layers.mask,this.stage&&t.broadcastEvent(e.obj3D,"added_to_stage")}},{key:"removeChild",value:function(t){var e=this._obj3D.children.indexOf(t._obj3D);if(-1==e)throw"not a child";this.removeChildAt(e)}},{key:"removeChildAt",value:function(e){var i=this._obj3D.children[e];this.stage&&t.broadcastEvent(i,"removed_from_stage"),this._obj3D.children.splice(e,1),i.parent=null}},{key:"setChildIndex",value:function(t,e){var i=this._obj3D.children.indexOf(t._obj3D);if(i!=e){if(-1==i)throw"Not a child";this._obj3D.children.splice(i,1),e>=this._obj3D.children.length?this._obj3D.children.push(t._obj3D):this._obj3D.children.splice(e,0,t._obj3D)}}},{key:"getIndex",value:function(t){return this._obj3D.children.indexOf(t._obj3D)}},{key:"update",value:function(t,e){this._clipRect&&(this.transformRect(this._clipRect,null,r),t&&(a.setMinMax(-t[0].constant,-t[3].constant,t[1].constant,t[2].constant),r.intersection(a)),this._clipPlanes||(this._clipPlanes=[new THREE.Plane(new THREE.Vector3(1,0,0)),new THREE.Plane(new THREE.Vector3(-1,0,0)),new THREE.Plane(new THREE.Vector3(0,-1,0)),new THREE.Plane(new THREE.Vector3(0,1,0))]),(t=this._clipPlanes)[0].constant=-r.x,t[1].constant=r.xMax,t[2].constant=r.yMax,t[3].constant=-r.y),this._graphics&&this._graphics.update(t,this._alpha*e)}},{key:"hitTest",value:function(t){if(0==this._obj3D.scale.x||0==this._obj3D.scale.y)return null;var e,i;this.camera&&(e=t.ray,t.camera=this.camera);var s=t.getLocal(this),n=s.x,r=s.y;if(this.hitArea){if(!this.hitArea.hitTest(this._contentRect,n,r))return null}else if(this._clipRect&&!this._clipRect.contains(n,r))return null;if(this.mask){var a=this.mask.visible?this.mask.hitTest(t):null;if(!this.reversedMask&&!a||this.reversedMask&&a)return null}return!(i=c(this._obj3D,t,this.mask))&&this.opaque&&(this.hitArea||this._contentRect.contains(n,r))&&(i=this),e&&(t.ray=e),i}},{key:"dispose",value:function(){}},{key:"obj3D",get:function(){return this._obj3D}},{key:"name",get:function(){return this._obj3D.name},set:function(t){this._obj3D.name=t}},{key:"x",get:function(){return this._pos.x},set:function(t){this.setPosition(t,-this._pos.y,this._pos.z)}},{key:"y",get:function(){return-this._pos.y},set:function(t){this.setPosition(this._pos.x,t,this._pos.z)}},{key:"z",get:function(){return this._pos.z},set:function(t){this.setPosition(this._pos.x,-this._pos.y,t)}},{key:"width",get:function(){return this.ensureSizeCorrect(),this._contentRect.width},set:function(t){this._contentRect.width!=t&&(this._contentRect.width=t,this.onSizeChanged())}},{key:"height",get:function(){return this.ensureSizeCorrect(),this._contentRect.height},set:function(t){this._contentRect.height!=t&&(this._contentRect.height=t,this.onSizeChanged())}},{key:"pivotX",get:function(){return this._pivot.x},set:function(t){this.setPivot(t,this._pivot.y)}},{key:"pivotY",get:function(){return this._pivot.y},set:function(t){this.setPosition(this._pivot.x,t)}},{key:"scaleX",get:function(){return this._obj3D.scale.x},set:function(t){this.setScale(t,this._obj3D.scale.y)}},{key:"scaleY",get:function(){return this._obj3D.scale.y},set:function(t){this.setScale(this._obj3D.scale.x,t)}},{key:"rotationX",get:function(){return 180*this._rot.x/Math.PI},set:function(t){this._rot.x=t*Math.PI/180,this.applyPivot(),this._matrixDirty=!0}},{key:"rotationY",get:function(){return 180*this._rot.y/Math.PI},set:function(t){this._rot.y=t*Math.PI/180,this.applyPivot(),this._matrixDirty=!0}},{key:"rotation",get:function(){return 180*-this._rot.z/Math.PI},set:function(t){this._rot.z=-t*Math.PI/180,this.applyPivot(),this._matrixDirty=!0}},{key:"parent",get:function(){return this._obj3D.parent}},{key:"stage",get:function(){for(var t=this._obj3D;t.parent;)t=t.parent;return t.isScene}},{key:"graphics",get:function(){return this._graphics}},{key:"alpha",get:function(){return this._alpha},set:function(t){this._alpha=t}},{key:"touchable",get:function(){return this._touchable},set:function(t){this._touchable=t}},{key:"visible",get:function(){return this._obj3D.visible},set:function(t){this._obj3D.visible=t}},{key:"color",get:function(){return this._graphics?this._graphics.color:0},set:function(t){this._graphics&&(this._graphics.color=t)}},{key:"blendMode",get:function(){return this._graphics?this._graphics.material.blending:THREE.NormalBlending},set:function(t){this._graphics&&(this._graphics.material.blending=t)}},{key:"numChildren",get:function(){return this._obj3D.children.length}},{key:"clipRect",get:function(){return this._clipRect},set:function(t){this._clipRect=t}}]),d}(t.EventDispatcher);t.DisplayObject=e;var i=new THREE.Vector3,s=new THREE.Vector3,n=new THREE.Vector4,r=new t.Rect,a=new t.Rect,o=new THREE.Matrix4,h=new THREE.Quaternion,l=new THREE.Vector3,u=new THREE.Vector3(0,0,1);function c(t,e,i){for(var s=t.children.length-1;s>=0;--s){var n=t.children[s];if(n.visible){var r=n.$owner;if(r){if(r==i||r._touchDisabled)continue;if(!e.forTouch||r._touchable){var a=r.hitTest(e);if(a)return a}}if(n.children.length>0){var o=c(n,e);if(o)return o}}}}t.traverseUpdate=function t(e,i,s){var n=e.children,r=n.length,a=e.$owner;a&&(a._clipRect&&(i=a._clipPlanes),s*=a.alpha);for(var o=0;o<r;o++){var h=n[o];(a=h.$owner)&&a.update(i,s),h.children.length>0&&t(h,i,s)}},t.traverseHitTest=c}(fgui||(fgui={})),function(t){var e=function(e){_inherits(f,e);var g=_createSuper(f);function f(){var e;return _classCallCheck(this,f),(e=g.call(this))._tileGridIndice=0,e._graphics=new t.NGraphics(e._obj3D),e._graphics.meshFactory=_assertThisInitialized(e),e._textureScale=new THREE.Vector2(1,1),e}return _createClass(f,[{key:"onPopulateMesh",value:function(e){this._fillMesh&&this._fillMesh.method!=t.FillMethod.None?this._fillMesh.onPopulateMesh(e):this._scaleByTile?(l.copy(e.contentRect),l.width*=this._textureScale.x,l.height*=this._textureScale.y,this.tileFill(e,l,e.uvRect,this._graphics.texture.width,this._graphics.texture.height),e.addTriangles()):this._scale9Grid?this.sliceFill(e):this._graphics.onPopulateMesh(e)}},{key:"sliceFill",value:function(e){var _=this.texture;h.copy(this._scale9Grid),l.copy(e.contentRect),l.width*=this._textureScale.x,l.height*=this._textureScale.y;var d=e.uvRect,g=_.width,f=_.height,p=this._graphics.flip;p!=t.FlipType.None&&(p!=t.FlipType.Horizontal&&p!=t.FlipType.Both||(h.x=g-h.xMax,h.xMax=h.x+h.width),p!=t.FlipType.Vertical&&p!=t.FlipType.Both||(h.y=f-h.yMax,h.yMax=h.y+h.height));var y=d.width/g,v=d.height/f,m=d.xMax,w=d.yMax,k=h.xMax,x=h.yMax;if(a[0]=d.x,a[1]=d.x+h.x*y,a[2]=d.x+k*y,a[3]=m,o[0]=w,o[1]=w-h.y*v,o[2]=w-x*v,o[3]=d.y,l.width>=g-h.width)n[1]=h.x,n[2]=l.width-(g-k),n[3]=l.width;else{var C=h.x/(g-k);C=l.width*C/(1+C),n[1]=C,n[2]=C,n[3]=l.width}if(l.height>=f-h.height)r[1]=h.y,r[2]=l.height-(f-x),r[3]=l.height;else{var b=h.y/(f-x);b=l.height*b/(1+b),r[1]=b,r[2]=b,r[3]=l.height}if(0==this._tileGridIndice){for(var T=0;T<4;T++)for(var S=0;S<4;S++)e.addVert(n[S]/this._textureScale.x,r[T]/this._textureScale.y,0,a[S],o[T],e.vertexColor);e.addTriangles(0,i)}else{for(var I,P,M,O=0;O<9;O++)P=O%3,I=O/3,M=s[O],u.setMinMax(n[P],r[I],n[P+1],r[I+1]),c.setMinMax(a[P],o[I+1],a[P+1],o[I]),-1!=M&&0!=(this._tileGridIndice&1<<M)?this.tileFill(e,u,c,0==M||1==M||4==M?h.width:u.width,2==M||3==M||4==M?h.height:u.height):(u.x/=this._textureScale.x,u.y/=this._textureScale.y,u.width/=this._textureScale.x,u.height/=this._textureScale.y,e.addQuad(u,c,e.vertexColor));e.addTriangles()}}},{key:"tileFill",value:function(e,i,s,n,r){for(var a=Math.ceil(i.width/n),o=Math.ceil(i.height/r),h=i.width-(a-1)*n,l=i.height-(o-1)*r,u=s.xMax,c=s.yMax,g=0;g<a;g++)for(var f=0;f<o;f++)d.copy(s),g==a-1&&(d.xMax=t.lerp(s.x,u,h/n)),f==o-1&&(d.yMin=t.lerp(s.y,c,1-l/r)),_.set(i.x+g*n,i.y+f*r,g==a-1?h:n,f==o-1?l:r),_.x/=this._textureScale.x,_.y/=this._textureScale.y,_.width/=this._textureScale.x,_.height/=this._textureScale.y,e.addQuad(_,d,e.vertexColor)}},{key:"texture",get:function(){return this._graphics.texture},set:function(t){this._graphics.texture=t}},{key:"textureScale",get:function(){return this._textureScale},set:function(t){this._textureScale.equals(t)||(this._textureScale.copy(t),this._graphics.setMeshDirty())}},{key:"scale9Grid",get:function(){return this._scale9Grid},set:function(t){this._scale9Grid=t,this._graphics.setMeshDirty()}},{key:"scaleByTile",get:function(){return this._scaleByTile},set:function(t){this._scaleByTile!=t&&(this._scaleByTile=t,this._graphics.setMeshDirty())}},{key:"tileGridIndice",get:function(){return this._tileGridIndice},set:function(t){this._tileGridIndice!=t&&(this._tileGridIndice=t,this._graphics.setMeshDirty())}},{key:"fillMethod",get:function(){return this._fillMesh?this._fillMesh.method:t.FillMethod.None},set:function(e){if(!this._fillMesh){if(e==t.FillMethod.None)return;this._fillMesh=new t.FillMesh}this._fillMesh.method!=e&&(this._fillMesh.method=e,this._graphics.setMeshDirty())}},{key:"fillOrigin",get:function(){return this._fillMesh?this._fillMesh.origin:0},set:function(e){this._fillMesh||(this._fillMesh=new t.FillMesh),this._fillMesh.origin!=e&&(this._fillMesh.origin=e,this._graphics.setMeshDirty())}},{key:"fillClockwise",get:function(){return!this._fillMesh||this._fillMesh.clockwise},set:function(e){this._fillMesh||(this._fillMesh=new t.FillMesh),this._fillMesh.clockwise!=e&&(this._fillMesh.clockwise=e,this._graphics.setMeshDirty())}},{key:"fillAmount",get:function(){return this._fillMesh?this._fillMesh.amount:0},set:function(e){this._fillMesh||(this._fillMesh=new t.FillMesh),this._fillMesh.amount!=e&&(this._fillMesh.amount=e,this._graphics.setMeshDirty())}}]),f}(t.DisplayObject);t.Image=e;var i=[4,1,0,1,4,5,5,2,1,2,5,6,6,3,2,3,6,7,8,5,4,5,8,9,9,6,5,6,9,10,10,7,6,7,10,11,12,9,8,9,12,13,13,10,9,10,13,14,14,11,10,11,14,15],s=[-1,0,-1,2,4,3,-1,1,-1],n=[0,0,0,0],r=[0,0,0,0],a=[0,0,0,0],o=[0,0,0,0],h=new t.Rect,l=new t.Rect,u=new t.Rect,c=new t.Rect,_=new t.Rect,d=new t.Rect}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(){var t;return _classCallCheck(this,s),(t=i.call(this)).interval=0,t.swing=!1,t.repeatDelay=0,t.timeScale=1,t._playing=!0,t._frameCount=0,t._frame=0,t._start=0,t._end=0,t._times=0,t._endAt=0,t._status=0,t._frameElapsed=0,t._reversed=!1,t._repeatedCount=0,t.setPlaySettings(),t.on("added_to_stage",t.__addToStage,_assertThisInitialized(t)),t.on("removed_from_stage",t.__removeFromStage,_assertThisInitialized(t)),t}return _createClass(s,[{key:"rewind",value:function(){this._frame=0,this._frameElapsed=0,this._reversed=!1,this._repeatedCount=0,this.drawFrame()}},{key:"syncStatus",value:function(t){this._frame=t._frame,this._frameElapsed=t._frameElapsed,this._reversed=t._reversed,this._repeatedCount=t._repeatedCount,this.drawFrame()}},{key:"advance",value:function(t){for(var e=this._frame,i=this._reversed,s=t;;){var n=this.interval+(this._frames[this._frame].addDelay||0);if(0==this._frame&&this._repeatedCount>0&&(n+=this.repeatDelay),t<n){this._frameElapsed=0;break}if(t-=n,this.swing?this._reversed?(this._frame--,this._frame<=0&&(this._frame=0,this._repeatedCount++,this._reversed=!this._reversed)):(this._frame++,this._frame>this._frameCount-1&&(this._frame=Math.max(0,this._frameCount-2),this._repeatedCount++,this._reversed=!this._reversed)):(this._frame++,this._frame>this._frameCount-1&&(this._frame=0,this._repeatedCount++)),this._frame==e&&this._reversed==i){var r=s-t;t-=Math.floor(t/r)*r}}this.drawFrame()}},{key:"setPlaySettings",value:function(t,e,i,s){this._start=t||0,this._end=e||-1,(-1==this._end||this._end>this._frameCount-1)&&(this._end=this._frameCount-1),this._times=i||0,this._endAt=s||-1,-1==this._endAt&&(this._endAt=this._end),this._status=0,this.frame=this._start}},{key:"onTimer",value:function(){if(this._playing&&0!=this._frameCount&&3!=this._status){var e=t.Timers.deltaTime;e>100&&(e=100),1!=this.timeScale&&(e*=this.timeScale),this._frameElapsed+=e;var i=this.interval+(this._frames[this._frame].addDelay||0);0==this._frame&&this._repeatedCount>0&&(i+=this.repeatDelay),this._frameElapsed<i||(this._frameElapsed-=i,this._frameElapsed>this.interval&&(this._frameElapsed=this.interval),this.swing?this._reversed?(this._frame--,this._frame<=0&&(this._frame=0,this._repeatedCount++,this._reversed=!this._reversed)):(this._frame++,this._frame>this._frameCount-1&&(this._frame=Math.max(0,this._frameCount-2),this._repeatedCount++,this._reversed=!this._reversed)):(this._frame++,this._frame>this._frameCount-1&&(this._frame=0,this._repeatedCount++)),1==this._status?(this._frame=this._start,this._frameElapsed=0,this._status=0):2==this._status?(this._frame=this._endAt,this._frameElapsed=0,this._status=3,this.dispatchEvent("play_end")):this._frame==this._end&&(this._times>0?(this._times--,0==this._times?this._status=2:this._status=1):this._status=1),this.drawFrame())}}},{key:"drawFrame",value:function(){if(this._frameCount>0&&this._frame<this._frames.length){var t=this._frames[this._frame];this._graphics.texture=t.texture}else this._graphics.texture=null}},{key:"checkTimer",value:function(){this._playing&&this._frameCount>0&&this.stage?t.Timers.addUpdate(this.onTimer,this):t.Timers.remove(this.onTimer,this)}},{key:"__addToStage",value:function(){this._playing&&this._frameCount>0&&t.Timers.addUpdate(this.onTimer,this)}},{key:"__removeFromStage",value:function(){t.Timers.remove(this.onTimer,this)}},{key:"frames",get:function(){return this._frames},set:function(t){this._frames=t,this._scaleByTile=!1,this._scale9Grid=null,this._frames?(this._frameCount=this._frames.length,(-1==this._end||this._end>this._frameCount-1)&&(this._end=this._frameCount-1),(-1==this._endAt||this._endAt>this._frameCount-1)&&(this._endAt=this._frameCount-1),(this._frame<0||this._frame>this._frameCount-1)&&(this._frame=this._frameCount-1),this._frameElapsed=0,this._repeatedCount=0,this._reversed=!1):this._frameCount=0,this.drawFrame(),this.checkTimer()}},{key:"frameCount",get:function(){return this._frameCount}},{key:"frame",get:function(){return this._frame},set:function(t){this._frame!=t&&(this._frames&&t>=this._frameCount&&(t=this._frameCount-1),this._frame=t,this._frameElapsed=0,this.drawFrame())}},{key:"playing",get:function(){return this._playing},set:function(t){this._playing!=t&&(this._playing=t,this.checkTimer())}}]),s}(t.Image);t.MovieClip=e}(fgui||(fgui={})),function(t){var e=function(t){_inherits(i,THREE.Color);var e=_createSuper(i);function i(t,s){var n;return _classCallCheck(this,i),(n=e.call(this,t||0)).a=null!=s?s:1,n}return i}();t.Color4=e}(fgui||(fgui={})),function(t){var e=function(){function e(i){_classCallCheck(this,e),this._flip=0,this._color=16777215,this._contentRect=new t.Rect,this._material=new t.NMaterial,this._geometry=new THREE.BufferGeometry;var s=i;s.geometry=this._geometry,s.material=this._material,s.isMesh=!0,s.drawMode=THREE.TrianglesDrawMode,delete s.isGroup}return _createClass(e,[{key:"getMeshFactory",value:function(t){return this._meshFactory instanceof t||(this._meshFactory=new t,this._meshDirty=!0),this._meshFactory}},{key:"setDrawRect",value:function(t){this._contentRect.copy(t),this._meshDirty=!0}},{key:"setKeyword",value:function(t,e){e?(this._material.defines[t]=e,this._material.needsUpdate=!0):delete this._material.defines[t]}},{key:"setMeshDirty",value:function(){this._meshDirty=!0}},{key:"updateMesh",value:function(){return!!this._meshDirty&&(this.updateMeshNow(),!0)}},{key:"update",value:function(t,e){this._meshDirty&&this.updateMeshNow(),this._material.clippingPlanes=t,this._material.clipping=null!=t,this._material.opacity=e}},{key:"updateMeshNow",value:function(){if(this._meshDirty=!1,this._texture&&this._meshFactory){var e=t.VertexBuffer.begin();if(e.contentRect.copy(this._contentRect),e.uvRect.copy(this._texture.uvRect),this._texture?e.textureSize.set(this._texture.width,this._texture.height):e.textureSize.set(0,0),this._flip!=t.FlipType.None){if(this._flip==t.FlipType.Horizontal||this._flip==t.FlipType.Both){var i=e.uvRect.xMin;e.uvRect.xMin=e.uvRect.xMax,e.uvRect.xMax=i}if(this._flip==t.FlipType.Vertical||this._flip==t.FlipType.Both){var s=e.uvRect.yMin;e.uvRect.yMin=e.uvRect.yMax,e.uvRect.yMax=s}}e.vertexColor.setHex(this._color),this._meshFactory.onPopulateMesh(e);var n=e.currentVertCount;if(0==n)return this._geometry.drawRange.count>0&&(this._geometry.setDrawRange(0,0),this._geometry.computeBoundingSphere()),void e.end();if(this._texture.rotated)for(var r=this._texture.uvRect.x,a=this._texture.uvRect.y,o=this._texture.uvRect.yMax,h=0;h<n;h++){var l=e.uvs[0],u=e.uvs[1];e.uvs[1]=a+l-r,e.uvs[0]=r+o-u}var c=this._geometry;this.writeAttribute(c,"position",e.vertices,3),this.writeAttribute(c,"uv",e.uvs,2),this.writeAttribute(c,"color",e.colors,4),this.writeIndexAttribute(c,e.triangles),c.setDrawRange(0,e.triangles.length),c.computeBoundingSphere(),e.end()}else this._geometry.drawRange.count>0&&(this._geometry.setDrawRange(0,0),this._geometry.computeBoundingSphere())}},{key:"writeAttribute",value:function(t,e,i,s){var n=t.attributes[e];(!n||!n.isBufferAttribute||n.array.length<i.length)&&(n=new THREE.BufferAttribute(new Float32Array(i.length),s),t.setAttribute(e,n)),n.copyArray(i),n.needsUpdate=!0}},{key:"writeIndexAttribute",value:function(t,e){var i=t.index;(!i||!i.isBufferAttribute||i.array.length<e.length)&&(i=new THREE.BufferAttribute(new Uint16Array(e.length),1),t.index=i),i.copyArray(e),i.needsUpdate=!0}},{key:"onPopulateMesh",value:function(t){this._texture.getDrawRect(t.contentRect),t.addQuad(t.contentRect,t.uvRect,t.vertexColor),t.addTriangles()}},{key:"texture",get:function(){return this._texture},set:function(t){this._texture!=t&&(this._texture=t,this._meshDirty=!0),this._texture?this._material.map=this._texture.nativeTexture:this._material.map=null}},{key:"material",get:function(){return this._material},set:function(t){this._material=t}},{key:"meshFactory",get:function(){return this._meshFactory},set:function(t){this._meshFactory!=t&&(this._meshFactory=t,this._meshDirty=!0)}},{key:"flip",get:function(){return this._flip},set:function(t){this._flip!=t&&(this._flip=t,this._meshDirty=!0)}},{key:"color",get:function(){return this._color},set:function(t){if(this._color!=t&&(this._color=t,!this._meshDirty)){i.setHex(t);var e=this._geometry.attributes.color;if(e){for(var s=e.array,n=s.length,r=0;r<n;r+=4)s[r]=i.r,s[r+1]=i.g,s[r+2]=i.b,s[r+3]=i.a;e.needsUpdate=!0}}}},{key:"grayed",get:function(){return this._material.defines.GRAYED},set:function(t){this.setKeyword("GRAYED",t)}}]),e}();t.NGraphics=e;var i=new t.Color4}(fgui||(fgui={})),function(t){var e=function(t){_inherits(i,THREE.ShaderMaterial);var e=_createSuper(i);function i(){var t;_classCallCheck(this,i),t=e.call(this);var s=THREE.UniformsUtils.merge([THREE.ShaderLib.basic.uniforms,{_ColorMatrix:new THREE.Uniform(new THREE.Matrix4)},{_ColorOffset:new THREE.Uniform(new THREE.Vector4)}]);return t.uniforms=s,t.vertexShader="\n            #include <common>\n            #include <uv_pars_vertex>\n            #include <uv2_pars_vertex>\n            #include <envmap_pars_vertex>\n            varying vec4 vColor;\n            attribute vec4 color;\n            #include <fog_pars_vertex>\n            #include <morphtarget_pars_vertex>\n            #include <skinning_pars_vertex>\n            #include <logdepthbuf_pars_vertex>\n            #include <clipping_planes_pars_vertex>\n            \n            void main() {\n            \n                #include <uv_vertex>\n                #include <uv2_vertex>\n    \n                vColor = color;\n    \n                #include <skinbase_vertex>\n            \n                #ifdef USE_ENVMAP\n            \n                #include <beginnormal_vertex>\n                #include <morphnormal_vertex>\n                #include <skinnormal_vertex>\n                #include <defaultnormal_vertex>\n            \n                #endif\n            \n                #include <begin_vertex>\n                #include <morphtarget_vertex>\n                #include <skinning_vertex>\n                #include <project_vertex>\n                #include <logdepthbuf_vertex>\n            \n                #include <worldpos_vertex>\n                #include <clipping_planes_vertex>\n                #include <envmap_vertex>\n                #include <fog_vertex>\n            \n            }\n            ",t.fragmentShader="\n            uniform bool grayed;\n            uniform bool filter;\n            uniform mat4 colorMatrix;\n            uniform vec4 colorOffset;\n    \n            uniform vec3 diffuse;\n            uniform float opacity;\n            #ifndef FLAT_SHADED\n                varying vec3 vNormal;\n            #endif\n            #include <common>\n            #include <dithering_pars_fragment>\n    \n            varying vec4 vColor;\n    \n            #include <uv_pars_fragment>\n            #include <uv2_pars_fragment>\n            #include <map_pars_fragment>\n            #include <alphamap_pars_fragment>\n            #include <aomap_pars_fragment>\n            #include <lightmap_pars_fragment>\n            #include <envmap_common_pars_fragment>\n            #include <envmap_pars_fragment>\n            #include <cube_uv_reflection_fragment>\n            #include <fog_pars_fragment>\n            #include <specularmap_pars_fragment>\n            #include <logdepthbuf_pars_fragment>\n            #include <clipping_planes_pars_fragment>\n            void main() {\n                #include <clipping_planes_fragment>\n                vec4 diffuseColor = vec4( diffuse, opacity );\n                #include <logdepthbuf_fragment>\n                #ifdef USE_MAP\n                    #ifdef TEXT\n                        vec4 sampleColor = texture2D( map, vUv );\n                        if(vColor.a<0.1)\n                            diffuseColor.a *= sampleColor.r;\n                        else if(vColor.a<0.4)\n                            diffuseColor.a *= sampleColor.g;\n                        else\n                            diffuseColor.a *= sampleColor.b;\n                    #else\n                        #include <map_fragment>\n                    #endif\n                #endif\n    \n                #ifdef TEXT\n                diffuseColor.rgb *= vColor.rgb;\n                #else\n                diffuseColor *= vColor;\n                #endif\n    \n                #include <alphamap_fragment>\n                #include <alphatest_fragment>\n                #include <specularmap_fragment>\n                ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n                // accumulation (baked indirect lighting only)\n                #ifdef USE_LIGHTMAP\n                    vec4 lightMapTexel= texture2D( lightMap, vUv2 );\n                    reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n                #else\n                    reflectedLight.indirectDiffuse += vec3( 1.0 );\n                #endif\n                // modulation\n                #include <aomap_fragment>\n                reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n                vec3 outgoingLight = reflectedLight.indirectDiffuse;\n                #include <envmap_fragment>\n                gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n                #include <tonemapping_fragment>\n                #include <encodings_fragment>\n                #include <fog_fragment>\n                #include <premultiplied_alpha_fragment>\n                #include <dithering_fragment>\n    \n                #ifdef GRAYED\n                float grey = dot(gl_FragColor.rgb, vec3(0.299, 0.587, 0.114));\n                gl_FragColor.rgb = vec3(grey, grey, grey);\n                #endif\n    \n                #ifdef COLOR_FILTER\n                vec4 col = gl_FragColor;\n                gl_FragColor.r = dot(col, _ColorMatrix[0]) + _ColorOffset.x;\n                gl_FragColor.g = dot(col, _ColorMatrix[1]) + _ColorOffset.y;\n                gl_FragColor.b = dot(col, _ColorMatrix[2]) + _ColorOffset.z;\n                gl_FragColor.a = dot(col, _ColorMatrix[3]) + _ColorOffset.w;\n                #endif\n            }\n            ",t.name="ui-material",t.lights=!1,t.transparent=!0,t.depthTest=!1,t.side=THREE.DoubleSide,t.isMeshBasicMaterial=!0,t}return i}();t.NMaterial=e}(fgui||(fgui={})),function(t){var e=function(){function e(i,s,n){_classCallCheck(this,e),s=s||1,n=n||1,this._nativeTexture=i,this._root=this,this.uvRect=new t.Rect(0,0,s,n),n<0&&(this.uvRect.y=-n,this.uvRect.height=n),s<0&&(this.uvRect.x=-s,this.uvRect.width=s),this.originalSize=i?new THREE.Vector2(i.image.width,i.image.height):new THREE.Vector2(2,2),this.region=new t.Rect(0,0,this.originalSize.x,this.originalSize.y),this.offset=new THREE.Vector2(0,0)}return _createClass(e,[{key:"createSubTexture",value:function(t,i,s,n){var r=new e;if(r._root=this,r.rotated=i||!1,r.region.copy(t),r.region.x+=this.region.x,r.region.y+=this.region.y,r.uvRect.set(r.region.x*this.uvRect.width/this.width,1-r.region.yMax*this.uvRect.height/this.height,r.region.width*this.uvRect.width/this.width,r.region.height*this.uvRect.height/this.height),i){var a=r.region.width;r.region.width=r.region.height,r.region.height=a,a=r.uvRect.width,r.uvRect.width=r.uvRect.height,r.uvRect.height=a}return n?r.originalSize.copy(n):r.originalSize.set(r.region.width,r.region.height),s&&r.offset.copy(s),r}},{key:"getDrawRect",value:function(t){if(this.originalSize.x==this.region.width&&this.originalSize.y==this.region.height)return t;var e=t.width/this.originalSize.x,i=t.height/this.originalSize.y;return t.x=this.offset.x*e,t.y=this.offset.y*i,t.width=this.region.width*e,t.height=this.region.height*i,t}},{key:"getUV",value:function(t){if(t[0]=this.uvRect.position,t[1]=new THREE.Vector2(this.uvRect.x,this.uvRect.yMax),t[2]=new THREE.Vector2(this.uvRect.xMax,this.uvRect.yMax),t[3]=new THREE.Vector2(this.uvRect.xMax,this.uvRect.y),this.rotated)for(var e=this.uvRect.xMin,i=this.uvRect.yMin,s=this.uvRect.yMax,n=0;n<4;n++){var r=t[n],a=r.y;r.y=i+r.x-e,r.x=e+s-a}}},{key:"reload",value:function(t){if(this._root!=this)throw new Error("Reload is not allow to call on none root NTexture.");this._nativeTexture&&this._nativeTexture!=t&&this._nativeTexture.dispose(),this._nativeTexture=t,this._nativeTexture?this.originalSize.set(t.image.width,t.image.height):this.originalSize.set(0,0),this.region.set(0,0,this.originalSize.x,this.originalSize.y)}},{key:"dispose",value:function(){this._root==this&&this._nativeTexture.dispose()}},{key:"width",get:function(){return this.region.width}},{key:"height",get:function(){return this.region.height}},{key:"nativeTexture",get:function(){return this._root==this?this._nativeTexture:this._root.nativeTexture}},{key:"root",get:function(){return this._root}}]),e}();t.NTexture=e,t.EmptyTexture=new e}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(){var e;return _classCallCheck(this,s),(e=i.call(this))._graphics=new t.NGraphics(e._obj3D),e._graphics.texture=t.EmptyTexture,e}return _createClass(s,[{key:"drawRect",value:function(e,i,s){var n=this._graphics.getMeshFactory(t.RectMesh);n.lineWidth=e,n.lineColor=i,n.fillColor=s,this._graphics.setMeshDirty(),1==s.a?(n.fillColor=null,this._graphics.color=s.getHex()):this._graphics.color=16777215}},{key:"drawRoundRect",value:function(e,i,s,n,r,a,o){var h=this._graphics.getMeshFactory(t.RoundedRectMesh);h.lineWidth=e,h.lineColor=i,h.fillColor=s,h.topLeftRadius=n,h.topRightRadius=r,h.bottomLeftRadius=a,h.bottomRightRadius=o,this._graphics.setMeshDirty(),1==s.a?(h.fillColor=null,this._graphics.color=s.getHex()):this._graphics.color=16777215}},{key:"drawEllipse",value:function(e,i,s,n,r,a){var o=this._graphics.getMeshFactory(t.EllipseMesh);o.lineWidth=e,o.lineColor=s,o.fillColor=n,i.equals(n)?o.centerColor=null:o.centerColor=i,o.startDegree=r,o.endDegreee=a,this._graphics.setMeshDirty(),1==n.a?(o.fillColor=null,this._graphics.color=n.getHex()):this._graphics.color=16777215}},{key:"drawPolygon",value:function(e,i,s,n){var r=this._graphics.getMeshFactory(t.PolygonMesh);r.points.length=0,r.points.push.apply(r.points,e),r.fillColor=i,r.lineWidth=s,r.lineColor=n,this._graphics.setMeshDirty(),1==i.a?(r.fillColor=null,this._graphics.color=i.getHex()):this._graphics.color=16777215}},{key:"drawRegularPolygon",value:function(e,i,s,n,r,a,o){var h=this._graphics.getMeshFactory(t.RegularPolygonMesh);h.sides=e,h.lineWidth=i,h.centerColor=s,h.lineColor=n,h.fillColor=r,h.rotation=a,h.distances=o,this._graphics.setMeshDirty(),1==r.a?(h.fillColor=null,this._graphics.color=r.getHex()):this._graphics.color=16777215}},{key:"clear",value:function(){this._graphics.meshFactory=null,this._graphics.setMeshDirty()}},{key:"hitTest",value:function(t){if(!this._graphics.meshFactory)return null;var e=t.getLocal(this),i=this._graphics.meshFactory;return"hitTest"in i?i.hitTest(this._contentRect,e.x,e.y)?this:null:this._contentRect.contains(e)?this:null}}]),s}(t.DisplayObject);t.Shape=e}(fgui||(fgui={})),function(t){t.UILayer=1;var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"init",value:function(e){!function(e){l=e.domElement,(s=new THREE.OrthographicCamera(-1,1,1,-1,0,1e3)).layers.set(t.UILayer),g="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,r=[];for(var i=0;i<5;i++)r.push(new M);g||(r[0].touchId=0);h=0,o=new THREE.Vector2,g?(document.addEventListener("touchstart",(function(t){return C(t,0)}),{passive:!1}),document.addEventListener("touchend",(function(t){return C(t,1)}),{passive:!1}),document.addEventListener("touchmove",(function(t){return C(t,2)}),{passive:!1}),document.addEventListener("touchcancel",(function(t){return C(t,3)}),{passive:!1})):(document.addEventListener("mousedown",(function(t){return k(t,0)}),{passive:!1}),document.addEventListener("mouseup",(function(t){return k(t,1)}),{passive:!1}),document.addEventListener("mousemove",(function(t){return k(t,2)}),{passive:!1}));document.addEventListener("wheel",(function(t){return function(t){t.preventDefault(),o.set(t.pageX-_,t.pageY-d);var e=r[0];g&&(e.shiftKey=t.shiftKey,e.ctrlKey=t.ctrlKey,e.target=a=T(o.x,o.y,!0));null!=a&&(e.mouseWheelDelta=t.deltaY,P(e),O(a.obj3D,"mouse_wheel"),e.mouseWheelDelta=0)}(t)}),{passive:!1}),window.addEventListener("resize",w,!1),_=d=0;var n=l,u=getComputedStyle(n,null);d+=parseInt(u.getPropertyValue("padding-top"),10),_+=parseInt(u.getPropertyValue("padding-left"),10);do{_+=n.offsetLeft,d+=n.offsetTop,u=getComputedStyle(n,null),_+=parseInt(u.getPropertyValue("border-left-width"),10),d+=parseInt(u.getPropertyValue("border-top-width"),10)}while(n=n.offsetParent);w()}(e)}},{key:"getTouchPos",value:function(t,e){if(e||(e=new THREE.Vector2),null==t||-1==t)e.copy(o);else{var i=x(t);i?e.set(i.x,i.y):e.copy(o)}return e}},{key:"addTouchMonitor",value:function(t,e){var i=x(t);-1==i.touchMonitors.indexOf(e)&&i.touchMonitors.push(e)}},{key:"removeTouchMonitor",value:function(t){for(var e=0;e<5;e++){var i=r[e],s=i.touchMonitors.indexOf(t);-1!=s&&(i.touchMonitors[s]=null)}}},{key:"cancelClick",value:function(t){for(var e=0;e<5;e++){var i=r[e];i.touchId==t&&(i.clickCancelled=!0)}}},{key:"update",value:function(){this.disableMatrixValidation=!0,t.traverseUpdate(n,null,1),this.fontRebuilt&&(n.traverseVisible((function(t){var e=t.$owner;e&&"redraw"in e&&e.redraw()})),this.fontRebuilt=!1),this.disableMatrixValidation=!1}},{key:"hitTest",value:function(t,e,i){return T(t,e,i)}},{key:"setFocus",value:function(t){}},{key:"scene",set:function(t){n=t},get:function(){return n}},{key:"camera",get:function(){return s},set:function(t){s=t}},{key:"width",get:function(){return u}},{key:"height",get:function(){return c}},{key:"touchPos",get:function(){return o}},{key:"touchTarget",get:function(){return a}},{key:"touchCount",get:function(){return h}}]),e}();t.Stage=e;var i=function(){function t(){_classCallCheck(this,t),this.screenPt=new THREE.Vector3}return _createClass(t,[{key:"getLocal",value:function(t){return v.copy(this._ray.origin),t.worldToLocal(v,this._ray.direction),m.set(v.x,v.y),m}},{key:"camera",get:function(){return this._camera},set:function(t){this._camera=t,this._ray=this._camera.$hitTestRay,this._ray||(this._camera.$hitTestRay=this._ray={origin:new THREE.Vector3,direction:new THREE.Vector3}),I(this._camera,this.screenPt.x,this.screenPt.y,this._ray.origin,this._ray.direction)}},{key:"ray",get:function(){return this._ray},set:function(t){this._ray=t}}]),t}();t.HitTestContext=i;var s,n,r,a,o,h,l,u,c,_,d,g,f=[],p=[],y=new i,v=new THREE.Vector3,m=new THREE.Vector2;function w(e){u=l.clientWidth,c=l.clientHeight;var i=u/c;if(s instanceof THREE.OrthographicCamera){var n=c/2;s.left=-n*i,s.right=n*i,s.top=n,s.bottom=-n,s.position.x=n*i,s.position.y=-n,s.position.z=0,s.updateProjectionMatrix()}else s instanceof THREE.PerspectiveCamera&&(s.aspect=window.innerWidth/window.innerHeight,s.updateProjectionMatrix());e&&t.UIContentScaler._refresh()}function k(t,i){t.preventDefault(),o.set(t.pageX-_,t.pageY-d);var s=r[0];if(s.shiftKey=t.shiftKey,s.ctrlKey=t.ctrlKey,s.target=a=T(o.x,o.y,!0),o.x==s.x&&o.y==s.y||(s.x=o.x,s.y=o.y,s.move()),s.lastRollOver!=s.target&&b(s),0==i)s.began||(h=1,s.begin(),s.button=t.button,e.setFocus(s.target),P(s),s.target&&O(s.target.obj3D,"touch_begin"));else if(1==i&&s.began){h=0,s.end();var n=s.clickTest();n&&(P(s),1==t.button||2==t.button?O(n.obj3D,"right_click"):O(n.obj3D,"click")),s.button=-1}}function x(t){for(var e=0;e<5;e++){var i=r[e];if(-1==t&&-1!=i.touchId||-1!=t&&i.touchId==t)return i}return null}function C(t,i){t.preventDefault();for(var s=t.changedTouches,n=0;n<s.length;++n){var l=s[n];o.set(l.pageX-_,l.pageY-d);for(var u=void 0,c=void 0,g=0;g<5;g++){if(r[g].touchId==l.identifier){u=r[g];break}-1==r[g].touchId&&(c=r[g])}if(!u){if(!(u=c)||0!=i)continue;u.touchId=l.identifier}if(u.shiftKey=t.shiftKey,u.ctrlKey=t.ctrlKey,u.target=a=T(o.x,o.y,!0),u.x==o.x&&u.y==o.y||(u.x=o.x,u.y=o.y,u.began&&u.move()),u.lastRollOver!=u.target&&b(u),0==i)u.began||(h++,u.begin(),u.button=0,e.setFocus(u.target),P(u),u.target&&O(u.target.obj3D,"touch_begin"));else if((1==i||3==i)&&u.began){if(h--,u.end(),3!=i){var f=u.clickTest();null!=f&&(P(u),O(f.obj3D,"click"))}u.target=null,b(u),u.touchId=-1}}}function b(t){if(f.length=0,p.length=0,t.lastRollOver&&(p.push(t.lastRollOver),t.lastRollOver.obj3D.traverseAncestors((function(t){var e=t.$owner;e&&p.push(e)}))),t.lastRollOver=t.target,t.target)for(var e=t.target.obj3D;e;){var i=e.$owner;if(i){var s=p.indexOf(i);if(-1!=s){p.splice(s,p.length-s);break}f.push(i)}e=e.parent}var n=p.length;if(n>0){for(var r=0;r<n;r++){var a=p[r];a.stage&&a.dispatchEvent("roll_out",null)}p.length=0}if((n=f.length)>0){for(var o=0;o<n;o++){var h=f[o];h.stage&&h.dispatchEvent("roll_over",null)}f.length=0}}function T(r,a,o){y||(y=new i),e.disableMatrixValidation=!0,y.screenPt.set(r,a,0),y.camera=s,y.forTouch=null==o||o;var h=t.traverseHitTest(n,y);return e.disableMatrixValidation=!1,h}var S=new THREE.Vector3;function I(t,e,i,s,n){s.set(e/u*2-1,-i/c*2+1,0),s.unproject(t),t.isPerspectiveCamera?(S.setFromMatrixPosition(t.matrixWorld),n.copy(s).sub(S).normalize(),n.multiplyScalar(-1)):n.set(0,0,1)}function P(e){t.lastInput.touchId=e.touchId,t.lastInput.x=e.x,t.lastInput.y=e.y,t.lastInput.clickCount=e.clickCount,t.lastInput.mouseWheelDelta=e.mouseWheelDelta,t.lastInput.button=e.button,t.lastInput.holdTime=e.holdTime,t.lastInput.ctrlKey=e.ctrlKey,t.lastInput.shiftKey=e.shiftKey,t.lastInput.commandKey=e.commandKey}t.screenToWorld=I,t.worldToScreen=function(t,e,i){S.copy(e),S.project(t),i.set((S.x+1)/2*u,(1-S.y)/2*c)};var M=function(){function i(){_classCallCheck(this,i),this.downTargets=new Array,this.touchMonitors=new Array,this.reset()}return _createClass(i,[{key:"reset",value:function(){this.touchId=-1,this.x=0,this.y=0,this.clickCount=0,this.button=-1,this.mouseWheelDelta=0,this.lastClickTime=0,this.began=!1,this.target=null,this.downTargets.length=0,this.lastRollOver=null,this.clickCancelled=!1,this.touchMonitors.length=0}},{key:"begin",value:function(){var e=this;this.began=!0,this.clickCancelled=!1,this.downX=this.x,this.downY=this.y,this.downTime=performance.now(),this.downFrame=t.Timers.frameCount,this.holdTime=0,this.downTargets.length=0,this.target&&(this.downTargets.push(this.target),this.target.obj3D.traverseAncestors((function(t){var i=t.$owner;i&&e.downTargets.push(i)})))}},{key:"move",value:function(){if(this.began&&(this.holdTime=t.Timers.frameCount-this.downFrame==1?1/60:performance.now()-this.downTime),P(this),(Math.abs(this.x-this.downX)>50||Math.abs(this.y-this.downY)>50)&&(this.clickCancelled=!0),this.touchMonitors.length>0){for(var e=this.touchMonitors.length,i=0;i<e;i++){var s=this.touchMonitors[i];s instanceof t.DisplayObject&&!s.stage&&(this.touchMonitors[i]=null)}O(null,"touch_move",null,this.touchMonitors)}}},{key:"end",value:function(){this.began=!1;var i=performance.now();0==this.downTargets.length||this.clickCancelled||Math.abs(this.x-this.downX)>10||Math.abs(this.y-this.downY)>10?(this.clickCancelled=!0,this.lastClickTime=0,this.clickCount=1):(i-this.lastClickTime<.35&&Math.abs(this.x-this.lastClickX)<10&&Math.abs(this.y-this.lastClickY)<10&&this.lastClickButton==this.button?2==this.clickCount?this.clickCount=1:this.clickCount++:this.clickCount=1,this.lastClickTime=i,this.lastClickX=this.x,this.lastClickY=this.y,this.lastClickButton=this.button),this.holdTime=t.Timers.frameCount-this.downFrame==1?1/60:i-this.downTime,P(this);var s=this.target?this.target.obj3D:e.scene;if(this.touchMonitors.length>0){for(var n=this.touchMonitors.length,r=0;r<n;r++){var a=this.touchMonitors[r];a instanceof t.DisplayObject&&!a.stage&&(this.touchMonitors[r]=null)}O(s,"touch_end",null,this.touchMonitors),this.touchMonitors.length=0}else O(s,"touch_end")}},{key:"clickTest",value:function(){if(this.clickCancelled)return this.downTargets.length=0,null;var t=this.downTargets[0];if(t.stage)return this.downTargets.length=0,t;for(t=this.target;t;){if(-1!=this.downTargets.indexOf(t)&&t.stage)break;t=t.parent?t.parent.$owner:null}return this.downTargets.length=0,t}}]),i}();function O(i,s,n,r){i=i||e.scene;var a=t.EventPool.borrow();a._type=s,a.data=n,a._initiator=i.$owner;var o=a._callChain;a.initiator&&o.push(a.initiator),i.traverseAncestors((function(t){var e=t.$owner;e&&o.push(e)}));for(var h=o.length-1;h>=0;h--){var l=o[h],u=l._listeners[s];u&&u.captures.length>0&&(l._dispatch(u,a,!0),a._touchCapture&&(a._touchCapture=!1,"touch_begin"==s&&e.addTouchMonitor(a.input.touchId,l)))}if(!a._stopsPropagation){for(var c=0;c<o.length;c++){var _=o[c],d=_._listeners[s];if(d&&d.callbacks.length>0&&(_._dispatch(d,a,!1),a._touchCapture&&(a._touchCapture=!1,"touch_begin"==s&&e.addTouchMonitor(a.input.touchId,_)),a._stopsPropagation))break}if(r)for(var g=0;g<r.length;g++){var f=r[g];if(f&&-1==o.indexOf(f)){var p=f._listeners[s];p&&(p.captures.length>0&&f._dispatch(p,a,!0),p.callbacks.length>0&&f._dispatch(p,a,!1))}}}o.length=0,t.EventPool.returns(a)}t.broadcastEvent=function(i,s,n){i=i||e.scene;var r=t.EventPool.borrow();r._type=s,r.data=n;var a=r._callChain;i.traverseVisible((function(t){var e=t.$owner;e&&a.push(e)})),a.forEach((function(t){var e=t._listeners[s];e&&(e.captures.length>0&&t._dispatch(e,r,!0),e.callbacks.length>0&&t._dispatch(e,r,!1))})),a.length=0,t.EventPool.returns(r)},t.bubbleEvent=O}(fgui||(fgui={})),function(t){var e=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"load",value:function(t){t.readInt(),this.pixelWidth=t.readInt(),this.scale=1/t.readByte();var e=t.readInt();this.pixels=new Uint8Array(t.data,t.pos,e),t.skip(e)}}]),t}();t.PixelHitTestData=e;var i=function(){function t(e,i,s,n,r){_classCallCheck(this,t),this._data=e,this.offsetX=i,this.offsetY=s,this.sourceWidth=n,this.sourceHeight=r}return _createClass(t,[{key:"hitTest",value:function(t,e,i){if(!t.contains(e,i))return!1;var s=this._data;if(e=Math.floor((e*this.sourceWidth/t.width-this.offsetX)*s.scale),i=Math.floor((i*this.sourceHeight/t.height-this.offsetY)*s.scale),e<0||i<0||e>=s.pixelWidth)return!1;var n=i*s.pixelWidth+e,r=Math.floor(n/8),a=n%8;return r>=0&&r<s.pixels.length&&(s.pixels[r]>>a&1)>0}}]),t}();t.PixelHitTest=i}(fgui||(fgui={})),function(t){var e=new THREE.Vector2,i=function(){function t(e){_classCallCheck(this,t),this.shape=e}return _createClass(t,[{key:"hitTest",value:function(t,i,s){if(!this.shape.graphics)return!1;if(this.shape.parent){var n=this.shape.parent.$owner;n&&(n.transformPoint(i,s,this.shape.obj3D,e),i=e.x,s=e.y)}var r=this.shape.graphics.meshFactory;return"hitTest"in r&&r.hitTest(t,i,s)}}]),t}();t.ShapeHitTest=i}(fgui||(fgui={})),function(t){var e=function(){function e(){_classCallCheck(this,e),this.elements=[],this.activeIndex=-1}return _createClass(e,[{key:"onPopulateMesh",value:function(e){var i=this.elements.length;if(1==i)this.elements[0].onPopulateMesh(e);else{for(var s=t.VertexBuffer.begin(e),n=0;n<i;n++)-1!=this.activeIndex&&n!=this.activeIndex||(s.clear(),this.elements[n].onPopulateMesh(s),e.append(s));s.end()}}},{key:"hitTest",value:function(t,e,i){if(!t.contains(e,i))return!1;for(var s=!1,n=this.elements.length,r=0;r<n;r++)if(-1==this.activeIndex||r==this.activeIndex){var a=this.elements[r];if("hitTest"in a){if(a.hitTest(t,e,i))return!0}else s=!0}return s}}]),e}();t.CompositeMesh=e}(fgui||(fgui={})),function(t){var e=[0,4,1,0,3,4,0,2,3,0,8,5,0,7,8,0,6,7,6,5,2,2,1,6],i=new THREE.Vector3,s=function(){function s(){_classCallCheck(this,s),this.lineColor=new t.Color4,this.lineWidth=1,this.startDegree=0,this.endDegreee=360}return _createClass(s,[{key:"onPopulateMesh",value:function(s){var n=this.drawRect?this.drawRect:s.contentRect,r=this.fillColor?this.fillColor:s.vertexColor,a=this.lineColor,o=t.clamp(this.startDegree,0,360),h=t.clamp(this.endDegreee,0,360),l=o>0||h<360;o=o*Math.PI/180,h=h*Math.PI/180;var u=this.centerColor?this.centerColor:r,c=n.width/2,_=n.height/2,d=Math.ceil(Math.PI*(c+_)/4);d=t.clamp(d,40,800);var g=2*Math.PI/d,f=0,p=0;this.lineWidth>0&&l&&(o+=p=this.lineWidth/Math.max(c,_),h-=p);var y=s.currentVertCount,v=n.x+c,m=n.y+_;s.addVert(v,m,0,u);for(var w=0;w<d;w++){f<o?f=o:f>h&&(f=h);var k=Math.cos(f)*(c-this.lineWidth)+v,x=Math.sin(f)*(_-this.lineWidth)+m;s.addVert(k,x,0,r),this.lineWidth>0&&(s.addVert(k,x,0,a),s.addVert(Math.cos(f)*c+v,Math.sin(f)*_+m,0,a)),f+=g}if(this.lineWidth>0)for(var C=3*d,b=0;b<C;b+=3)b!=C-3?(s.addTriangle(0,b+4,b+1),s.addTriangle(b+5,b+3,b+2),s.addTriangle(b+3,b+5,b+6)):l?(s.addTriangle(0,b+1,b+1),s.addTriangle(b+2,b+3,b+2),s.addTriangle(b+3,b+2,b+3)):(s.addTriangle(0,1,b+1),s.addTriangle(2,b+3,b+2),s.addTriangle(b+3,2,3));else for(var T=0;T<d;T++)T!=d-1?s.addTriangle(0,T+2,T+1):l?s.addTriangle(0,T+1,T+1):s.addTriangle(0,1,T+1);if(this.lineWidth>0&&l){s.addVert(c,_,0,a);var S=.5*this.lineWidth;f=(o-=p)+.5*p+.5*Math.PI,s.addVert(Math.cos(f)*S+c,Math.sin(f)*S+_,0,a),f-=Math.PI,s.addVert(Math.cos(f)*S+c,Math.sin(f)*S+_,0,a),s.addVert(Math.cos(o)*c+c,Math.sin(o)*_+_,0,a),s.getPosition(y+3,i),s.addVert(i.x,i.y,i.z,a),f=(h+=p)-.5*p+.5*Math.PI,s.addVert(Math.cos(f)*S+c,Math.sin(f)*S+_,0,a),f-=Math.PI,s.addVert(Math.cos(f)*S+c,Math.sin(f)*S+_,0,a),s.getPosition(y+3*d,i),s.addVert(i.x,i.y,i.z,a),s.addVert(Math.cos(h)*c+c,Math.sin(h)*_+_,0,a),s.addTriangles(3*d+1,e)}}},{key:"hitTest",value:function(t,e,i){if(!t.contains(e,i))return!1;var s=.5*t.width,n=.5*t.height;if(e=e-s-t.x,i=i-n-t.y,Math.pow(e/s,2)+Math.pow(i/n,2)<1){if(0!=this.startDegree||360!=this.endDegreee){var r=180*Math.atan2(i,e)/Math.PI;return r<0&&(r+=360),r>=this.startDegree&&r<=this.endDegreee}return!0}return!1}}]),s}();t.EllipseMesh=s}(fgui||(fgui={})),function(t){var e=function(){function e(){_classCallCheck(this,e),this.origin=0,this.amount=1,this.clockwise=!0}return _createClass(e,[{key:"onPopulateMesh",value:function(e){var r=t.clamp01(this.amount);switch(this.method){case t.FillMethod.Horizontal:!function(e,i,n,r){s.copy(i);var a=(i=s).width*r;n!=t.FillOrigin.Right&&n!=t.FillOrigin.Bottom||(i.x+=i.width-a);i.width=a,e.addQuad(i),e.addTriangles()}(e,e.contentRect,this.origin,r);break;case t.FillMethod.Vertical:!function(e,i,n,r){s.copy(i);var a=(i=s).height*r;n!=t.FillOrigin.Right&&n!=t.FillOrigin.Bottom||(i.y+=i.height-a);i.height=a,e.addQuad(i),e.addTriangles()}(e,e.contentRect,this.origin,r);break;case t.FillMethod.Radial90:n(e,e.contentRect,this.origin,r,this.clockwise);break;case t.FillMethod.Radial180:a(e,e.contentRect,this.origin,r,this.clockwise);break;case t.FillMethod.Radial360:!function(e,n,r,h,l){switch(o.copy(n),n=o,r){case t.FillOrigin.Top:if(h<.5){n.width/=2,l&&(n.x+=n.width),a(e,n,l?t.FillOrigin.Left:t.FillOrigin.Right,h/.5,l);var u=e.getPosition(-8,i);s.set(u.x,u.y,0,0),e.addQuad(s),e.addTriangles(-4)}else n.width/=2,l||(n.x+=n.width),a(e,n,l?t.FillOrigin.Right:t.FillOrigin.Left,(h-.5)/.5,l),l?n.x+=n.width:n.x-=n.width,e.addQuad(n),e.addTriangles(-4);break;case t.FillOrigin.Bottom:if(h<.5){n.width/=2,l||(n.x+=n.width),a(e,n,l?t.FillOrigin.Right:t.FillOrigin.Left,h/.5,l);var c=e.getPosition(-8,i);s.set(c.x,c.y,0,0),e.addQuad(s),e.addTriangles(-4)}else n.width/=2,l&&(n.x+=n.width),a(e,n,l?t.FillOrigin.Left:t.FillOrigin.Right,(h-.5)/.5,l),l?n.x-=n.width:n.x+=n.width,e.addQuad(n),e.addTriangles(-4);break;case t.FillOrigin.Left:if(h<.5){n.height/=2,l||(n.y+=n.height),a(e,n,l?t.FillOrigin.Bottom:t.FillOrigin.Top,h/.5,l);var _=e.getPosition(-8,i);s.set(_.x,_.y,0,0),e.addQuad(s),e.addTriangles(-4)}else n.height/=2,l&&(n.y+=n.height),a(e,n,l?t.FillOrigin.Top:t.FillOrigin.Bottom,(h-.5)/.5,l),l?n.y-=n.height:n.y+=n.height,e.addQuad(n),e.addTriangles(-4);break;case t.FillOrigin.Right:if(h<.5){n.height/=2,l&&(n.y+=n.height),a(e,n,l?t.FillOrigin.Top:t.FillOrigin.Bottom,h/.5,l);var d=e.getPosition(-8,i);s.set(d.x,d.y,0,0),e.addQuad(s),e.addTriangles(-4)}else n.height/=2,l||(n.y+=n.height),a(e,n,l?t.FillOrigin.Bottom:t.FillOrigin.Top,(h-.5)/.5,l),l?n.y+=n.height:n.y-=n.height,e.addQuad(n),e.addTriangles(-4)}}(e,e.contentRect,this.origin,r,this.clockwise)}}}]),e}();t.FillMesh=e;var i=new THREE.Vector3,s=new t.Rect;function n(e,i,s,n,r){var a=s==t.FillOrigin.TopRight||s==t.FillOrigin.BottomRight,o=s==t.FillOrigin.BottomLeft||s==t.FillOrigin.BottomRight;a!=o&&(r=!r);var h=r?n:1-n,l=Math.tan(.5*Math.PI*h),u=!1;1!=h&&(u=i.height/i.width-l>0),r||(u=!u);var c=i.x+(0==h?Number.POSITIVE_INFINITY:i.height/l),_=i.y+(1==h?Number.POSITIVE_INFINITY:i.width*l),d=c,g=_;a&&(d=i.width-c),o&&(g=i.height-_);var f=a?i.width-i.x:i.xMin,p=o?i.height-i.y:i.yMin,y=a?-i.x:i.xMax,v=o?-i.y:i.yMax;e.addVert(f,p,0),r&&e.addVert(y,p,0),_>i.yMax?u?e.addVert(d,v,0):e.addVert(y,v,0):e.addVert(y,g,0),c>i.xMax?u?e.addVert(y,g,0):e.addVert(y,v,0):e.addVert(d,v,0),r||e.addVert(f,v,0),a==o?(e.addTriangle(0,2,1),e.addTriangle(0,3,2)):(e.addTriangle(2,0,1),e.addTriangle(3,0,2))}var r=new t.Rect;function a(e,a,o,h,l){switch(r.copy(a),a=r,o){case t.FillOrigin.Top:if(h<=.5){a.width/=2,l&&(a.x+=a.width),n(e,a,l?t.FillOrigin.TopLeft:t.FillOrigin.TopRight,h/.5,l);var u=e.getPosition(-4,i);s.set(u.x,u.y,0,0),e.addQuad(s),e.addTriangles(-4)}else a.width/=2,l||(a.x+=a.width),n(e,a,l?t.FillOrigin.TopRight:t.FillOrigin.TopLeft,(h-.5)/.5,l),l?a.x+=a.width:a.x-=a.width,e.addQuad(a),e.addTriangles(-4);break;case t.FillOrigin.Bottom:if(h<=.5){a.width/=2,l||(a.x+=a.width),n(e,a,l?t.FillOrigin.BottomRight:t.FillOrigin.BottomLeft,h/.5,l);var c=e.getPosition(-4,i);s.set(c.x,c.y,0,0),e.addQuad(s),e.addTriangles(-4)}else a.width/=2,l&&(a.x+=a.width),n(e,a,l?t.FillOrigin.BottomLeft:t.FillOrigin.BottomRight,(h-.5)/.5,l),l?a.x-=a.width:a.x+=a.width,e.addQuad(a),e.addTriangles(-4);break;case t.FillOrigin.Left:if(h<=.5){a.height/=2,l||(a.y+=a.height),n(e,a,l?t.FillOrigin.BottomLeft:t.FillOrigin.TopLeft,h/.5,l);var _=e.getPosition(-4,i);s.set(_.x,_.y,0,0),e.addQuad(s),e.addTriangles(-4)}else a.height/=2,l&&(a.y+=a.height),n(e,a,l?t.FillOrigin.TopLeft:t.FillOrigin.BottomLeft,(h-.5)/.5,l),l?a.y-=a.height:a.y+=a.height,e.addQuad(a),e.addTriangles(-4);break;case t.FillOrigin.Right:if(h<=.5){a.height/=2,l&&(a.y+=a.height),n(e,a,l?t.FillOrigin.TopRight:t.FillOrigin.BottomRight,h/.5,l);var d=e.getPosition(-4,i);s.set(d.x,d.y,0,0),e.addQuad(s),e.addTriangles(-4)}else a.height/=2,l||(a.y+=a.height),n(e,a,l?t.FillOrigin.BottomRight:t.FillOrigin.TopRight,(h-.5)/.5,l),l?a.y+=a.height:a.y-=a.height,e.addQuad(a),e.addTriangles(-4)}}var o=new t.Rect}(fgui||(fgui={})),function(t){var e=[],i=new THREE.Vector2,s=new THREE.Vector2,n=new THREE.Vector2,r=new THREE.Vector2,a=new THREE.Vector3,o=new THREE.Vector3,h=new THREE.Vector3,l=new THREE.Vector3,u=new THREE.Vector3,c=function(){function c(){_classCallCheck(this,c),this.points=new Array,this.texcoords=new Array}return _createClass(c,[{key:"add",value:function(t,e,i,s){this.points.push(t,e),null!=i&&this.texcoords.push(i,s)}},{key:"onPopulateMesh",value:function(a){var o=this.points.length/2;if(!(o<3)){for(var h,l,u,c,_,d,g,f=null!=this.fillColor?this.fillColor:a.vertexColor,p=a.contentRect.width,y=a.contentRect.height,v=this.texcoords.length>=this.points.length,m=0;m<o;m++){var w=2*m,k=this.points[w],x=this.points[w+1];if(this.usePercentPositions&&(k*=p,x*=y),v){var C=this.texcoords[w],b=this.texcoords[w+1];C=t.lerp(a.uvRect.x,a.uvRect.xMax,C),b=t.lerp(a.uvRect.y,a.uvRect.yMax,b),a.addVert(k,x,0,C,b,f)}else a.addVert(k,x,0,f)}e.length=0;for(var T=0;T<o;++T)e.push(T);for(h=0,l=o;l>3;){if(c=!1,_=e[h%l],d=e[(h+1)%l],g=e[(h+2)%l],i.set(this.points[2*_],this.points[2*_+1]),s.set(this.points[2*d],this.points[2*d+1]),n.set(this.points[2*g],this.points[2*g+1]),(i.y-s.y)*(n.x-s.x)+(s.x-i.x)*(n.y-s.y)>=0){c=!0;for(var S=3;S<l;++S)if(u=e[(h+S)%l],r.set(this.points[2*u],this.points[2*u+1]),this.isPointInTriangle(r,i,s,n)){c=!1;break}}if(c)a.addTriangle(_,g,d),e.splice((h+1)%l,1),l--,h=0;else if(++h==l)break}a.addTriangle(e[0],e[2],e[1]),this.lineWidth>0&&this.drawOutline(a)}}},{key:"drawOutline",value:function(t){for(var e=this.points.length/2,i=t.currentVertCount-e,s=t.currentVertCount,n=0;n<e;n++)t.getPosition(i+n,a),n<e-1?t.getPosition(i+n+1,o):t.getPosition(t.vertices[i],o),l.copy(o),l.sub(a),u.copy(l),u.cross(new THREE.Vector3(0,0,1)),u.normalize(),u.multiplyScalar(.5*this.lineWidth),h.copy(a),h.sub(u),t.addVert(h.x,h.y,h.z,this.lineColor),h.copy(a),h.add(u),t.addVert(h.x,h.y,h.z,this.lineColor),h.copy(o),h.sub(u),t.addVert(h.x,h.y,h.z,this.lineColor),h.copy(o),h.add(u),t.addVert(h.x,h.y,h.z,this.lineColor),s+=4,t.addTriangle(s-4,s-1,s-3),t.addTriangle(s-4,s-2,s-1),0!=n&&(t.addTriangle(s-6,s-3,s-5),t.addTriangle(s-6,s-4,s-3)),n==e-1&&(i+=e,t.addTriangle(s-2,i+1,s-1),t.addTriangle(s-2,i,i+1))}},{key:"isPointInTriangle",value:function(t,e,i,s){var n=s.x-e.x,r=s.y-e.y,a=i.x-e.x,o=i.y-e.y,h=t.x-e.x,l=t.y-e.y,u=n*n+r*r,c=n*a+r*o,_=n*h+r*l,d=a*a+o*o,g=a*h+o*l,f=1/(u*d-c*c),p=(d*_-c*g)*f,y=(u*g-c*_)*f;return p>=0&&y>=0&&p+y<1}},{key:"hitTest",value:function(t,e,i){if(!t.contains(e,i))return!1;var s,n=this.points.length/2,r=n-1,a=!1,o=t.width,h=t.height;for(s=0;s<n;++s){var l=this.points[2*s],u=this.points[2*s+1],c=this.points[2*r],_=this.points[2*r+1];this.usePercentPositions&&(l*=o,u*=h,l*=o,u*=h),(u<i&&_>=i||_<i&&u>=i)&&(l<=e||c<=e)&&l+(i-u)/(_-u)*(c-l)<e&&(a=!a),r=s}return a}}]),c}();t.PolygonMesh=c}(fgui||(fgui={})),function(t){var e=new t.Rect,i=function(){function t(){_classCallCheck(this,t),this.lineWidth=1}return _createClass(t,[{key:"onPopulateMesh",value:function(t){var i=this.drawRect?this.drawRect:t.contentRect,s=this.fillColor?this.fillColor:t.vertexColor,n=this.lineColor?this.lineColor:t.vertexColor;if(0==this.lineWidth)0!=s.a&&t.addQuad(i,null,s);else{var r=e;r.set(i.x,i.y,this.lineWidth,i.height),t.addQuad(r,null,n),r.set(i.xMax-this.lineWidth,i.y,this.lineWidth,i.height),t.addQuad(r,null,n),r.set(i.x+this.lineWidth,i.y,i.width-2*this.lineWidth,this.lineWidth),t.addQuad(r,null,n),r.set(i.x+this.lineWidth,i.yMax-this.lineWidth,i.width-2*this.lineWidth,this.lineWidth),t.addQuad(r,null,n),0!=s.a&&(r.setMinMax(i.x+this.lineWidth,i.y+this.lineWidth,i.xMax-this.lineWidth,i.yMax-this.lineWidth),r.width>0&&r.height>0&&t.addQuad(r,null,s))}t.addTriangles()}}]),t}();t.RectMesh=i}(fgui||(fgui={})),function(t){var e=function(){function e(){_classCallCheck(this,e),this.sides=3,this.lineWidth=1,this.lineColor=new t.Color4}return _createClass(e,[{key:"onPopulateMesh",value:function(t){if(null!=this.distances&&this.distances.length<this.sides)console.error("distances.Length<sides");else{var e=null!=this.drawRect?this.drawRect:t.contentRect,i=null!=this.fillColor?this.fillColor:t.vertexColor,s=2*Math.PI/this.sides,n=this.rotation*Math.PI/180,r=Math.min(e.width/2,e.height/2),a=r+e.x,o=r+e.y;t.addVert(a,o,0,this.centerColor?this.centerColor:i);for(var h=0;h<this.sides;h++){var l=r;null!=this.distances&&(l*=this.distances[h]);var u=Math.cos(n)*(l-this.lineWidth),c=Math.sin(n)*(l-this.lineWidth);t.addVert(u+a,c+o,0,i),this.lineWidth>0&&(t.addVert(u+a,c+o,0,this.lineColor),u=Math.cos(n)*l+a,c=Math.sin(n)*l+o,t.addVert(u,c,0,this.lineColor)),n+=s}if(this.lineWidth>0)for(var _=3*this.sides,d=0;d<_;d+=3)d!=_-3?(t.addTriangle(0,d+4,d+1),t.addTriangle(d+5,d+3,d+2),t.addTriangle(d+3,d+5,d+6)):(t.addTriangle(0,1,d+1),t.addTriangle(2,d+3,d+2),t.addTriangle(d+3,2,3));else for(var g=0;g<this.sides;g++)t.addTriangle(0,g==this.sides-1?1:g+2,g+1)}}},{key:"hitTest",value:function(t,e,i){return this.drawRect?this.drawRect.contains(e,i):t.contains(e,i)}}]),e}();t.RegularPolygonMesh=e}(fgui||(fgui={})),function(t){var e=function(){function e(){_classCallCheck(this,e),this.topLeftRadius=0,this.topRightRadius=0,this.bottomLeftRadius=0,this.bottomRightRadius=0,this.lineWidth=1,this.lineColor=new t.Color4}return _createClass(e,[{key:"onPopulateMesh",value:function(t){var e=this.drawRect?this.drawRect:t.contentRect,i=this.fillColor?this.fillColor:t.vertexColor,s=this.lineColor,n=e.width/2,r=e.height/2,a=Math.min(n,r),o=n+e.x,h=r+e.y;t.addVert(o,h,0,i);for(var l=t.currentVertCount,u=0;u<4;u++){var c=0;switch(u){case 0:c=this.bottomRightRadius;break;case 1:c=this.bottomLeftRadius;break;case 2:c=this.topLeftRadius;break;case 3:c=this.topRightRadius}c=Math.min(a,c);var _=e.x,d=e.y;if(0!=u&&3!=u||(_=e.xMax-2*c),0!=u&&1!=u||(d=e.yMax-2*c),0!=c)for(var g=Math.max(1,Math.ceil(Math.PI*c/8))+1,f=Math.PI/2/g,p=Math.PI/2*u,y=p,v=1;v<=g;v++){v==g&&(p=y+Math.PI/2);var m=_+Math.cos(p)*(c-this.lineWidth)+c,w=d+Math.sin(p)*(c-this.lineWidth)+c;t.addVert(m,w,0,i),0!=this.lineWidth&&(t.addVert(m,w,0,s),t.addVert(_+Math.cos(p)*c+c,d+Math.sin(p)*c+c,0,s)),p+=f}else{var k=_,x=d;0!=this.lineWidth?(0==u||3==u?_-=this.lineWidth:_+=this.lineWidth,0==u||1==u?d-=this.lineWidth:d+=this.lineWidth,t.addVert(_,d,0,i),t.addVert(_,d,0,s),t.addVert(k,x,0,s)):t.addVert(k,x,0,i)}}if(l=t.currentVertCount-l,this.lineWidth>0)for(var C=0;C<l;C+=3)C!=l-3?(t.addTriangle(0,C+4,C+1),t.addTriangle(C+5,C+3,C+2),t.addTriangle(C+3,C+5,C+6)):(t.addTriangle(0,1,C+1),t.addTriangle(2,C+3,C+2),t.addTriangle(C+3,2,3));else for(var b=0;b<l;b++)t.addTriangle(0,b==l-1?1:b+2,b+1)}},{key:"hitTest",value:function(t,e,i){return this.drawRect?this.drawRect.contains(e,i):t.contains(e,i)}}]),e}();t.RoundedRectMesh=e}(fgui||(fgui={})),function(t){var e=function(){function t(e,i,s){_classCallCheck(this,t),this.pool=[],this._init=i,this._reset=s,this._ct=e}return _createClass(t,[{key:"borrow",value:function(){var t;t=this.pool.length>0?this.pool.pop():new this._ct;for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];return this._init&&this._init.apply(this,[t].concat(i)),t}},{key:"returns",value:function(t){if(Array.isArray(t)){for(var e=t.length,i=0;i<e;i++){var s=t[i];this._reset&&this._reset(s),this.pool.push(s)}t.length=0}else this._reset&&this._reset(t),this.pool.push(t)}}]),t}();t.Pool=e}(fgui||(fgui={})),function(t){var e=function(){function e(){_classCallCheck(this,e),this.vertices=new Array,this.uvs=new Array,this.colors=new Array,this.triangles=new Array,this.contentRect=new t.Rect,this.uvRect=new t.Rect,this.textureSize=new THREE.Vector2,this.vertexColor=new t.Color4}return _createClass(e,[{key:"end",value:function(){this.clear(),i.returns(this)}},{key:"clear",value:function(){this.vertices.length=0,this.colors.length=0,this.uvs.length=0,this.triangles.length=0}},{key:"addVert",value:function(e,i,s,n,r,a){i=-i,this.vertices.push(e,i,s||0),"number"==typeof n?this.uvs.push(n,r):(this.uvs.push(t.lerp(this.uvRect.x,this.uvRect.xMax,(e-this.contentRect.x)/this.contentRect.width),t.lerp(this.uvRect.yMax,this.uvRect.y,(-i-this.contentRect.y)/this.contentRect.height)),n instanceof t.Color4&&(a=n)),null==a&&(a=this.vertexColor),this.colors.push(a.r,a.g,a.b,a.a)}},{key:"addQuad",value:function(t,e,i){if(s.length=0,e)if(Array.isArray(e))for(var n=0;n<4;n++)s.push(e[n].x,e[n].y);else s.push(e.x,e.y,e.x,e.yMax,e.xMax,e.yMax,e.xMax,e.y);this.addVert(t.x,t.yMax,0,s[0],s[1],i),this.addVert(t.x,t.y,0,s[2],s[3],i),this.addVert(t.xMax,t.y,0,s[4],s[5],i),this.addVert(t.xMax,t.yMax,0,s[6],s[7],i)}},{key:"repeatColors",value:function(t,e,i){for(var s=Math.min(e+i,this.vertices.length/3),n=t.length,r=0,a=e;a<s;a++){var o=t[r++%n];this.colors[a]=o}}},{key:"addTriangle",value:function(t,e,i){this.triangles.push(t),this.triangles.push(e),this.triangles.push(i)}},{key:"addTriangles",value:function(t,e){if(null!=e)if(0!=t){t<0&&(t=this.vertices.length/3+t);for(var i=e.length,s=0;s<i;s++)this.triangles.push(e[s]+t)}else this.triangles.push.apply(this.triangles,e);else{var n=this.vertices.length/3;null==t?t=0:t<0&&(t=n+t);for(var r=this.triangles,a=t;a<n;a+=4)r.push(a),r.push(a+2),r.push(a+1),r.push(a+3),r.push(a+2),r.push(a)}}},{key:"getPosition",value:function(t,e){t<0&&(t=this.vertices.length/3+t);var i=e||new THREE.Vector3;return i.x=this.vertices[3*t],i.y=-this.vertices[3*t+1],i.z=this.vertices[3*t+2],i}},{key:"append",value:function(t){this.vertices.push.apply(this.vertices,t.vertices),this.uvs.push.apply(this.uvs,t.uvs),this.colors.push.apply(this.colors,t.colors),this.triangles.push.apply(this.triangles,t.triangles)}},{key:"currentVertCount",get:function(){return this.vertices.length/3}}],[{key:"begin",value:function(t){var e=i.borrow();return t&&(e.contentRect=t.contentRect,e.uvRect=t.uvRect,e.vertexColor=t.vertexColor,e.textureSize=t.textureSize),e}}]),e}();t.VertexBuffer=e;var i=new t.Pool(e),s=new Array(8)}(fgui||(fgui={})),function(t){var e=new t.Rect,i=new t.Color4(16777215,1),s=function(){function s(){_classCallCheck(this,s),this.version=0,this.size=0,this.glyphs={},this._color=new t.Color4}return _createClass(s,[{key:"setFormat",value:function(t,e){this.resizable?this._scale=t.size/this.size*e:this._scale=e,this._color.setHex(t.color)}},{key:"prepareCharacters",value:function(t){}},{key:"getGlyph",value:function(t,e){return" "==t?(e.width=Math.round(this.size*this._scale/2),e.height=Math.round(this.size*this._scale),e.baseline=e.height,this._glyph=null,!0):(this._glyph=this.glyphs[t])?(e.width=Math.round(this._glyph.advance*this._scale),e.height=Math.round(this._glyph.lineHeight*this._scale),e.baseline=e.height,!0):(e.width=0,e.height=0,e.baseline=0,!1)}},{key:"drawGlyph",value:function(t,s,n){if(!this._glyph)return 0;var r=t+this._glyph.x*this._scale,a=-s-this._glyph.y*this._scale,o=t+(this._glyph.x+this._glyph.width)*this._scale,h=-s-(this._glyph.y+this._glyph.height)*this._scale;return e.setMinMax(r,h,o,a),n.addQuad(e,this._glyph.uv,this.tint?this._color:i),n.addTriangles(-4),4}},{key:"drawLine",value:function(t,e,i,s,n,r){return 0}},{key:"getLineHeight",value:function(t){for(var e in this.glyphs){var i=this.glyphs[e];return this.resizable?Math.round(i.lineHeight*t/this.size):i.lineHeight}return 0}}]),s}();t.BitmapFont=s;t.BMGlyph=function t(){_classCallCheck(this,t),this.x=0,this.y=0,this.width=0,this.height=0,this.advance=0,this.lineHeight=0,this.channel=0,this.uv=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2,new THREE.Vector2]}}(fgui||(fgui={})),function(t){var e=new t.Rect,i=window.devicePixelRatio,s=function(){function s(){_classCallCheck(this,s),this.version=0,this.isDynamic=!0,this.keepCrisp=!0,this._glyphs={},this._color=new t.Color4,this._outlineColor=new t.Color4,this._packers=[new n,new n,new n],this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d"),this._context.globalCompositeOperation="lighter",this.createTexture(512)}return _createClass(s,[{key:"createTexture",value:function(e){this._canvas.width=this._canvas.height=e,this.mainTexture?(this._texture.needsUpdate=!0,this.mainTexture.reload(this._texture)):(this._texture=new THREE.Texture(this._canvas),this._texture.generateMipmaps=!1,this._texture.magFilter=THREE.LinearFilter,this._texture.minFilter=THREE.LinearFilter,this.mainTexture=new t.NTexture(this._texture)),this.clearTexture()}},{key:"clearTexture",value:function(){this._context.fillStyle="black",this._context.fillRect(0,0,this._canvas.width,this._canvas.height),this._context.globalCompositeOperation="lighter";for(var t=0;t<3;t++)this._packers[t].init(this._canvas.width,this._canvas.height)}},{key:"rebuild",value:function(){this._canvas.width<2048?this.createTexture(2*this._canvas.width):this.clearTexture(),this.version++,t.Stage.fontRebuilt=!0,console.log("font atlas rebuilt : %s (%d)",this.name,this._canvas.width)}},{key:"setFormat",value:function(t,e){this._format=t;var i=t.size*e;this._size=Math.floor(i),0==this._size&&(this._size=1),this._color.setHex(t.color),this._outlineColor.setHex(t.outlineColor)}},{key:"prepareCharacters",value:function(t){for(var e=t.length,i=0;i<e;i++){var s=t[i],n=this.prepareChar(s,this._size);if(!n)break;this._format.outline>0&&this.prepareOutline(s,n,this._size,this._format.outline)}}},{key:"prepareChar",value:function(t,e){var s=(e<<16)+t.charCodeAt(0),n=this._glyphs[s];if(n&&n.ver==this.version)return n;this.keepCrisp&&(e*=i),this._context.font=e+"px "+this._name,n||(n=this.measureChar(t),this._glyphs[s]=n),n.ver=this.version;var r=n.sourceRect.width,a=n.sourceRect.height;if(0==r)return n;var o=this.addNode(r+2,a+2);return o?(this._context.textBaseline="top",this._context.fillStyle=0==o.z?"#FF0000":1==o.z?"#00FF00":"#0000FF",this._context.fillText(t,o.x+n.sourceRect.x,o.y+n.sourceRect.y),this._texture.needsUpdate=!0,n.chl=o.z/3,n.uvRect.set(o.x/this.mainTexture.width,1-(o.y+a)/this.mainTexture.height,r/this.mainTexture.width,a/this.mainTexture.height),n):(this.rebuild(),null)}},{key:"prepareOutline",value:function(e,s,n,r){s.outlines||(s.outlines={});var a=s.outlines[r];if(!(a&&a.ver==this.version||0==s.sourceRect.width)){a?a.ver=this.version:(a={vertRect:new t.Rect,uvRect:new t.Rect,ver:this.version},s.outlines[r]=a);var o=r;this.keepCrisp&&(o*=i);var h=s.sourceRect.width+2*o,l=s.sourceRect.height+2*o,u=this.addNode(h+2,l+2);if(!u)return this.rebuild(),null;this.keepCrisp&&(n*=i),this._context.font=n+"px "+this._name,this._context.textBaseline="top",this._context.strokeStyle=0==u.z?"#FF0000":1==u.z?"#00FF00":"#0000FF",this._context.lineWidth=o,this._context.strokeText(e,u.x+s.sourceRect.x+o,u.y+s.sourceRect.y+o),this._texture.needsUpdate=!0,a.chl=u.z/3,a.vertRect.copy(s.vertRect),a.vertRect.extend(r,r),a.uvRect.set(u.x/this.mainTexture.width,1-(u.y+l)/this.mainTexture.height,h/this.mainTexture.width,l/this.mainTexture.height)}}},{key:"measureChar",value:function(e){this._context.textBaseline="alphabetic";var s=this._context.measureText(e);this._context.textBaseline="top";var n,r=this._context.measureText(e),a=s.actualBoundingBoxLeft>0?Math.ceil(s.actualBoundingBoxLeft):0,o=Math.ceil(r.actualBoundingBoxAscent)+1,h=Math.ceil(a+s.actualBoundingBoxRight)+1,l=Math.ceil(s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)+2;return 0==h?n={ver:this.version}:(n={uvRect:new t.Rect,vertRect:new t.Rect(-a,-s.actualBoundingBoxAscent,h,l),advance:s.width,sourceRect:new t.Rect(a,o,h,l),ver:this.version},this.keepCrisp&&(n.vertRect.x/=i,n.vertRect.y/=i,n.vertRect.width/=i,n.vertRect.height/=i,n.advance/=i)),n}},{key:"addNode",value:function(t,e){for(var i,s=0;s<3;s++){var n=this._packers[s];if(!n.full&&(i=n.add(t,e))){i.z=s;break}}return i}},{key:"getGlyph",value:function(t,e){var i=(this._size<<16)+t.charCodeAt(0);return this._glyph=this._glyphs[i],!!this._glyph&&(e.width=this._glyph.advance,e.height=Math.round(1.25*this._size),e.baseline=Math.round(this._size),!0)}},{key:"drawGlyph",value:function(t,i,s){if(!this._glyph.vertRect)return 0;if(this._format.outline>0){var n=this._glyph.outlines[this._format.outline];e.copy(n.vertRect),e.x+=t,e.y-=i,this._outlineColor.a=n.chl,s.addQuad(e,n.uvRect,this._outlineColor),s.addTriangles(-4)}return e.copy(this._glyph.vertRect),e.x+=t,e.y-=i,this._color.a=this._glyph.chl,s.addQuad(e,this._glyph.uvRect,this._color),s.addTriangles(-4),4}},{key:"drawLine",value:function(t,e,i,s,n,r){return 0}},{key:"getLineHeight",value:function(t){return Math.round(1.25*t)}},{key:"name",get:function(){return this._name},set:function(t){this._name=t,this._canvas.id=t}}]),s}();t.DynamicFont=s;var n=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"init",value:function(t,e){this._root={x:0,y:0,w:t,h:e},delete this.full}},{key:"add",value:function(t,e){var i;return(i=this.findNode(this._root,t,e))&&(i=this.splitNode(i,t,e)),i||(this.full=!0),i}},{key:"findNode",value:function(t,e,i){return t.used?this.findNode(t.right,e,i)||this.findNode(t.down,e,i):e<=t.w&&i<=t.h?t:null}},{key:"splitNode",value:function(t,e,i){return t.used=!0,t.down={x:t.x,y:t.y+i,w:t.w,h:t.h-i},t.right={x:t.x+e,y:t.y,w:t.w-e,h:i},t}}]),t}()}(fgui||(fgui={})),function(t){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"registerFont",value:function(t){this.fonts[t.name]=t}},{key:"unregisterFont",value:function(t){this.fonts[t.name]=void 0}},{key:"getFont",value:function(e){if(this.packageFontGetter&&e.startsWith("ui://")){var i=this.packageFontGetter(e);if(i)return i}var s=this.fonts[e];return s||((s=new t.DynamicFont).name=e,this.fonts[e]=s),s}}]),e}();e.fonts={},t.FontManager=e}(fgui||(fgui={})),function(t){var e=function(e){_inherits(a,e);var n=_createSuper(a);function a(){var e;return _classCallCheck(this,a),(e=n.call(this))._touchDisabled=!0,e._graphics=new t.NGraphics(e.obj3D),e._graphics.meshFactory=_assertThisInitialized(e),e._textFormat=new t.TextFormat,e._fontSizeScale=1,e._wordWrap=!1,e._text="",e._parsedText="",e._elements=new Array,e._lines=new Array,e}return _createClass(a,[{key:"applyFormat",value:function(){var e=this._textFormat.font;e||(e=t.UIConfig.defaultFont);var i=t.FontManager.getFont(e);this._font!=i&&(this._font=i,this._fontVersion=this._font.version,this._graphics.texture=this._font.mainTexture,this._graphics.setKeyword("TEXT",this._font.isDynamic)),this._text&&(this._textChanged=!0)}},{key:"redraw",value:function(){return null==this._font&&(this._font=t.FontManager.getFont(t.UIConfig.defaultFont),this._graphics.texture=this._font.mainTexture,this._graphics.setKeyword("TEXT",this._font.isDynamic),this._fontVersion=this._font.version,this._textChanged=!0),this._font.version!=this._fontVersion&&(this._fontVersion=this._font.version,this._graphics.texture=this._font.mainTexture,this._textChanged=!0),this._textChanged&&this.buildLines(),this._graphics.updateMesh()}},{key:"getLinesShape",value:function(e,i,s,n,r,a){var o=this._lines[e],h=this._lines[s];if(e==s){var l=new t.Rect;l.setMinMax(i,o.y,n,o.y+o.height),r?a.push(l.intersection(this._contentRect)):a.push(l)}else if(e==s-1){var u=new t.Rect;u.setMinMax(i,o.y,t.GUTTER_X+o.width,o.y+o.height),r?a.push(u.intersection(this._contentRect)):a.push(u),(u=new t.Rect).setMinMax(t.GUTTER_X,o.y+o.height,n,h.y+h.height),r?a.push(u.intersection(this._contentRect)):a.push(u)}else{var c=new t.Rect;c.setMinMax(i,o.y,t.GUTTER_X+o.width,o.y+o.height),r?a.push(c.intersection(this._contentRect)):a.push(c);for(var _=e+1;_<s;_++){var d=this._lines[_];(c=new t.Rect).setMinMax(t.GUTTER_X,c.yMax,t.GUTTER_X+d.width,d.y+d.height),r?a.push(c.intersection(this._contentRect)):a.push(c)}(c=new t.Rect).setMinMax(t.GUTTER_X,c.yMax,n,h.y+h.height),r?a.push(c.intersection(this._contentRect)):a.push(c)}}},{key:"onSizeChanged",value:function(){this._updatingSize||(this._autoSize==t.AutoSizeType.Shrink||this._wordWrap?this._textChanged=!0:this._autoSize!=t.AutoSizeType.None&&this._graphics.setMeshDirty(),this._verticalAlign!=t.VertAlignType.Top&&this.applyVertAlign()),_get(_getPrototypeOf(a.prototype),"onSizeChanged",this).call(this)}},{key:"ensureSizeCorrect",value:function(){this._textChanged&&this._autoSize!=t.AutoSizeType.None&&this.buildLines()}},{key:"update",value:function(t,e){this.redraw(),_get(_getPrototypeOf(a.prototype),"update",this).call(this,t,e)}},{key:"requestText",value:function(){if(this._html)for(var e=this._elements.length,i=0;i<e;i++){var s=this._elements[i];s.type==t.HtmlElementType.Text&&(this._font.setFormat(s.format,this._fontSizeScale),this._font.prepareCharacters(s.text))}else this._font.setFormat(this._textFormat,this._fontSizeScale),this._font.prepareCharacters(this._parsedText)}},{key:"buildLines",value:function(){if(null==this._font&&(this._font=t.FontManager.getFont(t.UIConfig.defaultFont),this._fontVersion=this._font.version,this._graphics.texture=this._font.mainTexture,this._graphics.setKeyword("TEXT",this._font.isDynamic)),this._textChanged=!1,this._graphics.setMeshDirty(),this._fontSizeScale=1,this.cleanup(),0==this._text.length){var e=r.borrow();e.width=0,e.height=this._font.getLineHeight(this._textFormat.size),e.charIndex=e.charCount=0,e.y=e.y2=t.GUTTER_Y,this._lines.push(e),this._textWidth=this._textHeight=0}else this.parseText(),this.buildLines2(),this._autoSize==t.AutoSizeType.Shrink&&this.doShrink();if(this._autoSize==t.AutoSizeType.Both){if(this._updatingSize=!0,this._input){var i=Math.max(this._textFormat.size,this._textWidth),s=Math.max(this._font.getLineHeight(this._textFormat.size)+2*t.GUTTER_Y,this._textHeight);this.setSize(i,s)}else this.setSize(this._textWidth,this._textHeight);this._updatingSize=!1}else this._autoSize==t.AutoSizeType.Height&&(this._updatingSize=!0,this._input?this.height=Math.max(this._font.getLineHeight(this._textFormat.size)+2*t.GUTTER_Y,this._textHeight):this.height=this._textHeight,this._updatingSize=!1);this._yOffset=0,this.applyVertAlign()}},{key:"parseText",value:function(){this._html?(t.htmldefaultParser.parse(this._text,this._textFormat,this._elements,this._rich?this.htmlParseOptions:null),this._parsedText=""):this._parsedText=this._text;var e=this._elements.length;if(0==e)this._input&&(this._parsedText=this._parsedText.replace(/\r\n/g,"\n").replace(/\r/g,"\n"));else for(var i=0;i<e;){var s=this._elements[i];s.charIndex=this._parsedText.length,s.type==t.HtmlElementType.Text?this._input?this._parsedText+=s.text.replace(/\r\n/g,"\n").replace(/\r/g,"\n"):this._parsedText+=s.text:s.isEntity&&(this._parsedText+=" "),i++}}},{key:"buildLines2",value:function(){var e=this._textFormat.letterSpacing*this._fontSizeScale,n=(this._textFormat.lineSpacing-1)*this._fontSizeScale,a=this._contentRect.width-2*t.GUTTER_X,o=0,h=!1,l=0,u=this._textFormat;this._font.setFormat(u,this._fontSizeScale);var c=this._wordWrap&&!this._singleLine;this._maxWidth>0&&(c=!0,a=this._maxWidth-2*t.GUTTER_X),this._textWidth=this._textHeight=0,this.requestText();var _=this._elements.length,d=0,g=null;_>0&&(g=this._elements[d]);var f=this._parsedText.length,p=r.borrow();this._lines.push(p),p.y=p.y2=t.GUTTER_Y;var y=s;y.length=0;for(var v={width:0,height:0,baseline:0},m=0;m<f;m++){var w=this._parsedText[m];for(v.width=v.height=v.baseline=0;g&&g.charIndex==m;){if(g.type==t.HtmlElementType.Text)u=g.format,this._font.setFormat(u,this._fontSizeScale);else{var k=g.htmlObject;this._rich&&!k&&(g.space=a-p.width-4,k=this.htmlPageContext.createObject(this,g),g.htmlObject=k),k&&(v.width=k.width+2,v.height=k.height,v.baseline=v.height*i),g.isEntity&&(w="")}g=++d<_?this._elements[d]:null}if(0==w.length||"\n"==w?h=!1:this._font.getGlyph("\t"==w?" ":w,v)?("\t"==w&&(v.width*=4),h?-1!=" \t\n\r\v".indexOf(w)?o=0:w>="a"&&w<="z"||w>="A"&&w<="Z"||w>="0"&&w<="9"||"."==w||'"'==w||"'"==w?o++:h=!1:-1!=" \t\n\r\v".indexOf(w)?(o=0,h=!0):h=!1):h=!1,y.push(v.width,v.height,v.baseline),0!=v.width&&(0!=l&&(l+=e),l+=v.width),"\n"!=w||this._singleLine){if(c&&l>a){var x=y.length/3,C=void 0;C=h&&o<20&&x>2?o:1!=x?1:0,this.updateLineInfo(p,e,x-C);var b=r.borrow();if(this._lines.push(b),b.y=p.y+(p.height+n),b.y<t.GUTTER_Y&&(b.y=t.GUTTER_Y),b.y2=b.y,b.charIndex=p.charIndex+p.charCount,l=0,0!=C){for(var T=p.charCount;T<x;T++)0!=l&&(l+=e),l+=y[3*T];for(var S=0;S<3*p.charCount;S++)y.shift()}else y.length=0;h=!1,p=b}}else{this.updateLineInfo(p,e,y.length/3);var I=r.borrow();this._lines.push(I),I.y=p.y+(p.height+n),I.y<t.GUTTER_Y&&(I.y=t.GUTTER_Y),I.y2=I.y,I.charIndex=p.charIndex+p.charCount,y.length=0,h=!1,l=0,p=I}}this.updateLineInfo(p,e,y.length/3),this._textWidth>0&&(this._textWidth+=2*t.GUTTER_X),this._textHeight=p.y+p.height+t.GUTTER_Y,this._textWidth=Math.round(this._textWidth),this._textHeight=Math.round(this._textHeight)}},{key:"updateLineInfo",value:function(t,e,i){for(var n=s,r=0;r<3*i;r+=3){var a=n[r],o=n[r+1],h=n[r+2];h>t.baseline&&(t.height+=h-t.baseline,t.baseline=h),o-h>t.height-t.baseline&&(t.height+=o-h-(t.height-t.baseline)),a>0&&(0!=t.width&&(t.width+=e),t.width+=a)}0==t.height&&(1==this._lines.length?t.height=this._textFormat.size:t.height=this._lines[this._lines.length-2].height),t.width>this._textWidth&&(this._textWidth=t.width),t.charCount=i}},{key:"doShrink",value:function(){if(this._lines.length>1&&this._textHeight>this._contentRect.height){var t=0,e=this._textFormat.size;this._fontSizeScale=Math.sqrt(this._contentRect.height/this._textHeight);for(var i=Math.floor(this._fontSizeScale*this._textFormat.size);r.returns(this._lines),this.buildLines2(),this._textWidth>this._contentRect.width||this._textHeight>this._contentRect.height?e=i:t=i,e-t>1||e!=t&&i==e;)i=t+(e-t)/2,this._fontSizeScale=i/this._textFormat.size}else if(this._textWidth>this._contentRect.width&&(this._fontSizeScale=this._contentRect.width/this._textWidth,r.returns(this._lines),this.buildLines2(),this._textWidth>this._contentRect.width)){var s=Math.floor(this._textFormat.size*this._fontSizeScale);s--,this._fontSizeScale=s/this._textFormat.size,r.returns(this._lines),this.buildLines2()}}},{key:"onPopulateMesh",value:function(e){if(0==this._textWidth&&1==this._lines.length)return this._charPositions&&(o.returns(this._charPositions),this._charPositions.push(o.borrow())),void this.refreshObjects();var s=this._textFormat.letterSpacing*this._fontSizeScale,n=this._textFormat;this._font.setFormat(n,this._fontSizeScale);var r=this._contentRect.width>0?this._contentRect.width-2*t.GUTTER_X:0,a=this._contentRect.height>0?Math.max(this._contentRect.height,this._font.getLineHeight(n.size)):0;this._charPositions&&o.returns(this._charPositions);var h,l,u,c,_,d,g,f,p=null,y=0,v=0,m=0,w=!this._input&&this._autoSize==t.AutoSizeType.None,k=0,x=this._elements.length,C=null;x>0&&(C=this._elements[k]);for(var b={width:0,height:0,baseline:0},T=this._lines.length,S=0;S<T;++S){var I=this._lines[S];if(0!=I.charCount){l=w&&0!=S&&I.y+I.height>a,u=n.align,(h=(u=C&&C.charIndex==I.charIndex?C.format.align:n.align)==t.AlignType.Center?Math.floor((r-I.width)/2):u==t.AlignType.Right?r-I.width:0)<0&&(h=0),m=t.GUTTER_X+h;var P=I.charCount;_=m,d=m,g=f=n.size;for(var M=0;M<P;M++){for(var O=I.charIndex+M,R=this._parsedText[O];C&&O==C.charIndex;){if(C.type==t.HtmlElementType.Text){if(c=0,n.underline!=C.format.underline)if(n.underline){if(!l){var L=_-(w?t.clamp(m,t.GUTTER_X,t.GUTTER_X+r):m);L>0&&(c+=this._font.drawLine(_<m?_:m,-(I.y+I.baseline),L,f,0,e))}f=0}else _=m;if(n.strikethrough!=C.format.strikethrough)if(n.strikethrough){if(!l){var z=d-(w?t.clamp(m,t.GUTTER_X,t.GUTTER_X+r):m);z>0&&(c+=this._font.drawLine(d<m?d:m,-(I.y+I.baseline),z,g,1,e))}g=Number.POSITIVE_INFINITY}else d=m;if(c>0&&this._charPositions){var B=this._charPositions[this._charPositions.length-1];B.vertCount+=c,this._charPositions[this._charPositions.length-1]=B}n=C.format,g=Math.min(g,n.size),f=Math.max(f,n.size),this._font.setFormat(n,this._fontSizeScale)}else if(C.type==t.HtmlElementType.Link)(p=C.htmlObject)&&(C.position.set(0,0),p.setPosition(0,0),y=m,v=S);else if(C.type==t.HtmlElementType.LinkEnd)p&&(p.setArea(v,y,S,m),p=null);else{var j=C.htmlObject;if(j){if(this._charPositions){var F=o.borrow();F.lineIndex=S,F.charIndex=this._charPositions.length,F.imgIndex=k+1,F.offsetX=m,F.width=j.width,this._charPositions.push(F)}l||w&&(m<t.GUTTER_X||m>t.GUTTER_X&&m+j.width>this._contentRect.width-t.GUTTER_X)?C.status|=1:C.status&=254,C.position=new THREE.Vector2(m+1,I.y+I.baseline-j.height*i),j.setPosition(C.position.x,C.position.y),m+=j.width+s+2}}C.isEntity&&(R="\0"),C=++k<x?this._elements[k]:null}if("\0"!=R)if(this._font.getGlyph("\t"==R?" ":R,b)){if("\t"==R&&(b.width*=4),l||w&&(r<7||m!=t.GUTTER_X+h)&&m+b.width>this._contentRect.width-t.GUTTER_X+.5){m+=s+b.width;continue}if(c=this._font.drawGlyph(m,-(I.y+I.baseline),e),this._charPositions){var E=o.borrow();E.lineIndex=S,E.charIndex=this._charPositions.length,E.vertCount=c,E.offsetX=m,E.width=b.width,this._charPositions.push(E)}m+=s+b.width}else{if(this._charPositions){var A=o.borrow();A.lineIndex=S,A.charIndex=this._charPositions.length,A.offsetX=m,this._charPositions.push(A)}m+=s}}if(!l){if(c=0,n.underline){var D=_-(w?t.clamp(m,t.GUTTER_X,t.GUTTER_X+r):m);D>0&&(c+=this._font.drawLine(_<m?_:m,-(I.y+I.baseline),D,f,0,e))}if(n.strikethrough){var V=d-(w?t.clamp(m,t.GUTTER_X,t.GUTTER_X+r):m);V>0&&(c+=this._font.drawLine(d<m?d:m,-(I.y+I.baseline),V,g,1,e))}if(c>0&&this._charPositions)this._charPositions[this._charPositions.length-1].vertCount+=c}}}if(C&&C.type==t.HtmlElementType.LinkEnd&&p&&p.setArea(v,y,T-1,m),this._charPositions){var H=o.borrow();H.lineIndex=T-1,H.charIndex=this._charPositions.length,H.offsetX=m,this._charPositions.push(H)}this.refreshObjects()}},{key:"cleanup",value:function(){this.cleanupObjects(),t.elementPool.returns(this._elements),r.returns(this._lines),this._textWidth=0,this._textHeight=0,this._parsedText="",this._charPositions&&o.returns(this._charPositions)}},{key:"applyVertAlign",value:function(){var e,i=this._yOffset;this._autoSize==t.AutoSizeType.Both||this._autoSize==t.AutoSizeType.Height||this._verticalAlign==t.VertAlignType.Top?this._yOffset=0:((e=0==this._textHeight&&this._lines.length>0?this._contentRect.height-this._lines[0].height:this._contentRect.height-this._textHeight)<0&&(e=0),this._verticalAlign==t.VertAlignType.Middle?this._yOffset=Math.floor(e/2):this._yOffset=e);if(i!=this._yOffset){for(var s=this._lines.length,n=0;n<s;n++)this._lines[n].y=this._lines[n].y2+this._yOffset;this._graphics.setMeshDirty()}}},{key:"refreshObjects",value:function(){}},{key:"cleanupObjects",value:function(){}},{key:"textFormat",get:function(){return this._textFormat}},{key:"align",get:function(){return this._textFormat.align},set:function(t){this._textFormat.align!=t&&(this._textFormat.align=t,this._text&&(this._textChanged=!0))}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!=t&&(this._verticalAlign=t,this._textChanged||this.applyVertAlign())}},{key:"text",get:function(){return this._text},set:function(t){(this._text!=t||this._html)&&(this._text=t,this._textChanged=!0,this._html=!1)}},{key:"htmlText",get:function(){return this._text},set:function(t){this._text==t&&this._html||(this._text=t,this._textChanged=!0,this._html=!0)}},{key:"parsedText",get:function(){return this._parsedText}},{key:"autoSize",get:function(){return this._autoSize},set:function(t){this._autoSize!=t&&(this._autoSize=t,this._textChanged=!0)}},{key:"wordWrap",get:function(){return this._wordWrap},set:function(t){this._wordWrap!=t&&(this._wordWrap=t,this._textChanged=!0)}},{key:"singleLine",get:function(){return this._singleLine},set:function(t){this._singleLine!=t&&(this._singleLine=t,this._textChanged=!0)}},{key:"textWidth",get:function(){return this._textChanged&&this.buildLines(),this._textWidth}},{key:"textHeight",get:function(){return this._textChanged&&this.buildLines(),this._textHeight}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(t){this._maxWidth!=t&&(this._maxWidth=t,this._textChanged=!0)}},{key:"htmlElements",get:function(){return this._textChanged&&this.buildLines(),this._elements}},{key:"lines",get:function(){return this._textChanged&&this.buildLines(),this._lines}},{key:"charPositions",get:function(){return this._textChanged&&this.buildLines(),this._graphics.updateMesh(),this._charPositions}}]),a}(t.DisplayObject);t.TextField=e,t.GUTTER_X=2,t.GUTTER_Y=2;var i=.8,s=new Array,n=function t(){_classCallCheck(this,t)};t.LineInfo=n;var r=new t.Pool(n,(function(t){t.width=t.height=t.baseline=t.y=t.y2=t.charIndex=t.charCount=0})),a=function t(){_classCallCheck(this,t)};t.CharPosition=a;var o=new t.Pool(a)}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(){var e;return _classCallCheck(this,s),(e=i.call(this))._touchDisabled=!1,e._input=!0,e.maxLength=0,e.editable=!0,e._borderColor=new t.Color4,e._backgroundColor=new t.Color4(16777215,0),e}return _createClass(s,[{key:"onSizeChanged",value:function(){_get(_getPrototypeOf(s.prototype),"onSizeChanged",this).call(this),this._clipRect||(this._clipRect=new t.Rect),this._clipRect.copy(this._contentRect),this._clipRect.x+=t.GUTTER_X,this._clipRect.y+=t.GUTTER_Y,this._clipRect.width-=2*t.GUTTER_X,this._clipRect.height-=2*t.GUTTER_Y}},{key:"password",get:function(){return this._password},set:function(t){this._password=t}}]),s}(t.TextField);t.InputTextField=e}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(){var e;return _classCallCheck(this,s),(e=i.call(this))._touchDisabled=!1,e._rich=!0,e.htmlPageContext=t.defaultContext,e.htmlParseOptions=new t.HtmlParseOptions,e}return _createClass(s,[{key:"getHtmlElement",value:function(t){for(var e=this.htmlElements,i=e.length,s=0;s<i;s++){var n=e[s];if(t==n.name)return n}return null}},{key:"showHtmlObject",value:function(e,i){var s=this.htmlElements[e];s.htmlObject&&s.type!=t.HtmlElementType.Link&&(i?s.status&=253:s.status|=2,0==(3&s.status)?0==(4&s.status)&&(s.status|=4,s.htmlObject.add()):0!=(4&s.status)&&(s.status&=251,s.htmlObject.remove()))}},{key:"dispose",value:function(){this.cleanupObjects(),_get(_getPrototypeOf(s.prototype),"dispose",this).call(this)}},{key:"cleanupObjects",value:function(){for(var t=this.htmlElements,e=t.length,i=0;i<e;i++){var s=t[i];s.htmlObject&&(s.htmlObject.remove(),this.htmlPageContext.freeObject(s.htmlObject))}}},{key:"refreshObjects",value:function(){for(var t=this.htmlElements,e=t.length,i=0;i<e;i++){var s=t[i];s.htmlObject&&(0==(3&s.status)?0==(4&s.status)&&(s.status|=4,s.htmlObject.add()):0!=(4&s.status)&&(s.status&=251,s.htmlObject.remove()))}}}]),s}(t.TextField);t.RichTextField=e}(fgui||(fgui={})),function(t){var e=new t.Rect,i=function(i){_inherits(n,i);var s=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=s.call(this)).rects=new Array,e._graphics=new t.NGraphics(e._obj3D),e._graphics.texture=t.EmptyTexture,e}return _createClass(n,[{key:"refresh",value:function(){var t=this.rects.length;if(t>0){e.copy(this.rects[0]);for(var i=1;i<t;i++)e.union(this.rects[i]);this.setSize(e.xMax,e.yMax)}else this.setSize(0,0);this.graphics.setMeshDirty()}},{key:"clear",value:function(){this.rects.length=0,this.graphics.setMeshDirty()}},{key:"onPopulateMesh",value:function(t){var e=this.rects.length;if(0!=e){for(var i=0;i<e;i++)t.addQuad(this.rects[i]);t.addTriangles()}}},{key:"hitTest",value:function(t){var e=t.getLocal(this);if(this._contentRect.contains(e))for(var i=this.rects.length,s=0;s<i;s++)if(this.rects[s].contains(e))return this;return null}}]),n}(t.DisplayObject);t.SelectionShape=i}(fgui||(fgui={})),function(t){var e=function(){function t(){_classCallCheck(this,t),this.size=0,this.color=0,this.lineSpacing=0,this.letterSpacing=0,this.outline=0,this.outlineColor=0,this.shadowOffset=new THREE.Vector2,this.shadowColor=0}return _createClass(t,[{key:"copy",value:function(t){this.size=t.size,this.font=t.font,this.color=t.color,this.lineSpacing=t.lineSpacing,this.letterSpacing=t.letterSpacing,this.bold=t.bold,this.underline=t.underline,this.italic=t.italic,this.strikethrough=t.strikethrough,this.align=t.align}},{key:"equalStyle",value:function(t){return this.size==t.size&&this.color==t.color&&this.bold==t.bold&&this.underline==t.underline&&this.italic==t.italic&&this.strikethrough==t.strikethrough&&this.align==t.align}}]),t}();t.TextFormat=e}(fgui||(fgui={})),function(t){t.lastInput={x:0,y:0,mouseWheelDelta:0,touchId:0,button:0,clickCount:0,holdTime:0};var e=function(){function e(){_classCallCheck(this,e),this.data=null,this._callChain=[]}return _createClass(e,[{key:"stopPropagation",value:function(){this._stopsPropagation=!0}},{key:"preventDefault",value:function(){this._defaultPrevented=!0}},{key:"captureTouch",value:function(){this._touchCapture=!0}},{key:"type",get:function(){return this._type}},{key:"sender",get:function(){return this._sender}},{key:"initiator",get:function(){return this._initiator}},{key:"input",get:function(){return t.lastInput}},{key:"isDefaultPrevented",get:function(){return this._defaultPrevented}}]),e}();t.Event=e,t.EventPool=new t.Pool(e,(function(t){t._stopsPropagation=!1,t._defaultPrevented=!1,t._touchCapture=!1}),(function(t){t.data=null}))}(fgui||(fgui={})),function(t){var e=function(){function t(e){_classCallCheck(this,t),this._owner=e}return _createClass(t,[{key:"dispose",value:function(){this._tweenConfig&&this._tweenConfig._tweener&&(this._tweenConfig._tweener.kill(),this._tweenConfig._tweener=null)}},{key:"setup",value:function(t){var e,s;this._controller=this._owner.parent.getControllerAt(t.readShort()),this.init();var n=t.readShort();if("pages"in this)this.pages=t.readSArray(n);else{for(e=0;e<n;e++)null!=(s=t.readS())&&this.addStatus(s,t);t.readBool()&&this.addStatus(null,t)}if(t.readBool()&&(this._tweenConfig=new i,this._tweenConfig.easeType=t.readByte(),this._tweenConfig.duration=t.readFloat(),this._tweenConfig.delay=t.readFloat()),t.version>=2)if("positionsInPercent"in this){if(t.readBool()){for(this.positionsInPercent=!0,e=0;e<n;e++)null!=(s=t.readS())&&this.addExtStatus(s,t);t.readBool()&&this.addExtStatus(null,t)}}else"condition"in this&&(this.condition=t.readByte())}},{key:"updateFromRelations",value:function(t,e){}},{key:"addStatus",value:function(t,e){}},{key:"init",value:function(){}},{key:"apply",value:function(){}},{key:"updateState",value:function(){}},{key:"controller",get:function(){return this._controller},set:function(t){t!=this._controller&&(this._controller=t,this._controller&&this.init())}},{key:"tweenConfig",get:function(){return this._tweenConfig||(this._tweenConfig=new i),this._tweenConfig}}]),t}();t.GearBase=e;var i=function e(){_classCallCheck(this,e),this.tween=!0,this.easeType=t.EaseType.QuadOut,this.duration=.3,this.delay=0};t.GearTweenConfig=i}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(t){return _classCallCheck(this,s),i.call(this,t)}return _createClass(s,[{key:"init",value:function(){this._default={playing:this._owner.getProp(t.ObjectPropID.Playing),frame:this._owner.getProp(t.ObjectPropID.Frame)},this._storage={}}},{key:"addStatus",value:function(t,e){var i;t?(i={},this._storage[t]=i):i=this._default,i.playing=e.readBool(),i.frame=e.readInt()}},{key:"apply",value:function(){this._owner._gearLocked=!0;var e=this._storage[this._controller.selectedPageId]||this._default;this._owner.setProp(t.ObjectPropID.Playing,e.playing),this._owner.setProp(t.ObjectPropID.Frame,e.frame),this._owner._gearLocked=!1}},{key:"updateState",value:function(){var e=this._storage[this._controller.selectedPageId];e||(e={},this._storage[this._controller.selectedPageId]=e),e.playing=this._owner.getProp(t.ObjectPropID.Playing),e.frame=this._owner.getProp(t.ObjectPropID.Frame)}}]),s}(t.GearBase);t.GearAnimation=e}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(t){return _classCallCheck(this,s),i.call(this,t)}return _createClass(s,[{key:"init",value:function(){this._default={color:this._owner.getProp(t.ObjectPropID.Color),strokeColor:this._owner.getProp(t.ObjectPropID.OutlineColor)},this._storage={}}},{key:"addStatus",value:function(t,e){var i;t?(i={},this._storage[t]=i):i=this._default,i.color=e.readColor(),i.strokeColor=e.readColor()}},{key:"apply",value:function(){this._owner._gearLocked=!0;var e=this._storage[this._controller.selectedPageId]||this._default;this._owner.setProp(t.ObjectPropID.Color,e.color),this._owner.setProp(t.ObjectPropID.OutlineColor,e.strokeColor),this._owner._gearLocked=!1}},{key:"updateState",value:function(){var e=this._storage[this._controller.selectedPageId];e||(e={},this._storage[this._controller.selectedPageId]=e),e.color=this._owner.getProp(t.ObjectPropID.Color),e.strokeColor=this._owner.getProp(t.ObjectPropID.OutlineColor)}}]),s}(t.GearBase);t.GearColor=e}(fgui||(fgui={})),function(t){var e=function(t){_inherits(i,t);var e=_createSuper(i);function i(t){var s;return _classCallCheck(this,i),(s=e.call(this,t))._visible=0,s._displayLockToken=0,s._displayLockToken=1,s}return _createClass(i,[{key:"init",value:function(){this.pages=null}},{key:"addLock",value:function(){return this._visible++,this._displayLockToken}},{key:"releaseLock",value:function(t){t==this._displayLockToken&&this._visible--}},{key:"apply",value:function(){this._displayLockToken++,this._displayLockToken<=0&&(this._displayLockToken=1),null==this.pages||0==this.pages.length||-1!=this.pages.indexOf(this._controller.selectedPageId)?this._visible=1:this._visible=0}},{key:"connected",get:function(){return null==this._controller||this._visible>0}}]),i}(t.GearBase);t.GearDisplay=e}(fgui||(fgui={})),function(t){var e=function(t){_inherits(i,t);var e=_createSuper(i);function i(t){var s;return _classCallCheck(this,i),(s=e.call(this,t))._visible=0,s}return _createClass(i,[{key:"init",value:function(){this.pages=null}},{key:"apply",value:function(){null==this.pages||0==this.pages.length||-1!=this.pages.indexOf(this._controller.selectedPageId)?this._visible=1:this._visible=0}},{key:"evaluate",value:function(t){var e=null==this._controller||this._visible>0;return e=0==this.condition?e&&t:e||t}}]),i}(t.GearBase);t.GearDisplay2=e}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(t){var e;return _classCallCheck(this,s),(e=i.call(this,t))._default=0,e}return _createClass(s,[{key:"init",value:function(){this._default=this._owner.getProp(t.ObjectPropID.FontSize),this._storage={}}},{key:"addStatus",value:function(t,e){t?this._storage[t]=e.readInt():this._default=e.readInt()}},{key:"apply",value:function(){this._owner._gearLocked=!0;var e=this._storage[this._controller.selectedPageId];void 0!==e?this._owner.setProp(t.ObjectPropID.FontSize,e):this._owner.setProp(t.ObjectPropID.FontSize,this._default),this._owner._gearLocked=!1}},{key:"updateState",value:function(){this._storage[this._controller.selectedPageId]=this._owner.getProp(t.ObjectPropID.FontSize)}}]),s}(t.GearBase);t.GearFontSize=e}(fgui||(fgui={})),function(t){var e=function(t){_inherits(i,t);var e=_createSuper(i);function i(t){return _classCallCheck(this,i),e.call(this,t)}return _createClass(i,[{key:"init",value:function(){this._default=this._owner.icon,this._storage={}}},{key:"addStatus",value:function(t,e){t?this._storage[t]=e.readS():this._default=e.readS()}},{key:"apply",value:function(){this._owner._gearLocked=!0;var t=this._storage[this._controller.selectedPageId];this._owner.icon=void 0!==t?t:this._default,this._owner._gearLocked=!1}},{key:"updateState",value:function(){this._storage[this._controller.selectedPageId]=this._owner.icon}}]),i}(t.GearBase);t.GearIcon=e}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(t){return _classCallCheck(this,s),i.call(this,t)}return _createClass(s,[{key:"init",value:function(){this._default={alpha:this._owner.alpha,rotation:this._owner.rotation,grayed:this._owner.grayed,touchable:this._owner.touchable},this._storage={}}},{key:"addStatus",value:function(t,e){var i;t?(i={},this._storage[t]=i):i=this._default,i.alpha=e.readFloat(),i.rotation=e.readFloat(),i.grayed=e.readBool(),i.touchable=e.readBool()}},{key:"apply",value:function(){var e=this._storage[this._controller.selectedPageId]||this._default;if(this._tweenConfig&&this._tweenConfig.tween&&0==t.constructingDepth.n&&!t.GearBase.disableAllTweenEffect){if(this._owner._gearLocked=!0,this._owner.grayed=e.grayed,this._owner.touchable=e.touchable,this._owner._gearLocked=!1,this._tweenConfig._tweener){if(this._tweenConfig._tweener.endValue.x==e.alpha&&this._tweenConfig._tweener.endValue.y==e.rotation)return;this._tweenConfig._tweener.kill(!0),this._tweenConfig._tweener=null}var i=e.alpha!=this._owner.alpha,s=e.rotation!=this._owner.rotation;(i||s)&&(this._owner.checkGearController(0,this._controller)&&(this._tweenConfig._displayLockToken=this._owner.addDisplayLock()),this._tweenConfig._tweener=t.GTween.to2(this._owner.alpha,this._owner.rotation,e.alpha,e.rotation,this._tweenConfig.duration).setDelay(this._tweenConfig.delay).setEase(this._tweenConfig.easeType).setUserData((i?1:0)+(s?2:0)).setTarget(this).onUpdate(this.__tweenUpdate,this).onComplete(this.__tweenComplete,this))}else this._owner._gearLocked=!0,this._owner.grayed=e.grayed,this._owner.alpha=e.alpha,this._owner.rotation=e.rotation,this._owner.touchable=e.touchable,this._owner._gearLocked=!1}},{key:"__tweenUpdate",value:function(t){var e=t.userData;this._owner._gearLocked=!0,0!=(1&e)&&(this._owner.alpha=t.value.x),0!=(2&e)&&(this._owner.rotation=t.value.y),this._owner._gearLocked=!1}},{key:"__tweenComplete",value:function(){0!=this._tweenConfig._displayLockToken&&(this._owner.releaseDisplayLock(this._tweenConfig._displayLockToken),this._tweenConfig._displayLockToken=0),this._tweenConfig._tweener=null}},{key:"updateState",value:function(){var t=this._storage[this._controller.selectedPageId];t||(t={},this._storage[this._controller.selectedPageId]=t),t.alpha=this._owner.alpha,t.rotation=this._owner.rotation,t.grayed=this._owner.grayed,t.touchable=this._owner.touchable}}]),s}(t.GearBase);t.GearLook=e}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(t){return _classCallCheck(this,s),i.call(this,t)}return _createClass(s,[{key:"init",value:function(){this._default={width:this._owner.width,height:this._owner.height,scaleX:this._owner.scaleX,scaleY:this._owner.scaleY},this._storage={}}},{key:"addStatus",value:function(t,e){var i;t?(i={},this._storage[t]=i):i=this._default,i.width=e.readInt(),i.height=e.readInt(),i.scaleX=e.readFloat(),i.scaleY=e.readFloat()}},{key:"apply",value:function(){var e=this._storage[this._controller.selectedPageId]||this._default;if(this._tweenConfig&&this._tweenConfig.tween&&0==t.constructingDepth.n&&!t.GearBase.disableAllTweenEffect){if(this._tweenConfig._tweener){if(this._tweenConfig._tweener.endValue.x==e.width&&this._tweenConfig._tweener.endValue.y==e.height&&this._tweenConfig._tweener.endValue.z==e.scaleX&&this._tweenConfig._tweener.endValue.w==e.scaleY)return;this._tweenConfig._tweener.kill(!0),this._tweenConfig._tweener=null}var i=e.width!=this._owner.width||e.height!=this._owner.height,s=e.scaleX!=this._owner.scaleX||e.scaleY!=this._owner.scaleY;(i||s)&&(this._owner.checkGearController(0,this._controller)&&(this._tweenConfig._displayLockToken=this._owner.addDisplayLock()),this._tweenConfig._tweener=t.GTween.to4(this._owner.width,this._owner.height,this._owner.scaleX,this._owner.scaleY,e.width,e.height,e.scaleX,e.scaleY,this._tweenConfig.duration).setDelay(this._tweenConfig.delay).setEase(this._tweenConfig.easeType).setUserData((i?1:0)+(s?2:0)).setTarget(this).onUpdate(this.__tweenUpdate,this).onComplete(this.__tweenComplete,this))}else this._owner._gearLocked=!0,this._owner.setSize(e.width,e.height,this._owner.checkGearController(1,this._controller)),this._owner.setScale(e.scaleX,e.scaleY),this._owner._gearLocked=!1}},{key:"__tweenUpdate",value:function(t){var e=t.userData;this._owner._gearLocked=!0,0!=(1&e)&&this._owner.setSize(t.value.x,t.value.y,this._owner.checkGearController(1,this._controller)),0!=(2&e)&&this._owner.setScale(t.value.z,t.value.w),this._owner._gearLocked=!1}},{key:"__tweenComplete",value:function(){0!=this._tweenConfig._displayLockToken&&(this._owner.releaseDisplayLock(this._tweenConfig._displayLockToken),this._tweenConfig._displayLockToken=0),this._tweenConfig._tweener=null}},{key:"updateState",value:function(){var t=this._storage[this._controller.selectedPageId];t||(t={},this._storage[this._controller.selectedPageId]=t),t.width=this._owner.width,t.height=this._owner.height,t.scaleX=this._owner.scaleX,t.scaleY=this._owner.scaleY}},{key:"updateFromRelations",value:function(t,e){if(null!=this._controller&&null!=this._storage){for(var i in this._storage){var s=this._storage[i];s.width+=t,s.height+=e}this._default.width+=t,this._default.height+=e,this.updateState()}}}]),s}(t.GearBase);t.GearSize=e}(fgui||(fgui={})),function(t){var e=function(t){_inherits(i,t);var e=_createSuper(i);function i(t){return _classCallCheck(this,i),e.call(this,t)}return _createClass(i,[{key:"init",value:function(){this._default=this._owner.text,this._storage={}}},{key:"addStatus",value:function(t,e){null==t?this._default=e.readS():this._storage[t]=e.readS()}},{key:"apply",value:function(){this._owner._gearLocked=!0;var t=this._storage[this._controller.selectedPageId];this._owner.text=void 0!==t?t:this._default,this._owner._gearLocked=!1}},{key:"updateState",value:function(){this._storage[this._controller.selectedPageId]=this._owner.text}}]),i}(t.GearBase);t.GearText=e}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(t){return _classCallCheck(this,s),i.call(this,t)}return _createClass(s,[{key:"init",value:function(){this._default={x:this._owner.x,y:this._owner.y,px:this._owner.x/this._owner.parent.width,py:this._owner.y/this._owner.parent.height},this._storage={}}},{key:"addStatus",value:function(t,e){var i;t?(i={},this._storage[t]=i):i=this._default,i.x=e.readInt(),i.y=e.readInt()}},{key:"addExtStatus",value:function(t,e){var i;(i=t?this._storage[t]:this._default).px=e.readFloat(),i.py=e.readFloat()}},{key:"apply",value:function(){var e,i,s=this._storage[this._controller.selectedPageId]||this._default;if(this.positionsInPercent&&this._owner.parent?(e=s.px*this._owner.parent.width,i=s.py*this._owner.parent.height):(e=s.x,i=s.y),this._tweenConfig&&this._tweenConfig.tween&&0==t.constructingDepth.n&&!t.GearBase.disableAllTweenEffect){if(this._tweenConfig._tweener){if(this._tweenConfig._tweener.endValue.x==e&&this._tweenConfig._tweener.endValue.y==i)return;this._tweenConfig._tweener.kill(!0),this._tweenConfig._tweener=null}var n=this._owner.x,r=this._owner.y;n==e&&r==i||(this._owner.checkGearController(0,this._controller)&&(this._tweenConfig._displayLockToken=this._owner.addDisplayLock()),this._tweenConfig._tweener=t.GTween.to2(n,r,e,i,this._tweenConfig.duration).setDelay(this._tweenConfig.delay).setEase(this._tweenConfig.easeType).setTarget(this).onUpdate(this.__tweenUpdate,this).onComplete(this.__tweenComplete,this))}else this._owner._gearLocked=!0,this._owner.setPosition(e,i),this._owner._gearLocked=!1}},{key:"__tweenUpdate",value:function(t){this._owner._gearLocked=!0,this._owner.setPosition(t.value.x,t.value.y),this._owner._gearLocked=!1}},{key:"__tweenComplete",value:function(){0!=this._tweenConfig._displayLockToken&&(this._owner.releaseDisplayLock(this._tweenConfig._displayLockToken),this._tweenConfig._displayLockToken=0),this._tweenConfig._tweener=null}},{key:"updateState",value:function(){var t=this._storage[this._controller.selectedPageId];t||(t={},this._storage[this._controller.selectedPageId]=t),t.x=this._owner.x,t.y=this._owner.y,t.px=this._owner.x/this._owner.parent.width,t.py=this._owner.y/this._owner.parent.height}},{key:"updateFromRelations",value:function(t,e){if(null!=this._controller&&null!=this._storage&&!this.positionsInPercent){for(var i in this._storage){var s=this._storage[i];s.x+=t,s.y+=e}this._default.x+=t,this._default.y+=e,this.updateState()}}}]),s}(t.GearBase);t.GearXY=e}(fgui||(fgui={})),function(t){var e=.5*Math.PI,i=2*Math.PI;function s(t,e){return 1-n(e-t,e)}function n(t,e){return(t/=e)<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}t.evaluateEase=function(r,a,o,h,l){switch(r){case t.EaseType.Linear:return a/o;case t.EaseType.SineIn:return 1-Math.cos(a/o*e);case t.EaseType.SineOut:return Math.sin(a/o*e);case t.EaseType.SineInOut:return-.5*(Math.cos(Math.PI*a/o)-1);case t.EaseType.QuadIn:return(a/=o)*a;case t.EaseType.QuadOut:return-(a/=o)*(a-2);case t.EaseType.QuadInOut:return(a/=.5*o)<1?.5*a*a:-.5*(--a*(a-2)-1);case t.EaseType.CubicIn:return(a/=o)*a*a;case t.EaseType.CubicOut:return(a=a/o-1)*a*a+1;case t.EaseType.CubicInOut:return(a/=.5*o)<1?.5*a*a*a:.5*((a-=2)*a*a+2);case t.EaseType.QuartIn:return(a/=o)*a*a*a;case t.EaseType.QuartOut:return-((a=a/o-1)*a*a*a-1);case t.EaseType.QuartInOut:return(a/=.5*o)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2);case t.EaseType.QuintIn:return(a/=o)*a*a*a*a;case t.EaseType.QuintOut:return(a=a/o-1)*a*a*a*a+1;case t.EaseType.QuintInOut:return(a/=.5*o)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2);case t.EaseType.ExpoIn:return 0==a?0:Math.pow(2,10*(a/o-1));case t.EaseType.ExpoOut:return a==o?1:1-Math.pow(2,-10*a/o);case t.EaseType.ExpoInOut:return 0==a?0:a==o?1:(a/=.5*o)<1?.5*Math.pow(2,10*(a-1)):.5*(2-Math.pow(2,-10*--a));case t.EaseType.CircIn:return-(Math.sqrt(1-(a/=o)*a)-1);case t.EaseType.CircOut:return Math.sqrt(1-(a=a/o-1)*a);case t.EaseType.CircInOut:return(a/=.5*o)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1);case t.EaseType.ElasticIn:var u;return 0==a?0:1==(a/=o)?1:(0==l&&(l=.3*o),h<1?(h=1,u=l/4):u=l/i*Math.asin(1/h),-h*Math.pow(2,10*(a-=1))*Math.sin((a*o-u)*i/l));case t.EaseType.ElasticOut:var c;return 0==a?0:1==(a/=o)?1:(0==l&&(l=.3*o),h<1?(h=1,c=l/4):c=l/i*Math.asin(1/h),h*Math.pow(2,-10*a)*Math.sin((a*o-c)*i/l)+1);case t.EaseType.ElasticInOut:var _;return 0==a?0:2==(a/=.5*o)?1:(0==l&&(l=o*(.3*1.5)),h<1?(h=1,_=l/4):_=l/i*Math.asin(1/h),a<1?h*Math.pow(2,10*(a-=1))*Math.sin((a*o-_)*i/l)*-.5:h*Math.pow(2,-10*(a-=1))*Math.sin((a*o-_)*i/l)*.5+1);case t.EaseType.BackIn:return(a/=o)*a*((h+1)*a-h);case t.EaseType.BackOut:return(a=a/o-1)*a*((h+1)*a+h)+1;case t.EaseType.BackInOut:return(a/=.5*o)<1?a*a*((1+(h*=1.525))*a-h)*.5:.5*((a-=2)*a*((1+(h*=1.525))*a+h)+2);case t.EaseType.BounceIn:return s(a,o);case t.EaseType.BounceOut:return n(a,o);case t.EaseType.BounceInOut:return function(t,e){if(t<.5*e)return.5*s(2*t,e);return.5*n(2*t-e,e)+.5}(a,o);default:return-(a/=o)*(a-2)}}}(fgui||(fgui={})),function(t){!function(t){t[t.Linear=0]="Linear",t[t.SineIn=1]="SineIn",t[t.SineOut=2]="SineOut",t[t.SineInOut=3]="SineInOut",t[t.QuadIn=4]="QuadIn",t[t.QuadOut=5]="QuadOut",t[t.QuadInOut=6]="QuadInOut",t[t.CubicIn=7]="CubicIn",t[t.CubicOut=8]="CubicOut",t[t.CubicInOut=9]="CubicInOut",t[t.QuartIn=10]="QuartIn",t[t.QuartOut=11]="QuartOut",t[t.QuartInOut=12]="QuartInOut",t[t.QuintIn=13]="QuintIn",t[t.QuintOut=14]="QuintOut",t[t.QuintInOut=15]="QuintInOut",t[t.ExpoIn=16]="ExpoIn",t[t.ExpoOut=17]="ExpoOut",t[t.ExpoInOut=18]="ExpoInOut",t[t.CircIn=19]="CircIn",t[t.CircOut=20]="CircOut",t[t.CircInOut=21]="CircInOut",t[t.ElasticIn=22]="ElasticIn",t[t.ElasticOut=23]="ElasticOut",t[t.ElasticInOut=24]="ElasticInOut",t[t.BackIn=25]="BackIn",t[t.BackOut=26]="BackOut",t[t.BackInOut=27]="BackInOut",t[t.BounceIn=28]="BounceIn",t[t.BounceOut=29]="BounceOut",t[t.BounceInOut=30]="BounceInOut",t[t.Custom=31]="Custom"}(t.EaseType||(t.EaseType={}))}(fgui||(fgui={})),function(t){var e=function(){function e(){_classCallCheck(this,e),this._segments=new Array,this._points=new Array}return _createClass(e,[{key:"create2",value:function(t,e,i,s){var n=new Array;n.push(t),n.push(e),i&&n.push(i),s&&n.push(s),this.create(n)}},{key:"create",value:function(e){this._segments.length=0,this._points.length=0,this._fullLength=0;var s=e.length;if(0!=s){var n=[],r=e[0];r.curveType==t.CurveType.CRSpline&&n.push(new THREE.Vector2(r.x,r.y));for(var a=1;a<s;a++){var o=e[a];if(r.curveType!=t.CurveType.CRSpline){var h=new i;h.type=r.curveType,h.ptStart=this._points.length,r.curveType==t.CurveType.Straight?(h.ptCount=2,this._points.push(new THREE.Vector2(r.x,r.y)),this._points.push(new THREE.Vector2(o.x,o.y))):r.curveType==t.CurveType.Bezier?(h.ptCount=3,this._points.push(new THREE.Vector2(r.x,r.y)),this._points.push(new THREE.Vector2(o.x,o.y)),this._points.push(new THREE.Vector2(r.control1_x,r.control1_y))):r.curveType==t.CurveType.CubicBezier&&(h.ptCount=4,this._points.push(new THREE.Vector2(r.x,r.y)),this._points.push(new THREE.Vector2(o.x,o.y)),this._points.push(new THREE.Vector2(r.control1_x,r.control1_y)),this._points.push(new THREE.Vector2(r.control2_x,r.control2_y))),h.length=t.distance(r.x,r.y,o.x,o.y),this._fullLength+=h.length,this._segments.push(h)}o.curveType!=t.CurveType.CRSpline?n.length>0&&(n.push(new THREE.Vector2(o.x,o.y)),this.createSplineSegment(n)):n.push(new THREE.Vector2(o.x,o.y)),r=o}n.length>1&&this.createSplineSegment(n)}}},{key:"createSplineSegment",value:function(e){var s=e.length;e.splice(0,0,e[0]),e.push(e[s]),e.push(e[s]),s+=3;var n=new i;n.type=t.CurveType.CRSpline,n.ptStart=this._points.length,n.ptCount=s,this._points=this._points.concat(e),n.length=0;for(var r=1;r<s;r++)n.length+=t.distance(e[r-1].x,e[r-1].y,e[r].x,e[r].y);this._fullLength+=n.length,this._segments.push(n),e.length=0}},{key:"clear",value:function(){this._segments.length=0,this._points.length=0}},{key:"getPointAt",value:function(e,i){i?i.set(0,0):i=new THREE.Vector2,e=t.clamp01(e);var s,n=this._segments.length;if(0==n)return i;if(1==e)return(s=this._segments[n-1]).type==t.CurveType.Straight?(i.x=t.lerp(this._points[s.ptStart].x,this._points[s.ptStart+1].x,e),i.y=t.lerp(this._points[s.ptStart].y,this._points[s.ptStart+1].y,e),i):s.type==t.CurveType.Bezier||s.type==t.CurveType.CubicBezier?this.onBezierCurve(s.ptStart,s.ptCount,e,i):this.onCRSplineCurve(s.ptStart,s.ptCount,e,i);for(var r=e*this._fullLength,a=0;a<n;a++)if((r-=(s=this._segments[a]).length)<0){e=1+r/s.length,s.type==t.CurveType.Straight?(i.x=t.lerp(this._points[s.ptStart].x,this._points[s.ptStart+1].x,e),i.y=t.lerp(this._points[s.ptStart].y,this._points[s.ptStart+1].y,e)):i=s.type==t.CurveType.Bezier||s.type==t.CurveType.CubicBezier?this.onBezierCurve(s.ptStart,s.ptCount,e,i):this.onCRSplineCurve(s.ptStart,s.ptCount,e,i);break}return i}},{key:"getAnchorsInSegment",value:function(t,e){null==e&&(e=new Array);for(var i=this._segments[t],s=0;s<i.ptCount;s++)e.push(new THREE.Vector2(this._points[i.ptStart+s].x,this._points[i.ptStart+s].y));return e}},{key:"getPointsInSegment",value:function(e,i,s,n,r,a){null==n&&(n=new Array),a&&!isNaN(a)||(a=.1),r&&r.push(i);var o=this._segments[e];if(o.type==t.CurveType.Straight)n.push(new THREE.Vector2(t.lerp(this._points[o.ptStart].x,this._points[o.ptStart+1].x,i),t.lerp(this._points[o.ptStart].y,this._points[o.ptStart+1].y,i))),n.push(new THREE.Vector2(t.lerp(this._points[o.ptStart].x,this._points[o.ptStart+1].x,s),t.lerp(this._points[o.ptStart].y,this._points[o.ptStart+1].y,s)));else{var h;h=o.type==t.CurveType.Bezier||o.type==t.CurveType.CubicBezier?this.onBezierCurve:this.onCRSplineCurve,n.push(h.call(this,o.ptStart,o.ptCount,i,new THREE.Vector2));for(var l=Math.min(o.length*a,50),u=0;u<=l;u++){var c=u/l;c>i&&c<s&&(n.push(h.call(this,o.ptStart,o.ptCount,c,new THREE.Vector2)),r&&r.push(c))}n.push(h.call(this,o.ptStart,o.ptCount,s,new THREE.Vector2))}return r&&r.push(s),n}},{key:"getAllPoints",value:function(t,e,i){null==t&&(t=new Array),i&&!isNaN(i)||(i=.1);for(var s=this._segments.length,n=0;n<s;n++)this.getPointsInSegment(n,0,1,t,e,i);return t}},{key:"onCRSplineCurve",value:function(e,i,s,n){var r=Math.floor(s*(i-4))+e,a=this._points[r].x,o=this._points[r].y,h=this._points[r+1].x,l=this._points[r+1].y,u=this._points[r+2].x,c=this._points[r+2].y,_=this._points[r+3].x,d=this._points[r+3].y,g=1==s?1:t.repeat(s*(i-4),1),f=((2-g)*g-1)*g*.5,p=.5*((3*g-5)*g*g+2),y=((-3*g+4)*g+1)*g*.5,v=(g-1)*g*g*.5;return n.x=a*f+h*p+u*y+_*v,n.y=o*f+l*p+c*y+d*v,n}},{key:"onBezierCurve",value:function(t,e,i,s){var n=1-i,r=this._points[t].x,a=this._points[t].y,o=this._points[t+1].x,h=this._points[t+1].y,l=this._points[t+2].x,u=this._points[t+2].y;if(4==e){var c=this._points[t+3].x,_=this._points[t+3].y;s.x=n*n*n*r+3*n*n*i*l+3*n*i*i*c+i*i*i*o,s.y=n*n*n*a+3*n*n*i*u+3*n*i*i*_+i*i*i*h}else s.x=n*n*r+2*n*i*l+i*i*o,s.y=n*n*a+2*n*i*u+i*i*h;return s}},{key:"length",get:function(){return this._fullLength}},{key:"segmentCount",get:function(){return this._segments.length}}]),e}();t.GPath=e;var i=function t(){_classCallCheck(this,t)}}(fgui||(fgui={})),function(t){var e;!function(t){t[t.CRSpline=0]="CRSpline",t[t.Bezier=1]="Bezier",t[t.CubicBezier=2]="CubicBezier",t[t.Straight=3]="Straight"}(e=t.CurveType||(t.CurveType={}));var i=function(){function t(){_classCallCheck(this,t),this.x=0,this.y=0,this.control1_x=0,this.control1_y=0,this.control2_x=0,this.control2_y=0,this.curveType=0}return _createClass(t,[{key:"clone",value:function(){var e=new t;return e.x=this.x,e.y=this.y,e.control1_x=this.control1_x,e.control1_y=this.control1_y,e.control2_x=this.control2_x,e.control2_y=this.control2_y,e.curveType=this.curveType,e}}],[{key:"newPoint",value:function(i,s,n){var r=new t;return r.x=i||0,r.y=s||0,r.control1_x=0,r.control1_y=0,r.control2_x=0,r.control2_y=0,r.curveType=n||e.CRSpline,r}},{key:"newBezierPoint",value:function(i,s,n,r){var a=new t;return a.x=i||0,a.y=s||0,a.control1_x=n||0,a.control1_y=r||0,a.control2_x=0,a.control2_y=0,a.curveType=e.Bezier,a}},{key:"newCubicBezierPoint",value:function(i,s,n,r,a,o){var h=new t;return h.x=i||0,h.y=s||0,h.control1_x=n||0,h.control1_y=r||0,h.control2_x=a||0,h.control2_y=o||0,h.curveType=e.CubicBezier,h}}]),t}();t.GPathPoint=i}(fgui||(fgui={})),function(t){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"to",value:function(e,i,s){return t.TweenManager.createTween()._to(e,i,s)}},{key:"to2",value:function(e,i,s,n,r){return t.TweenManager.createTween()._to2(e,i,s,n,r)}},{key:"to3",value:function(e,i,s,n,r,a,o){return t.TweenManager.createTween()._to3(e,i,s,n,r,a,o)}},{key:"to4",value:function(e,i,s,n,r,a,o,h,l){return t.TweenManager.createTween()._to4(e,i,s,n,r,a,o,h,l)}},{key:"toColor",value:function(e,i,s){return t.TweenManager.createTween()._toColor(e,i,s)}},{key:"delayedCall",value:function(e){return t.TweenManager.createTween().setDelay(e)}},{key:"shake",value:function(e,i,s,n){return t.TweenManager.createTween()._shake(e,i,s,n)}},{key:"isTweening",value:function(e,i){return t.TweenManager.isTweening(e,i)}},{key:"kill",value:function(e,i,s){t.TweenManager.killTweens(e,i,s)}},{key:"getTween",value:function(e,i){return t.TweenManager.getTween(e,i)}}]),e}();e.catchCallbackExceptions=!0,t.GTween=e}(fgui||(fgui={})),function(t){var e=new THREE.Vector2,i=function(){function i(){_classCallCheck(this,i),this._startValue=new t.TweenValue,this._endValue=new t.TweenValue,this._value=new t.TweenValue,this._deltaValue=new t.TweenValue,this._reset()}return _createClass(i,[{key:"setDelay",value:function(t){return this._delay=t,this}},{key:"setDuration",value:function(t){return this._duration=t,this}},{key:"setBreakpoint",value:function(t){return this._breakpoint=t,this}},{key:"setEase",value:function(t){return this._easeType=t,this}},{key:"setEasePeriod",value:function(t){return this._easePeriod=t,this}},{key:"setEaseOvershootOrAmplitude",value:function(t){return this._easeOvershootOrAmplitude=t,this}},{key:"setRepeat",value:function(t,e){return this._repeat=t,this._yoyo=e,this}},{key:"setTimeScale",value:function(t){return this._timeScale=t,this}},{key:"setSnapping",value:function(t){return this._snapping=t,this}},{key:"setTarget",value:function(t,e){return this._target=t,this._propType=e,this}},{key:"setPath",value:function(t){return this._path=t,this}},{key:"setUserData",value:function(t){return this._userData=t,this}},{key:"onUpdate",value:function(t,e){return this._onUpdate=t,this._onUpdateCaller=e,this}},{key:"onStart",value:function(t,e){return this._onStart=t,this._onStartCaller=e,this}},{key:"onComplete",value:function(t,e){return this._onComplete=t,this._onCompleteCaller=e,this}},{key:"setPaused",value:function(t){return this._paused=t,this}},{key:"seek",value:function(t){if(!this._killed){if(this._elapsedTime=t,this._elapsedTime<this._delay){if(!this._started)return;this._elapsedTime=this._delay}this.update()}}},{key:"kill",value:function(t){this._killed||(t&&(0==this._ended&&(this._breakpoint>=0?this._elapsedTime=this._delay+this._breakpoint:this._repeat>=0?this._elapsedTime=this._delay+this._duration*(this._repeat+1):this._elapsedTime=this._delay+2*this._duration,this.update()),this.callCompleteCallback()),this._killed=!0)}},{key:"_to",value:function(t,e,i){return this._valueSize=1,this._startValue.x=t,this._endValue.x=e,this._value.x=t,this._duration=i,this}},{key:"_to2",value:function(t,e,i,s,n){return this._valueSize=2,this._startValue.x=t,this._endValue.x=i,this._startValue.y=e,this._endValue.y=s,this._value.x=t,this._value.y=e,this._duration=n,this}},{key:"_to3",value:function(t,e,i,s,n,r,a){return this._valueSize=3,this._startValue.x=t,this._endValue.x=s,this._startValue.y=e,this._endValue.y=n,this._startValue.z=i,this._endValue.z=r,this._value.x=t,this._value.y=e,this._value.z=i,this._duration=a,this}},{key:"_to4",value:function(t,e,i,s,n,r,a,o,h){return this._valueSize=4,this._startValue.x=t,this._endValue.x=n,this._startValue.y=e,this._endValue.y=r,this._startValue.z=i,this._endValue.z=a,this._startValue.w=s,this._endValue.w=o,this._value.x=t,this._value.y=e,this._value.z=i,this._value.w=s,this._duration=h,this}},{key:"_toColor",value:function(t,e,i){return this._valueSize=4,this._startValue.color=t,this._endValue.color=e,this._value.color=t,this._duration=i,this}},{key:"_shake",value:function(t,e,i,s){return this._valueSize=5,this._startValue.x=t,this._startValue.y=e,this._startValue.w=i,this._duration=s,this}},{key:"_init",value:function(){this._delay=0,this._duration=0,this._breakpoint=-1,this._easeType=t.EaseType.QuadOut,this._timeScale=1,this._easePeriod=0,this._easeOvershootOrAmplitude=1.70158,this._snapping=!1,this._repeat=0,this._yoyo=!1,this._valueSize=0,this._started=!1,this._paused=!1,this._killed=!1,this._elapsedTime=0,this._normalizedTime=0,this._ended=0}},{key:"_reset",value:function(){this._target=null,this._propType=null,this._userData=null,this._path=null,this._onStart=this._onUpdate=this._onComplete=null,this._onStartCaller=this._onUpdateCaller=this._onCompleteCaller=null}},{key:"_update",value:function(t){if(1!=this._timeScale&&(t*=this._timeScale),0!=t){if(0!=this._ended)return this.callCompleteCallback(),void(this._killed=!0);this._elapsedTime+=t,this.update(),0!=this._ended&&(this._killed||(this.callCompleteCallback(),this._killed=!0))}}},{key:"update",value:function(){if(this._ended=0,0!=this._valueSize){if(!this._started){if(this._elapsedTime<this._delay)return;if(this._started=!0,this.callStartCallback(),this._killed)return}var i=!1,s=this._elapsedTime-this._delay;if(this._breakpoint>=0&&s>=this._breakpoint&&(s=this._breakpoint,this._ended=2),0!=this._repeat){var n=Math.floor(s/this._duration);s-=this._duration*n,this._yoyo&&(i=n%2==1),this._repeat>0&&this._repeat-n<0&&(this._yoyo&&(i=this._repeat%2==1),s=this._duration,this._ended=1)}else s>=this._duration&&(s=this._duration,this._ended=1);if(this._normalizedTime=t.evaluateEase(this._easeType,i?this._duration-s:s,this._duration,this._easeOvershootOrAmplitude,this._easePeriod),this._value.setZero(),this._deltaValue.setZero(),5==this._valueSize)if(0==this._ended){var r=this._startValue.w*(1-this._normalizedTime),a=r*(Math.random()>.5?1:-1),o=r*(Math.random()>.5?1:-1);this._deltaValue.x=a,this._deltaValue.y=o,this._value.x=this._startValue.x+a,this._value.y=this._startValue.y+o}else this._value.x=this._startValue.x,this._value.y=this._startValue.y;else if(this._path){var h=this._path.getPointAt(this._normalizedTime,e);this._snapping&&(h.x=Math.round(h.x),h.y=Math.round(h.y)),this._deltaValue.x=h.x-this._value.x,this._deltaValue.y=h.y-this._value.y,this._value.x=h.x,this._value.y=h.y}else for(var l=0;l<this._valueSize;l++){var u=this._startValue.getField(l),c=u+(this._endValue.getField(l)-u)*this._normalizedTime;this._snapping&&(c=Math.round(c)),this._deltaValue.setField(l,c-this._value.getField(l)),this._value.setField(l,c)}if(this._target&&this._propType)if(this._propType instanceof Function)switch(this._valueSize){case 1:this._propType.call(this._target,this._value.x);break;case 2:this._propType.call(this._target,this._value.x,this._value.y);break;case 3:this._propType.call(this._target,this._value.x,this._value.y,this._value.z);break;case 4:this._propType.call(this._target,this._value.x,this._value.y,this._value.z,this._value.w);break;case 5:this._propType.call(this._target,this._value.color);break;case 6:this._propType.call(this._target,this._value.x,this._value.y)}else 5==this._valueSize?this._target[this._propType]=this._value.color:this._target[this._propType]=this._value.x;this.callUpdateCallback()}else this._elapsedTime>=this._delay+this._duration&&(this._ended=1)}},{key:"callStartCallback",value:function(){if(this._onStart)try{this._onStart.call(this._onStartCaller,this)}catch(t){console.log("error in start callback > "+t)}}},{key:"callUpdateCallback",value:function(){if(this._onUpdate)try{this._onUpdate.call(this._onUpdateCaller,this)}catch(t){console.log("error in update callback > "+t)}}},{key:"callCompleteCallback",value:function(){if(this._onComplete)try{this._onComplete.call(this._onCompleteCaller,this)}catch(t){console.log("error in complete callback > "+t)}}},{key:"delay",get:function(){return this._delay}},{key:"duration",get:function(){return this._duration}},{key:"repeat",get:function(){return this._repeat}},{key:"target",get:function(){return this._target}},{key:"userData",get:function(){return this._userData}},{key:"startValue",get:function(){return this._startValue}},{key:"endValue",get:function(){return this._endValue}},{key:"value",get:function(){return this._value}},{key:"deltaValue",get:function(){return this._deltaValue}},{key:"normalizedTime",get:function(){return this._normalizedTime}},{key:"completed",get:function(){return 0!=this._ended}},{key:"allCompleted",get:function(){return 1==this._ended}}]),i}();t.GTweener=i}(fgui||(fgui={})),function(t){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"createTween",value:function(){r||(t.Timers.addUpdate(e.update),r=!0);var a=s.borrow();return i[n++]=a,a}},{key:"isTweening",value:function(t,e){if(null==t)return!1;for(var s=!e,r=0;r<n;r++){var a=i[r];if(a&&a.target==t&&!a._killed&&(s||a._propType==e))return!0}return!1}},{key:"killTweens",value:function(t,e,s){if(null==t)return!1;for(var r=!1,a=n,o=!s,h=0;h<a;h++){var l=i[h];!l||l.target!=t||l._killed||!o&&l._propType!=s||(l.kill(e),r=!0)}return r}},{key:"getTween",value:function(t,e){if(null==t)return null;for(var s=n,r=!e,a=0;a<s;a++){var o=i[a];if(o&&o.target==t&&!o._killed&&(r||o._propType==e))return o}return null}},{key:"update",value:function(){for(var e=t.Timers.deltaTime/1e3,r=n,a=-1,o=0;o<r;o++){var h=i[o];null==h?-1==a&&(a=o):h._killed?(s.returns(h),i[o]=null,-1==a&&(a=o)):(h._target instanceof t.GObject&&h._target.isDisposed?h._killed=!0:h._paused||h._update(e),-1!=a&&(i[a]=h,i[o]=null,a++))}if(a>=0){if(n!=r){var l=r;for(r=n-r,o=0;o<r;o++)i[a++]=i[l++]}n=a}}}]),e}();t.TweenManager=e;var i=new Array,s=new t.Pool(t.GTweener,(function(t){return t._init()}),(function(t){return t._reset()})),n=0,r=!1}(fgui||(fgui={})),function(t){var e=function(){function t(){_classCallCheck(this,t),this.x=this.y=this.z=this.w=0}return _createClass(t,[{key:"getField",value:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("Index out of bounds: "+t)}}},{key:"setField",value:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("Index out of bounds: "+t)}}},{key:"setZero",value:function(){this.x=this.y=this.z=this.w=0}},{key:"color",get:function(){return(this.w<<24)+(this.x<<16)+(this.y<<8)+this.z},set:function(t){this.x=(16711680&t)>>16,this.y=(65280&t)>>8,this.z=255&t,this.w=(4278190080&t)>>24}}]),t}();t.TweenValue=e}(fgui||(fgui={})),function(t){var e=function(){function e(){_classCallCheck(this,e),this._itemList=new Array,this._objectPool=[]}return _createClass(e,[{key:"createObject",value:function(e,i){var s=t.UIPackage.getByName(e);if(!s)throw new Error("package not found: "+e);var n=s.getItemByName(i);if(!n)throw new Error("resource not found: "+i);this.internalCreateObject(n)}},{key:"createObjectFromURL",value:function(e){var i=t.UIPackage.getItemByURL(e);if(!i)throw new Error("resource not found: "+e);this.internalCreateObject(i)}},{key:"cancel",value:function(){if(t.Timers.remove(this.run,this),this._itemList.length=0,this._objectPool.length>0){for(var e=this._objectPool.length,i=0;i<e;i++)this._objectPool[i].dispose();this._objectPool.length=0}}},{key:"internalCreateObject",value:function(e){this._itemList.length=0,this._objectPool.length=0;var s=new i(e,t.ObjectType.Component);s.childCount=this.collectComponentChildren(e),this._itemList.push(s),this._index=0,t.Timers.addUpdate(this.run,this)}},{key:"collectComponentChildren",value:function(e){var s,n,r,a,o,h,l=e.rawData;l.seek(0,2);var u=l.readShort();for(r=0;r<u;r++){a=l.readShort(),o=l.pos,l.seek(o,0);var c=l.readByte(),_=l.readS(),d=l.readS();l.pos=o,null!=_?(n=null!=(h=null!=d?t.UIPackage.getById(d):e.owner)?h.getItemById(_):null,s=new i(n,c),null!=n&&n.type==t.PackageItemType.Component&&(s.childCount=this.collectComponentChildren(n))):(s=new i(null,c),c==t.ObjectType.List&&(s.listItemCount=this.collectListChildren(l))),this._itemList.push(s),l.pos=o+a}return u}},{key:"collectListChildren",value:function(e){e.seek(e.pos,8);var s,n,r,a,o,h=0,l=e.readS(),u=e.readShort();for(s=0;s<u;s++)n=e.readShort(),n+=e.pos,null==(r=e.readS())&&(r=l),r&&null!=(a=t.UIPackage.getItemByURL(r))&&(o=new i(a,a.objectType),a.type==t.PackageItemType.Component&&(o.childCount=this.collectComponentChildren(a)),this._itemList.push(o),h++),e.pos=n;return h}},{key:"run",value:function(){for(var e,i,s,n,r=performance.now(),a=t.UIConfig.frameTimeForAsyncUIConstruction,o=this._itemList.length;this._index<o;){if(null!=(i=this._itemList[this._index]).packageItem)e=t.UIObjectFactory.newObject(i.packageItem),this._objectPool.push(e),t.constructingDepth.n++,i.packageItem.type==t.PackageItemType.Component?(s=this._objectPool.length-i.childCount-1,e.constructFromResource2(this._objectPool,s),this._objectPool.splice(s,i.childCount)):e.constructFromResource(),t.constructingDepth.n--;else if(e=t.UIObjectFactory.newObject(i.type),this._objectPool.push(e),i.type==t.ObjectType.List&&i.listItemCount>0){for(s=this._objectPool.length-i.listItemCount-1,n=0;n<i.listItemCount;n++)e.itemPool.returnObject(this._objectPool[n+s]);this._objectPool.splice(s,i.listItemCount)}if(this._index++,this._index%5==0&&performance.now()-r>=a)return}t.Timers.remove(this.run,this);var h=this._objectPool[0];this._itemList.length=0,this._objectPool.length=0,null!=this.callback&&this.callback(h)}}]),e}();t.AsyncOperation=e;var i=function t(e,i){_classCallCheck(this,t),this.packageItem=e,this.type=i}}(fgui||(fgui={})),function(t){var e=0,i=function(i){_inherits(r,i);var n=_createSuper(r);function r(){var t;return _classCallCheck(this,r),(t=n.call(this))._selectedIndex=0,t._previousIndex=0,t.changing=!1,t._pageIds=[],t._pageNames=[],t._selectedIndex=-1,t._previousIndex=-1,t}return _createClass(r,[{key:"dispose",value:function(){this.offAll()}},{key:"setSelectedIndex",value:function(t){if(this._selectedIndex!=t){if(t>this._pageIds.length-1)throw"index out of bounds: "+t;this.changing=!0,this._previousIndex=this._selectedIndex,this._selectedIndex=t,this.parent.applyController(this),this.changing=!1}}},{key:"setSelectedPage",value:function(t){var e=this._pageNames.indexOf(t);-1==e&&(e=0),this.setSelectedIndex(e)}},{key:"getPageName",value:function(t){return this._pageNames[t]}},{key:"addPage",value:function(t){t=t||"",this.addPageAt(t,this._pageIds.length)}},{key:"addPageAt",value:function(t,i){t=t||"";var s=""+e++;null==i||i==this._pageIds.length?(this._pageIds.push(s),this._pageNames.push(this.name)):(this._pageIds.splice(i,0,s),this._pageNames.splice(i,0,this.name))}},{key:"removePage",value:function(t){var e=this._pageNames.indexOf(t);-1!=e&&(this._pageIds.splice(e,1),this._pageNames.splice(e,1),this._selectedIndex>=this._pageIds.length?this.selectedIndex=this._selectedIndex-1:this.parent.applyController(this))}},{key:"removePageAt",value:function(t){this._pageIds.splice(t,1),this._pageNames.splice(t,1),this._selectedIndex>=this._pageIds.length?this.selectedIndex=this._selectedIndex-1:this.parent.applyController(this)}},{key:"clearPages",value:function(){this._pageIds.length=0,this._pageNames.length=0,-1!=this._selectedIndex?this.selectedIndex=-1:this.parent.applyController(this)}},{key:"hasPage",value:function(t){return-1!=this._pageNames.indexOf(t)}},{key:"getPageIndexById",value:function(t){return this._pageIds.indexOf(t)}},{key:"getPageIdByName",value:function(t){var e=this._pageNames.indexOf(t);return-1!=e?this._pageIds[e]:null}},{key:"getPageNameById",value:function(t){var e=this._pageIds.indexOf(t);return-1!=e?this._pageNames[e]:null}},{key:"getPageId",value:function(t){return this._pageIds[t]}},{key:"runActions",value:function(){if(this._actions)for(var t=this._actions.length,e=0;e<t;e++)this._actions[e].run(this,this.previousPageId,this.selectedPageId)}},{key:"setup",value:function(e){var i,n,r=e.pos;e.seek(r,0),this.name=e.readS(),this.autoRadioGroupDepth=e.readBool(),e.seek(r,1);var a=e.readShort();for(i=0;i<a;i++)this._pageIds.push(e.readS()),this._pageNames.push(e.readS());var o=0;if(e.version>=2)switch(e.readByte()){case 1:o=e.readShort();break;case 2:-1==(o=this._pageNames.indexOf(t.UIPackage.branch))&&(o=0);break;case 3:-1==(o=this._pageNames.indexOf(t.UIPackage.getVar(e.readS())))&&(o=0)}if(e.seek(r,2),(a=e.readShort())>0)for(null==this._actions&&(this._actions=[]),i=0;i<a;i++){n=e.readShort(),n+=e.pos;var h=s(e.readByte());h.setup(e),this._actions.push(h),e.pos=n}this.parent&&this._pageIds.length>0?this._selectedIndex=o:this._selectedIndex=-1}},{key:"selectedIndex",get:function(){return this._selectedIndex},set:function(t){if(this._selectedIndex!=t){if(t>this._pageIds.length-1)throw"index out of bounds: "+t;this.changing=!0,this._previousIndex=this._selectedIndex,this._selectedIndex=t,this.parent.applyController(this),this.dispatchEvent("status_changed"),this.changing=!1}}},{key:"previsousIndex",get:function(){return this._previousIndex}},{key:"selectedPage",get:function(){return-1==this._selectedIndex?null:this._pageNames[this._selectedIndex]},set:function(t){var e=this._pageNames.indexOf(t);-1==e&&(e=0),this.selectedIndex=e}},{key:"previousPage",get:function(){return-1==this._previousIndex?null:this._pageNames[this._previousIndex]}},{key:"pageCount",get:function(){return this._pageIds.length}},{key:"selectedPageId",get:function(){return-1==this._selectedIndex?null:this._pageIds[this._selectedIndex]},set:function(t){var e=this._pageIds.indexOf(t);this.selectedIndex=e}},{key:"oppositePageId",set:function(t){this._pageIds.indexOf(t)>0?this.selectedIndex=0:this._pageIds.length>1&&(this.selectedIndex=1)}},{key:"previousPageId",get:function(){return-1==this._previousIndex?null:this._pageIds[this._previousIndex]}}]),r}(t.EventDispatcher);function s(e){switch(e){case 0:return new t.PlayTransitionAction;case 1:return new t.ChangePageAction}return null}t.Controller=i}(fgui||(fgui={})),function(t){var e,i=function(){function i(){_classCallCheck(this,i);var e=this._agent=new t.GLoader;e.draggable=!0,e.touchable=!1,e.setSize(100,100),e.setPivot(.5,.5,!0),e.align="center",e.verticalAlign="middle",e.sortingOrder=1e6,e.on("drag_end",this.__dragEnd,this)}return _createClass(i,[{key:"startDrag",value:function(e,i,s){if(!this._agent.parent){this._sourceData=i,this._agent.url=e,t.GRoot.inst.addChild(this._agent);var n=t.GRoot.inst.globalToLocal(t.Stage.touchPos.x,t.Stage.touchPos.y);this._agent.setPosition(n.x,n.y),this._agent.startDrag(null!=s?s:-1)}}},{key:"cancel",value:function(){this._agent.parent&&(this._agent.stopDrag(),t.GRoot.inst.removeChild(this._agent),this._sourceData=null)}},{key:"__dragEnd",value:function(e){if(null!=this._agent.parent){t.GRoot.inst.removeChild(this._agent);var i=this._sourceData;this._sourceData=null;for(var s=t.GObject.cast(t.Stage.touchTarget);s;){if(s.hasListener("drop"))return void s.dispatchEvent("drop",i);s=s.parent}}}},{key:"dragAgent",get:function(){return this._agent}},{key:"dragging",get:function(){return null!=this._agent.parent}}],[{key:"inst",get:function(){return e||(e=new i),e}}]),i}();t.DragDropManager=i}(fgui||(fgui={})),function(t){!function(t){t[t.Common=0]="Common",t[t.Check=1]="Check",t[t.Radio=2]="Radio"}(t.ButtonMode||(t.ButtonMode={})),function(t){t[t.None=0]="None",t[t.Both=1]="Both",t[t.Height=2]="Height",t[t.Shrink=3]="Shrink"}(t.AutoSizeType||(t.AutoSizeType={})),function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"}(t.AlignType||(t.AlignType={})),function(t){t[t.Top=0]="Top",t[t.Middle=1]="Middle",t[t.Bottom=2]="Bottom"}(t.VertAlignType||(t.VertAlignType={})),function(t){t[t.None=0]="None",t[t.Scale=1]="Scale",t[t.ScaleMatchHeight=2]="ScaleMatchHeight",t[t.ScaleMatchWidth=3]="ScaleMatchWidth",t[t.ScaleFree=4]="ScaleFree",t[t.ScaleNoBorder=5]="ScaleNoBorder"}(t.LoaderFillType||(t.LoaderFillType={})),function(t){t[t.SingleColumn=0]="SingleColumn",t[t.SingleRow=1]="SingleRow",t[t.FlowHorizontal=2]="FlowHorizontal",t[t.FlowVertical=3]="FlowVertical",t[t.Pagination=4]="Pagination"}(t.ListLayoutType||(t.ListLayoutType={})),function(t){t[t.Single=0]="Single",t[t.Multiple=1]="Multiple",t[t.Multiple_SingleClick=2]="Multiple_SingleClick",t[t.None=3]="None"}(t.ListSelectionMode||(t.ListSelectionMode={})),function(t){t[t.Visible=0]="Visible",t[t.Hidden=1]="Hidden",t[t.Scroll=2]="Scroll"}(t.OverflowType||(t.OverflowType={})),function(t){t[t.Image=0]="Image",t[t.MovieClip=1]="MovieClip",t[t.Sound=2]="Sound",t[t.Component=3]="Component",t[t.Atlas=4]="Atlas",t[t.Font=5]="Font",t[t.Swf=6]="Swf",t[t.Misc=7]="Misc",t[t.Unknown=8]="Unknown"}(t.PackageItemType||(t.PackageItemType={})),function(t){t[t.Image=0]="Image",t[t.MovieClip=1]="MovieClip",t[t.Swf=2]="Swf",t[t.Graph=3]="Graph",t[t.Loader=4]="Loader",t[t.Group=5]="Group",t[t.Text=6]="Text",t[t.RichText=7]="RichText",t[t.InputText=8]="InputText",t[t.Component=9]="Component",t[t.List=10]="List",t[t.Label=11]="Label",t[t.Button=12]="Button",t[t.ComboBox=13]="ComboBox",t[t.ProgressBar=14]="ProgressBar",t[t.Slider=15]="Slider",t[t.ScrollBar=16]="ScrollBar",t[t.Tree=17]="Tree",t[t.Loader3D=18]="Loader3D"}(t.ObjectType||(t.ObjectType={})),function(t){t[t.Percent=0]="Percent",t[t.ValueAndMax=1]="ValueAndMax",t[t.Value=2]="Value",t[t.Max=3]="Max"}(t.ProgressTitleType||(t.ProgressTitleType={})),function(t){t[t.Default=0]="Default",t[t.Visible=1]="Visible",t[t.Auto=2]="Auto",t[t.Hidden=3]="Hidden"}(t.ScrollBarDisplayType||(t.ScrollBarDisplayType={})),function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Both=2]="Both"}(t.ScrollType||(t.ScrollType={})),function(t){t[t.None=0]="None",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical",t[t.Both=3]="Both"}(t.FlipType||(t.FlipType={})),function(t){t[t.Ascent=0]="Ascent",t[t.Descent=1]="Descent",t[t.Arch=2]="Arch"}(t.ChildrenRenderOrder||(t.ChildrenRenderOrder={})),function(t){t[t.None=0]="None",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical"}(t.GroupLayoutType||(t.GroupLayoutType={})),function(t){t[t.Auto=0]="Auto",t[t.Up=1]="Up",t[t.Down=2]="Down"}(t.PopupDirection||(t.PopupDirection={})),function(t){t[t.Left_Left=0]="Left_Left",t[t.Left_Center=1]="Left_Center",t[t.Left_Right=2]="Left_Right",t[t.Center_Center=3]="Center_Center",t[t.Right_Left=4]="Right_Left",t[t.Right_Center=5]="Right_Center",t[t.Right_Right=6]="Right_Right",t[t.Top_Top=7]="Top_Top",t[t.Top_Middle=8]="Top_Middle",t[t.Top_Bottom=9]="Top_Bottom",t[t.Middle_Middle=10]="Middle_Middle",t[t.Bottom_Top=11]="Bottom_Top",t[t.Bottom_Middle=12]="Bottom_Middle",t[t.Bottom_Bottom=13]="Bottom_Bottom",t[t.Width=14]="Width",t[t.Height=15]="Height",t[t.LeftExt_Left=16]="LeftExt_Left",t[t.LeftExt_Right=17]="LeftExt_Right",t[t.RightExt_Left=18]="RightExt_Left",t[t.RightExt_Right=19]="RightExt_Right",t[t.TopExt_Top=20]="TopExt_Top",t[t.TopExt_Bottom=21]="TopExt_Bottom",t[t.BottomExt_Top=22]="BottomExt_Top",t[t.BottomExt_Bottom=23]="BottomExt_Bottom",t[t.Size=24]="Size"}(t.RelationType||(t.RelationType={})),function(t){t[t.None=0]="None",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical",t[t.Radial90=3]="Radial90",t[t.Radial180=4]="Radial180",t[t.Radial360=5]="Radial360"}(t.FillMethod||(t.FillMethod={})),function(t){t[t.Top=0]="Top",t[t.Bottom=1]="Bottom",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.TopLeft=0]="TopLeft",t[t.TopRight=1]="TopRight",t[t.BottomLeft=2]="BottomLeft",t[t.BottomRight=3]="BottomRight"}(t.FillOrigin||(t.FillOrigin={})),function(t){t[t.TopLeft=0]="TopLeft",t[t.TopRight=1]="TopRight",t[t.BottomLeft=2]="BottomLeft",t[t.BottomRight=3]="BottomRight"}(t.FillOrigin90||(t.FillOrigin90={})),function(t){t[t.Text=0]="Text",t[t.Icon=1]="Icon",t[t.Color=2]="Color",t[t.OutlineColor=3]="OutlineColor",t[t.Playing=4]="Playing",t[t.Frame=5]="Frame",t[t.DeltaTime=6]="DeltaTime",t[t.TimeScale=7]="TimeScale",t[t.FontSize=8]="FontSize",t[t.Selected=9]="Selected"}(t.ObjectPropID||(t.ObjectPropID={}))}(fgui||(fgui={})),function(t){var e=function(){function e(){_classCallCheck(this,e),this._x=0,this._y=0,this._z=0,this._alpha=1,this._visible=!0,this._touchable=!0,this._scaleX=1,this._scaleY=1,this._skewX=0,this._skewY=0,this._pivotX=0,this._pivotY=0,this._sortingOrder=0,this._internalVisible=!0,this.minWidth=0,this.minHeight=0,this.maxWidth=0,this.maxHeight=0,this.sourceWidth=0,this.sourceHeight=0,this.initWidth=0,this.initHeight=0,this._width=0,this._height=0,this._rawWidth=0,this._rawHeight=0,this._sizePercentInGroup=0,this._dragTouchStartPos=new THREE.Vector2,this._dragTesting=!1,this._id=""+t.gInstanceCounter++,this._name="",this.createDisplayObject(),this._displayObject.$owner=this,this._relations=new t.Relations(this),this._gears=new Array(10)}return _createClass(e,[{key:"setPosition",value:function(i,n,r){if(this._x!=i||this._y!=n){var a=i-this._x,h=n-this._y;this._x=i,this._y=n,null!=r&&(this._z=r),this.handlePositionChanged(),this instanceof t.GGroup&&this.moveChildren(a,h),this.updateGear(1),this._parent&&!("itemRenderer"in this._parent)&&(this._parent.setBoundsChangedFlag(),this._group&&this._group.setBoundsChangedFlag(!0),this.dispatchEvent("pos_changed")),e.draggingObject!=this||s||this.localToGlobalRect(0,0,this.width,this.height,o)}}},{key:"center",value:function(e){var i;i=this._parent?this.parent:t.Decls.GRoot.inst,this.setPosition(Math.floor((i.width-this.width)/2),Math.floor((i.height-this.height)/2)),e&&(this.addRelation(i,t.RelationType.Center_Center),this.addRelation(i,t.RelationType.Middle_Middle))}},{key:"setSize",value:function(e,i,s){if(this._rawWidth!=e||this._rawHeight!=i){this._rawWidth=e,this._rawHeight=i,e<this.minWidth&&(e=this.minWidth),i<this.minHeight&&(i=this.minHeight),this.maxWidth>0&&e>this.maxWidth&&(e=this.maxWidth),this.maxHeight>0&&i>this.maxHeight&&(i=this.maxHeight);var n=e-this._width,r=i-this._height;this._width=e,this._height=i,this.handleSizeChanged(),0==this._pivotX&&0==this._pivotY||(this._pivotAsAnchor||s?this.handlePositionChanged():this.setPosition(this.x-this._pivotX*n,this.y-this._pivotY*r)),this instanceof t.GGroup&&this.resizeChildren(n,r),this.updateGear(2),this._parent&&(this._relations.onOwnerSizeChanged(n,r,this._pivotAsAnchor||!s),this._parent.setBoundsChangedFlag(),this._group&&this._group.setBoundsChangedFlag()),this.dispatchEvent("size_changed")}}},{key:"setSizeDirectly",value:function(t,e){this._rawWidth=t,this._rawHeight=e,t<0&&(t=0),e<0&&(e=0),this._width=t,this._height=e}},{key:"makeFullScreen",value:function(){this.setSize(t.Decls.GRoot.inst.width,t.Decls.GRoot.inst.height)}},{key:"setScale",value:function(t,e){this._scaleX==t&&this._scaleY==e||(this._scaleX=t,this._scaleY=e,this.handleScaleChanged(),this.updateGear(2))}},{key:"setSkew",value:function(t,e){this._skewX==t&&this._skewY==e||(this._skewX=t,this._skewY=e)}},{key:"setPivot",value:function(t,e,i){i=i||!1,this._pivotX==t&&this._pivotY==e&&this._pivotAsAnchor==i||(this._pivotX=t,this._pivotY=e,this._pivotAsAnchor=i,this._displayObject.setPivot(t,e),this.handlePositionChanged())}},{key:"__rollOver",value:function(){t.Timers.callDelay(100,this.__doShowTooltips,this)}},{key:"__doShowTooltips",value:function(){t.Decls.GRoot.findFor(this).showTooltips(this._tooltips)}},{key:"__rollOut",value:function(){t.Timers.remove(this.__doShowTooltips,this),t.Decls.GRoot.findFor(this).hideTooltips()}},{key:"getGear",value:function(t){var e=this._gears[t];return null==e&&(this._gears[t]=e=function(t,e){return new i[e](t)}(this,t)),e}},{key:"updateGear",value:function(t){if(!this._underConstruct&&!this._gearLocked){var e=this._gears[t];e&&e.controller&&e.updateState()}}},{key:"checkGearController",value:function(t,e){return this._gears[t]&&this._gears[t].controller==e}},{key:"updateGearFromRelations",value:function(t,e,i){this._gears[t]&&this._gears[t].updateFromRelations(e,i)}},{key:"addDisplayLock",value:function(){var t=this._gears[0];if(t&&t.controller){var e=t.addLock();return this.checkGearDisplay(),e}return 0}},{key:"releaseDisplayLock",value:function(t){var e=this._gears[0];e&&e.controller&&(e.releaseLock(t),this.checkGearDisplay())}},{key:"checkGearDisplay",value:function(){if(!this._handlingController){var t=null==this._gears[0]||this._gears[0].connected;this._gears[8]&&(t=this._gears[8].evaluate(t)),t!=this._internalVisible&&(this._internalVisible=t,this._parent&&(this._parent.childStateChanged(this),this._group&&this._group.excludeInvisibles&&this._group.setBoundsChangedFlag()))}}},{key:"addRelation",value:function(t,e,i){this._relations.add(t,e,i)}},{key:"removeRelation",value:function(t,e){this._relations.remove(t,e)}},{key:"removeFromParent",value:function(){this._parent&&this._parent.removeChild(this)}},{key:"dispose",value:function(){this.removeFromParent(),this._relations.dispose(),this._displayObject.dispose(),this._displayObject=null;for(var t=0;t<10;t++){var e=this._gears[t];e&&e.dispose()}}},{key:"on",value:function(t,e,i,s){this._displayObject.on(t,e,i,s)}},{key:"off",value:function(t,e,i,s){this._displayObject.off(t,e,i,s)}},{key:"offAll",value:function(t){this._displayObject.offAll(t)}},{key:"hasListener",value:function(t,e,i,s){return this._displayObject.hasListener(t,e,i,s)}},{key:"dispatchEvent",value:function(t,e){return this._displayObject.dispatchEvent(t,e)}},{key:"onClick",value:function(t,e){this.on("click",t,e)}},{key:"offClick",value:function(t,e){this.off("click",t,e)}},{key:"hasClickListener",value:function(){return this.hasListener("click")}},{key:"startDrag",value:function(t){null!=this._displayObject.stage&&(null==t&&(t=-1),this.dragBegin(t))}},{key:"stopDrag",value:function(){this.dragEnd()}},{key:"localToGlobal",value:function(t,e,i){return t=t||0,e=e||0,this._pivotAsAnchor&&(t+=this._pivotX*this._width,e+=this._pivotY*this._height),this._displayObject.localToGlobal(t,e,i)}},{key:"globalToLocal",value:function(t,e,i){return t=t||0,e=e||0,i=this._displayObject.globalToLocal(t,e,i),this._pivotAsAnchor&&(i.x-=this._pivotX*this._width,i.y-=this._pivotY*this._height),i}},{key:"localToRoot",value:function(e,i,s){var n=t.Decls.GRoot.findFor(this),r=this.localToGlobal(e,i,s);return n.globalToLocal(r.x,r.y,r)}},{key:"rootToLocal",value:function(e,i,s){var n=t.Decls.GRoot.findFor(this).localToGlobal(e,i,s);return this.globalToLocal(n.x,n.y,n)}},{key:"localToGlobalRect",value:function(e,i,s,r,a){a||(a=new t.Rect);var o=this.localToGlobal(e,i,n);return a.x=o.x,a.y=o.y,o=this.localToGlobal(e+s,i+r,n),a.width=o.x-a.x,a.height=o.y-a.y,a}},{key:"globalToLocalRect",value:function(e,i,s,r,a){a||(a=new t.Rect);var o=this.globalToLocal(e,i,n);return a.x=o.x,a.y=o.y,o=this.globalToLocal(e+s,i+r,n),a.width=o.x-a.x,a.height=o.y-a.y,a}},{key:"handleControllerChanged",value:function(t){this._handlingController=!0;for(var e=0;e<10;e++){var i=this._gears[e];i&&i.controller==t&&i.apply()}this._handlingController=!1,this.checkGearDisplay()}},{key:"createDisplayObject",value:function(){this._displayObject=new t.DisplayObject}},{key:"handlePositionChanged",value:function(){var t=this._x,e=this._y;this._pivotAsAnchor||(t+=this._pivotX*this._width,e+=this._pivotY*this._height),this._displayObject.setPosition(t,e,this._z,!0)}},{key:"handleSizeChanged",value:function(){this._displayObject.setSize(this._width,this._height)}},{key:"handleScaleChanged",value:function(){this._displayObject.setScale(this._scaleX,this._scaleY)}},{key:"handleGrayedChanged",value:function(){this._displayObject.graphics&&(this._displayObject.graphics.grayed=this._grayed)}},{key:"handleAlphaChanged",value:function(){this._displayObject.alpha=this._alpha}},{key:"handleVisibleChanged",value:function(){this._displayObject.visible=this.internalVisible2}},{key:"getProp",value:function(e){switch(e){case t.ObjectPropID.Text:return this.text;case t.ObjectPropID.Icon:return this.icon;case t.ObjectPropID.Color:case t.ObjectPropID.OutlineColor:return null;case t.ObjectPropID.Playing:return!1;case t.ObjectPropID.Frame:case t.ObjectPropID.DeltaTime:return 0;case t.ObjectPropID.TimeScale:return 1;case t.ObjectPropID.FontSize:return 0;case t.ObjectPropID.Selected:return!1;default:return}}},{key:"setProp",value:function(e,i){switch(e){case t.ObjectPropID.Text:this.text=i;break;case t.ObjectPropID.Icon:this.icon=i}}},{key:"constructFromResource",value:function(){}},{key:"setup_beforeAdd",value:function(t,e){var i,s;t.seek(e,0),t.skip(5),this._id=t.readS(),this._name=t.readS(),i=t.readInt(),s=t.readInt(),this.setPosition(i,s),t.readBool()&&(this.initWidth=t.readInt(),this.initHeight=t.readInt(),this.setSize(this.initWidth,this.initHeight,!0)),t.readBool()&&(this.minWidth=t.readInt(),this.maxWidth=t.readInt(),this.minHeight=t.readInt(),this.maxHeight=t.readInt()),t.readBool()&&(i=t.readFloat(),s=t.readFloat(),this.setScale(i,s)),t.readBool()&&(i=t.readFloat(),s=t.readFloat(),this.setSkew(i,s)),t.readBool()&&(i=t.readFloat(),s=t.readFloat(),this.setPivot(i,s,t.readBool())),1!=(i=t.readFloat())&&(this.alpha=i),0!=(i=t.readFloat())&&(this.rotation=i),t.readBool()||(this.visible=!1),t.readBool()||(this.touchable=!1),t.readBool()&&(this.grayed=!0);var n=t.readByte();this.blendMode=h[n]||THREE.NormalBlending;t.readByte();var r=t.readS();null!=r&&(this.data=r)}},{key:"setup_afterAdd",value:function(t,e){t.seek(e,1);var i=t.readS();i&&(this.tooltips=i);var s=t.readShort();s>=0&&(this.group=this.parent.getChildAt(s)),t.seek(e,2);for(var n=t.readShort(),r=0;r<n;r++){var a=t.readShort();a+=t.pos,this.getGear(t.readByte()).setup(t),t.pos=a}}},{key:"initDrag",value:function(){this._draggable?(this.on("touch_begin",this.__touchBegin,this),this.on("touch_move",this.__touchMove,this),this.on("touch_end",this.__touchEnd,this)):(this.off("touch_begin",this.__touchBegin,this),this.off("touch_move",this.__touchMove,this),this.off("touch_end",this.__touchEnd,this))}},{key:"dragBegin",value:function(i){if(e.draggingObject){var s=e.draggingObject;e.draggingObject.stopDrag(),e.draggingObject=null,s.dispatchEvent("drag_end")}this.on("touch_move",this.__touchMove,this),this.on("touch_end",this.__touchEnd,this),t.Stage.getTouchPos(i,a),this.localToGlobalRect(0,0,this.width,this.height,o),this._dragTesting=!1,e.draggingObject=this,t.Stage.addTouchMonitor(i,this._displayObject)}},{key:"dragEnd",value:function(){e.draggingObject==this&&(this._dragTesting=!1,e.draggingObject=null)}},{key:"__touchBegin",value:function(t){null==this._dragTouchStartPos&&(this._dragTouchStartPos=new THREE.Vector2),this._dragTouchStartPos.set(t.input.x,t.input.y),this._dragTesting=!0,t.captureTouch()}},{key:"__touchMove",value:function(i){if(this._dragTesting&&e.draggingObject!=this){var h;if(h=t.Stage.touchScreen?t.UIConfig.touchDragSensitivity:t.UIConfig.clickDragSensitivity,Math.abs(this._dragTouchStartPos.x-i.input.x)<h&&Math.abs(this._dragTouchStartPos.y-i.input.y)<h)return;this._dragTesting=!1,this.dispatchEvent("drag_start",i.input.touchId)||this.dragBegin(i.input.touchId)}if(e.draggingObject==this){var l=i.input.x-a.x+o.x,u=i.input.y-a.y+o.y;if(this._dragBounds){var c=t.Decls.GRoot.findFor(this).localToGlobalRect(this._dragBounds.x,this._dragBounds.y,this._dragBounds.width,this._dragBounds.height,r);(l<c.x||l+o.width>c.xMax&&(l=c.xMax-o.width)<c.x)&&(l=c.x),(u<c.y||u+o.height>c.yMax&&(u=c.yMax-o.height)<c.y)&&(u=c.y)}var _=this.parent.globalToLocal(l,u,n);s=!0,this.setPosition(Math.round(_.x),Math.round(_.y)),s=!1,this.dispatchEvent("drag_move")}}},{key:"__touchEnd",value:function(){e.draggingObject==this&&(e.draggingObject=null,this.dispatchEvent("drag_end"))}},{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"x",get:function(){return this._x},set:function(t){this.setPosition(t,this._y)}},{key:"y",get:function(){return this._y},set:function(t){this.setPosition(this._x,t)}},{key:"z",get:function(){return this._z},set:function(t){this.setPosition(this._x,this._y,t)}},{key:"xMin",get:function(){return this._pivotAsAnchor?this._x-this._width*this._pivotX:this._x},set:function(t){this._pivotAsAnchor?this.setPosition(t+this._width*this._pivotX,this._y):this.setPosition(t,this._y)}},{key:"yMin",get:function(){return this._pivotAsAnchor?this._y-this._height*this._pivotY:this._y},set:function(t){this._pivotAsAnchor?this.setPosition(this._x,t+this._height*this._pivotY):this.setPosition(this._x,t)}},{key:"width",get:function(){return this._width},set:function(t){this.setSize(t,this._rawHeight)}},{key:"height",get:function(){return this._height},set:function(t){this.setSize(this._rawWidth,t)}},{key:"actualWidth",get:function(){return this.width*Math.abs(this._scaleX)}},{key:"actualHeight",get:function(){return this.height*Math.abs(this._scaleY)}},{key:"scaleX",get:function(){return this._scaleX},set:function(t){this.setScale(t,this._scaleY)}},{key:"scaleY",get:function(){return this._scaleY},set:function(t){this.setScale(this._scaleX,t)}},{key:"skewX",get:function(){return this._skewX},set:function(t){this.setSkew(t,this._skewY)}},{key:"skewY",get:function(){return this._skewY},set:function(t){this.setSkew(this._skewX,t)}},{key:"pivotX",get:function(){return this._pivotX},set:function(t){this.setPivot(t,this._pivotY)}},{key:"pivotY",get:function(){return this._pivotY},set:function(t){this.setPivot(this._pivotX,t)}},{key:"pivotAsAnchor",get:function(){return this._pivotAsAnchor}},{key:"touchable",get:function(){return this._touchable},set:function(t){this._touchable!=t&&(this._touchable=t,this.updateGear(3),this._displayObject.touchable=this._touchable)}},{key:"grayed",get:function(){return this._grayed},set:function(t){this._grayed!=t&&(this._grayed=t,this.handleGrayedChanged(),this.updateGear(3))}},{key:"enabled",get:function(){return!this._grayed&&this._touchable},set:function(t){this.grayed=!t,this.touchable=t}},{key:"rotation",get:function(){return this._displayObject.rotation},set:function(t){this._displayObject.rotation!=t&&(this._displayObject.rotation=t,this.updateGear(3))}},{key:"rotationX",get:function(){return this._displayObject.rotationX},set:function(t){this._displayObject.rotationX=t}},{key:"rotationY",get:function(){return this._displayObject.rotationY},set:function(t){this._displayObject.rotationY=t}},{key:"alpha",get:function(){return this._alpha},set:function(t){this._alpha!=t&&(this._alpha=t,this.handleAlphaChanged(),this.updateGear(3))}},{key:"visible",get:function(){return this._visible},set:function(t){this._visible!=t&&(this._visible=t,this.handleVisibleChanged(),this._parent&&this._parent.setBoundsChangedFlag(),this._group&&this._group.excludeInvisibles&&this._group.setBoundsChangedFlag())}},{key:"internalVisible",get:function(){return this._internalVisible&&(!this._group||this._group.internalVisible)}},{key:"internalVisible2",get:function(){return this._visible&&(!this._group||this._group.internalVisible2)}},{key:"internalVisible3",get:function(){return this._internalVisible&&this._visible}},{key:"sortingOrder",get:function(){return this._sortingOrder},set:function(t){if(t<0&&(t=0),this._sortingOrder!=t){var e=this._sortingOrder;this._sortingOrder=t,this._parent&&this._parent.childSortingOrderChanged(this,e,this._sortingOrder)}}},{key:"tooltips",get:function(){return this._tooltips},set:function(t){this._tooltips&&(this.off("roll_over",this.__rollOver,this),this.off("roll_out",this.__rollOut,this)),this._tooltips=t,this._tooltips&&(this.on("roll_over",this.__rollOver,this),this.on("roll_out",this.__rollOut,this))}},{key:"blendMode",get:function(){return this._displayObject.blendMode},set:function(t){this._displayObject.blendMode=t}},{key:"onStage",get:function(){return null!=this._displayObject.stage}},{key:"resourceURL",get:function(){return this.packageItem?"ui://"+this.packageItem.owner.id+this.packageItem.id:null}},{key:"group",set:function(t){this._group!=t&&(this._group&&this._group.setBoundsChangedFlag(),this._group=t,this._group&&this._group.setBoundsChangedFlag())},get:function(){return this._group}},{key:"relations",get:function(){return this._relations}},{key:"displayObject",get:function(){return this._displayObject}},{key:"obj3D",get:function(){return this._displayObject.obj3D}},{key:"parent",get:function(){return this._parent},set:function(t){this._parent=t}},{key:"asCom",get:function(){return this}},{key:"text",get:function(){return null},set:function(t){}},{key:"icon",get:function(){return null},set:function(t){}},{key:"treeNode",get:function(){return this._treeNode}},{key:"isDisposed",get:function(){return null==this._displayObject}},{key:"draggable",get:function(){return this._draggable},set:function(t){this._draggable!=t&&(this._draggable=t,this.initDrag())}},{key:"dragBounds",get:function(){return this._dragBounds},set:function(t){this._dragBounds=t}},{key:"dragging",get:function(){return e.draggingObject==this}}],[{key:"cast",value:function(t){var e;if(t instanceof THREE.Object3D){if(!(e=t.$owner))return null}else e=t;return e.$owner}}]),e}();t.GObject=e;var i=[t.GearDisplay,t.GearXY,t.GearSize,t.GearLook,t.GearColor,t.GearAnimation,t.GearText,t.GearIcon,t.GearDisplay2,t.GearFontSize];var s,n=new THREE.Vector2,r=new t.Rect,a=new THREE.Vector2,o=new t.Rect,h={0:THREE.NormalBlending,1:THREE.NoBlending,2:THREE.AdditiveBlending,3:THREE.MultiplyBlending,4:THREE.SubtractiveBlending};t.gInstanceCounter=0,t.constructingDepth={n:0}}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(){var e;return _classCallCheck(this,s),(e=i.call(this))._sortingChildCount=0,e._children=[],e._controllers=[],e._transitions=[],e._margin=new t.Margin,e._alignOffset=new THREE.Vector2,e._childrenRenderOrder=0,e._apexIndex=0,e}return _createClass(s,[{key:"createDisplayObject",value:function(){_get(_getPrototypeOf(s.prototype),"createDisplayObject",this).call(this),this._container=new t.DisplayObject,this._displayObject=this._container}},{key:"dispose",value:function(){var t,e;for(e=this._transitions.length,t=0;t<e;++t){this._transitions[t].dispose()}for(e=this._controllers.length,t=0;t<e;++t){this._controllers[t].dispose()}for(this.scrollPane&&this.scrollPane.dispose(),t=(e=this._children.length)-1;t>=0;--t){var i=this._children[t];i.parent=null,i.dispose()}this._boundsChanged=!1,_get(_getPrototypeOf(s.prototype),"dispose",this).call(this)}},{key:"addChild",value:function(t){return this.addChildAt(t,this._children.length),t}},{key:"addChildAt",value:function(t,e){if(!t)throw"child is null";if(e>=0&&e<=this._children.length){if(t.parent==this)this.setChildIndex(t,e);else{t.removeFromParent(),t.parent=this;var i=this._children.length;0!=t.sortingOrder?(this._sortingChildCount++,e=this.getInsertPosForSortingChild(t)):this._sortingChildCount>0&&e>i-this._sortingChildCount&&(e=i-this._sortingChildCount),e==i?this._children.push(t):this._children.splice(e,0,t),this.childStateChanged(t),this.setBoundsChangedFlag()}return t}throw"Invalid child index"}},{key:"getInsertPosForSortingChild",value:function(t){for(var e=this._children.length,i=0;i<e;i++){var s=this._children[i];if(s!=t&&t.sortingOrder<s.sortingOrder)break}return i}},{key:"removeChild",value:function(t,e){var i=this._children.indexOf(t);return-1!=i&&this.removeChildAt(i,e),t}},{key:"removeChildAt",value:function(e,i){if(e>=0&&e<this._children.length){var s=this._children[e];return s.parent=null,0!=s.sortingOrder&&this._sortingChildCount--,this._children.splice(e,1),s.group=null,s.displayObject.parent&&(this._container.removeChild(s.displayObject),this._childrenRenderOrder==t.ChildrenRenderOrder.Arch&&t.Timers.callLater(this.buildNativeDisplayList,this)),i&&s.dispose(),this.setBoundsChangedFlag(),s}throw"Invalid child index"}},{key:"removeChildren",value:function(t,e,i){t=t||0,null==e&&(e=-1),(e<0||e>=this._children.length)&&(e=this._children.length-1);for(var s=t;s<=e;++s)this.removeChildAt(t,i)}},{key:"getChildAt",value:function(t){if(t>=0&&t<this._children.length)return this._children[t];throw"Invalid child index"}},{key:"getChild",value:function(t){for(var e=this._children.length,i=0;i<e;++i)if(this._children[i].name==t)return this._children[i];return null}},{key:"getChildByPath",value:function(t){for(var e,i=t.split("."),n=i.length,r=this,a=0;a<n&&(e=r.getChild(i[a]));++a)if(a!=n-1){if(!(r instanceof s)){e=null;break}r=e}return e}},{key:"getVisibleChild",value:function(t){for(var e=this._children.length,i=0;i<e;++i){var s=this._children[i];if(s.internalVisible&&s.internalVisible2&&s.name==t)return s}return null}},{key:"getChildInGroup",value:function(t,e){for(var i=this._children.length,s=0;s<i;++s){var n=this._children[s];if(n.group==e&&n.name==t)return n}return null}},{key:"getChildById",value:function(t){for(var e=this._children.length,i=0;i<e;++i)if(this._children[i]._id==t)return this._children[i];return null}},{key:"getChildIndex",value:function(t){return this._children.indexOf(t)}},{key:"setChildIndex",value:function(t,e){var i=this._children.indexOf(t);if(-1==i)throw"Not a child of this container";if(0==t.sortingOrder){var s=this._children.length;this._sortingChildCount>0&&e>s-this._sortingChildCount-1&&(e=s-this._sortingChildCount-1),this._setChildIndex(t,i,e)}}},{key:"setChildIndexBefore",value:function(t,e){var i=this._children.indexOf(t);if(-1==i)throw"Not a child of this container";if(0!=t.sortingOrder)return i;var s=this._children.length;return this._sortingChildCount>0&&e>s-this._sortingChildCount-1&&(e=s-this._sortingChildCount-1),i<e?this._setChildIndex(t,i,e-1):this._setChildIndex(t,i,e)}},{key:"_setChildIndex",value:function(e,i,s){var n=this._children.length;if(s>n&&(s=n),i==s)return i;if(this._children.splice(i,1),this._children.splice(s,0,e),e.displayObject.parent){var r,a=0;if(this._childrenRenderOrder==t.ChildrenRenderOrder.Ascent){for(r=0;r<s;r++)this._children[r].displayObject.parent&&a++;a==this._container.numChildren&&a--,this._container.setChildIndex(e.displayObject,a)}else if(this._childrenRenderOrder==t.ChildrenRenderOrder.Descent){for(r=n-1;r>s;r--)this._children[r].displayObject.parent&&a++;a==this._container.numChildren&&a--,this._container.setChildIndex(e.displayObject,a)}else t.Timers.callLater(this.buildNativeDisplayList,this);this.setBoundsChangedFlag()}return s}},{key:"swapChildren",value:function(t,e){var i=this._children.indexOf(t),s=this._children.indexOf(e);if(-1==i||-1==s)throw"Not a child of this container";this.swapChildrenAt(i,s)}},{key:"swapChildrenAt",value:function(t,e){var i=this._children[t],s=this._children[e];this.setChildIndex(i,e),this.setChildIndex(s,t)}},{key:"isAncestorOf",value:function(t){if(null==t)return!1;for(var e=t.parent;e;){if(e==this)return!0;e=e.parent}return!1}},{key:"addController",value:function(t){this._controllers.push(t),t.parent=this,this.applyController(t)}},{key:"getControllerAt",value:function(t){return this._controllers[t]}},{key:"getController",value:function(t){for(var e=this._controllers.length,i=0;i<e;++i){var s=this._controllers[i];if(s.name==t)return s}return null}},{key:"removeController",value:function(t){var e=this._controllers.indexOf(t);if(-1==e)throw new Error("controller not exists");t.parent=null,this._controllers.splice(e,1);for(var i=this._children.length,s=0;s<i;s++){this._children[s].handleControllerChanged(t)}}},{key:"childStateChanged",value:function(e){if(!this._buildingDisplayList){var i=this._children.length;if(e instanceof t.GGroup)for(var s=0;s<i;s++){var n=this._children[s];n.group==e&&this.childStateChanged(n)}else if(e.internalVisible){if(!e.displayObject.parent){var r=0;if(this._childrenRenderOrder==t.ChildrenRenderOrder.Ascent){for(var a=0;a<i;a++){var o=this._children[a];if(o==e)break;o.displayObject.parent&&r++}this._container.addChildAt(e.displayObject,r)}else if(this._childrenRenderOrder==t.ChildrenRenderOrder.Descent){for(var h=i-1;h>=0;h--){var l=this._children[h];if(l==e)break;l.displayObject.parent&&r++}this._container.addChildAt(e.displayObject,r)}else this._container.addChild(e.displayObject),t.Timers.callLater(this.buildNativeDisplayList,this)}}else e.displayObject.parent&&(this._container.removeChild(e.displayObject),this._childrenRenderOrder==t.ChildrenRenderOrder.Arch&&t.Timers.callLater(this.buildNativeDisplayList,this))}}},{key:"buildNativeDisplayList",value:function(){if(this._displayObject){var e=this._children.length;if(0!=e)switch(this._childrenRenderOrder){case t.ChildrenRenderOrder.Ascent:for(var i=0;i<e;i++){var s=this._children[i];s.internalVisible&&this._container.addChild(s.displayObject)}break;case t.ChildrenRenderOrder.Descent:for(var n=e-1;n>=0;n--){var r=this._children[n];r.internalVisible&&this._container.addChild(r.displayObject)}break;case t.ChildrenRenderOrder.Arch:for(var a=t.clamp(this._apexIndex,0,e),o=0;o<a;o++){var h=this._children[o];h.internalVisible&&this._container.addChild(h.displayObject)}for(var l=e-1;l>=a;l--){var u=this._children[l];u.internalVisible&&this._container.addChild(u.displayObject)}}}}},{key:"applyController",value:function(t){this._applyingController=t;for(var e=this._children.length,i=0;i<e;i++)this._children[i].handleControllerChanged(t);this._applyingController=null,t.runActions()}},{key:"applyAllControllers",value:function(){for(var t=this._controllers.length,e=0;e<t;++e)this.applyController(this._controllers[e])}},{key:"adjustRadioGroupDepth",value:function(t,e){for(var i=this._children.length,s=-1,n=-1,r=0;r<i;r++){var a=this._children[r];a==t?s=r:"relatedController"in a&&a.relatedController==e&&r>n&&(n=r)}s<n&&(this._applyingController&&this._children[n].handleControllerChanged(this._applyingController),this.swapChildrenAt(s,n))}},{key:"getTransitionAt",value:function(t){return this._transitions[t]}},{key:"getTransition",value:function(t){for(var e=this._transitions.length,i=0;i<e;++i){var s=this._transitions[i];if(s.name==t)return s}return null}},{key:"isChildInView",value:function(t){return this._displayObject.clipRect?t.x+t.width>=0&&t.x<=this.width&&t.y+t.height>=0&&t.y<=this.height:!this._scrollPane||this._scrollPane.isChildInView(t)}},{key:"getFirstChildInView",value:function(){for(var t=this._children.length,e=0;e<t;++e){var i=this._children[e];if(this.isChildInView(i))return e}return-1}},{key:"updateMask",value:function(){var e=this._displayObject.clipRect;null==e&&(e=new t.Rect),e.x=this._margin.left,e.y=this._margin.top,e.width=this._width-this._margin.right,e.height=this._height-this._margin.bottom,this._displayObject.clipRect=e}},{key:"setupScroll",value:function(e){this._displayObject==this._container&&(this._container=new t.DisplayObject,this._displayObject.addChild(this._container)),this._scrollPane=new t.ScrollPane(this),this._scrollPane.setup(e)}},{key:"setupOverflow",value:function(e){e==t.OverflowType.Hidden?(this._displayObject==this._container&&(this._container=new t.DisplayObject,this._displayObject.addChild(this._container)),this.updateMask(),this._container.setPosition(this._margin.left,this._margin.top)):0==this._margin.left&&0==this._margin.top||(this._displayObject==this._container&&(this._container=new t.DisplayObject,this._displayObject.addChild(this._container)),this._container.setPosition(this._margin.left,this._margin.top))}},{key:"handleSizeChanged",value:function(){_get(_getPrototypeOf(s.prototype),"handleSizeChanged",this).call(this),this._scrollPane?this._scrollPane.onOwnerSizeChanged():this._displayObject.clipRect&&this.updateMask()}},{key:"handleGrayedChanged",value:function(){var t=this.getController("grayed");if(t)t.selectedIndex=this.grayed?1:0;else for(var e=this.grayed,i=this._children.length,s=0;s<i;++s)this._children[s].grayed=e}},{key:"handleControllerChanged",value:function(t){_get(_getPrototypeOf(s.prototype),"handleControllerChanged",this).call(this,t),this._scrollPane&&this._scrollPane.handleControllerChanged(t)}},{key:"setBoundsChangedFlag",value:function(){(this._scrollPane||this._trackBounds)&&(this._boundsChanged||(this._boundsChanged=!0,t.Timers.callLater(this.__render,this)))}},{key:"__render",value:function(){this._boundsChanged&&this.updateBounds()}},{key:"ensureBoundsCorrect",value:function(){this._boundsChanged&&this.updateBounds()}},{key:"updateBounds",value:function(){var t=0,e=0,i=0,s=0,n=this._children.length;if(n>0){t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY;var r=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY,o=0,h=0;for(h=0;h<n;h++){var l=this._children[h];(o=l.x)<t&&(t=o),(o=l.y)<e&&(e=o),(o=l.x+l.actualWidth)>r&&(r=o),(o=l.y+l.actualHeight)>a&&(a=o)}i=r-t,s=a-e}this.setBounds(t,e,i,s)}},{key:"setBounds",value:function(t,e,i,s){this._boundsChanged=!1,this._scrollPane&&this._scrollPane.setContentSize(Math.round(t+i),Math.round(e+s))}},{key:"getSnappingPosition",value:function(t,e,i){return this.getSnappingPositionWithDir(t,e,0,0,i)}},{key:"getSnappingPositionWithDir",value:function(t,e,i,s,n){n||(n=new THREE.Vector2);var r=this._children.length;if(0==r)return n.x=0,n.y=0,n;this.ensureBoundsCorrect();var a=null,o=null,h=0;if(0!=e){for(;h<r;h++)if(e<(a=this._children[h]).y){if(0==h){e=0;break}e=e<(o=this._children[h-1]).y+o.actualHeight/2?o.y:a.y;break}h==r&&(e=a.y)}if(0!=t){for(h>0&&h--;h<r;h++)if(t<(a=this._children[h]).x){if(0==h){t=0;break}t=t<(o=this._children[h-1]).x+o.actualWidth/2?o.x:a.x;break}h==r&&(t=a.x)}return n.x=t,n.y=e,n}},{key:"childSortingOrderChanged",value:function(t,e,i){if(0==i)this._sortingChildCount--,this.setChildIndex(t,this._children.length);else{0==e&&this._sortingChildCount++;var s=this._children.indexOf(t),n=this.getInsertPosForSortingChild(t);s<n?this._setChildIndex(t,s,n-1):this._setChildIndex(t,s,n)}}},{key:"constructFromResource",value:function(){this.constructFromResource2(null,0)}},{key:"constructFromResource2",value:function(e,i){var s,n,r,a,o,h,l,u,c=this,_=this.packageItem.getBranch();_.decoded||(_.decoded=!0,t.TranslationHelper.translateComponent(_));var d=_.rawData;d.seek(0,0),this._underConstruct=!0,this.sourceWidth=d.readInt(),this.sourceHeight=d.readInt(),this.initWidth=this.sourceWidth,this.initHeight=this.sourceHeight,this.setSize(this.sourceWidth,this.sourceHeight),d.readBool()&&(this.minWidth=d.readInt(),this.maxWidth=d.readInt(),this.minHeight=d.readInt(),this.maxHeight=d.readInt()),d.readBool()&&(o=d.readFloat(),h=d.readFloat(),this.setPivot(o,h,d.readBool())),d.readBool()&&(this._margin.top=d.readInt(),this._margin.bottom=d.readInt(),this._margin.left=d.readInt(),this._margin.right=d.readInt());var g=d.readByte();if(g==t.OverflowType.Scroll){var f=d.pos;d.seek(0,7),this.setupScroll(d),d.pos=f}else this.setupOverflow(g);d.readBool()&&d.skip(8),this._buildingDisplayList=!0,d.seek(0,1);var p,y=d.readShort();for(s=0;s<y;s++){a=d.readShort(),a+=d.pos;var v=new t.Controller;this._controllers.push(v),v.parent=this,v.setup(d),d.pos=a}d.seek(0,2);var m=d.readShort();for(s=0;s<m;s++){if(n=d.readShort(),r=d.pos,e)p=e[i+s];else{d.seek(r,0);var w,k,x=d.readByte(),C=d.readS(),b=d.readS();if(C)w=(k=b?t.UIPackage.getById(b):_.owner)?k.getItemById(C):null;else w=null;w?(p=t.Decls.UIObjectFactory.newObject(w)).constructFromResource():p=t.Decls.UIObjectFactory.newObject(x)}p._underConstruct=!0,p.setup_beforeAdd(d,r),p.parent=this,this._children.push(p),d.pos=r+n}for(d.seek(0,3),this.relations.setup(d,!0),d.seek(0,2),d.skip(2),s=0;s<m;s++)a=d.readShort(),a+=d.pos,d.seek(d.pos,3),this._children[s].relations.setup(d,!1),d.pos=a;for(d.seek(0,2),d.skip(2),s=0;s<m;s++)a=d.readShort(),a+=d.pos,(p=this._children[s]).setup_afterAdd(d,d.pos),p._underConstruct=!1,d.pos=a;d.seek(0,4),d.skip(2),this.opaque=d.readBool(),-1!=d.readShort()&&d.readBool();var T=d.readS();l=d.readInt(),u=d.readInt(),T?(w=_.owner.getItemById(T))&&w.pixelHitTestData&&(this._displayObject.hitArea=new t.PixelHitTest(w.pixelHitTestData,l,u,this.sourceWidth,this.sourceHeight)):0!=l&&-1!=u&&(this._displayObject.hitArea=new t.ShapeHitTest(this.getChildAt(u).displayObject)),d.seek(0,5);var S=d.readShort();for(s=0;s<S;s++){a=d.readShort(),a+=d.pos;var I=new t.Transition(this);I.setup(d),this._transitions.push(I),d.pos=a}this._transitions.length>0&&(this.on("added_to_stage",(function(){c._transitions.forEach((function(t){return t.onOwnerAddedToStage()}))})),this.on("removed_from_stage",(function(){c._transitions.forEach((function(t){return t.onOwnerRemovedFromStage()}))}))),this.applyAllControllers(),this._buildingDisplayList=!1,this._underConstruct=!1,this.buildNativeDisplayList(),this.setBoundsChangedFlag(),_.objectType!=t.ObjectType.Component&&this.constructExtension(d),this.onConstruct()}},{key:"constructExtension",value:function(t){}},{key:"onConstruct",value:function(){}},{key:"setup_afterAdd",value:function(t,e){_get(_getPrototypeOf(s.prototype),"setup_afterAdd",this).call(this,t,e),t.seek(e,4);var i,n,r=t.readShort();for(-1!=r&&this._scrollPane&&(this._scrollPane.pageController=this._parent.getControllerAt(r)),i=t.readShort(),n=0;n<i;n++){var a=this.getController(t.readS()),o=t.readS();a&&(a.selectedPageId=o)}if(t.version>=2)for(i=t.readShort(),n=0;n<i;n++){var h=t.readS(),l=t.readShort(),u=t.readS(),c=this.getChildByPath(h);c&&c.setProp(l,u)}}},{key:"displayListContainer",get:function(){return this._container}},{key:"numChildren",get:function(){return this._children.length}},{key:"controllers",get:function(){return this._controllers}},{key:"scrollPane",get:function(){return this._scrollPane}},{key:"opaque",get:function(){return this._displayObject.opaque},set:function(t){this._displayObject.opaque=t}},{key:"margin",get:function(){return this._margin},set:function(t){this._margin.copy(t),this._displayObject.clipRect&&this._container.setPosition(this._margin.left+this._alignOffset.x,this._margin.top+this._alignOffset.y),this.handleSizeChanged()}},{key:"childrenRenderOrder",get:function(){return this._childrenRenderOrder},set:function(t){this._childrenRenderOrder!=t&&(this._childrenRenderOrder=t,this.buildNativeDisplayList())}},{key:"apexIndex",get:function(){return this._apexIndex},set:function(e){this._apexIndex!=e&&(this._apexIndex=e,this._childrenRenderOrder==t.ChildrenRenderOrder.Arch&&this.buildNativeDisplayList())}},{key:"baseUserData",get:function(){var t=this.packageItem.rawData;return t.seek(0,4),t.readS()}},{key:"viewWidth",get:function(){return this._scrollPane?this._scrollPane.viewWidth:this.width-this._margin.left-this._margin.right},set:function(t){this._scrollPane?this._scrollPane.viewWidth=t:this.width=t+this._margin.left+this._margin.right}},{key:"viewHeight",get:function(){return this._scrollPane?this._scrollPane.viewHeight:this.height-this._margin.top-this._margin.bottom},set:function(t){this._scrollPane?this._scrollPane.viewHeight=t:this.height=t+this._margin.top+this._margin.bottom}}]),s}(t.GObject);t.GComponent=e}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(){var e;return _classCallCheck(this,s),(e=i.call(this))._soundVolumeScale=0,e._downEffect=0,e._downEffectValue=0,e._downScaled=!1,e._mode=t.ButtonMode.Common,e._title="",e._icon="",e._sound=t.UIConfig.buttonSound,e._soundVolumeScale=t.UIConfig.buttonSoundVolumeScale,e._changeStateOnClick=!0,e._downEffectValue=.8,e}return _createClass(s,[{key:"getTextField",value:function(){return this._titleObject instanceof t.GTextField?this._titleObject:this._titleObject instanceof t.GLabel||this._titleObject instanceof s?this._titleObject.getTextField():null}},{key:"fireClick",value:function(e,i){var s=this;(e=e||!1)&&this._mode==t.ButtonMode.Common&&(this.setState("over"),t.Timers.add(100,1,this.setState,this,"down"),t.Timers.add(200,1,this.setState,this,(function(){s.setState("up"),i&&s.dispatchEvent("click")})))}},{key:"setState",value:function(e){if(this._buttonController&&(this._buttonController.selectedPage=e),1==this._downEffect){var i=this.numChildren;if("down"==e||"selectedOver"==e||"selectedDisabled"==e)for(var s=255*this._downEffectValue,n=(s<<16)+(s<<8)+s,r=0;r<i;r++){var a=this.getChildAt(r);a instanceof t.GTextField||a.setProp(t.ObjectPropID.Color,n)}else for(r=0;r<i;r++)(a=this.getChildAt(r))instanceof t.GTextField||a.setProp(t.ObjectPropID.Color,16777215)}else 2==this._downEffect&&("down"==e||"selectedOver"==e||"selectedDisabled"==e?this._downScaled||(this.setScale(this.scaleX*this._downEffectValue,this.scaleY*this._downEffectValue),this._downScaled=!0):this._downScaled&&(this.setScale(this.scaleX/this._downEffectValue,this.scaleY/this._downEffectValue),this._downScaled=!1))}},{key:"setCurrentState",value:function(){this.grayed&&this._buttonController&&this._buttonController.hasPage("disabled")?this._selected?this.setState("selectedDisabled"):this.setState("disabled"):this._selected?this.setState(this._over?"selectedOver":"down"):this.setState(this._over?"over":"up")}},{key:"handleControllerChanged",value:function(t){_get(_getPrototypeOf(s.prototype),"handleControllerChanged",this).call(this,t),this._relatedController==t&&(this.selected=this._relatedPageId==t.selectedPageId)}},{key:"handleGrayedChanged",value:function(){this._buttonController&&this._buttonController.hasPage("disabled")?this.grayed?this._selected&&this._buttonController.hasPage("selectedDisabled")?this.setState("selectedDisabled"):this.setState("disabled"):this._selected?this.setState("down"):this.setState("up"):_get(_getPrototypeOf(s.prototype),"handleGrayedChanged",this).call(this)}},{key:"getProp",value:function(e){switch(e){case t.ObjectPropID.Color:return this.titleColor;case t.ObjectPropID.OutlineColor:var i=this.getTextField();return i?i.textFormat.outlineColor:0;case t.ObjectPropID.FontSize:return this.titleFontSize;case t.ObjectPropID.Selected:return this.selected;default:return _get(_getPrototypeOf(s.prototype),"getProp",this).call(this,e)}}},{key:"setProp",value:function(e,i){switch(e){case t.ObjectPropID.Color:this.titleColor=i;break;case t.ObjectPropID.OutlineColor:var n=this.getTextField();n&&(n.textFormat.outlineColor=i,n.applyFormat());break;case t.ObjectPropID.FontSize:this.titleFontSize=i;break;case t.ObjectPropID.Selected:this.selected=i;break;default:_get(_getPrototypeOf(s.prototype),"setProp",this).call(this,e,i)}}},{key:"constructExtension",value:function(e){e.seek(0,6),this._mode=e.readByte();var i=e.readS();i&&(this._sound=i),this._soundVolumeScale=e.readFloat(),this._downEffect=e.readByte(),this._downEffectValue=e.readFloat(),2==this._downEffect&&this.setPivot(.5,.5,this.pivotAsAnchor),this._buttonController=this.getController("button"),this._titleObject=this.getChild("title"),this._iconObject=this.getChild("icon"),this._titleObject&&(this._title=this._titleObject.text),this._iconObject&&(this._icon=this._iconObject.icon),this._mode==t.ButtonMode.Common&&this.setState("up"),this.on("roll_over",this.__rollover,this),this.on("roll_out",this.__rollout,this),this.on("touch_begin",this.__btnTouchBegin,this),this.on("touch_end",this.__btnTouchEnd,this),this.on("click",this.__click,this),this.on("removed_from_stage",this.__removeFromStage,this)}},{key:"setup_afterAdd",value:function(t,e){var i,n;(_get(_getPrototypeOf(s.prototype),"setup_afterAdd",this).call(this,t,e),t.seek(e,6))&&(t.readByte()==this.packageItem.objectType&&(null!=(i=t.readS())&&(this.title=i),null!=(i=t.readS())&&(this.selectedTitle=i),null!=(i=t.readS())&&(this.icon=i),null!=(i=t.readS())&&(this.selectedIcon=i),t.readBool()&&(this.titleColor=t.readColor()),0!=(n=t.readInt())&&(this.titleFontSize=n),(n=t.readShort())>=0&&(this._relatedController=this.parent.getControllerAt(n)),this._relatedPageId=t.readS(),null!=(i=t.readS())&&(this._sound=i),t.readBool()&&(this._soundVolumeScale=t.readFloat()),this.selected=t.readBool()))}},{key:"__rollover",value:function(){this._buttonController&&this._buttonController.hasPage("over")&&(this._over=!0,this._down||this.grayed&&this._buttonController.hasPage("disabled")||this.setState(this._selected?"selectedOver":"over"))}},{key:"__rollout",value:function(){this._buttonController&&this._buttonController.hasPage("over")&&(this._over=!1,this._down||this.grayed&&this._buttonController.hasPage("disabled")||this.setState(this._selected?"down":"up"))}},{key:"__btnTouchBegin",value:function(e){0==e.input.button&&(this._down=!0,e.captureTouch(),this._mode==t.ButtonMode.Common&&(this.grayed&&this._buttonController&&this._buttonController.hasPage("disabled")?this.setState("selectedDisabled"):this.setState("down")),this._linkedPopup&&(this._linkedPopup instanceof t.Window?this._linkedPopup.toggleStatus():t.GRoot.findFor(this).togglePopup(this._linkedPopup,this)))}},{key:"__btnTouchEnd",value:function(e){this._down&&(this._down=!1,this._mode==t.ButtonMode.Common?this.grayed&&this._buttonController&&this._buttonController.hasPage("disabled")?this.setState("disabled"):this._over?this.setState("over"):this.setState("up"):this._over||!this._buttonController||"over"!=this._buttonController.selectedPage&&"selectedOver"!=this._buttonController.selectedPage||this.setCurrentState())}},{key:"__removeFromStage",value:function(){this._over&&this.__rollout()}},{key:"__click",value:function(e){if(this._sound){var i=t.UIPackage.getItemByURL(this._sound);i?t.GRoot.inst.playOneShotSound(i.file):t.GRoot.inst.playOneShotSound(this._sound)}this._mode==t.ButtonMode.Check?this._changeStateOnClick&&(this.selected=!this._selected,this.dispatchEvent("status_changed")):this._mode==t.ButtonMode.Radio?this._changeStateOnClick&&!this._selected&&(this.selected=!0,this.dispatchEvent("status_changed")):this._relatedController&&(this._relatedController.selectedPageId=this._relatedPageId)}},{key:"icon",get:function(){return this._icon},set:function(t){this._icon=t,t=this._selected&&this._selectedIcon?this._selectedIcon:this._icon,this._iconObject&&(this._iconObject.icon=t),this.updateGear(7)}},{key:"selectedIcon",get:function(){return this._selectedIcon},set:function(t){this._selectedIcon=t,t=this._selected&&this._selectedIcon?this._selectedIcon:this._icon,this._iconObject&&(this._iconObject.icon=t)}},{key:"title",get:function(){return this._title},set:function(t){this._title=t,this._titleObject&&(this._titleObject.text=this._selected&&this._selectedTitle?this._selectedTitle:this._title),this.updateGear(6)}},{key:"text",get:function(){return this.title},set:function(t){this.title=t}},{key:"selectedTitle",get:function(){return this._selectedTitle},set:function(t){this._selectedTitle=t,this._titleObject&&(this._titleObject.text=this._selected&&this._selectedTitle?this._selectedTitle:this._title)}},{key:"titleColor",get:function(){var t=this.getTextField();return t?t.color:0},set:function(t){var e=this.getTextField();e&&(e.color=t),this.updateGear(4)}},{key:"titleFontSize",get:function(){var t=this.getTextField();return t?t.textFormat.size:0},set:function(t){var e=this.getTextField();e&&(e.textFormat.size=t,e.applyFormat())}},{key:"sound",get:function(){return this._sound},set:function(t){this._sound=t}},{key:"soundVolumeScale",get:function(){return this._soundVolumeScale},set:function(t){this._soundVolumeScale=t}},{key:"selected",set:function(e){if(this._mode!=t.ButtonMode.Common&&this._selected!=e){if(this._selected=e,this.setCurrentState(),this._selectedTitle&&this._titleObject&&(this._titleObject.text=this._selected?this._selectedTitle:this._title),this._selectedIcon){var i=this._selected?this._selectedIcon:this._icon;this._iconObject&&(this._iconObject.icon=i)}this._relatedController&&this._parent&&!this._parent._buildingDisplayList&&(this._selected?(this._relatedController.selectedPageId=this._relatedPageId,this._relatedController.autoRadioGroupDepth&&this._parent.adjustRadioGroupDepth(this,this._relatedController)):this._mode==t.ButtonMode.Check&&this._relatedController.selectedPageId==this._relatedPageId&&(this._relatedController.oppositePageId=this._relatedPageId))}},get:function(){return this._selected}},{key:"mode",get:function(){return this._mode},set:function(e){this._mode!=e&&(e==t.ButtonMode.Common&&(this.selected=!1),this._mode=e)}},{key:"relatedController",get:function(){return this._relatedController},set:function(t){t!=this._relatedController&&(this._relatedController=t,this._relatedPageId=null)}},{key:"relatedPageId",get:function(){return this._relatedPageId},set:function(t){this._relatedPageId=t}},{key:"changeStateOnClick",get:function(){return this._changeStateOnClick},set:function(t){this._changeStateOnClick=t}},{key:"linkedPopup",get:function(){return this._linkedPopup},set:function(t){this._linkedPopup=t}}]),s}(t.GComponent);t.GButton=e}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(){var e;return _classCallCheck(this,s),(e=i.call(this)).visibleItemCount=t.UIConfig.defaultComboBoxVisibleItemCount,e.popupDirection=t.PopupDirection.Auto,e._itemsUpdated=!0,e._selectedIndex=-1,e._items=[],e._values=[],e}return _createClass(s,[{key:"getTextField",value:function(){return this._titleObject instanceof t.GTextField?this._titleObject:this._titleObject instanceof t.GLabel||this._titleObject instanceof t.GButton?this._titleObject.getTextField():null}},{key:"setState",value:function(t){this._buttonController&&(this._buttonController.selectedPage=t)}},{key:"setCurrentState",value:function(){this.grayed&&this._buttonController&&this._buttonController.hasPage("disabled")?this.setState("disabled"):this.dropdown&&this.dropdown.parent?this.setState("down"):this.setState(this._over?"over":"up")}},{key:"handleControllerChanged",value:function(t){_get(_getPrototypeOf(s.prototype),"handleControllerChanged",this).call(this,t),this._selectionController==t&&(this.selectedIndex=t.selectedIndex)}},{key:"updateSelectionController",value:function(){if(this._selectionController&&!this._selectionController.changing&&this._selectedIndex<this._selectionController.pageCount){var t=this._selectionController;this._selectionController=null,t.selectedIndex=this._selectedIndex,this._selectionController=t}}},{key:"dispose",value:function(){this.dropdown&&(this.dropdown.dispose(),this.dropdown=null),this._selectionController=null,_get(_getPrototypeOf(s.prototype),"dispose",this).call(this)}},{key:"getProp",value:function(e){switch(e){case t.ObjectPropID.Color:return this.titleColor;case t.ObjectPropID.OutlineColor:var i=this.getTextField();return i?i.textFormat.outlineColor:0;case t.ObjectPropID.FontSize:return(i=this.getTextField())?i.textFormat.size:0;default:return _get(_getPrototypeOf(s.prototype),"getProp",this).call(this,e)}}},{key:"setProp",value:function(e,i){switch(e){case t.ObjectPropID.Color:this.titleColor=i;break;case t.ObjectPropID.OutlineColor:var n=this.getTextField();n&&(n.textFormat.outlineColor=i,n.applyFormat());break;case t.ObjectPropID.FontSize:(n=this.getTextField())&&(n.textFormat.size=i,n.applyFormat());break;default:_get(_getPrototypeOf(s.prototype),"setProp",this).call(this,e,i)}}},{key:"constructExtension",value:function(e){this._buttonController=this.getController("button"),this._titleObject=this.getChild("title"),this._iconObject=this.getChild("icon");var i=e.readS();if(i){if(this.dropdown=t.UIPackage.createObjectFromURL(i),!this.dropdown)return void console.warn(this.resourceURL+" should be a component.");if(this._list=this.dropdown.getChild("list"),null==this._list)return void console.warn(this.resourceURL+": should container a list component named list.");this._list.on("click_item",this.__clickItem,this),this._list.addRelation(this.dropdown,t.RelationType.Width),this._list.removeRelation(this.dropdown,t.RelationType.Height),this.dropdown.addRelation(this._list,t.RelationType.Height),this.dropdown.removeRelation(this._list,t.RelationType.Width),this.dropdown.on("removed_from_stage",this.__popupWinClosed,this)}this.on("roll_over",this.__rollover,this),this.on("roll_out",this.__rollout,this),this.on("touch_begin",this.__mousedown,this),this.on("touch_end",this.__mouseup,this)}},{key:"setup_afterAdd",value:function(t,e){if(_get(_getPrototypeOf(s.prototype),"setup_afterAdd",this).call(this,t,e),t.seek(e,6)&&t.readByte()==this.packageItem.objectType){var i,n,r,a,o=t.readShort();for(i=0;i<o;i++)r=t.readShort(),r+=t.pos,this._items[i]=t.readS(),this._values[i]=t.readS(),null!=(a=t.readS())&&(null==this._icons&&(this._icons=[]),this._icons[i]=a),t.pos=r;null!=(a=t.readS())?(this.text=a,this._selectedIndex=this._items.indexOf(a)):this._items.length>0?(this._selectedIndex=0,this.text=this._items[0]):this._selectedIndex=-1,null!=(a=t.readS())&&(this.icon=a),t.readBool()&&(this.titleColor=t.readColor()),(n=t.readInt())>0&&(this.visibleItemCount=n),this.popupDirection=t.readByte(),(n=t.readShort())>=0&&(this._selectionController=this.parent.getControllerAt(n))}}},{key:"showDropdown",value:function(){if(this._itemsUpdated){this._itemsUpdated=!1,this._list.removeChildrenToPool();for(var e=this._items.length,i=0;i<e;i++){var s=this._list.addItemFromPool();s.name=i<this._values.length?this._values[i]:"",s.text=this._items[i],s.icon=this._icons&&i<this._icons.length?this._icons[i]:null}this._list.resizeToFit(this.visibleItemCount)}this._list.selectedIndex=-1,this.dropdown.width=this.width,this._list.ensureBoundsCorrect(),t.GRoot.findFor(this).togglePopup(this.dropdown,this,this.popupDirection),this.dropdown.parent&&this.setState("down")}},{key:"__popupWinClosed",value:function(){this.setCurrentState()}},{key:"__clickItem",value:function(e){this.dropdown.parent instanceof t.GRoot&&this.dropdown.parent.hidePopup(),this._selectedIndex=-1,this.selectedIndex=this._list.getChildIndex(e.data),this.dispatchEvent("status_changed")}},{key:"__rollover",value:function(){this._over=!0,this._down||this.dropdown&&this.dropdown.parent||this.setCurrentState()}},{key:"__rollout",value:function(){this._over=!1,this._down||this.dropdown&&this.dropdown.parent||this.setCurrentState()}},{key:"__mousedown",value:function(e){e.initiator instanceof t.InputTextField||(this._down=!0,this.dropdown&&this.showDropdown(),e.captureTouch())}},{key:"__mouseup",value:function(){this._down&&(this._down=!1,this.setCurrentState())}},{key:"text",get:function(){return this._titleObject?this._titleObject.text:null},set:function(t){this._titleObject&&(this._titleObject.text=t),this.updateGear(6)}},{key:"titleColor",get:function(){var t=this.getTextField();return t?t.color:0},set:function(t){var e=this.getTextField();e&&(e.color=t),this.updateGear(4)}},{key:"titleFontSize",get:function(){var t=this.getTextField();return t?t.textFormat.size:0},set:function(t){var e=this.getTextField();e&&(e.textFormat.size=t,e.applyFormat())}},{key:"icon",get:function(){return this._iconObject?this._iconObject.icon:null},set:function(t){this._iconObject&&(this._iconObject.icon=t),this.updateGear(7)}},{key:"items",get:function(){return this._items},set:function(t){t?this._items=t.concat():this._items.length=0,this._items.length>0?(this._selectedIndex>=this._items.length?this._selectedIndex=this._items.length-1:-1==this._selectedIndex&&(this._selectedIndex=0),this.text=this._items[this._selectedIndex],this._icons&&this._selectedIndex<this._icons.length&&(this.icon=this._icons[this._selectedIndex])):(this.text="",this._icons&&(this.icon=null),this._selectedIndex=-1),this._itemsUpdated=!0}},{key:"icons",get:function(){return this._icons},set:function(t){this._icons=t,this._icons&&-1!=this._selectedIndex&&this._selectedIndex<this._icons.length&&(this.icon=this._icons[this._selectedIndex])}},{key:"values",get:function(){return this._values},set:function(t){t?this._values=t.concat():this._values.length=0}},{key:"selectedIndex",get:function(){return this._selectedIndex},set:function(t){this._selectedIndex!=t&&(this._selectedIndex=t,this._selectedIndex>=0&&this._selectedIndex<this._items.length?(this.text=this._items[this._selectedIndex],this._icons&&this._selectedIndex<this._icons.length&&(this.icon=this._icons[this._selectedIndex])):(this.text="",this._icons&&(this.icon=null)),this.updateSelectionController())}},{key:"value",get:function(){return this._values[this._selectedIndex]},set:function(t){var e=this._values.indexOf(t);-1==e&&null==t&&(e=this._values.indexOf("")),this.selectedIndex=e}},{key:"selectionController",get:function(){return this._selectionController},set:function(t){this._selectionController=t}}]),s}(t.GComponent);t.GComboBox=e}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(){return _classCallCheck(this,s),i.call(this)}return _createClass(s,[{key:"createDisplayObject",value:function(){this._displayObject=this._shape=new t.Shape}},{key:"getProp",value:function(e){return e==t.ObjectPropID.Color?this.color:_get(_getPrototypeOf(s.prototype),"getProp",this).call(this,e)}},{key:"setProp",value:function(e,i){e==t.ObjectPropID.Color?this.color=i:_get(_getPrototypeOf(s.prototype),"setProp",this).call(this,e,i)}},{key:"setup_beforeAdd",value:function(t,e){_get(_getPrototypeOf(s.prototype),"setup_beforeAdd",this).call(this,t,e),t.seek(e,5);var i=t.readByte();if(0!=i){var n,r,a,o=t.readInt(),h=t.readFullColor(),l=t.readFullColor(),u=t.readBool();if(u)for(a=[],n=0;n<4;n++)a[n]=t.readFloat();if(1==i)u?this._shape.drawRoundRect(o,h,l,a[0],a[1],a[2],a[3]):this._shape.drawRect(o,h,l);else if(2==i)this._shape.drawEllipse(o,l,h,l,0,360);else if(3==i){r=t.readShort();var c=[];for(c.length=r,n=0;n<r;n++)c[n]=t.readFloat();this._shape.drawPolygon(c,l,o,h)}else if(4==i){var _,d=t.readShort(),g=t.readFloat();if((r=t.readShort())>0)for(_=[],n=0;n<r;n++)_[n]=t.readFloat();this._shape.drawRegularPolygon(d,o,l,h,l,g,_)}}}},{key:"shape",get:function(){return this._shape}},{key:"color",get:function(){return this._shape.graphics.color},set:function(t){this._shape.graphics.color!=t&&(this._shape.graphics.color=t,this.updateGear(4))}}]),s}(t.GObject);t.GGraph=e}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(){var t;return _classCallCheck(this,s),(t=i.call(this))._layout=0,t._lineGap=0,t._columnGap=0,t._mainGridIndex=-1,t._mainGridMinSize=50,t._mainChildIndex=-1,t._totalSize=0,t._numChildren=0,t._updating=0,t}return _createClass(s,[{key:"dispose",value:function(){this._boundsChanged=!1,_get(_getPrototypeOf(s.prototype),"dispose",this).call(this)}},{key:"setBoundsChangedFlag",value:function(e){0==this._updating&&this._parent&&(e||(this._percentReady=!1),this._boundsChanged||(this._boundsChanged=!0,this._layout!=t.GroupLayoutType.None&&t.Timers.callLater(this.ensureBoundsCorrect,this)))}},{key:"ensureBoundsCorrect",value:function(){null!=this._parent&&this._boundsChanged&&(this._boundsChanged=!1,0==this._layout?this.updateBounds():this._autoSizeDisabled?this.resizeChildren(0,0):(this.handleLayout(),this.updateBounds()))}},{key:"updateBounds",value:function(){t.Timers.remove(this.ensureBoundsCorrect,this);var e,i,s,n=this._parent.numChildren,r=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY,l=!0;for(e=0;e<n;e++)(i=this._parent.getChildAt(e)).group!=this||this._excludeInvisibles&&!i.internalVisible3||((s=i.xMin)<r&&(r=s),(s=i.yMin)<a&&(a=s),(s=i.xMin+i.width)>o&&(o=s),(s=i.yMin+i.height)>h&&(h=s),l=!1);var u=0,c=0;l||(this._updating|=1,this.setPosition(r,a),this._updating&=2,u=o-r,c=h-a),0==(2&this._updating)?(this._updating|=2,this.setSize(u,c),this._updating&=1):(this._updating&=1,this.resizeChildren(this._width-u,this._height-c))}},{key:"handleLayout",value:function(){var e,i,s;if(this._updating|=1,this._layout==t.GroupLayoutType.Horizontal){var n=this.x;for(s=this._parent.numChildren,i=0;i<s;i++)(e=this._parent.getChildAt(i)).group==this&&(this._excludeInvisibles&&!e.internalVisible3||(e.xMin=n,0!=e.width&&(n+=e.width+this._columnGap)))}else if(this._layout==t.GroupLayoutType.Vertical){var r=this.y;for(s=this._parent.numChildren,i=0;i<s;i++)(e=this._parent.getChildAt(i)).group==this&&(this._excludeInvisibles&&!e.internalVisible3||(e.yMin=r,0!=e.height&&(r+=e.height+this._lineGap)))}this._updating&=2}},{key:"moveChildren",value:function(t,e){if(0==(1&this._updating)&&null!=this._parent){this._updating|=1;var i,s,n=this._parent.numChildren;for(i=0;i<n;i++)(s=this._parent.getChildAt(i)).group==this&&s.setPosition(s.x+t,s.y+e);this._updating&=2}}},{key:"resizeChildren",value:function(e,i){if(this._layout!=t.GroupLayoutType.None&&0==(2&this._updating)&&null!=this._parent)if(this._updating|=2,!this._boundsChanged||(this._boundsChanged=!1,this._autoSizeDisabled)){var s,n,r=this._parent.numChildren;if(!this._percentReady){this._percentReady=!0,this._numChildren=0,this._totalSize=0,this._mainChildIndex=-1;var a=0;for(s=0;s<r;s++)(n=this._parent.getChildAt(s)).group==this&&(this._excludeInvisibles&&!n.internalVisible3||(a==this._mainGridIndex&&(this._mainChildIndex=s),this._numChildren++,1==this._layout?this._totalSize+=n.width:this._totalSize+=n.height),a++);for(-1!=this._mainChildIndex&&(1==this._layout?(n=this._parent.getChildAt(this._mainChildIndex),this._totalSize+=this._mainGridMinSize-n.width,n._sizePercentInGroup=this._mainGridMinSize/this._totalSize):(n=this._parent.getChildAt(this._mainChildIndex),this._totalSize+=this._mainGridMinSize-n.height,n._sizePercentInGroup=this._mainGridMinSize/this._totalSize)),s=0;s<r;s++)(n=this._parent.getChildAt(s)).group==this&&s!=this._mainChildIndex&&(this._totalSize>0?n._sizePercentInGroup=(1==this._layout?n.width:n.height)/this._totalSize:n._sizePercentInGroup=0)}var o=0,h=1,l=!1;if(1==this._layout){o=this.width-(this._numChildren-1)*this._columnGap,-1!=this._mainChildIndex&&o>=this._totalSize&&((n=this._parent.getChildAt(this._mainChildIndex)).setSize(o-(this._totalSize-this._mainGridMinSize),n._rawHeight+i,!0),o-=n.width,h-=n._sizePercentInGroup,l=!0);var u=this.x;for(s=0;s<r;s++)(n=this._parent.getChildAt(s)).group==this&&(!this._excludeInvisibles||n.internalVisible3?(l&&s==this._mainChildIndex||(n.setSize(Math.round(n._sizePercentInGroup/h*o),n._rawHeight+i,!0),h-=n._sizePercentInGroup,o-=n.width),n.xMin=u,0!=n.width&&(u+=n.width+this._columnGap)):n.setSize(n._rawWidth,n._rawHeight+i,!0))}else{o=this.height-(this._numChildren-1)*this._lineGap,-1!=this._mainChildIndex&&o>=this._totalSize&&((n=this._parent.getChildAt(this._mainChildIndex)).setSize(n._rawWidth+e,o-(this._totalSize-this._mainGridMinSize),!0),o-=n.height,h-=n._sizePercentInGroup,l=!0);var c=this.y;for(s=0;s<r;s++)(n=this._parent.getChildAt(s)).group==this&&(!this._excludeInvisibles||n.internalVisible3?(l&&s==this._mainChildIndex||(n.setSize(n._rawWidth+e,Math.round(n._sizePercentInGroup/h*o),!0),h-=n._sizePercentInGroup,o-=n.height),n.yMin=c,0!=n.height&&(c+=n.height+this._lineGap)):n.setSize(n._rawWidth+e,n._rawHeight,!0))}this._updating&=1}else this.updateBounds()}},{key:"handleAlphaChanged",value:function(){if(!this._underConstruct)for(var t=this._parent.numChildren,e=0;e<t;e++){var i=this._parent.getChildAt(e);i.group==this&&(i.alpha=this.alpha)}}},{key:"handleVisibleChanged",value:function(){if(this._parent)for(var t=this._parent.numChildren,e=0;e<t;e++){var i=this._parent.getChildAt(e);i.group==this&&i.handleVisibleChanged()}}},{key:"setup_beforeAdd",value:function(t,e){_get(_getPrototypeOf(s.prototype),"setup_beforeAdd",this).call(this,t,e),t.seek(e,5),this._layout=t.readByte(),this._lineGap=t.readInt(),this._columnGap=t.readInt(),t.version>=2&&(this._excludeInvisibles=t.readBool(),this._autoSizeDisabled=t.readBool(),this._mainChildIndex=t.readShort())}},{key:"setup_afterAdd",value:function(t,e){_get(_getPrototypeOf(s.prototype),"setup_afterAdd",this).call(this,t,e),this.visible||this.handleVisibleChanged()}},{key:"layout",get:function(){return this._layout},set:function(t){this._layout!=t&&(this._layout=t,this.setBoundsChangedFlag())}},{key:"lineGap",get:function(){return this._lineGap},set:function(t){this._lineGap!=t&&(this._lineGap=t,this.setBoundsChangedFlag(!0))}},{key:"columnGap",get:function(){return this._columnGap},set:function(t){this._columnGap!=t&&(this._columnGap=t,this.setBoundsChangedFlag(!0))}},{key:"excludeInvisibles",get:function(){return this._excludeInvisibles},set:function(t){this._excludeInvisibles!=t&&(this._excludeInvisibles=t,this.setBoundsChangedFlag())}},{key:"autoSizeDisabled",get:function(){return this._autoSizeDisabled},set:function(t){this._autoSizeDisabled=t}},{key:"mainGridMinSize",get:function(){return this._mainGridMinSize},set:function(t){this._mainGridMinSize!=t&&(this._mainGridMinSize=t,this.setBoundsChangedFlag())}},{key:"mainGridIndex",get:function(){return this._mainGridIndex},set:function(t){this._mainGridIndex!=t&&(this._mainGridIndex=t,this.setBoundsChangedFlag())}}]),s}(t.GObject);t.GGroup=e}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(){return _classCallCheck(this,s),i.call(this)}return _createClass(s,[{key:"createDisplayObject",value:function(){this._displayObject=this._image=new t.Image}},{key:"handleSizeChanged",value:function(){this._image.width=this._width,this._image.height=this._height}},{key:"constructFromResource",value:function(){this._contentItem=this.packageItem.getBranch(),this.sourceWidth=this._contentItem.width,this.sourceHeight=this._contentItem.height,this.initWidth=this.sourceWidth,this.initHeight=this.sourceHeight,this._contentItem=this._contentItem.getHighResolution(),this._contentItem.load(),this._image.scale9Grid=this._contentItem.scale9Grid,this._image.scaleByTile=this._contentItem.scaleByTile,this._image.tileGridIndice=this._contentItem.tileGridIndice,this._image.texture=this._contentItem.texture,this.setSize(this.sourceWidth,this.sourceHeight)}},{key:"getProp",value:function(e){return e==t.ObjectPropID.Color?this.color:_get(_getPrototypeOf(s.prototype),"getProp",this).call(this,e)}},{key:"setProp",value:function(e,i){e==t.ObjectPropID.Color?this.color=i:_get(_getPrototypeOf(s.prototype),"setProp",this).call(this,e,i)}},{key:"setup_beforeAdd",value:function(t,e){_get(_getPrototypeOf(s.prototype),"setup_beforeAdd",this).call(this,t,e),t.seek(e,5),t.readBool()&&(this.color=t.readColor()),this.flip=t.readByte(),this._image.fillMethod=t.readByte(),0!=this._image.fillMethod&&(this._image.fillOrigin=t.readByte(),this._image.fillClockwise=t.readBool(),this._image.fillAmount=t.readFloat())}},{key:"color",get:function(){return this._image.graphics.color},set:function(t){this._image.graphics.color!=t&&(this._image.graphics.color=t,this.updateGear(4))}},{key:"flip",get:function(){return this._image.graphics.flip},set:function(t){this._image.graphics.flip=t}},{key:"fillMethod",get:function(){return this._image.fillMethod},set:function(t){this._image.fillMethod=t}},{key:"fillOrigin",get:function(){return this._image.fillOrigin},set:function(t){this._image.fillOrigin=t}},{key:"fillClockwise",get:function(){return this._image.fillClockwise},set:function(t){this._image.fillClockwise=t}},{key:"fillAmount",get:function(){return this._image.fillAmount},set:function(t){this._image.fillAmount=t}}]),s}(t.GObject);t.GImage=e}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(){return _classCallCheck(this,s),i.call(this)}return _createClass(s,[{key:"getTextField",value:function(){return this._titleObject instanceof t.GTextField?this._titleObject:this._titleObject instanceof s||this._titleObject instanceof t.GButton?this._titleObject.getTextField():null}},{key:"getProp",value:function(e){switch(e){case t.ObjectPropID.Color:return this.titleColor;case t.ObjectPropID.OutlineColor:var i=this.getTextField();return i?i.textFormat.outlineColor:0;case t.ObjectPropID.FontSize:return this.titleFontSize;default:return _get(_getPrototypeOf(s.prototype),"getProp",this).call(this,e)}}},{key:"setProp",value:function(e,i){switch(e){case t.ObjectPropID.Color:this.titleColor=i;break;case t.ObjectPropID.OutlineColor:var n=this.getTextField();n&&(n.textFormat.outlineColor=i,n.applyFormat());break;case t.ObjectPropID.FontSize:this.titleFontSize=i;break;default:_get(_getPrototypeOf(s.prototype),"setProp",this).call(this,e,i)}}},{key:"constructExtension",value:function(t){this._titleObject=this.getChild("title"),this._iconObject=this.getChild("icon")}},{key:"setup_afterAdd",value:function(t,e){if(_get(_getPrototypeOf(s.prototype),"setup_afterAdd",this).call(this,t,e),t.seek(e,6)&&t.readByte()==this.packageItem.objectType){var i;null!=(i=t.readS())&&(this.title=i),null!=(i=t.readS())&&(this.icon=i),t.readBool()&&(this.titleColor=t.readColor());var n=t.readInt();if(0!=n&&(this.titleFontSize=n),t.readBool()){var r=this.getTextField();r?(null!=(i=t.readS())&&(r.promptText=i),null!=(i=t.readS())&&(r.restrict=i),0!=(n=t.readInt())&&(r.maxLength=n),0!=(n=t.readInt())&&(4==n?r.keyboardType="number":3==n&&(r.keyboardType="url")),t.readBool()&&(r.password=!0)):t.skip(13)}}}},{key:"icon",get:function(){return this._iconObject?this._iconObject.icon:null},set:function(t){this._iconObject&&(this._iconObject.icon=t),this.updateGear(7)}},{key:"title",get:function(){return this._titleObject?this._titleObject.text:null},set:function(t){this._titleObject&&(this._titleObject.text=t),this.updateGear(6)}},{key:"text",get:function(){return this.title},set:function(t){this.title=t}},{key:"titleColor",get:function(){var t=this.getTextField();return t?t.color:0},set:function(t){var e=this.getTextField();e&&(e.color=t),this.updateGear(4)}},{key:"titleFontSize",get:function(){var t=this.getTextField();return t?t.textFormat.size:0},set:function(t){var e=this.getTextField();e&&(e.textFormat.size=t,e.applyFormat())}},{key:"color",get:function(){return this.titleColor},set:function(t){this.titleColor=t}},{key:"editable",set:function(t){this._titleObject&&(this._titleObject.editable=t)},get:function(){return!!(this._titleObject&&this._titleObject instanceof t.GTextInput)&&this._titleObject.editable}}]),s}(t.GComponent);t.GLabel=e}(fgui||(fgui={})),function(t){var e=function(e){_inherits(n,e);var s=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=s.call(this))._lineCount=0,e._columnCount=0,e._lineGap=0,e._columnGap=0,e._lastSelectedIndex=0,e._numItems=0,e._firstIndex=0,e._curLineItemCount=0,e._virtualListChanged=0,e.itemInfoVer=0,e._trackBounds=!0,e._pool=new t.GObjectPool,e._layout=t.ListLayoutType.SingleColumn,e._autoResizeItem=!0,e._lastSelectedIndex=-1,e._selectionMode=t.ListSelectionMode.Single,e.opaque=!0,e.scrollItemToViewOnClick=!0,e._align="left",e._verticalAlign="top",e._container=new t.DisplayObject,e._displayObject.addChild(e._container),e}return _createClass(n,[{key:"dispose",value:function(){this._pool.clear(),_get(_getPrototypeOf(n.prototype),"dispose",this).call(this)}},{key:"getFromPool",value:function(t){t||(t=this._defaultItem);var e=this._pool.getObject(t);return e&&(e.visible=!0),e}},{key:"returnToPool",value:function(t){this._pool.returnObject(t)}},{key:"addChildAt",value:function(e,i){if(_get(_getPrototypeOf(n.prototype),"addChildAt",this).call(this,e,i),e instanceof t.GButton){var s=e;s.selected=!1,s.changeStateOnClick=!1}return e.on("click",this.__clickItem,this),e}},{key:"addItem",value:function(e){return e||(e=this._defaultItem),this.addChild(t.UIPackage.createObjectFromURL(e))}},{key:"addItemFromPool",value:function(t){return this.addChild(this.getFromPool(t))}},{key:"removeChildAt",value:function(t,e){var i=_get(_getPrototypeOf(n.prototype),"removeChildAt",this).call(this,t);return e?i.dispose():i.off("click",this.__clickItem,this),i}},{key:"removeChildToPoolAt",value:function(t){var e=_get(_getPrototypeOf(n.prototype),"removeChildAt",this).call(this,t);this.returnToPool(e)}},{key:"removeChildToPool",value:function(t){_get(_getPrototypeOf(n.prototype),"removeChild",this).call(this,t),this.returnToPool(t)}},{key:"removeChildrenToPool",value:function(t,e){t=t||0,null==e&&(e=-1),(e<0||e>=this._children.length)&&(e=this._children.length-1);for(var i=t;i<=e;++i)this.removeChildToPoolAt(t)}},{key:"getSelection",value:function(e){var i;if(e||(e=new Array),this._virtual)for(i=0;i<this._realNumItems;i++){var s=this._virtualItems[i];if(s.obj instanceof t.GButton&&s.obj.selected||null==s.obj&&s.selected){var n=i;if(this._loop&&(n=i%this._numItems,-1!=e.indexOf(n)))continue;e.push(n)}}else{var r=this._children.length;for(i=0;i<r;i++){var a=this._children[i];a&&a.selected&&e.push(i)}}return e}},{key:"addSelection",value:function(e,i){if(this._selectionMode!=t.ListSelectionMode.None){this.checkVirtualList(),this._selectionMode==t.ListSelectionMode.Single&&this.clearSelection(),i&&this.scrollToView(e),this._lastSelectedIndex=e;var s=null;if(this._virtual){var n=this._virtualItems[e];n.obj&&(s=n.obj),n.selected=!0}else s=this.getChildAt(e);s&&!s.selected&&(s.selected=!0,this.updateSelectionController(e))}}},{key:"removeSelection",value:function(e){if(this._selectionMode!=t.ListSelectionMode.None){var i=null;if(this._virtual){var s=this._virtualItems[e];s.obj&&(i=s.obj),s.selected=!1}else i=this.getChildAt(e);i&&(i.selected=!1)}}},{key:"clearSelection",value:function(){var e;if(this._virtual)for(e=0;e<this._realNumItems;e++){var i=this._virtualItems[e];i.obj instanceof t.GButton&&(i.obj.selected=!1),i.selected=!1}else{var s=this._children.length;for(e=0;e<s;e++){var n=this._children[e];n&&(n.selected=!1)}}}},{key:"clearSelectionExcept",value:function(e){var i;if(this._virtual)for(i=0;i<this._realNumItems;i++){var s=this._virtualItems[i];s.obj!=e&&(s.obj instanceof t.GButton&&(s.obj.selected=!1),s.selected=!1)}else{var n=this._children.length;for(i=0;i<n;i++){var r=this._children[i];r&&r!=e&&(r.selected=!1)}}}},{key:"selectAll",value:function(){this.checkVirtualList();var e,i=-1;if(this._virtual)for(e=0;e<this._realNumItems;e++){var s=this._virtualItems[e];s.obj instanceof t.GButton&&!s.obj.selected&&(s.obj.selected=!0,i=e),s.selected=!0}else{var n=this._children.length;for(e=0;e<n;e++){var r=this._children[e];r&&!r.selected&&(r.selected=!0,i=e)}}-1!=i&&this.updateSelectionController(i)}},{key:"selectNone",value:function(){this.clearSelection()}},{key:"selectReverse",value:function(){this.checkVirtualList();var e,i=-1;if(this._virtual)for(e=0;e<this._realNumItems;e++){var s=this._virtualItems[e];s.obj instanceof t.GButton&&(s.obj.selected=!s.obj.selected,s.obj.selected&&(i=e)),s.selected=!s.selected}else{var n=this._children.length;for(e=0;e<n;e++){var r=this._children[e];r&&(r.selected=!r.selected,r.selected&&(i=e))}}-1!=i&&this.updateSelectionController(i)}},{key:"handleArrowKey",value:function(e){var i=this.selectedIndex;if(-1!=i)switch(e){case 1:if(this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowVertical)--i>=0&&(this.clearSelection(),this.addSelection(i,!0));else if(this._layout==t.ListLayoutType.FlowHorizontal||this._layout==t.ListLayoutType.Pagination){for(var s=this._children[i],n=0,r=i-1;r>=0;r--){var a=this._children[r];if(a.y!=s.y){s=a;break}n++}for(;r>=0;r--)if((a=this._children[r]).y!=s.y){this.clearSelection(),this.addSelection(r+n+1,!0);break}}break;case 3:if(this._layout==t.ListLayoutType.SingleRow||this._layout==t.ListLayoutType.FlowHorizontal||this._layout==t.ListLayoutType.Pagination)++i<this.numItems&&(this.clearSelection(),this.addSelection(i,!0));else if(this._layout==t.ListLayoutType.FlowVertical){s=this._children[i],n=0;var o=this._children.length;for(r=i+1;r<o;r++){if((a=this._children[r]).x!=s.x){s=a;break}n++}for(;r<o;r++)if((a=this._children[r]).x!=s.x){this.clearSelection(),this.addSelection(r-n-1,!0);break}}break;case 5:if(this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowVertical)++i<this.numItems&&(this.clearSelection(),this.addSelection(i,!0));else if(this._layout==t.ListLayoutType.FlowHorizontal||this._layout==t.ListLayoutType.Pagination){for(s=this._children[i],n=0,o=this._children.length,r=i+1;r<o;r++){if((a=this._children[r]).y!=s.y){s=a;break}n++}for(;r<o;r++)if((a=this._children[r]).y!=s.y){this.clearSelection(),this.addSelection(r-n-1,!0);break}}break;case 7:if(this._layout==t.ListLayoutType.SingleRow||this._layout==t.ListLayoutType.FlowHorizontal||this._layout==t.ListLayoutType.Pagination)--i>=0&&(this.clearSelection(),this.addSelection(i,!0));else if(this._layout==t.ListLayoutType.FlowVertical){for(s=this._children[i],n=0,r=i-1;r>=0;r--){if((a=this._children[r]).x!=s.x){s=a;break}n++}for(;r>=0;r--)if((a=this._children[r]).x!=s.x){this.clearSelection(),this.addSelection(r+n+1,!0);break}}}}},{key:"__clickItem",value:function(e){if(!this._scrollPane||!this._scrollPane.isDragged){var i=t.GObject.cast(e.sender);this.setSelectionOnEvent(i,e),this._scrollPane&&this.scrollItemToViewOnClick&&this._scrollPane.scrollToView(i,!0),this.dispatchItemEvent(i,e)}}},{key:"dispatchItemEvent",value:function(t,e){this.dispatchEvent("click_item",t)}},{key:"setSelectionOnEvent",value:function(e,i){if(e instanceof t.GButton&&this._selectionMode!=t.ListSelectionMode.None){var s=!1,n=e,r=this.childIndexToItemIndex(this.getChildIndex(e));if(this._selectionMode==t.ListSelectionMode.Single)n.selected||(this.clearSelectionExcept(n),n.selected=!0);else if(i.input.shiftKey){if(!n.selected)if(-1!=this._lastSelectedIndex){var a,o=Math.min(this._lastSelectedIndex,r),h=Math.max(this._lastSelectedIndex,r);if(h=Math.min(h,this.numItems-1),this._virtual)for(a=o;a<=h;a++){var l=this._virtualItems[a];l.obj instanceof t.GButton&&(l.obj.selected=!0),l.selected=!0}else for(a=o;a<=h;a++){var u=this.getChildAt(a);u&&(u.selected=!0)}s=!0}else n.selected=!0}else i.input.ctrlKey||i.input.commandKey||this._selectionMode==t.ListSelectionMode.Multiple_SingleClick?n.selected=!n.selected:n.selected?this.clearSelectionExcept(n):(this.clearSelectionExcept(n),n.selected=!0);s||(this._lastSelectedIndex=r),n.selected&&this.updateSelectionController(r)}}},{key:"resizeToFit",value:function(e,i){this.ensureBoundsCorrect();var s=this.numItems;if((null==e||e>s)&&(e=s),i=i||0,this._virtual){var n=Math.ceil(e/this._curLineItemCount);this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal?this.viewHeight=n*this._itemSize.y+Math.max(0,n-1)*this._lineGap:this.viewWidth=n*this._itemSize.x+Math.max(0,n-1)*this._columnGap}else if(0==e)this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal?this.viewHeight=i:this.viewWidth=i;else{for(var r=e-1,a=null;r>=0&&(a=this.getChildAt(r),this.foldInvisibleItems&&!a.visible);)r--;if(r<0)this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal?this.viewHeight=i:this.viewWidth=i;else{var o=0;this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal?((o=a.y+a.height)<i&&(o=i),this.viewHeight=o):((o=a.x+a.width)<i&&(o=i),this.viewWidth=o)}}}},{key:"getMaxItemWidth",value:function(){for(var t=this._children.length,e=0,i=0;i<t;i++){var s=this.getChildAt(i);s.width>e&&(e=s.width)}return e}},{key:"handleSizeChanged",value:function(){_get(_getPrototypeOf(n.prototype),"handleSizeChanged",this).call(this),this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0)}},{key:"handleControllerChanged",value:function(t){_get(_getPrototypeOf(n.prototype),"handleControllerChanged",this).call(this,t),this._selectionController==t&&(this.selectedIndex=t.selectedIndex)}},{key:"updateSelectionController",value:function(t){if(this._selectionController&&!this._selectionController.changing&&t<this._selectionController.pageCount){var e=this._selectionController;this._selectionController=null,e.selectedIndex=t,this._selectionController=e}}},{key:"shouldSnapToNext",value:function(e,i,s){return e<0&&i>t.UIConfig.defaultScrollSnappingThreshold*s||e>0&&i>(1-t.UIConfig.defaultScrollSnappingThreshold)*s||0==e&&i>s/2}},{key:"getSnappingPositionWithDir",value:function(e,s,r,a,o){var h,l,u;return this._virtual?(o||(o=new THREE.Vector2),this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal?(h=s,i=s,l=this.getIndexOnPos1(!1),s=i,l<this._virtualItems.length&&l<this._realNumItems&&(u=this._virtualItems[l].height,this.shouldSnapToNext(a,h-s,u)&&(s+=u+this._lineGap))):this._layout==t.ListLayoutType.SingleRow||this._layout==t.ListLayoutType.FlowVertical?(h=e,i=e,l=this.getIndexOnPos2(!1),e=i,l<this._virtualItems.length&&l<this._realNumItems&&(u=this._virtualItems[l].width,this.shouldSnapToNext(r,h-e,u)&&(e+=u+this._columnGap))):(h=e,i=e,l=this.getIndexOnPos3(!1),e=i,l<this._virtualItems.length&&l<this._realNumItems&&(u=this._virtualItems[l].width,this.shouldSnapToNext(r,h-e,u)&&(e+=u+this._columnGap))),o.x=e,o.y=s,o):_get(_getPrototypeOf(n.prototype),"getSnappingPositionWithDir",this).call(this,e,s,r,a,o)}},{key:"scrollToView",value:function(e,i,s){if(this._virtual){if(0==this._numItems)return;if(this.checkVirtualList(),e>=this._virtualItems.length)throw new Error("Invalid child index: "+e+">"+this._virtualItems.length);var n;this._loop&&(e=Math.floor(this._firstIndex/this._numItems)*this._numItems+e);var r,a=this._virtualItems[e],o=0;if(this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal){for(r=this._curLineItemCount-1;r<e;r+=this._curLineItemCount)o+=this._virtualItems[r].height+this._lineGap;n=new t.Rect(0,o,this._itemSize.x,a.height)}else if(this._layout==t.ListLayoutType.SingleRow||this._layout==t.ListLayoutType.FlowVertical){for(r=this._curLineItemCount-1;r<e;r+=this._curLineItemCount)o+=this._virtualItems[r].width+this._columnGap;n=new t.Rect(o,0,a.width,this._itemSize.y)}else{var h=e/(this._curLineItemCount*this._curLineItemCount2);n=new t.Rect(h*this.viewWidth+e%this._curLineItemCount*(a.width+this._columnGap),e/this._curLineItemCount%this._curLineItemCount2*(a.height+this._lineGap),a.width,a.height)}s=!0,this._scrollPane&&this._scrollPane.scrollToView(n,i,s)}else{var l=this.getChildAt(e);this._scrollPane?this._scrollPane.scrollToView(l,i,s):this._parent&&this._parent.scrollPane&&this._parent.scrollPane.scrollToView(l,i,s)}}},{key:"getFirstChildInView",value:function(){return this.childIndexToItemIndex(_get(_getPrototypeOf(n.prototype),"getFirstChildInView",this).call(this))}},{key:"childIndexToItemIndex",value:function(e){if(!this._virtual)return e;if(this._layout==t.ListLayoutType.Pagination){for(var i=this._firstIndex;i<this._realNumItems;i++)if(this._virtualItems[i].obj&&--e<0)return i;return e}return e+=this._firstIndex,this._loop&&this._numItems>0&&(e%=this._numItems),e}},{key:"itemIndexToChildIndex",value:function(e){if(!this._virtual)return e;if(this._layout==t.ListLayoutType.Pagination)return this.getChildIndex(this._virtualItems[e].obj);if(this._loop&&this._numItems>0){var i=this._firstIndex%this._numItems;e>=i?e-=i:e=this._numItems-i+e}else e-=this._firstIndex;return e}},{key:"setVirtual",value:function(){this._setVirtual(!1)}},{key:"setVirtualAndLoop",value:function(){this._setVirtual(!0)}},{key:"_setVirtual",value:function(e){if(!this._virtual){if(null==this._scrollPane)throw new Error("Virtual list must be scrollable!");if(e){if(this._layout==t.ListLayoutType.FlowHorizontal||this._layout==t.ListLayoutType.FlowVertical)throw new Error("Loop list instanceof not supported for FlowHorizontal or FlowVertical this.layout!");this._scrollPane.bouncebackEffect=!1}if(this._virtual=!0,this._loop=e,this._virtualItems=new Array,this.removeChildrenToPool(),null==this._itemSize){this._itemSize=new THREE.Vector2;var i=this.getFromPool(null);if(null==i)throw new Error("Virtual List must have a default list item resource.");this._itemSize.x=i.width,this._itemSize.y=i.height,this.returnToPool(i)}this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal?(this._scrollPane.scrollStep=this._itemSize.y,this._loop&&(this._scrollPane._loop=2)):(this._scrollPane.scrollStep=this._itemSize.x,this._loop&&(this._scrollPane._loop=1)),this.on("scroll",this.__scrolled,this),this.setVirtualListChangedFlag(!0)}}},{key:"refreshVirtualList",value:function(){this.setVirtualListChangedFlag(!1)}},{key:"checkVirtualList",value:function(){0!=this._virtualListChanged&&(this._refreshVirtualList(),t.Timers.remove(this._refreshVirtualList,this))}},{key:"setVirtualListChangedFlag",value:function(e){e?this._virtualListChanged=2:0==this._virtualListChanged&&(this._virtualListChanged=1),t.Timers.callLater(this._refreshVirtualList,this)}},{key:"_refreshVirtualList",value:function(){if(this._displayObject){var e=2==this._virtualListChanged;this._virtualListChanged=0,this._eventLocked=!0,e&&(this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.SingleRow?this._curLineItemCount=1:this._layout==t.ListLayoutType.FlowHorizontal?this._columnCount>0?this._curLineItemCount=this._columnCount:(this._curLineItemCount=Math.floor((this._scrollPane.viewWidth+this._columnGap)/(this._itemSize.x+this._columnGap)),this._curLineItemCount<=0&&(this._curLineItemCount=1)):this._layout==t.ListLayoutType.FlowVertical?this._lineCount>0?this._curLineItemCount=this._lineCount:(this._curLineItemCount=Math.floor((this._scrollPane.viewHeight+this._lineGap)/(this._itemSize.y+this._lineGap)),this._curLineItemCount<=0&&(this._curLineItemCount=1)):(this._columnCount>0?this._curLineItemCount=this._columnCount:(this._curLineItemCount=Math.floor((this._scrollPane.viewWidth+this._columnGap)/(this._itemSize.x+this._columnGap)),this._curLineItemCount<=0&&(this._curLineItemCount=1)),this._lineCount>0?this._curLineItemCount2=this._lineCount:(this._curLineItemCount2=Math.floor((this._scrollPane.viewHeight+this._lineGap)/(this._itemSize.y+this._lineGap)),this._curLineItemCount2<=0&&(this._curLineItemCount2=1))));var i=0,s=0;if(this._realNumItems>0){var n,r=Math.ceil(this._realNumItems/this._curLineItemCount)*this._curLineItemCount,a=Math.min(this._curLineItemCount,this._realNumItems);if(this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal){for(n=0;n<r;n+=this._curLineItemCount)i+=this._virtualItems[n].height+this._lineGap;if(i>0&&(i-=this._lineGap),this._autoResizeItem)s=this._scrollPane.viewWidth;else{for(n=0;n<a;n++)s+=this._virtualItems[n].width+this._columnGap;s>0&&(s-=this._columnGap)}}else if(this._layout==t.ListLayoutType.SingleRow||this._layout==t.ListLayoutType.FlowVertical){for(n=0;n<r;n+=this._curLineItemCount)s+=this._virtualItems[n].width+this._columnGap;if(s>0&&(s-=this._columnGap),this._autoResizeItem)i=this._scrollPane.viewHeight;else{for(n=0;n<a;n++)i+=this._virtualItems[n].height+this._lineGap;i>0&&(i-=this._lineGap)}}else{s=Math.ceil(r/(this._curLineItemCount*this._curLineItemCount2))*this.viewWidth,i=this.viewHeight}}this.handleAlign(s,i),this._scrollPane.setContentSize(s,i),this._eventLocked=!1,this.handleScroll(!0)}}},{key:"__scrolled",value:function(){this.handleScroll(!1)}},{key:"getIndexOnPos1",value:function(t){if(this._realNumItems<this._curLineItemCount)return i=0,0;var e,s,n;if(this.numChildren>0&&!t){if((s=this.getChildAt(0).y)>i){for(e=this._firstIndex-this._curLineItemCount;e>=0;e-=this._curLineItemCount)if((s-=this._virtualItems[e].height+this._lineGap)<=i)return i=s,e;return i=0,0}for(e=this._firstIndex;e<this._realNumItems;e+=this._curLineItemCount){if((n=s+this._virtualItems[e].height+this._lineGap)>i)return i=s,e;s=n}return i=s,this._realNumItems-this._curLineItemCount}for(s=0,e=0;e<this._realNumItems;e+=this._curLineItemCount){if((n=s+this._virtualItems[e].height+this._lineGap)>i)return i=s,e;s=n}return i=s,this._realNumItems-this._curLineItemCount}},{key:"getIndexOnPos2",value:function(t){if(this._realNumItems<this._curLineItemCount)return i=0,0;var e,s,n;if(this.numChildren>0&&!t){if((s=this.getChildAt(0).x)>i){for(e=this._firstIndex-this._curLineItemCount;e>=0;e-=this._curLineItemCount)if((s-=this._virtualItems[e].width+this._columnGap)<=i)return i=s,e;return i=0,0}for(e=this._firstIndex;e<this._realNumItems;e+=this._curLineItemCount){if((n=s+this._virtualItems[e].width+this._columnGap)>i)return i=s,e;s=n}return i=s,this._realNumItems-this._curLineItemCount}for(s=0,e=0;e<this._realNumItems;e+=this._curLineItemCount){if((n=s+this._virtualItems[e].width+this._columnGap)>i)return i=s,e;s=n}return i=s,this._realNumItems-this._curLineItemCount}},{key:"getIndexOnPos3",value:function(t){if(this._realNumItems<this._curLineItemCount)return i=0,0;var e,s,n=this.viewWidth,r=Math.floor(i/n),a=r*(this._curLineItemCount*this._curLineItemCount2),o=r*n;for(e=0;e<this._curLineItemCount;e++){if((s=o+this._virtualItems[a+e].width+this._columnGap)>i)return i=o,a+e;o=s}return i=o,a+this._curLineItemCount-1}},{key:"handleScroll",value:function(e){if(!this._eventLocked){if(this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal){for(var i=0;this.handleScroll1(e);)if(e=!1,++i>20){console.log("list will never be <the> filled item renderer function always returns a different size.");break}this.handleArchOrder1()}else if(this._layout==t.ListLayoutType.SingleRow||this._layout==t.ListLayoutType.FlowVertical){for(i=0;this.handleScroll2(e);)if(e=!1,++i>20){console.log("list will never be <the> filled item renderer function always returns a different size.");break}this.handleArchOrder2()}else this.handleScroll3(e);this._boundsChanged=!1}}},{key:"handleScroll1",value:function(e){var s=this._scrollPane.scrollingPosY,n=s+this._scrollPane.viewHeight,r=n==this._scrollPane.contentHeight;i=s;var a=this.getIndexOnPos1(e);if(s=i,a==this._firstIndex&&!e)return!1;var o=this._firstIndex;this._firstIndex=a;var h,l,u,c,_,d=a,g=o>a,f=this.numChildren,p=o+f-1,y=g?p:o,v=0,m=s,w=0,k=0,x=this.defaultItem,C=(this._scrollPane.viewWidth-this._columnGap*(this._curLineItemCount-1))/this._curLineItemCount;for(this.itemInfoVer++;d<this._realNumItems&&(r||m<n);){if((null==(l=this._virtualItems[d]).obj||e)&&(this.itemProvider&&(null==(x=this.itemProvider(d%this._numItems))&&(x=this._defaultItem),x=t.UIPackage.normalizeURL(x)),l.obj&&l.obj.resourceURL!=x&&(l.obj instanceof t.GButton&&(l.selected=l.obj.selected),this.removeChildToPool(l.obj),l.obj=null)),null==l.obj){if(g){for(_=y;_>=o;_--)if((u=this._virtualItems[_]).obj&&u.flag!=this.itemInfoVer&&u.obj.resourceURL==x){u.obj instanceof t.GButton&&(u.selected=u.obj.selected),l.obj=u.obj,u.obj=null,_==y&&y--;break}}else for(_=y;_<=p;_++)if((u=this._virtualItems[_]).obj&&u.flag!=this.itemInfoVer&&u.obj.resourceURL==x){u.obj instanceof t.GButton&&(u.selected=u.obj.selected),l.obj=u.obj,u.obj=null,_==y&&y++;break}l.obj?this.setChildIndex(l.obj,g?d-a:this.numChildren):(l.obj=this._pool.getObject(x),g?this.addChildAt(l.obj,d-a):this.addChild(l.obj)),l.obj instanceof t.GButton&&(l.obj.selected=l.selected),h=!0}else h=e;h&&(this._autoResizeItem&&(this._layout==t.ListLayoutType.SingleColumn||this._columnCount>0)&&l.obj.setSize(C,l.obj.height,!0),this.itemRenderer(d%this._numItems,l.obj),d%this._curLineItemCount==0&&(w+=Math.ceil(l.obj.height)-l.height,d==a&&o>a&&(k=Math.ceil(l.obj.height)-l.height)),l.width=Math.ceil(l.obj.width),l.height=Math.ceil(l.obj.height)),l.flag=this.itemInfoVer,l.obj.setPosition(v,m),d==a&&(n+=l.height),v+=l.width+this._columnGap,d%this._curLineItemCount==this._curLineItemCount-1&&(v=0,m+=l.height+this._lineGap),d++}for(c=0;c<f;c++)(l=this._virtualItems[o+c]).flag!=this.itemInfoVer&&l.obj&&(l.obj instanceof t.GButton&&(l.selected=l.obj.selected),this.removeChildToPool(l.obj),l.obj=null);for(f=this._children.length,c=0;c<f;c++){var b=this._virtualItems[a+c].obj;this._children[c]!=b&&this.setChildIndex(b,c)}return 0==w&&0==k||this._scrollPane.changeContentSizeOnScrolling(0,w,0,k),d>0&&this.numChildren>0&&this._container.y<=0&&this.getChildAt(0).y>-this._container.y}},{key:"handleScroll2",value:function(e){var s=this._scrollPane.scrollingPosX,n=s+this._scrollPane.viewWidth,r=s==this._scrollPane.contentWidth;i=s;var a=this.getIndexOnPos2(e);if(s=i,a==this._firstIndex&&!e)return!1;var o=this._firstIndex;this._firstIndex=a;var h,l,u,c,_,d=a,g=o>a,f=this.numChildren,p=o+f-1,y=g?p:o,v=s,m=0,w=0,k=0,x=this.defaultItem,C=(this._scrollPane.viewHeight-this._lineGap*(this._curLineItemCount-1))/this._curLineItemCount;for(this.itemInfoVer++;d<this._realNumItems&&(r||v<n);){if((null==(l=this._virtualItems[d]).obj||e)&&(this.itemProvider&&(null==(x=this.itemProvider(d%this._numItems))&&(x=this._defaultItem),x=t.UIPackage.normalizeURL(x)),l.obj&&l.obj.resourceURL!=x&&(l.obj instanceof t.GButton&&(l.selected=l.obj.selected),this.removeChildToPool(l.obj),l.obj=null)),null==l.obj){if(g){for(_=y;_>=o;_--)if((u=this._virtualItems[_]).obj&&u.flag!=this.itemInfoVer&&u.obj.resourceURL==x){u.obj instanceof t.GButton&&(u.selected=u.obj.selected),l.obj=u.obj,u.obj=null,_==y&&y--;break}}else for(_=y;_<=p;_++)if((u=this._virtualItems[_]).obj&&u.flag!=this.itemInfoVer&&u.obj.resourceURL==x){u.obj instanceof t.GButton&&(u.selected=u.obj.selected),l.obj=u.obj,u.obj=null,_==y&&y++;break}l.obj?this.setChildIndex(l.obj,g?d-a:this.numChildren):(l.obj=this._pool.getObject(x),g?this.addChildAt(l.obj,d-a):this.addChild(l.obj)),l.obj instanceof t.GButton&&(l.obj.selected=l.selected),h=!0}else h=e;h&&(this._autoResizeItem&&(this._layout==t.ListLayoutType.SingleRow||this._lineCount>0)&&l.obj.setSize(l.obj.width,C,!0),this.itemRenderer(d%this._numItems,l.obj),d%this._curLineItemCount==0&&(w+=Math.ceil(l.obj.width)-l.width,d==a&&o>a&&(k=Math.ceil(l.obj.width)-l.width)),l.width=Math.ceil(l.obj.width),l.height=Math.ceil(l.obj.height)),l.flag=this.itemInfoVer,l.obj.setPosition(v,m),d==a&&(n+=l.width),m+=l.height+this._lineGap,d%this._curLineItemCount==this._curLineItemCount-1&&(m=0,v+=l.width+this._columnGap),d++}for(c=0;c<f;c++)(l=this._virtualItems[o+c]).flag!=this.itemInfoVer&&l.obj&&(l.obj instanceof t.GButton&&(l.selected=l.obj.selected),this.removeChildToPool(l.obj),l.obj=null);for(f=this._children.length,c=0;c<f;c++){var b=this._virtualItems[a+c].obj;this._children[c]!=b&&this.setChildIndex(b,c)}return 0==w&&0==k||this._scrollPane.changeContentSizeOnScrolling(w,0,k,0),d>0&&this.numChildren>0&&this._container.x<=0&&this.getChildAt(0).x>-this._container.x}},{key:"handleScroll3",value:function(e){var s=this._scrollPane.scrollingPosX;i=s;var n=this.getIndexOnPos3(e);if(s=i,n!=this._firstIndex||e){var r=this._firstIndex;this._firstIndex=n;var a,o,h,l,u,c=r,_=this._virtualItems.length,d=this._curLineItemCount*this._curLineItemCount2,g=n%this._curLineItemCount,f=this.viewWidth,p=Math.floor(n/d)*d,y=p+2*d,v=this._defaultItem,m=(this._scrollPane.viewWidth-this._columnGap*(this._curLineItemCount-1))/this._curLineItemCount,w=(this._scrollPane.viewHeight-this._lineGap*(this._curLineItemCount2-1))/this._curLineItemCount2;for(this.itemInfoVer++,o=p;o<y;o++)if(!(o>=this._realNumItems)){if(u=o%this._curLineItemCount,o-p<d){if(u<g)continue}else if(u>g)continue;(h=this._virtualItems[o]).flag=this.itemInfoVer}var k=null,x=0;for(o=p;o<y;o++)if(!(o>=this._realNumItems)&&(h=this._virtualItems[o]).flag==this.itemInfoVer){if(null==h.obj){for(;c<_;){if((l=this._virtualItems[c]).obj&&l.flag!=this.itemInfoVer){l.obj instanceof t.GButton&&(l.selected=l.obj.selected),h.obj=l.obj,l.obj=null;break}c++}-1==x&&(x=this.getChildIndex(k)+1),null==h.obj?(this.itemProvider&&(null==(v=this.itemProvider(o%this._numItems))&&(v=this._defaultItem),v=t.UIPackage.normalizeURL(v)),h.obj=this._pool.getObject(v),this.addChildAt(h.obj,x)):x=this.setChildIndexBefore(h.obj,x),x++,h.obj instanceof t.GButton&&(h.obj.selected=h.selected),a=!0}else a=e,x=-1,k=h.obj;a&&(this._autoResizeItem&&(this._curLineItemCount==this._columnCount&&this._curLineItemCount2==this._lineCount?h.obj.setSize(m,w,!0):this._curLineItemCount==this._columnCount?h.obj.setSize(m,h.obj.height,!0):this._curLineItemCount2==this._lineCount&&h.obj.setSize(h.obj.width,w,!0)),this.itemRenderer(o%this._numItems,h.obj),h.width=Math.ceil(h.obj.width),h.height=Math.ceil(h.obj.height))}var C=p/d*f,b=C,T=0,S=0;for(o=p;o<y;o++)o>=this._realNumItems||((h=this._virtualItems[o]).flag==this.itemInfoVer&&h.obj.setPosition(b,T),h.height>S&&(S=h.height),o%this._curLineItemCount==this._curLineItemCount-1?(b=C,T+=S+this._lineGap,S=0,o==p+d-1&&(b=C+=f,T=0)):b+=h.width+this._columnGap);for(o=c;o<_;o++)(h=this._virtualItems[o]).flag!=this.itemInfoVer&&h.obj&&(h.obj instanceof t.GButton&&(h.selected=h.obj.selected),this.removeChildToPool(h.obj),h.obj=null)}}},{key:"handleArchOrder1",value:function(){if(this.childrenRenderOrder==t.ChildrenRenderOrder.Arch){for(var e=this._scrollPane.posY+this.viewHeight/2,i=Number.POSITIVE_INFINITY,s=0,n=0,r=this.numChildren,a=0;a<r;a++){var o=this.getChildAt(a);this.foldInvisibleItems&&!o.visible||(s=Math.abs(e-o.y-o.height/2))<i&&(i=s,n=a)}this.apexIndex=n}}},{key:"handleArchOrder2",value:function(){if(this.childrenRenderOrder==t.ChildrenRenderOrder.Arch){for(var e=this._scrollPane.posX+this.viewWidth/2,i=Number.POSITIVE_INFINITY,s=0,n=0,r=this.numChildren,a=0;a<r;a++){var o=this.getChildAt(a);this.foldInvisibleItems&&!o.visible||(s=Math.abs(e-o.x-o.width/2))<i&&(i=s,n=a)}this.apexIndex=n}}},{key:"handleAlign",value:function(t,e){var i=0,s=0;e<this.viewHeight&&("middle"==this._verticalAlign?s=Math.floor((this.viewHeight-e)/2):"bottom"==this._verticalAlign&&(s=this.viewHeight-e)),t<this.viewWidth&&("center"==this._align?i=Math.floor((this.viewWidth-t)/2):"right"==this._align&&(i=this.viewWidth-t)),i==this._alignOffset.x&&s==this._alignOffset.y||(this._alignOffset.set(i,s),this._scrollPane?this._scrollPane.adjustMaskContainer():this._container.setPosition(this._margin.left+this._alignOffset.x,this._margin.top+this._alignOffset.y))}},{key:"updateBounds",value:function(){if(!this._virtual){var e,i,s,n,r,a=0,o=0,h=0,l=0,u=0,c=0,_=0,d=this._children.length,g=this.viewWidth,f=this.viewHeight,p=0,y=0;if(this._layout==t.ListLayoutType.SingleColumn){for(e=0;e<d;e++)i=this.getChildAt(e),this.foldInvisibleItems&&!i.visible||(0!=o&&(o+=this._lineGap),i.y=o,this._autoResizeItem&&i.setSize(g,i.height,!0),o+=Math.ceil(i.height),i.width>h&&(h=i.width));if((n=o)<=f&&this._autoResizeItem&&this._scrollPane&&this._scrollPane._displayInDemand&&this._scrollPane.vtScrollBar)for(g+=this._scrollPane.vtScrollBar.width,e=0;e<d;e++)i=this.getChildAt(e),this.foldInvisibleItems&&!i.visible||(i.setSize(g,i.height,!0),i.width>h&&(h=i.width));s=Math.ceil(h)}else if(this._layout==t.ListLayoutType.SingleRow){for(e=0;e<d;e++)i=this.getChildAt(e),this.foldInvisibleItems&&!i.visible||(0!=a&&(a+=this._columnGap),i.x=a,this._autoResizeItem&&i.setSize(i.width,f,!0),a+=Math.ceil(i.width),i.height>l&&(l=i.height));if((s=a)<=g&&this._autoResizeItem&&this._scrollPane&&this._scrollPane._displayInDemand&&this._scrollPane.hzScrollBar)for(f+=this._scrollPane.hzScrollBar.height,e=0;e<d;e++)i=this.getChildAt(e),this.foldInvisibleItems&&!i.visible||(i.setSize(i.width,f,!0),i.height>l&&(l=i.height));n=Math.ceil(l)}else if(this._layout==t.ListLayoutType.FlowHorizontal)if(this._autoResizeItem&&this._columnCount>0){for(e=0;e<d;e++)if(i=this.getChildAt(e),(!this.foldInvisibleItems||i.visible)&&(p+=i.sourceWidth,++u==this._columnCount||e==d-1)){for(r=(g-p-(u-1)*this._columnGap)/p,a=0,u=y;u<=e;u++)i=this.getChildAt(u),this.foldInvisibleItems&&!i.visible||(i.setPosition(a,o),u<e?(i.setSize(i.sourceWidth+Math.round(i.sourceWidth*r),i.height,!0),a+=Math.ceil(i.width)+this._columnGap):i.setSize(g-a,i.height,!0),i.height>l&&(l=i.height));o+=Math.ceil(l)+this._lineGap,l=0,u=0,y=e+1,p=0}n=o+Math.ceil(l),s=g}else{for(e=0;e<d;e++)i=this.getChildAt(e),this.foldInvisibleItems&&!i.visible||(0!=a&&(a+=this._columnGap),(0!=this._columnCount&&u>=this._columnCount||0==this._columnCount&&a+i.width>g&&0!=l)&&(a=0,o+=Math.ceil(l)+this._lineGap,l=0,u=0),i.setPosition(a,o),(a+=Math.ceil(i.width))>h&&(h=a),i.height>l&&(l=i.height),u++);n=o+Math.ceil(l),s=Math.ceil(h)}else if(this._layout==t.ListLayoutType.FlowVertical)if(this._autoResizeItem&&this._lineCount>0){for(e=0;e<d;e++)if(i=this.getChildAt(e),(!this.foldInvisibleItems||i.visible)&&(p+=i.sourceHeight,++u==this._lineCount||e==d-1)){for(r=(f-p-(u-1)*this._lineGap)/p,o=0,u=y;u<=e;u++)i=this.getChildAt(u),this.foldInvisibleItems&&!i.visible||(i.setPosition(a,o),u<e?(i.setSize(i.width,i.sourceHeight+Math.round(i.sourceHeight*r),!0),o+=Math.ceil(i.height)+this._lineGap):i.setSize(i.width,f-o,!0),i.width>h&&(h=i.width));a+=Math.ceil(h)+this._columnGap,h=0,u=0,y=e+1,p=0}s=a+Math.ceil(h),n=f}else{for(e=0;e<d;e++)i=this.getChildAt(e),this.foldInvisibleItems&&!i.visible||(0!=o&&(o+=this._lineGap),(0!=this._lineCount&&u>=this._lineCount||0==this._lineCount&&o+i.height>f&&0!=h)&&(o=0,a+=Math.ceil(h)+this._columnGap,h=0,u=0),i.setPosition(a,o),(o+=Math.ceil(i.height))>l&&(l=o),i.width>h&&(h=i.width),u++);s=a+Math.ceil(h),n=Math.ceil(l)}else{var v;if(this._autoResizeItem&&this._lineCount>0&&(v=Math.floor((f-(this._lineCount-1)*this._lineGap)/this._lineCount)),this._autoResizeItem&&this._columnCount>0){for(e=0;e<d;e++)if(i=this.getChildAt(e),(!this.foldInvisibleItems||i.visible)&&(0==u&&(0!=this._lineCount&&_>=this._lineCount||0==this._lineCount&&o+i.height>f)&&(c++,o=0,_=0),p+=i.sourceWidth,++u==this._columnCount||e==d-1)){for(r=(g-p-(u-1)*this._columnGap)/p,a=0,u=y;u<=e;u++)i=this.getChildAt(u),this.foldInvisibleItems&&!i.visible||(i.setPosition(c*g+a,o),u<e?(i.setSize(i.sourceWidth+Math.round(i.sourceWidth*r),this._lineCount>0?v:i.height,!0),a+=Math.ceil(i.width)+this._columnGap):i.setSize(g-a,this._lineCount>0?v:i.height,!0),i.height>l&&(l=i.height));o+=Math.ceil(l)+this._lineGap,l=0,u=0,y=e+1,p=0,_++}}else for(e=0;e<d;e++)i=this.getChildAt(e),this.foldInvisibleItems&&!i.visible||(0!=a&&(a+=this._columnGap),this._autoResizeItem&&this._lineCount>0&&i.setSize(i.width,v,!0),(0!=this._columnCount&&u>=this._columnCount||0==this._columnCount&&a+i.width>g&&0!=l)&&(a=0,o+=Math.ceil(l)+this._lineGap,l=0,u=0,_++,(0!=this._lineCount&&_>=this._lineCount||0==this._lineCount&&o+i.height>f&&0!=h)&&(c++,o=0,_=0)),i.setPosition(c*g+a,o),(a+=Math.ceil(i.width))>h&&(h=a),i.height>l&&(l=i.height),u++);n=c>0?f:o+Math.ceil(l),s=(c+1)*g}this.handleAlign(s,n),this.setBounds(0,0,s,n)}}},{key:"setup_beforeAdd",value:function(e,i){var s;_get(_getPrototypeOf(n.prototype),"setup_beforeAdd",this).call(this,e,i),e.seek(i,5),this._layout=e.readByte(),this._selectionMode=e.readByte(),s=e.readByte(),this._align=0==s?"left":1==s?"center":"right",s=e.readByte(),this._verticalAlign=0==s?"top":1==s?"middle":"bottom",this._lineGap=e.readShort(),this._columnGap=e.readShort(),this._lineCount=e.readShort(),this._columnCount=e.readShort(),this._autoResizeItem=e.readBool(),this._childrenRenderOrder=e.readByte(),this._apexIndex=e.readShort(),e.readBool()&&(this._margin.top=e.readInt(),this._margin.bottom=e.readInt(),this._margin.left=e.readInt(),this._margin.right=e.readInt());var r=e.readByte();if(r==t.OverflowType.Scroll){var a=e.pos;e.seek(i,7),this.setupScroll(e),e.pos=a}else this.setupOverflow(r);e.readBool()&&e.skip(8),e.version>=2&&(this.scrollItemToViewOnClick=e.readBool(),this.foldInvisibleItems=e.readBool()),e.seek(i,8),this._defaultItem=e.readS(),this.readItems(e)}},{key:"readItems",value:function(t){var e,i,s,n;for(e=t.readShort(),i=0;i<e;i++)if(s=t.readShort(),s+=t.pos,null!=(n=t.readS())||(n=this.defaultItem)){var r=this.getFromPool(n);r&&(this.addChild(r),this.setupItem(t,r)),t.pos=s}else t.pos=s}},{key:"setupItem",value:function(e,i){var s,n,r;if(null!=(s=e.readS())&&(i.text=s),null!=(s=e.readS())&&i instanceof t.GButton&&(i.selectedTitle=s),null!=(s=e.readS())&&(i.icon=s),null!=(s=e.readS())&&i instanceof t.GButton&&(i.selectedIcon=s),null!=(s=e.readS())&&(i.name=s),i instanceof t.GComponent){for(n=e.readShort(),r=0;r<n;r++){var a=i.getController(e.readS());s=e.readS(),a&&(a.selectedPageId=s)}if(e.version>=2)for(n=e.readShort(),r=0;r<n;r++){var o=e.readS(),h=e.readShort(),l=e.readS(),u=i.getChildByPath(o);u&&u.setProp(h,l)}}}},{key:"setup_afterAdd",value:function(t,e){_get(_getPrototypeOf(n.prototype),"setup_afterAdd",this).call(this,t,e),t.seek(e,6);var i=t.readShort();-1!=i&&(this._selectionController=this._parent.getControllerAt(i))}},{key:"layout",get:function(){return this._layout},set:function(t){this._layout!=t&&(this._layout=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}},{key:"lineCount",get:function(){return this._lineCount},set:function(e){this._lineCount!=e&&(this._lineCount=e,this._layout!=t.ListLayoutType.FlowVertical&&this._layout!=t.ListLayoutType.Pagination||(this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0)))}},{key:"columnCount",get:function(){return this._columnCount},set:function(e){this._columnCount!=e&&(this._columnCount=e,this._layout!=t.ListLayoutType.FlowHorizontal&&this._layout!=t.ListLayoutType.Pagination||(this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0)))}},{key:"lineGap",get:function(){return this._lineGap},set:function(t){this._lineGap!=t&&(this._lineGap=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}},{key:"columnGap",get:function(){return this._columnGap},set:function(t){this._columnGap!=t&&(this._columnGap=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}},{key:"align",get:function(){return this._align},set:function(t){this._align!=t&&(this._align=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!=t&&(this._verticalAlign=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}},{key:"virtualItemSize",get:function(){return this._itemSize},set:function(t){this._virtual&&(null==this._itemSize&&(this._itemSize=new THREE.Vector2),this._itemSize.set(t.x,t.y),this.setVirtualListChangedFlag(!0))}},{key:"defaultItem",get:function(){return this._defaultItem},set:function(t){this._defaultItem=t}},{key:"autoResizeItem",get:function(){return this._autoResizeItem},set:function(t){this._autoResizeItem!=t&&(this._autoResizeItem=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}},{key:"selectionMode",get:function(){return this._selectionMode},set:function(t){this._selectionMode=t}},{key:"selectionController",get:function(){return this._selectionController},set:function(t){this._selectionController=t}},{key:"itemPool",get:function(){return this._pool}},{key:"selectedIndex",get:function(){var e;if(this._virtual)for(e=0;e<this._realNumItems;e++){var i=this._virtualItems[e];if(i.obj instanceof t.GButton&&i.obj.selected||null==i.obj&&i.selected)return this._loop?e%this._numItems:e}else{var s=this._children.length;for(e=0;e<s;e++){var n=this._children[e];if(n&&n.selected)return e}}return-1},set:function(e){e>=0&&e<this.numItems?(this._selectionMode!=t.ListSelectionMode.Single&&this.clearSelection(),this.addSelection(e)):this.clearSelection()}},{key:"numItems",get:function(){return this._virtual?this._numItems:this._children.length},set:function(e){var i;if(this._virtual){if(null==this.itemRenderer)throw new Error("set itemRenderer first!");this._numItems=e,this._loop?this._realNumItems=6*this._numItems:this._realNumItems=this._numItems;var s=this._virtualItems.length;if(this._realNumItems>s)for(i=s;i<this._realNumItems;i++){var n={width:0,height:0,flag:0};n.width=this._itemSize.x,n.height=this._itemSize.y,this._virtualItems.push(n)}else for(i=this._realNumItems;i<s;i++)this._virtualItems[i].selected=!1;0!=this._virtualListChanged&&t.Timers.remove(this._refreshVirtualList,this),this._refreshVirtualList()}else{var r=this._children.length;if(e>r)for(i=r;i<e;i++)null==this.itemProvider?this.addItemFromPool():this.addItemFromPool(this.itemProvider(i));else this.removeChildrenToPool(e,r);if(this.itemRenderer)for(i=0;i<e;i++)this.itemRenderer(i,this.getChildAt(i))}}}]),n}(t.GComponent);t.GList=e;var i=0}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(){var e;return _classCallCheck(this,s),(e=i.call(this))._contentSourceWidth=0,e._contentSourceHeight=0,e._contentWidth=0,e._contentHeight=0,e._url="",e._fill=t.LoaderFillType.None,e._align="left",e._valign="top",e}return _createClass(s,[{key:"createDisplayObject",value:function(){this._displayObject=new t.DisplayObject,this._content=new t.MovieClip,this._displayObject.addChild(this._content)}},{key:"dispose",value:function(){this._contentItem&&this._content.texture&&this.freeExternal(this._content.texture),this._content2&&this._content2.dispose(),_get(_getPrototypeOf(s.prototype),"dispose",this).call(this)}},{key:"loadContent",value:function(){this.clearContent(),this._url&&(this._url.startsWith("ui://")?this.loadFromPackage(this._url):this.loadExternal())}},{key:"loadFromPackage",value:function(e){if(this._contentItem=t.UIPackage.getItemByURL(e),this._contentItem)if(this._contentItem=this._contentItem.getBranch(),this._contentSourceWidth=this._contentItem.width,this._contentSourceHeight=this._contentItem.height,this._contentItem=this._contentItem.getHighResolution(),this._contentItem.load(),this._autoSize&&this.setSize(this._contentSourceWidth,this._contentSourceHeight),this._contentItem.type==t.PackageItemType.Image)null==this._contentItem.texture?this.setErrorState():(this._content.texture=this._contentItem.texture,this._content.scale9Grid=this._contentItem.scale9Grid,this._content.scaleByTile=this._contentItem.scaleByTile,this._content.tileGridIndice=this._contentItem.tileGridIndice,this._contentSourceWidth=this._contentItem.width,this._contentSourceHeight=this._contentItem.height,this.updateLayout());else if(this._contentItem.type==t.PackageItemType.MovieClip)this._contentSourceWidth=this._contentItem.width,this._contentSourceHeight=this._contentItem.height,this._content.interval=this._contentItem.interval,this._content.swing=this._contentItem.swing,this._content.repeatDelay=this._contentItem.repeatDelay,this._content.frames=this._contentItem.frames,this.updateLayout();else if(this._contentItem.type==t.PackageItemType.Component){var i=t.UIPackage.createObjectFromURL(e);i?i instanceof t.GComponent?(this._content2=i,this._displayObject.addChild(this._content2.displayObject),this.updateLayout()):(i.dispose(),this.setErrorState()):this.setErrorState()}else this.setErrorState();else this.setErrorState()}},{key:"loadExternal",value:function(){var e=this,i=this._url;(new THREE.TextureLoader).load(this._url,(function(s){i==e._url&&e.onExternalLoadSuccess(new t.NTexture(s))}))}},{key:"freeExternal",value:function(t){}},{key:"onExternalLoadSuccess",value:function(t){this._content.texture=t,this._content.scale9Grid=null,this._content.scaleByTile=!1,this._contentSourceWidth=t.width,this._contentSourceHeight=t.height,this.updateLayout()}},{key:"onExternalLoadFailed",value:function(){this.setErrorState()}},{key:"setErrorState",value:function(){}},{key:"clearErrorState",value:function(){}},{key:"updateLayout",value:function(){if(this._content2||this._content.texture||this._content.frames)if(this._contentWidth=this._contentSourceWidth,this._contentHeight=this._contentSourceHeight,this._autoSize&&(this._updatingLayout=!0,0==this._contentWidth&&(this._contentWidth=50),0==this._contentHeight&&(this._contentHeight=30),this.setSize(this._contentWidth,this._contentHeight),this._updatingLayout=!1,this._contentWidth==this._width&&this._contentHeight==this._height))this._content2?(this._content2.setPosition(0,0),this._content2.setScale(1,1)):(this._content.setSize(this._contentWidth,this._contentHeight),this._content.setPosition(0,0));else{var e,i,s=1,n=1;this._fill!=t.LoaderFillType.None&&(s=this.width/this._contentSourceWidth,n=this.height/this._contentSourceHeight,1==s&&1==n||(this._fill==t.LoaderFillType.ScaleMatchHeight?s=n:this._fill==t.LoaderFillType.ScaleMatchWidth?n=s:this._fill==t.LoaderFillType.Scale?s>n?s=n:n=s:this._fill==t.LoaderFillType.ScaleNoBorder&&(s>n?n=s:s=n),this._shrinkOnly&&(s>1&&(s=1),n>1&&(n=1)),this._contentWidth=this._contentSourceWidth*s,this._contentHeight=this._contentSourceHeight*n)),this._content2?this._content2.setScale(s,n):this._content.setSize(this._contentWidth,this._contentHeight),e="center"==this._align?Math.floor((this.width-this._contentWidth)/2):"right"==this._align?this.width-this._contentWidth:0,i="middle"==this._valign?Math.floor((this.height-this._contentHeight)/2):"bottom"==this._valign?this.height-this._contentHeight:0,this._content2?this._content2.setPosition(e,i):this._content.setPosition(e,i)}else this._autoSize&&(this._updatingLayout=!0,this.setSize(50,30),this._updatingLayout=!1)}},{key:"clearContent",value:function(){this.clearErrorState(),null==this._contentItem&&this._content.texture&&this.freeExternal(this._content.texture),this._content.texture=null,this._content.frames=null,this._content2&&(this._content2.dispose(),this._content2=null),this._contentItem=null}},{key:"handleSizeChanged",value:function(){_get(_getPrototypeOf(s.prototype),"handleSizeChanged",this).call(this),this._updatingLayout||this.updateLayout()}},{key:"getProp",value:function(e){switch(e){case t.ObjectPropID.Color:return this.color;case t.ObjectPropID.Playing:return this.playing;case t.ObjectPropID.Frame:return this.frame;case t.ObjectPropID.TimeScale:return this._content.timeScale;default:return _get(_getPrototypeOf(s.prototype),"getProp",this).call(this,e)}}},{key:"setProp",value:function(e,i){switch(e){case t.ObjectPropID.Color:this.color=i;break;case t.ObjectPropID.Playing:this.playing=i;break;case t.ObjectPropID.Frame:this.frame=i;break;case t.ObjectPropID.TimeScale:this._content.timeScale=i;break;case t.ObjectPropID.DeltaTime:this._content.advance(i);break;default:_get(_getPrototypeOf(s.prototype),"setProp",this).call(this,e,i)}}},{key:"setup_beforeAdd",value:function(t,e){var i;_get(_getPrototypeOf(s.prototype),"setup_beforeAdd",this).call(this,t,e),t.seek(e,5),this._url=t.readS(),i=t.readByte(),this._align=0==i?"left":1==i?"center":"right",i=t.readByte(),this._valign=0==i?"top":1==i?"middle":"bottom",this._fill=t.readByte(),this._shrinkOnly=t.readBool(),this._autoSize=t.readBool(),t.readBool(),this._content.playing=t.readBool(),this._content.frame=t.readInt(),t.readBool()&&(this.color=t.readColor()),this._content.fillMethod=t.readByte(),0!=this._content.fillMethod&&(this._content.fillOrigin=t.readByte(),this._content.fillClockwise=t.readBool(),this._content.fillAmount=t.readFloat()),this._url&&this.loadContent()}},{key:"url",get:function(){return this._url},set:function(t){this._url!=t&&(this._url=t,this.loadContent(),this.updateGear(7))}},{key:"icon",get:function(){return this._url},set:function(t){this.url=t}},{key:"align",get:function(){return this._align},set:function(t){this._align!=t&&(this._align=t,this.updateLayout())}},{key:"verticalAlign",get:function(){return this._valign},set:function(t){this._valign!=t&&(this._valign=t,this.updateLayout())}},{key:"fill",get:function(){return this._fill},set:function(t){this._fill!=t&&(this._fill=t,this.updateLayout())}},{key:"shrinkOnly",get:function(){return this._shrinkOnly},set:function(t){this._shrinkOnly!=t&&(this._shrinkOnly=t,this.updateLayout())}},{key:"autoSize",get:function(){return this._autoSize},set:function(t){this._autoSize!=t&&(this._autoSize=t,this.updateLayout())}},{key:"playing",get:function(){return this._content.playing},set:function(t){this._content.playing!=t&&(this._content.playing=t,this.updateGear(5))}},{key:"frame",get:function(){return this._content.frame},set:function(t){this._content.frame!=t&&(this._content.frame=t,this.updateGear(5))}},{key:"color",get:function(){return this._content.graphics.color},set:function(t){this._content.graphics.color!=t&&(this._content.graphics.color=t,this.updateGear(4))}},{key:"content",get:function(){return this._content}},{key:"component",get:function(){return this._content2}}]),s}(t.GObject);t.GLoader=e}(fgui||(fgui={})),function(t){var e=function(t){_inherits(i,t);var e=_createSuper(i);function i(){return _classCallCheck(this,i),e.apply(this,arguments)}return i}(t.GObject);t.GLoader3D=e}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(){return _classCallCheck(this,s),i.call(this)}return _createClass(s,[{key:"createDisplayObject",value:function(){this._displayObject=this._movieClip=new t.MovieClip}},{key:"rewind",value:function(){this._movieClip.rewind()}},{key:"syncStatus",value:function(t){this._movieClip.syncStatus(t._movieClip)}},{key:"advance",value:function(t){this._movieClip.advance(t)}},{key:"setPlaySettings",value:function(t,e,i,s){this._movieClip.setPlaySettings(t,e,i,s)}},{key:"getProp",value:function(e){switch(e){case t.ObjectPropID.Color:return this.color;case t.ObjectPropID.Playing:return this.playing;case t.ObjectPropID.Frame:return this.frame;case t.ObjectPropID.TimeScale:return this.timeScale;default:return _get(_getPrototypeOf(s.prototype),"getProp",this).call(this,e)}}},{key:"setProp",value:function(e,i){switch(e){case t.ObjectPropID.Color:this.color=i;break;case t.ObjectPropID.Playing:this.playing=i;break;case t.ObjectPropID.Frame:this.frame=i;break;case t.ObjectPropID.TimeScale:this.timeScale=i;break;case t.ObjectPropID.DeltaTime:this.advance(i);break;default:_get(_getPrototypeOf(s.prototype),"setProp",this).call(this,e,i)}}},{key:"constructFromResource",value:function(){var t=this.packageItem.getBranch();this.sourceWidth=t.width,this.sourceHeight=t.height,this.initWidth=this.sourceWidth,this.initHeight=this.sourceHeight,this.setSize(this.sourceWidth,this.sourceHeight),(t=t.getHighResolution()).load(),this._movieClip.interval=t.interval,this._movieClip.swing=t.swing,this._movieClip.repeatDelay=t.repeatDelay,this._movieClip.frames=t.frames}},{key:"setup_beforeAdd",value:function(t,e){_get(_getPrototypeOf(s.prototype),"setup_beforeAdd",this).call(this,t,e),t.seek(e,5),t.readBool()&&(this.color=t.readColor()),this._movieClip.graphics.flip=t.readByte(),this._movieClip.frame=t.readInt(),this._movieClip.playing=t.readBool()}},{key:"color",get:function(){return this._movieClip.graphics.color},set:function(t){this._movieClip.graphics.color=t}},{key:"playing",get:function(){return this._movieClip.playing},set:function(t){this._movieClip.playing!=t&&(this._movieClip.playing=t,this.updateGear(5))}},{key:"frame",get:function(){return this._movieClip.frame},set:function(t){this._movieClip.frame!=t&&(this._movieClip.frame=t,this.updateGear(5))}},{key:"timeScale",get:function(){return this._movieClip.timeScale},set:function(t){this._movieClip.timeScale=t}}]),s}(t.GObject);t.GMovieClip=e}(fgui||(fgui={})),function(t){var e=function(){function e(){_classCallCheck(this,e),this._count=0,this._pool={}}return _createClass(e,[{key:"clear",value:function(){for(var t in this._pool){this._pool[t].forEach((function(t){return t.dispose()}))}this._pool={},this._count=0}},{key:"getObject",value:function(e){if(null==(e=t.UIPackage.normalizeURL(e)))return null;var i=this._pool[e];return i&&i.length>0?(this._count--,i.shift()):t.UIPackage.createObjectFromURL(e)}},{key:"returnObject",value:function(t){var e=t.resourceURL;if(e){var i=this._pool[e];i||(i=[],this._pool[e]=i),this._count++,i.push(t)}}},{key:"count",get:function(){return this._count}}]),e}();t.GObjectPool=e}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(){var e;return _classCallCheck(this,s),(e=i.call(this))._min=0,e._max=0,e._value=0,e._barMaxWidth=0,e._barMaxHeight=0,e._barMaxWidthDelta=0,e._barMaxHeightDelta=0,e._barStartX=0,e._barStartY=0,e._titleType=t.ProgressTitleType.Percent,e._value=50,e._max=100,e}return _createClass(s,[{key:"tweenValue",value:function(e,i){var s,n=t.GTween.getTween(this,this.update);return n?(s=n.value.x,n.kill()):s=this._value,this._value=e,t.GTween.to(s,this._value,i).setTarget(this,this.update).setEase(t.EaseType.Linear)}},{key:"update",value:function(e){var i=t.clamp01((e-this._min)/(this._max-this._min));if(this._titleObject)switch(this._titleType){case t.ProgressTitleType.Percent:this._titleObject.text=Math.floor(100*i)+"%";break;case t.ProgressTitleType.ValueAndMax:this._titleObject.text=Math.floor(e)+"/"+Math.floor(this._max);break;case t.ProgressTitleType.Value:this._titleObject.text=""+Math.floor(e);break;case t.ProgressTitleType.Max:this._titleObject.text=""+Math.floor(this._max)}var s=this.width-this._barMaxWidthDelta,n=this.height-this._barMaxHeightDelta;this._reverse?(this._barObjectH&&(this._barObjectH instanceof t.GImage&&this._barObjectH.fillMethod!=t.FillMethod.None?this._barObjectH.fillAmount=1-i:(this._barObjectH.width=Math.floor(s*i),this._barObjectH.x=this._barStartX+(s-this._barObjectH.width))),this._barObjectV&&(this._barObjectV instanceof t.GImage&&this._barObjectV.fillMethod!=t.FillMethod.None?this._barObjectV.fillAmount=1-i:(this._barObjectV.height=Math.floor(n*i),this._barObjectV.y=this._barStartY+(n-this._barObjectV.height)))):(this._barObjectH&&(this._barObjectH instanceof t.GImage&&this._barObjectH.fillMethod!=t.FillMethod.None?this._barObjectH.fillAmount=i:this._barObjectH.width=Math.floor(s*i)),this._barObjectV&&(this._barObjectV instanceof t.GImage&&this._barObjectV.fillMethod!=t.FillMethod.None?this._barObjectV.fillAmount=i:this._barObjectV.height=Math.floor(n*i))),this._aniObject&&this._aniObject.setProp(t.ObjectPropID.Frame,Math.floor(100*i))}},{key:"constructExtension",value:function(t){t.seek(0,6),this._titleType=t.readByte(),this._reverse=t.readBool(),this._titleObject=this.getChild("title"),this._barObjectH=this.getChild("bar"),this._barObjectV=this.getChild("bar_v"),this._aniObject=this.getChild("ani"),this._barObjectH&&(this._barMaxWidth=this._barObjectH.width,this._barMaxWidthDelta=this.width-this._barMaxWidth,this._barStartX=this._barObjectH.x),this._barObjectV&&(this._barMaxHeight=this._barObjectV.height,this._barMaxHeightDelta=this.height-this._barMaxHeight,this._barStartY=this._barObjectV.y)}},{key:"handleSizeChanged",value:function(){_get(_getPrototypeOf(s.prototype),"handleSizeChanged",this).call(this),this._barObjectH&&(this._barMaxWidth=this.width-this._barMaxWidthDelta),this._barObjectV&&(this._barMaxHeight=this.height-this._barMaxHeightDelta),this._underConstruct||this.update(this._value)}},{key:"setup_afterAdd",value:function(t,e){_get(_getPrototypeOf(s.prototype),"setup_afterAdd",this).call(this,t,e),t.seek(e,6)&&t.readByte()==this.packageItem.objectType?(this._value=t.readInt(),this._max=t.readInt(),t.version>=2&&(this._min=t.readInt()),this.update(this._value)):this.update(this._value)}},{key:"titleType",get:function(){return this._titleType},set:function(t){this._titleType!=t&&(this._titleType=t,this.update(t))}},{key:"min",get:function(){return this._min},set:function(t){this._min!=t&&(this._min=t,this.update(this._value))}},{key:"max",get:function(){return this._max},set:function(t){this._max!=t&&(this._max=t,this.update(this._value))}},{key:"value",get:function(){return this._value},set:function(e){this._value!=e&&(t.GTween.kill(this,!1,this.update),this._value=e,this.update(e))}}]),s}(t.GComponent);t.GProgressBar=e}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(){var e;_classCallCheck(this,s);var n=(e=i.call(this))._textField.textFormat;return n.font=t.UIConfig.defaultFont,n.size=12,n.lineSpacing=3,e._textField.applyFormat(),e._text="",e._textField.autoSize=t.AutoSizeType.Both,e._textField.wordWrap=!1,e}return _createClass(s,[{key:"createDisplayObject",value:function(){this._displayObject=this._textField=new t.TextField}},{key:"setText",value:function(){var e=this._text;this._template&&(e=this.parseTemplate(e)),this._textField.maxWidth=this.maxWidth,this._ubbEnabled?this._textField.htmlText=t.defaultParser.parse(t.XMLUtils.encodeString(e)):this._textField.text=e}},{key:"setVar",value:function(t,e){return this._template||(this._template={}),this._template[t]=e,this}},{key:"flushVars",value:function(){this.setText(),this.updateSize()}},{key:"applyFormat",value:function(){this._textField.applyFormat(),this._underConstruct||this.updateSize()}},{key:"getProp",value:function(e){switch(e){case t.ObjectPropID.Color:return this.color;case t.ObjectPropID.OutlineColor:return this._textField.textFormat.outlineColor;case t.ObjectPropID.FontSize:return this._textField.textFormat.size;default:return _get(_getPrototypeOf(s.prototype),"getProp",this).call(this,e)}}},{key:"setProp",value:function(e,i){switch(e){case t.ObjectPropID.Color:this.color=i;break;case t.ObjectPropID.OutlineColor:this._textField.textFormat.outlineColor=i,this._textField.applyFormat();break;case t.ObjectPropID.FontSize:this._textField.textFormat.size=i,this._textField.applyFormat();break;default:_get(_getPrototypeOf(s.prototype),"setProp",this).call(this,e,i)}}},{key:"updateSize",value:function(){this._updatingSize||(this._updatingSize=!0,this._textField.autoSize==t.AutoSizeType.Both?this.setSize(this._textField.width,this._textField.height):this._textField.autoSize==t.AutoSizeType.Height&&(this.height=this._textField.height),this._updatingSize=!1)}},{key:"handleSizeChanged",value:function(){this._updatingSize||(this._underConstruct?this._textField.setSize(this.width,this.height):this._textField.autoSize!=t.AutoSizeType.Both&&(this._textField.autoSize==t.AutoSizeType.Height?(this._textField.width=this.width,""!=this._text&&this.setSizeDirectly(this.width,this._textField.height)):this._textField.setSize(this.width,this.height)))}},{key:"setup_beforeAdd",value:function(t,e){_get(_getPrototypeOf(s.prototype),"setup_beforeAdd",this).call(this,t,e),t.seek(e,5);var i=this._textField.textFormat;if(i.font=t.readS(),i.size=t.readShort(),i.color=t.readColor(),this.align=t.readByte(),this.verticalAlign=t.readByte(),i.lineSpacing=t.readShort(),i.letterSpacing=t.readShort(),this.ubbEnabled=t.readBool(),this.autoSize=t.readByte(),i.underline=t.readBool(),i.italic=t.readBool(),i.bold=t.readBool(),this.singleLine=t.readBool(),t.readBool()&&(i.outlineColor=t.readColor(),i.outline=t.readFloat()+1),t.readBool()){i.shadowColor=t.readColor();var n=t.readFloat(),r=t.readFloat();i.shadowOffset.set(n,r)}t.readBool()&&(this._template={}),t.version>=3&&(i.strikethrough=t.readBool()),this._textField.applyFormat()}},{key:"setup_afterAdd",value:function(t,e){_get(_getPrototypeOf(s.prototype),"setup_afterAdd",this).call(this,t,e),t.seek(e,6);var i=t.readS();null!=i&&(this.text=i)}},{key:"parseTemplate",value:function(t){for(var e,i,s,n,r=0,a="";-1!=(e=t.indexOf("{",r));)if(e>0&&92==t.charCodeAt(e-1))a+=t.substring(r,e-1),a+="{",r=e+1;else{if(a+=t.substring(r,e),r=e,-1==(e=t.indexOf("}",r)))break;e!=r+1?(-1!=(i=(s=t.substring(r+1,e)).indexOf("="))?a+=null==(n=this._template[s.substring(0,i)])?s.substring(i+1):n:null!=(n=this._template[s])&&(a+=n),r=e+1):(a+=t.substr(r,2),r=e+1)}return r<t.length&&(a+=t.substr(r)),a}},{key:"text",get:function(){return this._displayObject instanceof t.InputTextField&&(this._text=this._textField.text),this._text},set:function(t){null==t&&(t=""),this._text=t,this.setText(),this.updateSize(),this.updateGear(6)}},{key:"textTemplate",get:function(){return this._template},set:function(t){(this._template||t)&&(this._template=t,this.flushVars())}},{key:"textFormat",get:function(){return this._textField.textFormat}},{key:"align",get:function(){return this._textField.align},set:function(t){this._textField.align=t}},{key:"verticalAlign",get:function(){return this._textField.verticalAlign},set:function(t){this._textField.verticalAlign=t}},{key:"singleLine",get:function(){return this._textField.singleLine},set:function(t){this._textField.singleLine=t}},{key:"ubbEnabled",set:function(t){this._ubbEnabled=t},get:function(){return this._ubbEnabled}},{key:"autoSize",get:function(){return this._textField.autoSize},set:function(e){this._textField.autoSize=e,e==t.AutoSizeType.Both?(this._textField.wordWrap=!1,this._underConstruct||this.setSize(this._textField.textWidth,this._textField.textHeight)):(this._textField.wordWrap=!0,e==t.AutoSizeType.Height?this._underConstruct||(this._textField.width=this.width,this.height=this._textField.textHeight):this._textField.setSize(this.width,this.height))}},{key:"textWidth",get:function(){return this._textField.textWidth}},{key:"textHeight",get:function(){return this._textField.textHeight}},{key:"color",get:function(){return this._textField.textFormat.color},set:function(t){this._textField.textFormat.color!=t&&(this._textField.textFormat.color=t,this._textField.applyFormat(),this.updateGear(4))}}]),s}(t.GObject);t.GTextField=e}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(){return _classCallCheck(this,s),i.call(this)}return _createClass(s,[{key:"createDisplayObject",value:function(){this._displayObject=this._textField=new t.RichTextField}},{key:"setText",value:function(){var e=this._text;this._template&&(e=this.parseTemplate(e)),this._textField.maxWidth=this.maxWidth,this._ubbEnabled?this._textField.htmlText=t.defaultParser.parse(e):this._textField.htmlText=e}}]),s}(t.GTextField);t.GRichTextField=e}(fgui||(fgui={})),function(t){var e,i=function(i){_inherits(n,i);var s=_createSuper(n);function n(){var i;return _classCallCheck(this,n),i=s.call(this),e||(e=_assertThisInitialized(i)),i.opaque=!1,i._popupStack=[],i._justClosedPopups=[],i.on("touch_begin",i.__stageTouchBegin,_assertThisInitialized(i),!0),i._modalLayer=new t.GGraph,i._modalLayer.setSize(i.width,i.height),i._modalLayer.shape.drawRect(0,new t.Color4(0,0),t.UIConfig.modalLayerColor),i._modalLayer.addRelation(_assertThisInitialized(i),t.RelationType.Size),i.applyScaleFactor(),i.on("content_scale_factor_changed",i.applyScaleFactor,_assertThisInitialized(i)),i}return _createClass(n,[{key:"applyScaleFactor",value:function(){this.setSize(Math.ceil(t.Stage.width/t.UIContentScaler.scaleFactor),Math.ceil(t.Stage.height/t.UIContentScaler.scaleFactor)),this.setScale(t.UIContentScaler.scaleFactor,t.UIContentScaler.scaleFactor)}},{key:"showWindow",value:function(t){this.addChild(t),t.x>this.width?t.x=this.width-t.width:t.x+t.width<0&&(t.x=0),t.y>this.height?t.y=this.height-t.height:t.y+t.height<0&&(t.y=0),this.adjustModalLayer()}},{key:"hideWindow",value:function(t){t.hide()}},{key:"hideWindowImmediately",value:function(t){t.parent==this&&this.removeChild(t),this.adjustModalLayer()}},{key:"bringToFront",value:function(e){var i,s=this.numChildren;for(i=this._modalLayer.parent&&!e.modal?this.getChildIndex(this._modalLayer)-1:s-1;i>=0;i--){var n=this.getChildAt(i);if(n==e)return;if(n instanceof t.Window)break}i>=0&&this.setChildIndex(e,i)}},{key:"showModalWait",value:function(e){t.UIConfig.globalModalWaiting&&(null==this._modalWaitPane&&(this._modalWaitPane=t.UIPackage.createObjectFromURL(t.UIConfig.globalModalWaiting)),this._modalWaitPane.setSize(this.width,this.height),this._modalWaitPane.addRelation(this,t.RelationType.Size),this.addChild(this._modalWaitPane),this._modalWaitPane.text=e||"")}},{key:"closeModalWait",value:function(){this._modalWaitPane&&this._modalWaitPane.parent&&this.removeChild(this._modalWaitPane)}},{key:"closeAllExceptModals",value:function(){for(var e=this._children.slice(),i=e.length,s=0;s<i;s++){var n=e[s];n instanceof t.Window&&!n.modal&&n.hide()}}},{key:"closeAllWindows",value:function(){for(var e=this._children.slice(),i=e.length,s=0;s<i;s++){var n=e[s];n instanceof t.Window&&n.hide()}}},{key:"getTopWindow",value:function(){for(var e=this.numChildren-1;e>=0;e--){var i=this.getChildAt(e);if(i instanceof t.Window)return i}return null}},{key:"showPopup",value:function(e,i,s){if(this._popupStack.length>0){var n=this._popupStack.indexOf(e);if(-1!=n)for(var r=this._popupStack.length-1;r>=n;r--)this.removeChild(this._popupStack.pop())}if(this._popupStack.push(e),i)for(var a=i;a;){if(a.parent==this){e.sortingOrder<a.sortingOrder&&(e.sortingOrder=a.sortingOrder);break}a=a.parent}var o;this.addChild(e),this.adjustModalLayer();var h,l,u=0,c=0;if(i){o=i.localToRoot(0,0);var _=i.localToRoot(i.width,i.height);u=_.x-o.x,c=_.y-o.y}else o=t.Stage.getTouchPos(),o=this.globalToLocal(o.x,o.y);(h=o.x)+e.width>this.width&&(h=h+u-e.width),l=o.y+c,((null==s||s==t.PopupDirection.Auto)&&l+e.height>this.height||s==t.PopupDirection.Up)&&(l=o.y-e.height-1)<0&&(l=0,h+=u/2),e.setPosition(h,l)}},{key:"togglePopup",value:function(t,e,i){-1==this._justClosedPopups.indexOf(t)&&this.showPopup(t,e,i)}},{key:"hidePopup",value:function(t){if(t){var e=this._popupStack.indexOf(t);if(-1!=e)for(var i=this._popupStack.length-1;i>=e;i--)this.closePopup(this._popupStack.pop())}else{for(i=this._popupStack.length-1;i>=0;i--)this.closePopup(this._popupStack[i]);this._popupStack.length=0}}},{key:"closePopup",value:function(e){e.parent&&(e instanceof t.Window?e.hide():this.removeChild(e))}},{key:"showTooltips",value:function(e){if(null==this._defaultTooltipWin){var i=t.UIConfig.tooltipsWin;if(!i)return void console.warn("UIConfig.tooltipsWin not defined");this._defaultTooltipWin=t.UIPackage.createObjectFromURL(i)}this._defaultTooltipWin.text=e,this.showTooltipsWin(this._defaultTooltipWin)}},{key:"showTooltipsWin",value:function(e,i,s){this.hideTooltips(),this._tooltipWin=e,null!=i&&null!=s||(i=t.Stage.touchPos.x+10,s=t.Stage.touchPos.y+20);var n=this.globalToLocal(i,s);i=n.x,s=n.y,i+this._tooltipWin.width>this.width&&(i=i-this._tooltipWin.width-1)<0&&(i=10),s+this._tooltipWin.height>this.height&&(s=s-this._tooltipWin.height-1,i-this._tooltipWin.width-1>0&&(i=i-this._tooltipWin.width-1),s<0&&(s=10)),this._tooltipWin.x=i,this._tooltipWin.y=s,this.addChild(this._tooltipWin)}},{key:"hideTooltips",value:function(){this._tooltipWin&&(this._tooltipWin.parent&&this.removeChild(this._tooltipWin),this._tooltipWin=null)}},{key:"playOneShotSound",value:function(e,i){if(t.Stage.audioListener){null==i&&(i=1);var s=t.UIPackage.getItemByURL(e);s&&s.audioBuffer&&(s.sound||(s.sound=new THREE.Audio(t.Stage.audioListener),s.sound.setBuffer(s.audioBuffer),s.sound.setLoop(!1)),s.sound.setVolume(i),s.sound.play())}}},{key:"adjustModalLayer",value:function(){var e=this.numChildren;this._modalWaitPane&&this._modalWaitPane.parent&&this.setChildIndex(this._modalWaitPane,e-1);for(var i=e-1;i>=0;i--){var s=this.getChildAt(i);if(s instanceof t.Window&&s.modal)return void(null==this._modalLayer.parent?this.addChildAt(this._modalLayer,i):this.setChildIndexBefore(this._modalLayer,i))}this._modalLayer.parent&&this.removeChild(this._modalLayer)}},{key:"checkPopups",value:function(){if(this._justClosedPopups.length=0,this._popupStack.length>0){for(var e=t.Stage.touchTarget,i=!1;e;){var s=t.GObject.cast(e);if(s){var n=this._popupStack.indexOf(s);if(-1!=n){for(var r=this._popupStack.length-1;r>n;r--){var a=this._popupStack.length-1,o=this._popupStack[a];this.closePopup(o),this._justClosedPopups.push(o),this._popupStack.splice(a,1)}i=!0;break}}e=e.parent}if(!i)for(var h=this._popupStack.length-1;h>=0;h--){var l=this._popupStack[h];this.closePopup(l),this._justClosedPopups.push(l),this._popupStack.splice(h,1)}}}},{key:"__stageTouchBegin",value:function(){this._tooltipWin&&this.hideTooltips(),this.checkPopups()}},{key:"modalLayer",get:function(){return this._modalLayer}},{key:"hasModalWindow",get:function(){return null!=this._modalLayer.parent}},{key:"modalWaiting",get:function(){return this._modalWaitPane&&this._modalWaitPane.onStage}},{key:"hasAnyPopup",get:function(){return 0!=this._popupStack.length}}],[{key:"findFor",value:function(t){if(t instanceof n)return t;if(!t)return e;for(var i=t._parent;i;){if(i instanceof n)return i;i=i.parent}return e}},{key:"inst",get:function(){return e||(e=new n,t.Stage.scene.add(e.displayObject.obj3D)),e}}]),n}(t.GComponent);t.GRoot=i,t.Decls.GRoot=i}(fgui||(fgui={})),function(t){var e=new THREE.Vector2,i=function(t){_inherits(s,t);var i=_createSuper(s);function s(){var t;return _classCallCheck(this,s),(t=i.call(this))._dragOffset=new THREE.Vector2,t._scrollPerc=0,t}return _createClass(s,[{key:"setScrollPane",value:function(t,e){this._target=t,this._vertical=e}},{key:"setDisplayPerc",value:function(t){this._vertical?(this._fixedGripSize||(this._grip.height=Math.floor(t*this._bar.height)),this._grip.y=this._bar.y+(this._bar.height-this._grip.height)*this._scrollPerc):(this._fixedGripSize||(this._grip.width=Math.floor(t*this._bar.width)),this._grip.x=this._bar.x+(this._bar.width-this._grip.width)*this._scrollPerc),this._grip.visible=0!=t&&1!=t}},{key:"setScrollPerc",value:function(t){this._scrollPerc=t,this._vertical?this._grip.y=this._bar.y+(this._bar.height-this._grip.height)*this._scrollPerc:this._grip.x=this._bar.x+(this._bar.width-this._grip.width)*this._scrollPerc}},{key:"constructExtension",value:function(t){t.seek(0,6),this._fixedGripSize=t.readBool(),this._grip=this.getChild("grip"),this._grip?(this._bar=this.getChild("bar"),this._bar?(this._arrowButton1=this.getChild("arrow1"),this._arrowButton2=this.getChild("arrow2"),this._grip.on("touch_begin",this.__gripTouchBegin,this),this._grip.on("touch_move",this.__gripTouchMove,this),this._grip.on("touch_end",this.__gripTouchEnd,this),this.on("touch_begin",this.__barTouchBegin,this),this._arrowButton1&&this._arrowButton1.on("touch_begin",this.__arrowButton1Click,this),this._arrowButton2&&this._arrowButton2.on("touch_begin",this.__arrowButton2Click,this)):console.warn("bar")):console.warn("grip")}},{key:"__gripTouchBegin",value:function(t){null!=this._bar&&(t.stopPropagation(),this._gripDragging=!0,this._target.updateScrollBarVisible(),this.globalToLocal(t.input.x,t.input.y,this._dragOffset),this._dragOffset.x-=this._grip.x,this._dragOffset.y-=this._grip.y)}},{key:"__gripTouchMove",value:function(t){if(this.onStage){var i=this.globalToLocal(t.input.x,t.input.y,e);if(this._vertical){var s=i.y-this._dragOffset.y,n=this._bar.height-this._grip.height;this._target.percY=0==n?0:(s-this._bar.y)/n}else{var r=i.x-this._dragOffset.x,a=this._bar.width-this._grip.width;this._target.percX=0==a?0:(r-this._bar.x)/(this._bar.width-this._grip.width)}}}},{key:"__gripTouchEnd",value:function(t){this._gripDragging=!1,this._target.updateScrollBarVisible()}},{key:"__arrowButton1Click",value:function(t){t.stopPropagation(),this._vertical?this._target.scrollUp():this._target.scrollLeft()}},{key:"__arrowButton2Click",value:function(t){t.stopPropagation(),this._vertical?this._target.scrollDown():this._target.scrollRight()}},{key:"__barTouchBegin",value:function(t){t.stopPropagation();var i=this.globalToLocal(t.input.x,t.input.y,e);i=this._grip.globalToLocal(t.input.x,t.input.y,e);this._vertical?i.y<0?this._target.scrollUp(4):this._target.scrollDown(4):i.x<0?this._target.scrollLeft(4):this._target.scrollRight(4)}},{key:"minSize",get:function(){return this._vertical?(this._arrowButton1?this._arrowButton1.height:0)+(this._arrowButton2?this._arrowButton2.height:0):(this._arrowButton1?this._arrowButton1.width:0)+(this._arrowButton2?this._arrowButton2.width:0)}},{key:"gripDragging",get:function(){return this._gripDragging}}]),s}(t.GComponent);t.GScrollBar=i}(fgui||(fgui={})),function(t){var e=new THREE.Vector2,i=function(i){_inherits(n,i);var s=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=s.call(this)).changeOnClick=!0,e.canDrag=!0,e._min=0,e._max=0,e._value=0,e._barMaxWidth=0,e._barMaxHeight=0,e._barMaxWidthDelta=0,e._barMaxHeightDelta=0,e._clickPercent=0,e._barStartX=0,e._barStartY=0,e._titleType=t.ProgressTitleType.Percent,e._value=50,e._max=100,e._clickPos=new THREE.Vector2,e}return _createClass(n,[{key:"update",value:function(){this.updateWithPercent((this._value-this._min)/(this._max-this._min),!1)}},{key:"updateWithPercent",value:function(e,i){if(e=t.clamp01(e),i){var s=t.clamp(this._min+(this._max-this._min)*e,this._min,this._max);if(this._wholeNumbers&&(s=Math.round(s),e=t.clamp01((s-this._min)/(this._max-this._min))),s!=this._value&&(this._value=s,this.dispatchEvent("status_changed")))return}if(this._titleObject)switch(this._titleType){case t.ProgressTitleType.Percent:this._titleObject.text=Math.floor(100*e)+"%";break;case t.ProgressTitleType.ValueAndMax:this._titleObject.text=this._value+"/"+this._max;break;case t.ProgressTitleType.Value:this._titleObject.text=""+this._value;break;case t.ProgressTitleType.Max:this._titleObject.text=""+this._max}var n=this.width-this._barMaxWidthDelta,r=this.height-this._barMaxHeightDelta;this._reverse?(this._barObjectH&&(this._barObjectH.width=Math.round(n*e),this._barObjectH.x=this._barStartX+(n-this._barObjectH.width)),this._barObjectV&&(this._barObjectV.height=Math.round(r*e),this._barObjectV.y=this._barStartY+(r-this._barObjectV.height))):(this._barObjectH&&(this._barObjectH.width=Math.round(n*e)),this._barObjectV&&(this._barObjectV.height=Math.round(r*e)))}},{key:"constructExtension",value:function(t){t.seek(0,6),this._titleType=t.readByte(),this._reverse=t.readBool(),t.version>=2&&(this._wholeNumbers=t.readBool(),this.changeOnClick=t.readBool()),this._titleObject=this.getChild("title"),this._barObjectH=this.getChild("bar"),this._barObjectV=this.getChild("bar_v"),this._gripObject=this.getChild("grip"),this._barObjectH&&(this._barMaxWidth=this._barObjectH.width,this._barMaxWidthDelta=this.width-this._barMaxWidth,this._barStartX=this._barObjectH.x),this._barObjectV&&(this._barMaxHeight=this._barObjectV.height,this._barMaxHeightDelta=this.height-this._barMaxHeight,this._barStartY=this._barObjectV.y),this._gripObject&&(this._gripObject.on("touch_begin",this.__gripTouchBegin,this),this._gripObject.on("touch_move",this.__gripTouchMove,this)),this.on("touch_begin",this.__barTouchBegin,this)}},{key:"handleSizeChanged",value:function(){_get(_getPrototypeOf(n.prototype),"handleSizeChanged",this).call(this),this._barObjectH&&(this._barMaxWidth=this.width-this._barMaxWidthDelta),this._barObjectV&&(this._barMaxHeight=this.height-this._barMaxHeightDelta),this._underConstruct||this.update()}},{key:"setup_afterAdd",value:function(t,e){_get(_getPrototypeOf(n.prototype),"setup_afterAdd",this).call(this,t,e),t.seek(e,6)&&t.readByte()==this.packageItem.objectType?(this._value=t.readInt(),this._max=t.readInt(),t.version>=2&&(this._min=t.readInt()),this.update()):this.update()}},{key:"__gripTouchBegin",value:function(e){0==e.input.button&&(this.canDrag=!0,e.stopPropagation(),e.captureTouch(),this.globalToLocal(e.input.x,e.input.y,this._clickPos),this._clickPercent=t.clamp01((this._value-this._min)/(this._max-this._min)))}},{key:"__gripTouchMove",value:function(t){if(this.canDrag){var i,s=this.globalToLocal(t.input.x,t.input.y,e),n=s.x-this._clickPos.x,r=s.y-this._clickPos.y;this._reverse&&(n=-n,r=-r),i=this._barObjectH?this._clickPercent+n/this._barMaxWidth:this._clickPercent+r/this._barMaxHeight,this.updateWithPercent(i,!0)}}},{key:"__barTouchBegin",value:function(i){if(this.changeOnClick){var s=this._gripObject.globalToLocal(i.input.x,i.input.y,e),n=t.clamp01((this._value-this._min)/(this._max-this._min)),r=0;null!=this._barObjectH&&(r=(s.x-this._gripObject.width/2)/this._barMaxWidth),null!=this._barObjectV&&(r=(s.y-this._gripObject.height/2)/this._barMaxHeight),this._reverse?n-=r:n+=r,this.updateWithPercent(n,!0)}}},{key:"titleType",get:function(){return this._titleType},set:function(t){this._titleType=t}},{key:"wholeNumbers",get:function(){return this._wholeNumbers},set:function(t){this._wholeNumbers!=t&&(this._wholeNumbers=t,this.update())}},{key:"min",get:function(){return this._min},set:function(t){this._min!=t&&(this._min=t,this.update())}},{key:"max",get:function(){return this._max},set:function(t){this._max!=t&&(this._max=t,this.update())}},{key:"value",get:function(){return this._value},set:function(t){this._value!=t&&(this._value=t,this.update())}}]),n}(t.GComponent);t.GSlider=i}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(){return _classCallCheck(this,s),i.call(this)}return _createClass(s,[{key:"createDisplayObject",value:function(){this._displayObject=this._textField=new t.InputTextField}},{key:"requestFocus",value:function(){}},{key:"setup_beforeAdd",value:function(t,e){_get(_getPrototypeOf(s.prototype),"setup_beforeAdd",this).call(this,t,e),t.seek(e,4);var i=t.readS();null!=i&&(this.promptText=i),null!=(i=t.readS())&&(this.restrict=i);var n=t.readInt();0!=n&&(this.maxLength=n),0!=(n=t.readInt())&&(4==n?this.keyboardType="number":3==n&&(this.keyboardType="url")),t.readBool()&&(this.password=!0)}},{key:"password",get:function(){return this._textField.password},set:function(t){this._textField.password=t}},{key:"keyboardType",get:function(){return this._textField.keyboardType},set:function(t){this._textField.keyboardType=t}},{key:"editable",set:function(t){this._textField.editable=t},get:function(){return this._textField.editable}},{key:"maxLength",set:function(t){this._textField.maxLength=t},get:function(){return this._textField.maxLength}},{key:"promptText",set:function(t){this._textField.promptText=t},get:function(){return this._textField.promptText}},{key:"restrict",set:function(t){this._textField.restrict=t},get:function(){return this._textField.restrict}}]),s}(t.GTextField);t.GTextInput=e}(fgui||(fgui={})),function(t){var e=new Array,i=function(i){_inherits(n,i);var s=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=s.call(this))._indent=15,e._rootNode=new t.GTreeNode(!0),e._rootNode._setTree(_assertThisInitialized(e)),e._rootNode.expanded=!0,e}return _createClass(n,[{key:"getSelectedNode",value:function(){return-1!=this.selectedIndex?this.getChildAt(this.selectedIndex)._treeNode:null}},{key:"getSelectedNodes",value:function(t){t||(t=new Array),e.length=0,_get(_getPrototypeOf(n.prototype),"getSelection",this).call(this,e);for(var i=e.length,s=new Array,r=0;r<i;r++){var a=this.getChildAt(e[r])._treeNode;s.push(a)}return s}},{key:"selectNode",value:function(t,e){for(var i=t.parent;i&&i!=this._rootNode;)i.expanded=!0,i=i.parent;t._cell&&this.addSelection(this.getChildIndex(t._cell),e)}},{key:"unselectNode",value:function(t){t._cell&&this.removeSelection(this.getChildIndex(t._cell))}},{key:"expandAll",value:function(t){t||(t=this._rootNode),t.expanded=!0;for(var e=t.numChildren,i=0;i<e;i++){var s=t.getChildAt(i);s.isFolder&&this.expandAll(s)}}},{key:"collapseAll",value:function(t){t||(t=this._rootNode),t!=this._rootNode&&(t.expanded=!1);for(var e=t.numChildren,i=0;i<e;i++){var s=t.getChildAt(i);s.isFolder&&this.collapseAll(s)}}},{key:"createCell",value:function(t){var e=this.getFromPool(t._resURL?t._resURL:this.defaultItem);if(!e)throw new Error("cannot create tree node object.");e._treeNode=t,t._cell=e;var i,s=e.getChild("indent");s&&(s.width=(t.level-1)*this._indent),(i=e.getController("expanded"))&&(i.on("status_changed",this.__expandedStateChanged,this),i.selectedIndex=t.expanded?1:0),(i=e.getController("leaf"))&&(i.selectedIndex=t.isFolder?0:1),t.isFolder&&e.on("touch_begin",this.__cellMouseDown,this),this.treeNodeRender&&this.treeNodeRender(t,e)}},{key:"_afterInserted",value:function(t){t._cell||this.createCell(t);var e=this.getInsertIndexForNode(t);this.addChildAt(t._cell,e),this.treeNodeRender&&this.treeNodeRender(t,t._cell),t.isFolder&&t.expanded&&this.checkChildren(t,e)}},{key:"getInsertIndexForNode",value:function(t){var e=t.getPrevSibling();null==e&&(e=t.parent);for(var i=this.getChildIndex(e._cell)+1,s=t.level,n=this.numChildren,r=i;r<n;r++){if(this.getChildAt(r)._treeNode.level<=s)break;i++}return i}},{key:"_afterRemoved",value:function(t){this.removeNode(t)}},{key:"_afterExpanded",value:function(t){if(t!=this._rootNode){if(this.treeNodeWillExpand&&this.treeNodeWillExpand(t,!0),null!=t._cell){this.treeNodeRender&&this.treeNodeRender(t,t._cell);var e=t._cell.getController("expanded");e&&(e.selectedIndex=1),t._cell.parent&&this.checkChildren(t,this.getChildIndex(t._cell))}}else this.checkChildren(this._rootNode,0)}},{key:"_afterCollapsed",value:function(t){if(t!=this._rootNode){if(this.treeNodeWillExpand&&this.treeNodeWillExpand(t,!1),null!=t._cell){this.treeNodeRender&&this.treeNodeRender(t,t._cell);var e=t._cell.getController("expanded");e&&(e.selectedIndex=0),t._cell.parent&&this.hideFolderNode(t)}}else this.checkChildren(this._rootNode,0)}},{key:"_afterMoved",value:function(t){var e,i=this.getChildIndex(t._cell);e=t.isFolder?this.getFolderEndIndex(i,t.level):i+1;var s,n,r=this.getInsertIndexForNode(t),a=e-i;if(r<i)for(s=0;s<a;s++)n=this.getChildAt(i+s),this.setChildIndex(n,r+s);else for(s=0;s<a;s++)n=this.getChildAt(i),this.setChildIndex(n,r)}},{key:"getFolderEndIndex",value:function(t,e){for(var i=this.numChildren,s=t+1;s<i;s++){if(this.getChildAt(s)._treeNode.level<=e)return s}return i}},{key:"checkChildren",value:function(t,e){for(var i=t.numChildren,s=0;s<i;s++){e++;var n=t.getChildAt(s);null==n._cell&&this.createCell(n),n._cell.parent||this.addChildAt(n._cell,e),n.isFolder&&n.expanded&&(e=this.checkChildren(n,e))}return e}},{key:"hideFolderNode",value:function(t){for(var e=t.numChildren,i=0;i<e;i++){var s=t.getChildAt(i);s._cell&&this.removeChild(s._cell),s.isFolder&&s.expanded&&this.hideFolderNode(s)}}},{key:"removeNode",value:function(t){if(t._cell&&(t._cell.parent&&this.removeChild(t._cell),this.returnToPool(t._cell),t._cell._treeNode=null,t._cell=null),t.isFolder)for(var e=t.numChildren,i=0;i<e;i++){var s=t.getChildAt(i);this.removeNode(s)}}},{key:"__cellMouseDown",value:function(e){var i=t.GObject.cast(e.sender)._treeNode;this._expandedStatusInEvt=i.expanded}},{key:"__expandedStateChanged",value:function(t){var e=t.sender;e.parent._treeNode.expanded=1==e.selectedIndex}},{key:"dispatchItemEvent",value:function(t,e){if(0!=this._clickToExpand){var i=t._treeNode;i&&i.isFolder&&this._expandedStatusInEvt==i.expanded&&(2==this._clickToExpand?2==e.input.clickCount&&(i.expanded=!i.expanded):i.expanded=!i.expanded)}_get(_getPrototypeOf(n.prototype),"dispatchItemEvent",this).call(this,t,e)}},{key:"setup_beforeAdd",value:function(t,e){_get(_getPrototypeOf(n.prototype),"setup_beforeAdd",this).call(this,t,e),t.seek(e,9),this._indent=t.readInt(),this._clickToExpand=t.readByte()}},{key:"readItems",value:function(e){var i,s,n,r,a,o,h,l=0;for(i=e.readShort(),s=0;s<i;s++)if(n=e.readShort(),n+=e.pos,null!=(r=e.readS())||(r=this.defaultItem)){a=e.readBool(),h=e.readByte();var u=new t.GTreeNode(a,r);if(u.expanded=!0,0==s)this._rootNode.addChild(u);else if(h>l)o.addChild(u);else if(h<l){for(var c=h;c<=l;c++)o=o.parent;o.addChild(u)}else o.parent.addChild(u);o=u,l=h,this.setupItem(e,u.cell),e.pos=n}else e.pos=n}},{key:"rootNode",get:function(){return this._rootNode}},{key:"indent",get:function(){return this._indent},set:function(t){this._indent=t}},{key:"clickToExpand",get:function(){return this._clickToExpand},set:function(t){this._clickToExpand=t}}]),n}(t.GList);t.GTree=i}(fgui||(fgui={})),function(t){var e=function(){function t(e,i){_classCallCheck(this,t),this._expanded=!1,this._level=0,this._resURL=i,e&&(this._children=new Array)}return _createClass(t,[{key:"_setLevel",value:function(t){this._level=t}},{key:"addChild",value:function(t){return this.addChildAt(t,this._children.length),t}},{key:"addChildAt",value:function(t,e){if(!t)throw new Error("child is null");var i=this._children.length;if(e>=0&&e<=i){if(t._parent==this)this.setChildIndex(t,e);else t._parent&&t._parent.removeChild(t),e==this._children.length?this._children.push(t):this._children.splice(e,0,t),t._parent=this,t._level=this._level+1,t._setTree(this._tree),(this._tree&&this==this._tree.rootNode||this._cell&&this._cell.parent&&this._expanded)&&this._tree._afterInserted(t);return t}throw new RangeError("Invalid child index")}},{key:"removeChild",value:function(t){var e=this._children.indexOf(t);return-1!=e&&this.removeChildAt(e),t}},{key:"removeChildAt",value:function(t){if(t>=0&&t<this.numChildren){var e=this._children[t];return this._children.splice(t,1),e._parent=null,this._tree&&(e._setTree(null),this._tree._afterRemoved(e)),e}throw"Invalid child index"}},{key:"removeChildren",value:function(t,e){t=t||0,null==e&&(e=-1),(e<0||e>=this.numChildren)&&(e=this.numChildren-1);for(var i=t;i<=e;++i)this.removeChildAt(t)}},{key:"getChildAt",value:function(t){if(t>=0&&t<this.numChildren)return this._children[t];throw"Invalid child index"}},{key:"getChildIndex",value:function(t){return this._children.indexOf(t)}},{key:"getPrevSibling",value:function(){if(null==this._parent)return null;var t=this._parent._children.indexOf(this);return t<=0?null:this._parent._children[t-1]}},{key:"getNextSibling",value:function(){if(null==this._parent)return null;var t=this._parent._children.indexOf(this);return t<0||t>=this._parent._children.length-1?null:this._parent._children[t+1]}},{key:"setChildIndex",value:function(t,e){var i=this._children.indexOf(t);if(-1==i)throw"Not a child of this container";var s=this._children.length;e<0?e=0:e>s&&(e=s),i!=e&&(this._children.splice(i,1),this._children.splice(e,0,t),(this._tree&&this==this._tree.rootNode||this._cell&&this._cell.parent&&this._expanded)&&this._tree._afterMoved(t))}},{key:"swapChildren",value:function(t,e){var i=this._children.indexOf(t),s=this._children.indexOf(e);if(-1==i||-1==s)throw"Not a child of this container";this.swapChildrenAt(i,s)}},{key:"swapChildrenAt",value:function(t,e){var i=this._children[t],s=this._children[e];this.setChildIndex(i,e),this.setChildIndex(s,t)}},{key:"expandToRoot",value:function(){for(var t=this;t;)t.expanded=!0,t=t.parent}},{key:"_setTree",value:function(t){if(this._tree=t,this._tree&&this._tree.treeNodeWillExpand&&this._expanded&&this._tree.treeNodeWillExpand(this,!0),this._children)for(var e=this._children.length,i=0;i<e;i++){var s=this._children[i];s._level=this._level+1,s._setTree(t)}}},{key:"expanded",set:function(t){null!=this._children&&this._expanded!=t&&(this._expanded=t,this._tree&&(this._expanded?this._tree._afterExpanded(this):this._tree._afterCollapsed(this)))},get:function(){return this._expanded}},{key:"isFolder",get:function(){return null!=this._children}},{key:"parent",get:function(){return this._parent}},{key:"text",get:function(){return this._cell?this._cell.text:null},set:function(t){this._cell&&(this._cell.text=t)}},{key:"icon",get:function(){return this._cell?this._cell.icon:null},set:function(t){this._cell&&(this._cell.icon=t)}},{key:"cell",get:function(){return this._cell}},{key:"level",get:function(){return this._level}},{key:"numChildren",get:function(){return this._children.length}},{key:"tree",get:function(){return this._tree}}]),t}();t.GTreeNode=e}(fgui||(fgui={})),function(t){var e=function(){function t(){_classCallCheck(this,t),this.left=0,this.right=0,this.top=0,this.bottom=0}return _createClass(t,[{key:"copy",value:function(t){this.top=t.top,this.bottom=t.bottom,this.left=t.left,this.right=t.right}}]),t}();t.Margin=e}(fgui||(fgui={})),function(t){var e=function(){function e(){_classCallCheck(this,e),this.width=0,this.height=0}return _createClass(e,[{key:"load",value:function(){return this.owner.getItemAsset(this)}},{key:"getBranch",value:function(){if(this.branches&&-1!=this.owner._branchIndex){var t=this.branches[this.owner._branchIndex];if(t)return this.owner.getItemById(t)}return this}},{key:"getHighResolution",value:function(){if(this.highResolution&&t.UIContentScaler.scaleLevel>0){var e=this.highResolution[t.UIContentScaler.scaleLevel-1];if(e)return this.owner.getItemById(e)}return this}},{key:"toString",value:function(){return this.name}}]),e}();t.PackageItem=e}(fgui||(fgui={})),function(t){var e=function(){function e(i){if(_classCallCheck(this,e),!i&&!(i=t.UIConfig.popupMenu))throw"UIConfig.popupMenu not defined";this._contentPane=t.UIPackage.createObjectFromURL(i),this._contentPane.on("added_to_stage",this.__addedToStage,this),this._list=this._contentPane.getChild("list"),this._list.removeChildrenToPool(),this._list.addRelation(this._contentPane,t.RelationType.Width),this._list.removeRelation(this._contentPane,t.RelationType.Height),this._contentPane.addRelation(this._list,t.RelationType.Height),this._list.on("click_item",this.__clickItem,this)}return _createClass(e,[{key:"dispose",value:function(){this._contentPane.dispose()}},{key:"addItem",value:function(t,e){var i=this._list.addItemFromPool();i.title=t,i.data=e,i.grayed=!1;var s=i.getController("checked");return s&&(s.selectedIndex=0),i}},{key:"addItemAt",value:function(t,e,i){var s=this._list.getFromPool();this._list.addChildAt(s,e),s.title=t,s.data=i,s.grayed=!1;var n=s.getController("checked");return n&&(n.selectedIndex=0),s}},{key:"addSeperator",value:function(){if(null==t.UIConfig.popupMenu_seperator)throw"UIConfig.popupMenu_seperator not defined";this.list.addItemFromPool(t.UIConfig.popupMenu_seperator)}},{key:"getItemName",value:function(t){return this._list.getChildAt(t).name}},{key:"setItemText",value:function(t,e){this._list.getChild(t).title=e}},{key:"setItemVisible",value:function(t,e){var i=this._list.getChild(t);i.visible!=e&&(i.visible=e,this._list.setBoundsChangedFlag())}},{key:"setItemGrayed",value:function(t,e){this._list.getChild(t).grayed=e}},{key:"setItemCheckable",value:function(t,e){var i=this._list.getChild(t).getController("checked");i&&(e?0==i.selectedIndex&&(i.selectedIndex=1):i.selectedIndex=0)}},{key:"setItemChecked",value:function(t,e){var i=this._list.getChild(t).getController("checked");i&&(i.selectedIndex=e?2:1)}},{key:"isItemChecked",value:function(t){var e=this._list.getChild(t).getController("checked");return!!e&&2==e.selectedIndex}},{key:"removeItem",value:function(t){var e=this._list.getChild(t);if(e){var i=this._list.getChildIndex(e);return this._list.removeChildToPoolAt(i),!0}return!1}},{key:"clearItems",value:function(){this._list.removeChildrenToPool()}},{key:"show",value:function(e,i){t.GRoot.findFor(e).showPopup(this.contentPane,e instanceof t.GRoot?null:e,i)}},{key:"__clickItem",value:function(e){var i=e.data;if(i instanceof t.GButton)if(i.grayed)this._list.selectedIndex=-1;else{var s=i.getController("checked");s&&0!=s.selectedIndex&&(1==s.selectedIndex?s.selectedIndex=2:s.selectedIndex=1),this._contentPane.parent.hidePopup(this.contentPane),i.data&&i.data()}}},{key:"__addedToStage",value:function(){this._list.selectedIndex=-1,this._list.resizeToFit(1e5,10)}},{key:"itemCount",get:function(){return this._list.numChildren}},{key:"contentPane",get:function(){return this._contentPane}},{key:"list",get:function(){return this._list}}]),e}();t.PopupMenu=e}(fgui||(fgui={})),function(t){var e=function(){function e(t){_classCallCheck(this,e),this._owner=t,this._defs=new Array}return _createClass(e,[{key:"add",value:function(e,i){if(e==t.RelationType.Size)return this.add(t.RelationType.Width,i),void this.add(t.RelationType.Height,i);for(var s=this._defs.length,n=0;n<s;n++)if(this._defs[n].type==e)return;this.internalAdd(e,i)}},{key:"internalAdd",value:function(e,s){if(e==t.RelationType.Size)return this.internalAdd(t.RelationType.Width,s),void this.internalAdd(t.RelationType.Height,s);var n=new i;n.percent=s,n.type=e,n.axis=e<=t.RelationType.Right_Right||e==t.RelationType.Width||e>=t.RelationType.LeftExt_Left&&e<=t.RelationType.RightExt_Right?0:1,this._defs.push(n)}},{key:"remove",value:function(e){if(e==t.RelationType.Size)return this.remove(t.RelationType.Width),void this.remove(t.RelationType.Height);for(var i=this._defs.length,s=0;s<i;s++)if(this._defs[s].type==e){this._defs.splice(s,1);break}}},{key:"copy",value:function(t){this._target=t.target,this._defs.length=0;for(var e=t._defs.length,s=0;s<e;s++){var n=t._defs[s],r=new i;r.copy(n),this._defs.push(r)}}},{key:"dispose",value:function(){this._target&&(this.releaseRefTarget(),this._target=null)}},{key:"applyOnSelfResized",value:function(e,i,s){var n=this._defs.length;if(0!=n){for(var r=this._owner.x,a=this._owner.y,o=0;o<n;o++){switch(this._defs[o].type){case t.RelationType.Center_Center:this._owner.x-=(.5-(s?this._owner.pivotX:0))*e;break;case t.RelationType.Right_Center:case t.RelationType.Right_Left:case t.RelationType.Right_Right:this._owner.x-=(1-(s?this._owner.pivotX:0))*e;break;case t.RelationType.Middle_Middle:this._owner.y-=(.5-(s?this._owner.pivotY:0))*i;break;case t.RelationType.Bottom_Middle:case t.RelationType.Bottom_Top:case t.RelationType.Bottom_Bottom:this._owner.y-=(1-(s?this._owner.pivotY:0))*i}}if((r!=this._owner.x||a!=this._owner.y)&&(r=this._owner.x-r,a=this._owner.y-a,this._owner.updateGearFromRelations(1,r,a),this._owner.parent&&this._owner.parent._transitions.length>0)){n=this._owner.parent._transitions.length;for(var h=0;h<n;h++){this._owner.parent._transitions[h].updateFromRelations(this._owner.id,r,a)}}}}},{key:"applyOnXYChanged",value:function(e,i,s){var n;switch(e.type){case t.RelationType.Left_Left:case t.RelationType.Left_Center:case t.RelationType.Left_Right:case t.RelationType.Center_Center:case t.RelationType.Right_Left:case t.RelationType.Right_Center:case t.RelationType.Right_Right:this._owner.x+=i;break;case t.RelationType.Top_Top:case t.RelationType.Top_Middle:case t.RelationType.Top_Bottom:case t.RelationType.Middle_Middle:case t.RelationType.Bottom_Top:case t.RelationType.Bottom_Middle:case t.RelationType.Bottom_Bottom:this._owner.y+=s;break;case t.RelationType.Width:case t.RelationType.Height:break;case t.RelationType.LeftExt_Left:case t.RelationType.LeftExt_Right:this._owner!=this._target.parent?(n=this._owner.xMin,this._owner.width=this._owner._rawWidth-i,this._owner.xMin=n+i):this._owner.width=this._owner._rawWidth-i;break;case t.RelationType.RightExt_Left:case t.RelationType.RightExt_Right:this._owner!=this._target.parent?(n=this._owner.xMin,this._owner.width=this._owner._rawWidth+i,this._owner.xMin=n):this._owner.width=this._owner._rawWidth+i;break;case t.RelationType.TopExt_Top:case t.RelationType.TopExt_Bottom:this._owner!=this._target.parent?(n=this._owner.yMin,this._owner.height=this._owner._rawHeight-s,this._owner.yMin=n+s):this._owner.height=this._owner._rawHeight-s;break;case t.RelationType.BottomExt_Top:case t.RelationType.BottomExt_Bottom:this._owner!=this._target.parent?(n=this._owner.yMin,this._owner.height=this._owner._rawHeight+s,this._owner.yMin=n):this._owner.height=this._owner._rawHeight+s}}},{key:"applyOnSizeChanged",value:function(e){var i,s,n=0,r=0,a=0;switch(0==e.axis?(this._target!=this._owner.parent&&(n=this._target.x,this._target.pivotAsAnchor&&(r=this._target.pivotX)),e.percent?0!=this._targetWidth&&(a=this._target._width/this._targetWidth):a=this._target._width-this._targetWidth):(this._target!=this._owner.parent&&(n=this._target.y,this._target.pivotAsAnchor&&(r=this._target.pivotY)),e.percent?0!=this._targetHeight&&(a=this._target._height/this._targetHeight):a=this._target._height-this._targetHeight),e.type){case t.RelationType.Left_Left:e.percent?this._owner.xMin=n+(this._owner.xMin-n)*a:0!=r&&(this._owner.x+=a*-r);break;case t.RelationType.Left_Center:e.percent?this._owner.xMin=n+(this._owner.xMin-n)*a:this._owner.x+=a*(.5-r);break;case t.RelationType.Left_Right:e.percent?this._owner.xMin=n+(this._owner.xMin-n)*a:this._owner.x+=a*(1-r);break;case t.RelationType.Center_Center:e.percent?this._owner.xMin=n+(this._owner.xMin+.5*this._owner._rawWidth-n)*a-.5*this._owner._rawWidth:this._owner.x+=a*(.5-r);break;case t.RelationType.Right_Left:e.percent?this._owner.xMin=n+(this._owner.xMin+this._owner._rawWidth-n)*a-this._owner._rawWidth:0!=r&&(this._owner.x+=a*-r);break;case t.RelationType.Right_Center:e.percent?this._owner.xMin=n+(this._owner.xMin+this._owner._rawWidth-n)*a-this._owner._rawWidth:this._owner.x+=a*(.5-r);break;case t.RelationType.Right_Right:e.percent?this._owner.xMin=n+(this._owner.xMin+this._owner._rawWidth-n)*a-this._owner._rawWidth:this._owner.x+=a*(1-r);break;case t.RelationType.Top_Top:e.percent?this._owner.yMin=n+(this._owner.yMin-n)*a:0!=r&&(this._owner.y+=a*-r);break;case t.RelationType.Top_Middle:e.percent?this._owner.yMin=n+(this._owner.yMin-n)*a:this._owner.y+=a*(.5-r);break;case t.RelationType.Top_Bottom:e.percent?this._owner.yMin=n+(this._owner.yMin-n)*a:this._owner.y+=a*(1-r);break;case t.RelationType.Middle_Middle:e.percent?this._owner.yMin=n+(this._owner.yMin+.5*this._owner._rawHeight-n)*a-.5*this._owner._rawHeight:this._owner.y+=a*(.5-r);break;case t.RelationType.Bottom_Top:e.percent?this._owner.yMin=n+(this._owner.yMin+this._owner._rawHeight-n)*a-this._owner._rawHeight:0!=r&&(this._owner.y+=a*-r);break;case t.RelationType.Bottom_Middle:e.percent?this._owner.yMin=n+(this._owner.yMin+this._owner._rawHeight-n)*a-this._owner._rawHeight:this._owner.y+=a*(.5-r);break;case t.RelationType.Bottom_Bottom:e.percent?this._owner.yMin=n+(this._owner.yMin+this._owner._rawHeight-n)*a-this._owner._rawHeight:this._owner.y+=a*(1-r);break;case t.RelationType.Width:i=this._owner._underConstruct&&this._owner==this._target.parent?this._owner.sourceWidth-this._target.initWidth:this._owner._rawWidth-this._targetWidth,e.percent&&(i*=a),this._target==this._owner.parent?this._owner.pivotAsAnchor?(s=this._owner.xMin,this._owner.setSize(this._target._width+i,this._owner._rawHeight,!0),this._owner.xMin=s):this._owner.setSize(this._target._width+i,this._owner._rawHeight,!0):this._owner.width=this._target._width+i;break;case t.RelationType.Height:i=this._owner._underConstruct&&this._owner==this._target.parent?this._owner.sourceHeight-this._target.initHeight:this._owner._rawHeight-this._targetHeight,e.percent&&(i*=a),this._target==this._owner.parent?this._owner.pivotAsAnchor?(s=this._owner.yMin,this._owner.setSize(this._owner._rawWidth,this._target._height+i,!0),this._owner.yMin=s):this._owner.setSize(this._owner._rawWidth,this._target._height+i,!0):this._owner.height=this._target._height+i;break;case t.RelationType.LeftExt_Left:s=this._owner.xMin,i=e.percent?n+(s-n)*a-s:a*-r,this._owner.width=this._owner._rawWidth-i,this._owner.xMin=s+i;break;case t.RelationType.LeftExt_Right:s=this._owner.xMin,i=e.percent?n+(s-n)*a-s:a*(1-r),this._owner.width=this._owner._rawWidth-i,this._owner.xMin=s+i;break;case t.RelationType.RightExt_Left:s=this._owner.xMin,i=e.percent?n+(s+this._owner._rawWidth-n)*a-(s+this._owner._rawWidth):a*-r,this._owner.width=this._owner._rawWidth+i,this._owner.xMin=s;break;case t.RelationType.RightExt_Right:s=this._owner.xMin,e.percent?this._owner==this._target.parent?this._owner._underConstruct?this._owner.width=n+this._target._width-this._target._width*r+(this._owner.sourceWidth-n-this._target.initWidth+this._target.initWidth*r)*a:this._owner.width=n+(this._owner._rawWidth-n)*a:(i=n+(s+this._owner._rawWidth-n)*a-(s+this._owner._rawWidth),this._owner.width=this._owner._rawWidth+i,this._owner.xMin=s):this._owner==this._target.parent?this._owner._underConstruct?this._owner.width=this._owner.sourceWidth+(this._target._width-this._target.initWidth)*(1-r):this._owner.width=this._owner._rawWidth+a*(1-r):(i=a*(1-r),this._owner.width=this._owner._rawWidth+i,this._owner.xMin=s);break;case t.RelationType.TopExt_Top:s=this._owner.yMin,i=e.percent?n+(s-n)*a-s:a*-r,this._owner.height=this._owner._rawHeight-i,this._owner.yMin=s+i;break;case t.RelationType.TopExt_Bottom:s=this._owner.yMin,i=e.percent?n+(s-n)*a-s:a*(1-r),this._owner.height=this._owner._rawHeight-i,this._owner.yMin=s+i;break;case t.RelationType.BottomExt_Top:s=this._owner.yMin,i=e.percent?n+(s+this._owner._rawHeight-n)*a-(s+this._owner._rawHeight):a*-r,this._owner.height=this._owner._rawHeight+i,this._owner.yMin=s;break;case t.RelationType.BottomExt_Bottom:s=this._owner.yMin,e.percent?this._owner==this._target.parent?this._owner._underConstruct?this._owner.height=n+this._target._height-this._target._height*r+(this._owner.sourceHeight-n-this._target.initHeight+this._target.initHeight*r)*a:this._owner.height=n+(this._owner._rawHeight-n)*a:(i=n+(s+this._owner._rawHeight-n)*a-(s+this._owner._rawHeight),this._owner.height=this._owner._rawHeight+i,this._owner.yMin=s):this._owner==this._target.parent?this._owner._underConstruct?this._owner.height=this._owner.sourceHeight+(this._target._height-this._target.initHeight)*(1-r):this._owner.height=this._owner._rawHeight+a*(1-r):(i=a*(1-r),this._owner.height=this._owner._rawHeight+i,this._owner.yMin=s)}}},{key:"addRefTarget",value:function(){this._target!=this._owner.parent&&this._target.on("pos_changed",this.__targetXYChanged,this),this._target.on("size_changed",this.__targetSizeChanged,this),this._targetX=this._target.x,this._targetY=this._target.y,this._targetWidth=this._target._width,this._targetHeight=this._target._height}},{key:"releaseRefTarget",value:function(){null!=this._target.displayObject&&(this._target.off("pos_changed",this.__targetXYChanged,this),this._target.off("size_changed",this.__targetSizeChanged,this))}},{key:"__targetXYChanged",value:function(){if(this._owner.relations.handling||this._owner.group&&this._owner.group._updating)return this._targetX=this._target.x,void(this._targetY=this._target.y);this._owner.relations.handling=this._target;for(var t=this._owner.x,e=this._owner.y,i=this._target.x-this._targetX,s=this._target.y-this._targetY,n=this._defs.length,r=0;r<n;r++)this.applyOnXYChanged(this._defs[r],i,s);if(this._targetX=this._target.x,this._targetY=this._target.y,(t!=this._owner.x||e!=this._owner.y)&&(t=this._owner.x-t,e=this._owner.y-e,this._owner.updateGearFromRelations(1,t,e),this._owner.parent&&this._owner.parent._transitions.length>0)){n=this._owner.parent._transitions.length;for(var a=0;a<n;a++){this._owner.parent._transitions[a].updateFromRelations(this._owner.id,t,e)}}this._owner.relations.handling=null}},{key:"__targetSizeChanged",value:function(){if(this._owner.relations.handling)return this._targetWidth=this._target._width,void(this._targetHeight=this._target._height);this._owner.relations.handling=this._target;for(var t=this._owner.x,e=this._owner.y,i=this._owner._rawWidth,s=this._owner._rawHeight,n=this._defs.length,r=0;r<n;r++)this.applyOnSizeChanged(this._defs[r]);if(this._targetWidth=this._target._width,this._targetHeight=this._target._height,(t!=this._owner.x||e!=this._owner.y)&&(t=this._owner.x-t,e=this._owner.y-e,this._owner.updateGearFromRelations(1,t,e),this._owner.parent&&this._owner.parent._transitions.length>0)){n=this._owner.parent._transitions.length;for(var a=0;a<n;a++){this._owner.parent._transitions[a].updateFromRelations(this._owner.id,t,e)}}i==this._owner._rawWidth&&s==this._owner._rawHeight||(i=this._owner._rawWidth-i,s=this._owner._rawHeight-s,this._owner.updateGearFromRelations(2,i,s)),this._owner.relations.handling=null}},{key:"owner",get:function(){return this._owner}},{key:"target",set:function(t){this._target!=t&&(this._target&&this.releaseRefTarget(),this._target=t,this._target&&this.addRefTarget())},get:function(){return this._target}},{key:"isEmpty",get:function(){return 0==this._defs.length}}]),e}();t.RelationItem=e;var i=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"copy",value:function(t){this.percent=t.percent,this.type=t.type,this.axis=t.axis}}]),t}()}(fgui||(fgui={})),function(t){var e=function(){function e(t){_classCallCheck(this,e),this._owner=t,this._items=[]}return _createClass(e,[{key:"add",value:function(e,i,s){for(var n=this._items.length,r=0;r<n;r++){var a=this._items[r];if(a.target==e)return void a.add(i,s)}var o=new t.RelationItem(this._owner);o.target=e,o.add(i,s),this._items.push(o)}},{key:"remove",value:function(t,e){e=e||0;for(var i=this._items.length,s=0;s<i;){var n=this._items[s];n.target==t?(n.remove(e),n.isEmpty?(n.dispose(),this._items.splice(s,1),i--):s++):s++}}},{key:"contains",value:function(t){for(var e=this._items.length,i=0;i<e;i++){if(this._items[i].target==t)return!0}return!1}},{key:"clearFor",value:function(t){for(var e=this._items.length,i=0;i<e;){var s=this._items[i];s.target==t?(s.dispose(),this._items.splice(i,1),e--):i++}}},{key:"clearAll",value:function(){for(var t=this._items.length,e=0;e<t;e++){this._items[e].dispose()}this._items.length=0}},{key:"copyFrom",value:function(e){this.clearAll();for(var i=e._items,s=i.length,n=0;n<s;n++){var r=i[n],a=new t.RelationItem(this._owner);a.copy(r),this._items.push(a)}}},{key:"dispose",value:function(){this.clearAll()}},{key:"onOwnerSizeChanged",value:function(t,e,i){if(0!=this._items.length)for(var s=this._items.length,n=0;n<s;n++){this._items[n].applyOnSelfResized(t,e,i)}}},{key:"setup",value:function(e,i){for(var s,n=e.readByte(),r=0;r<n;r++){var a=e.readShort();s=-1==a?this._owner.parent:i?this._owner.getChildAt(a):this._owner.parent.getChildAt(a);var o=new t.RelationItem(this._owner);o.target=s,this._items.push(o);for(var h=e.readByte(),l=0;l<h;l++){var u=e.readByte(),c=e.readBool();o.internalAdd(u,c)}}}},{key:"empty",get:function(){return 0==this._items.length}}]),e}();t.Relations=e}(fgui||(fgui={})),function(t){var e=new THREE.Vector2,i=new t.Rect,s=new THREE.Vector2,n=new THREE.Vector2,r=0,a=function(){function a(e){_classCallCheck(this,a),this._owner=e,this._maskContainer=new t.DisplayObject,this._owner.displayObject.addChild(this._maskContainer),this._container=this._owner._container,this._container.setPosition(0,0),this._maskContainer.addChild(this._container),this._mouseWheelEnabled=!0,this._xPos=0,this._yPos=0,this._aniFlag=0,this._tweening=0,this._loop=0,this._footerLockedSize=0,this._headerLockedSize=0,this._scrollBarMargin=new t.Margin,this._viewSize=new THREE.Vector2,this._contentSize=new THREE.Vector2,this._pageSize=new THREE.Vector2(1,1),this._overlapSize=new THREE.Vector2,this._tweenTime=new THREE.Vector2,this._tweenStart=new THREE.Vector2,this._tweenDuration=new THREE.Vector2,this._tweenChange=new THREE.Vector2,this._velocity=new THREE.Vector2,this._containerPos=new THREE.Vector2,this._beginTouchPos=new THREE.Vector2,this._lastTouchPos=new THREE.Vector2,this._lastTouchGlobalPos=new THREE.Vector2,this._scrollStep=t.UIConfig.defaultScrollStep,this._decelerationRate=t.UIConfig.defaultScrollDecelerationRate,this._owner.on("touch_begin",this.__touchBegin,this),this._owner.on("touch_move",this.__touchMove,this),this._owner.on("touch_end",this.__touchEnd,this),this._owner.on("mouse_wheel",this.__mouseWheel,this)}return _createClass(a,[{key:"setup",value:function(e){this._scrollType=e.readByte();var i=e.readByte(),s=e.readInt();e.readBool()&&(this._scrollBarMargin.top=e.readInt(),this._scrollBarMargin.bottom=e.readInt(),this._scrollBarMargin.left=e.readInt(),this._scrollBarMargin.right=e.readInt());var n=e.readS(),r=e.readS(),a=e.readS(),o=e.readS();if(this._displayOnLeft=0!=(1&s),this._snapToItem=0!=(2&s),this._displayInDemand=0!=(4&s),this._pageMode=0!=(8&s),this._touchEffect=!!(16&s)||!(32&s)&&t.UIConfig.defaultScrollTouchEffect,this._bouncebackEffect=!!(64&s)||!(128&s)&&t.UIConfig.defaultScrollBounceEffect,this._inertiaDisabled=0!=(256&s),0==(512&s)&&(this._maskContainer.clipRect=new t.Rect),this._floating=0!=(1024&s),i==t.ScrollBarDisplayType.Default&&(i=t.UIConfig.defaultScrollBarDisplay),i!=t.ScrollBarDisplayType.Hidden){if(this._scrollType==t.ScrollType.Both||this._scrollType==t.ScrollType.Vertical){var h=n||t.UIConfig.verticalScrollBar;if(h){if(this._vtScrollBar=t.UIPackage.createObjectFromURL(h),!this._vtScrollBar)throw"cannot create scrollbar} from "+h;this._vtScrollBar.setScrollPane(this,!0),this._owner.displayObject.addChild(this._vtScrollBar.displayObject)}}if((this._scrollType==t.ScrollType.Both||this._scrollType==t.ScrollType.Horizontal)&&(h=r||t.UIConfig.horizontalScrollBar)){if(this._hzScrollBar=t.UIPackage.createObjectFromURL(h),!this._hzScrollBar)throw"cannot create scrollbar} from "+h;this._hzScrollBar.setScrollPane(this,!1),this._owner.displayObject.addChild(this._hzScrollBar.displayObject)}this._scrollBarDisplayAuto=i==t.ScrollBarDisplayType.Auto,this._scrollBarDisplayAuto&&(this._vtScrollBar&&(this._vtScrollBar.displayObject.visible=!1),this._hzScrollBar&&(this._hzScrollBar.displayObject.visible=!1))}else this._mouseWheelEnabled=!1;if(a&&(this._header=t.UIPackage.createObjectFromURL(a),!this._header))throw new Error("cannot create scrollPane header from "+a);if(o&&(this._footer=t.UIPackage.createObjectFromURL(o),!this._footer))throw new Error("cannot create scrollPane footer from "+o);(this._header||this._footer)&&(this._refreshBarAxis=this._scrollType==t.ScrollType.Both||this._scrollType==t.ScrollType.Vertical?"y":"x"),this.setSize(this.owner.width,this.owner.height)}},{key:"dispose",value:function(){0!=this._tweening&&t.Timers.remove(this.tweenUpdate,this),this._pageController=null,this._hzScrollBar&&this._hzScrollBar.dispose(),this._vtScrollBar&&this._vtScrollBar.dispose(),this._header&&this._header.dispose(),this._footer&&this._footer.dispose()}},{key:"setPercX",value:function(e,i){this._owner.ensureBoundsCorrect(),this.setPosX(this._overlapSize.x*t.clamp01(e),i)}},{key:"setPercY",value:function(e,i){this._owner.ensureBoundsCorrect(),this.setPosY(this._overlapSize.y*t.clamp01(e),i)}},{key:"setPosX",value:function(e,i){this._owner.ensureBoundsCorrect(),1==this._loop&&(e=this.loopCheckingNewPos(e,"x")),(e=t.clamp(e,0,this._overlapSize.x))!=this._xPos&&(this._xPos=e,this.posChanged(i))}},{key:"setPosY",value:function(e,i){this._owner.ensureBoundsCorrect(),1==this._loop&&(e=this.loopCheckingNewPos(e,"y")),(e=t.clamp(e,0,this._overlapSize.y))!=this._yPos&&(this._yPos=e,this.posChanged(i))}},{key:"setCurrentPageX",value:function(t,e){this._pageMode&&(this._owner.ensureBoundsCorrect(),this._overlapSize.x>0&&this.setPosX(t*this._pageSize.x,e))}},{key:"setCurrentPageY",value:function(t,e){this._pageMode&&(this._owner.ensureBoundsCorrect(),this._overlapSize.y>0&&this.setPosY(t*this._pageSize.y,e))}},{key:"scrollTop",value:function(t){this.setPercY(0,t)}},{key:"scrollBottom",value:function(t){this.setPercY(1,t)}},{key:"scrollUp",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1?arguments[1]:void 0;this._pageMode?this.setPosY(this._yPos-this._pageSize.y*t,e):this.setPosY(this._yPos-this._scrollStep*t,e)}},{key:"scrollDown",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1?arguments[1]:void 0;this._pageMode?this.setPosY(this._yPos+this._pageSize.y*t,e):this.setPosY(this._yPos+this._scrollStep*t,e)}},{key:"scrollLeft",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1?arguments[1]:void 0;this._pageMode?this.setPosX(this._xPos-this._pageSize.x*t,e):this.setPosX(this._xPos-this._scrollStep*t,e)}},{key:"scrollRight",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1?arguments[1]:void 0;this._pageMode?this.setPosX(this._xPos+this._pageSize.x*t,e):this.setPosX(this._xPos+this._scrollStep*t,e)}},{key:"scrollToView",value:function(e,s,n){var r;if(this._owner.ensureBoundsCorrect(),this._needRefresh&&this.refresh(),e instanceof t.GObject?e.parent!=this._owner?(e.parent.localToGlobalRect(e.x,e.y,e.width,e.height,i),r=this._owner.globalToLocalRect(i.x,i.y,i.width,i.height,i)):(r=i).set(e.x,e.y,e.width,e.height):r=e,this._overlapSize.y>0){var a=this._yPos+this._viewSize.y;n||r.y<=this._yPos||r.height>=this._viewSize.y?this._pageMode?this.setPosY(Math.floor(r.y/this._pageSize.y)*this._pageSize.y,s):this.setPosY(r.y,s):r.y+r.height>a&&(this._pageMode?this.setPosY(Math.floor(r.y/this._pageSize.y)*this._pageSize.y,s):r.height<=this._viewSize.y/2?this.setPosY(r.y+2*r.height-this._viewSize.y,s):this.setPosY(r.y+r.height-this._viewSize.y,s))}if(this._overlapSize.x>0){var o=this._xPos+this._viewSize.x;n||r.x<=this._xPos||r.width>=this._viewSize.x?this._pageMode?this.setPosX(Math.floor(r.x/this._pageSize.x)*this._pageSize.x,s):this.setPosX(r.x,s):r.x+r.width>o&&(this._pageMode?this.setPosX(Math.floor(r.x/this._pageSize.x)*this._pageSize.x,s):r.width<=this._viewSize.x/2?this.setPosX(r.x+2*r.width-this._viewSize.x,s):this.setPosX(r.x+r.width-this._viewSize.x,s))}!s&&this._needRefresh&&this.refresh()}},{key:"isChildInView",value:function(t){if(this._overlapSize.y>0){var e=t.y+this._container.y;if(e<-t.height||e>this._viewSize.y)return!1}return!(this._overlapSize.x>0&&((e=t.x+this._container.x)<-t.width||e>this._viewSize.x))}},{key:"cancelDragging",value:function(){t.Stage.removeTouchMonitor(this._owner.displayObject),a.draggingPane==this&&(a.draggingPane=null),r=0,this._dragged=!1}},{key:"lockHeader",value:function(t){this._headerLockedSize!=t&&(this._headerLockedSize=t,!this._refreshEventDispatching&&this._container[this._refreshBarAxis]>=0&&(this._tweenStart.set(this._container.x,this._container.y),this._tweenChange.set(0,0),this._tweenChange[this._refreshBarAxis]=this._headerLockedSize-this._tweenStart[this._refreshBarAxis],this._tweenDuration.set(.3,.3),this.startTween(2)))}},{key:"lockFooter",value:function(t){if(this._footerLockedSize!=t&&(this._footerLockedSize=t,!this._refreshEventDispatching&&this._container[this._refreshBarAxis]<=-this._overlapSize[this._refreshBarAxis])){this._tweenStart.set(this._container.x,this._container.y),this._tweenChange.set(0,0);var e=this._overlapSize[this._refreshBarAxis];0==e?e=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):e+=this._footerLockedSize,this._tweenChange[this._refreshBarAxis]=-e-this._tweenStart[this._refreshBarAxis],this._tweenDuration.set(.3,.3),this.startTween(2)}}},{key:"onOwnerSizeChanged",value:function(){this.setSize(this._owner.width,this._owner.height),this.posChanged(!1)}},{key:"handleControllerChanged",value:function(e){this._pageController==e&&(this._scrollType==t.ScrollType.Horizontal?this.setCurrentPageX(e.selectedIndex,!0):this.setCurrentPageY(e.selectedIndex,!0))}},{key:"updatePageController",value:function(){var e;if(this._pageController&&!this._pageController.changing&&(e=this._scrollType==t.ScrollType.Horizontal?this.currentPageX:this.currentPageY)<this._pageController.pageCount){var i=this._pageController;this._pageController=null,i.selectedIndex=e,this._pageController=i}}},{key:"adjustMaskContainer",value:function(){var e,i;e=this._displayOnLeft&&this._vtScrollBar&&!this._floating?Math.floor(this._owner.margin.left+this._vtScrollBar.width):Math.floor(this._owner.margin.left),i=Math.floor(this._owner.margin.top),this._maskContainer.setPosition(e,i),0!=this._owner._alignOffset.x||0!=this._owner._alignOffset.y?(null==this._alignContainer&&(this._alignContainer=new t.DisplayObject,this._maskContainer.addChild(this._alignContainer),this._alignContainer.addChild(this._container)),this._alignContainer.setPosition(this._owner._alignOffset.x,this._owner._alignOffset.y)):this._alignContainer&&this._alignContainer.setPosition(0,0)}},{key:"setSize",value:function(t,e){this.adjustMaskContainer(),this._hzScrollBar&&(this._hzScrollBar.y=e-this._hzScrollBar.height,this._vtScrollBar?(this._hzScrollBar.width=t-this._vtScrollBar.width-this._scrollBarMargin.left-this._scrollBarMargin.right,this._displayOnLeft?this._hzScrollBar.x=this._scrollBarMargin.left+this._vtScrollBar.width:this._hzScrollBar.x=this._scrollBarMargin.left):(this._hzScrollBar.width=t-this._scrollBarMargin.left-this._scrollBarMargin.right,this._hzScrollBar.x=this._scrollBarMargin.left)),this._vtScrollBar&&(this._displayOnLeft||(this._vtScrollBar.x=t-this._vtScrollBar.width),this._hzScrollBar?this._vtScrollBar.height=e-this._hzScrollBar.height-this._scrollBarMargin.top-this._scrollBarMargin.bottom:this._vtScrollBar.height=e-this._scrollBarMargin.top-this._scrollBarMargin.bottom,this._vtScrollBar.y=this._scrollBarMargin.top),this._viewSize.x=t,this._viewSize.y=e,this._hzScrollBar&&!this._floating&&(this._viewSize.y-=this._hzScrollBar.height),this._vtScrollBar&&!this._floating&&(this._viewSize.x-=this._vtScrollBar.width),this._viewSize.x-=this._owner.margin.left+this._owner.margin.right,this._viewSize.y-=this._owner.margin.top+this._owner.margin.bottom,this._viewSize.x=Math.max(1,this._viewSize.x),this._viewSize.y=Math.max(1,this._viewSize.y),this._pageSize.x=this._viewSize.x,this._pageSize.y=this._viewSize.y,this.handleSizeChanged()}},{key:"setContentSize",value:function(t,e){this._contentSize.x==t&&this._contentSize.y==e||(this._contentSize.x=t,this._contentSize.y=e,this.handleSizeChanged())}},{key:"changeContentSizeOnScrolling",value:function(t,e,i,s){var n=this._xPos==this._overlapSize.x,r=this._yPos==this._overlapSize.y;this._contentSize.x+=t,this._contentSize.y+=e,this.handleSizeChanged(),1==this._tweening?(0!=t&&n&&this._tweenChange.x<0&&(this._xPos=this._overlapSize.x,this._tweenChange.x=-this._xPos-this._tweenStart.x),0!=e&&r&&this._tweenChange.y<0&&(this._yPos=this._overlapSize.y,this._tweenChange.y=-this._yPos-this._tweenStart.y)):2==this._tweening?(0!=i&&(this._container.x-=i,this._tweenStart.x-=i,this._xPos=-this._container.x),0!=s&&(this._container.y-=s,this._tweenStart.y-=s,this._yPos=-this._container.y)):this._dragged?(0!=i&&(this._container.x-=i,this._containerPos.x-=i,this._xPos=-this._container.x),0!=s&&(this._container.y-=s,this._containerPos.y-=s,this._yPos=-this._container.y)):(0!=t&&n&&(this._xPos=this._overlapSize.x,this._container.x=-this._xPos),0!=e&&r&&(this._yPos=this._overlapSize.y,this._container.y=-this._yPos)),this._pageMode&&this.updatePageController()}},{key:"handleSizeChanged",value:function(){this._displayInDemand&&(this._vScrollNone=this._contentSize.y<=this._viewSize.y,this._hScrollNone=this._contentSize.x<=this._viewSize.x),this._vtScrollBar&&(0==this._contentSize.y?this._vtScrollBar.setDisplayPerc(0):this._vtScrollBar.setDisplayPerc(Math.min(1,this._viewSize.y/this._contentSize.y))),this._hzScrollBar&&(0==this._contentSize.x?this._hzScrollBar.setDisplayPerc(0):this._hzScrollBar.setDisplayPerc(Math.min(1,this._viewSize.x/this._contentSize.x))),this.updateScrollBarVisible();var e=this._maskContainer.clipRect;if(e&&(e.width=this._viewSize.x,e.height=this._viewSize.y,this._vScrollNone&&this._vtScrollBar&&(e.width+=this._vtScrollBar.width),this._hScrollNone&&this._hzScrollBar&&(e.height+=this._hzScrollBar.height),this._maskContainer.clipRect=e),this._scrollType==t.ScrollType.Horizontal||this._scrollType==t.ScrollType.Both?this._overlapSize.x=Math.ceil(Math.max(0,this._contentSize.x-this._viewSize.x)):this._overlapSize.x=0,this._scrollType==t.ScrollType.Vertical||this._scrollType==t.ScrollType.Both?this._overlapSize.y=Math.ceil(Math.max(0,this._contentSize.y-this._viewSize.y)):this._overlapSize.y=0,this._xPos=t.clamp(this._xPos,0,this._overlapSize.x),this._yPos=t.clamp(this._yPos,0,this._overlapSize.y),this._refreshBarAxis){var i=this._overlapSize[this._refreshBarAxis];0==i?i=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):i+=this._footerLockedSize,"x"==this._refreshBarAxis?this._container.setPosition(t.clamp(this._container.x,-i,this._headerLockedSize),t.clamp(this._container.y,-this._overlapSize.y,0)):this._container.setPosition(t.clamp(this._container.x,-this._overlapSize.x,0),t.clamp(this._container.y,-i,this._headerLockedSize)),this._header&&("x"==this._refreshBarAxis?this._header.height=this._viewSize.y:this._header.width=this._viewSize.x),this._footer&&("y"==this._refreshBarAxis?this._footer.height=this._viewSize.y:this._footer.width=this._viewSize.x)}else this._container.setPosition(t.clamp(this._container.x,-this._overlapSize.x,0),t.clamp(this._container.y,-this._overlapSize.y,0));this.updateScrollBarPos(),this._pageMode&&this.updatePageController()}},{key:"posChanged",value:function(e){0==this._aniFlag?this._aniFlag=e?1:-1:1!=this._aniFlag||e||(this._aniFlag=-1),this._needRefresh=!0,t.Timers.callLater(this.refresh,this)}},{key:"refresh",value:function(){null!=this._owner.displayObject&&(this._needRefresh=!1,t.Timers.remove(this.refresh,this),(this._pageMode||this._snapToItem)&&(s.set(-this._xPos,-this._yPos),this.alignPosition(s,!1),this._xPos=-s.x,this._yPos=-s.y),this.refresh2(),this._owner.dispatchEvent("scroll"),this._needRefresh&&(this._needRefresh=!1,t.Timers.remove(this.refresh,this),this.refresh2()),this.updateScrollBarPos(),this._aniFlag=0)}},{key:"refresh2",value:function(){var t,e;1!=this._aniFlag||this._dragged?(0!=this._tweening&&this.killTween(),this._container.setPosition(Math.floor(-this._xPos),Math.floor(-this._yPos)),this.loopCheckingCurrent()):(this._overlapSize.x>0?t=-Math.floor(this._xPos):(0!=this._container.x&&(this._container.x=0),t=0),this._overlapSize.y>0?e=-Math.floor(this._yPos):(0!=this._container.y&&(this._container.y=0),e=0),t!=this._container.x||e!=this._container.y?(this._tweenDuration.set(.5,.5),this._tweenStart.set(this._container.x,this._container.y),this._tweenChange.set(t-this._tweenStart.x,e-this._tweenStart.y),this.startTween(1)):0!=this._tweening&&this.killTween());this._pageMode&&this.updatePageController()}},{key:"__touchBegin",value:function(i){if(this._touchEffect&&0==i.input.button){i.captureTouch(),0!=this._tweening?(this.killTween(),t.Stage.cancelClick(i.input.touchId),this._dragged=!0):this._dragged=!1;var s=this._owner.globalToLocal(i.input.x,i.input.y,e);this._containerPos.set(this._container.x,this._container.y),this._beginTouchPos.set(s.x,s.y),this._lastTouchPos.set(s.x,s.y),this._lastTouchGlobalPos.set(i.input.x,i.input.y),this._isHoldAreaDone=!1,this._velocity.set(0,0),this._velocityScale=1,this._lastMoveTime=performance.now()/1e3}}},{key:"__touchMove",value:function(e){if(this._touchEffect&&!this.owner.isDisposed&&!(a.draggingPane&&a.draggingPane!=this||t.GObject.draggingObject)){var i,s,n,o=t.UIConfig.touchScrollSensitivity,h=this._owner.globalToLocal(e.input.x,e.input.y);if(this._scrollType==t.ScrollType.Vertical){if(!this._isHoldAreaDone){if(r|=1,(i=Math.abs(this._beginTouchPos.y-h.y))<o)return;if(0!=(2&r))if(i<Math.abs(this._beginTouchPos.x-h.x))return}s=!0}else if(this._scrollType==t.ScrollType.Horizontal){if(!this._isHoldAreaDone){if(r|=2,(i=Math.abs(this._beginTouchPos.x-h.x))<o)return;if(0!=(1&r))if(i<Math.abs(this._beginTouchPos.y-h.y))return}n=!0}else{if(r=3,!this._isHoldAreaDone&&(i=Math.abs(this._beginTouchPos.y-h.y))<o&&(i=Math.abs(this._beginTouchPos.x-h.x))<o)return;s=n=!0}var l=Math.floor(this._containerPos.x+h.x-this._beginTouchPos.x),u=Math.floor(this._containerPos.y+h.y-this._beginTouchPos.y);s&&(u>0?this._bouncebackEffect?this._header&&0!=this._header.maxHeight?this._container.y=Math.floor(Math.min(.5*u,this._header.maxHeight)):this._container.y=Math.floor(Math.min(.5*u,.5*this._viewSize.y)):this._container.y=0:u<-this._overlapSize.y?this._bouncebackEffect?this._footer&&this._footer.maxHeight>0?this._container.y=Math.floor(Math.max(.5*(u+this._overlapSize.y),-this._footer.maxHeight)-this._overlapSize.y):this._container.y=Math.floor(Math.max(.5*(u+this._overlapSize.y),.5*-this._viewSize.y)-this._overlapSize.y):this._container.y=-this._overlapSize.y:this._container.y=u),n&&(l>0?this._bouncebackEffect?this._header&&0!=this._header.maxWidth?this._container.x=Math.floor(Math.min(.5*l,this._header.maxWidth)):this._container.x=Math.floor(Math.min(.5*l,.5*this._viewSize.x)):this._container.x=0:l<0-this._overlapSize.x?this._bouncebackEffect?this._footer&&this._footer.maxWidth>0?this._container.x=Math.floor(Math.max(.5*(l+this._overlapSize.x),-this._footer.maxWidth)-this._overlapSize.x):this._container.x=Math.floor(Math.max(.5*(l+this._overlapSize.x),.5*-this._viewSize.x)-this._overlapSize.x):this._container.x=-this._overlapSize.x:this._container.x=l);var c=performance.now()/1e3,_=Math.max(c-this._lastMoveTime,1/60),d=h.x-this._lastTouchPos.x,g=h.y-this._lastTouchPos.y;if(n||(d=0),s||(g=0),0!=_){var f=60*_-1;if(f>1){var p=Math.pow(.833,f);this._velocity.x=this._velocity.x*p,this._velocity.y=this._velocity.y*p}this._velocity.x=t.lerp(this._velocity.x,60*d/60/_,10*_),this._velocity.y=t.lerp(this._velocity.y,60*g/60/_,10*_)}var y=this._lastTouchGlobalPos.x-e.input.x,v=this._lastTouchGlobalPos.y-e.input.y;0!=d?this._velocityScale=Math.abs(y/d):0!=g&&(this._velocityScale=Math.abs(v/g)),this._lastTouchPos.set(h.x,h.y),this._lastTouchGlobalPos.set(e.input.x,e.input.y),this._lastMoveTime=c,this._overlapSize.x>0&&(this._xPos=t.clamp(-this._container.x,0,this._overlapSize.x)),this._overlapSize.y>0&&(this._yPos=t.clamp(-this._container.y,0,this._overlapSize.y)),0!=this._loop&&(l=this._container.x,u=this._container.y,this.loopCheckingCurrent()&&(this._containerPos.x+=this._container.x-l,this._containerPos.y+=this._container.y-u)),a.draggingPane=this,this._isHoldAreaDone=!0,this._dragged=!0,this.updateScrollBarPos(),this.updateScrollBarVisible(),this._pageMode&&this.updatePageController(),this._owner.dispatchEvent("scroll")}}},{key:"__touchEnd",value:function(){if(a.draggingPane==this&&(a.draggingPane=null),r=0,this._dragged&&this._touchEffect){this._dragged=!1,this._tweenStart.set(this._container.x,this._container.y),s.set(this._tweenStart.x,this._tweenStart.y);var e=!1;if(this._container.x>0?(s.x=0,e=!0):this._container.x<-this._overlapSize.x&&(s.x=-this._overlapSize.x,e=!0),this._container.y>0?(s.y=0,e=!0):this._container.y<-this._overlapSize.y&&(s.y=-this._overlapSize.y,e=!0),e){if(this._tweenChange.set(s.x-this._tweenStart.x,s.y-this._tweenStart.y),this._tweenChange.x<-t.UIConfig.touchDragSensitivity||this._tweenChange.y<-t.UIConfig.touchDragSensitivity?(this._refreshEventDispatching=!0,this._owner.dispatchEvent("pull_down_release"),this._refreshEventDispatching=!1):(this._tweenChange.x>t.UIConfig.touchDragSensitivity||this._tweenChange.y>t.UIConfig.touchDragSensitivity)&&(this._refreshEventDispatching=!0,this._owner.dispatchEvent("pull_up_release"),this._refreshEventDispatching=!1),this._headerLockedSize>0&&0==s[this._refreshBarAxis])s[this._refreshBarAxis]=this._headerLockedSize,this._tweenChange.x=s.x-this._tweenStart.x,this._tweenChange.y=s.y-this._tweenStart.y;else if(this._footerLockedSize>0&&s[this._refreshBarAxis]==-this._overlapSize[this._refreshBarAxis]){var i=this._overlapSize[this._refreshBarAxis];0==i?i=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):i+=this._footerLockedSize,s[this._refreshBarAxis]=-i,this._tweenChange.x=s.x-this._tweenStart.x,this._tweenChange.y=s.y-this._tweenStart.y}this._tweenDuration.set(.3,.3)}else{if(this._inertiaDisabled)this._tweenDuration.set(.3,.3);else{var o=60*(performance.now()/1e3-this._lastMoveTime)-1;if(o>1){var h=Math.pow(.833,o);this._velocity.x=this._velocity.x*h,this._velocity.y=this._velocity.y*h}this.updateTargetAndDuration(this._tweenStart,s)}if(n.set(s.x-this._tweenStart.x,s.y-this._tweenStart.y),this.loopCheckingTarget(s),(this._pageMode||this._snapToItem)&&this.alignPosition(s,!0),this._tweenChange.x=s.x-this._tweenStart.x,this._tweenChange.y=s.y-this._tweenStart.y,0==this._tweenChange.x&&0==this._tweenChange.y)return void this.updateScrollBarVisible();(this._pageMode||this._snapToItem)&&(this.fixDuration("x",n.x),this.fixDuration("y",n.y))}this.startTween(2)}else this._dragged=!1}},{key:"__mouseWheel",value:function(t){if(this._mouseWheelEnabled){var e=t.input.mouseWheelDelta/window.devicePixelRatio;if(this._snapToItem&&Math.abs(e)<1&&(e=Math.sign(e)),this._overlapSize.x>0&&0==this._overlapSize.y){var i=this._pageMode?this._pageSize.x:this._scrollStep;this.setPosX(this._xPos+i*e,!1)}else{var s=this._pageMode?this._pageSize.y:this._scrollStep;this.setPosY(this._yPos+s*e,!1)}}}},{key:"updateScrollBarPos",value:function(){this._vtScrollBar&&this._vtScrollBar.setScrollPerc(0==this._overlapSize.y?0:t.clamp(-this._container.y,0,this._overlapSize.y)/this._overlapSize.y),this._hzScrollBar&&this._hzScrollBar.setScrollPerc(0==this._overlapSize.x?0:t.clamp(-this._container.x,0,this._overlapSize.x)/this._overlapSize.x),this.checkRefreshBar()}},{key:"updateScrollBarVisible",value:function(){this._vtScrollBar&&(this._viewSize.y<=this._vtScrollBar.minSize||this._vScrollNone?this._vtScrollBar.displayObject.visible=!1:this.updateScrollBarVisible2(this._vtScrollBar)),this._hzScrollBar&&(this._viewSize.x<=this._hzScrollBar.minSize||this._hScrollNone?this._hzScrollBar.displayObject.visible=!1:this.updateScrollBarVisible2(this._hzScrollBar))}},{key:"updateScrollBarVisible2",value:function(e){this._scrollBarDisplayAuto&&t.GTween.kill(e,!1,"alpha"),!this._scrollBarDisplayAuto||0!=this._tweening||this._dragged||e.gripDragging?(e.alpha=1,e.displayObject.visible=!0):e.displayObject.visible&&t.GTween.to(1,0,.5).setDelay(.5).onComplete(this.__barTweenComplete,this).setTarget(e,"alpha")}},{key:"__barTweenComplete",value:function(t){var e=t.target;e.alpha=1,e.displayObject.visible=!1}},{key:"getLoopPartSize",value:function(t,e){return(this._contentSize[e]+("x"==e?this._owner.columnGap:this._owner.lineGap))/t}},{key:"loopCheckingCurrent",value:function(){var t=!1;return 1==this._loop&&this._overlapSize.x>0?this._xPos<.001?(this._xPos+=this.getLoopPartSize(2,"x"),t=!0):this._xPos>=this._overlapSize.x&&(this._xPos-=this.getLoopPartSize(2,"x"),t=!0):2==this._loop&&this._overlapSize.y>0&&(this._yPos<.001?(this._yPos+=this.getLoopPartSize(2,"y"),t=!0):this._yPos>=this._overlapSize.y&&(this._yPos-=this.getLoopPartSize(2,"y"),t=!0)),t&&this._container.setPosition(Math.floor(-this._xPos),Math.floor(-this._yPos)),t}},{key:"loopCheckingTarget",value:function(t){1==this._loop&&this.loopCheckingTarget2(t,"x"),2==this._loop&&this.loopCheckingTarget2(t,"y")}},{key:"loopCheckingTarget2",value:function(t,e){var i,s;t[e]>0?(i=this.getLoopPartSize(2,e),(s=this._tweenStart[e]-i)<=0&&s>=-this._overlapSize[e]&&(t[e]-=i,this._tweenStart[e]=s)):t[e]<-this._overlapSize[e]&&(i=this.getLoopPartSize(2,e),(s=this._tweenStart[e]+i)<=0&&s>=-this._overlapSize[e]&&(t[e]+=i,this._tweenStart[e]=s))}},{key:"loopCheckingNewPos",value:function(e,i){if(0==this._overlapSize[i])return e;var s,n="x"==i?this._xPos:this._yPos,r=!1;return e<.001?(e+=this.getLoopPartSize(2,i))>n&&(s=this.getLoopPartSize(6,i),s=Math.ceil((e-n)/s)*s,n=t.clamp(n+s,0,this._overlapSize[i]),r=!0):e>=this._overlapSize[i]&&(e-=this.getLoopPartSize(2,i))<n&&(s=this.getLoopPartSize(6,i),s=Math.ceil((n-e)/s)*s,n=t.clamp(n-s,0,this._overlapSize[i]),r=!0),r&&("x"==i?this._container.x=-Math.floor(n):this._container.y=-Math.floor(n)),e}},{key:"alignPosition",value:function(t,i){if(this._pageMode)t.x=this.alignByPage(t.x,"x",i),t.y=this.alignByPage(t.y,"y",i);else if(this._snapToItem){var s=0,n=0;i&&(s=t.x-this._containerPos.x,n=t.y-this._containerPos.y);var r=this._owner.getSnappingPositionWithDir(-t.x,-t.y,s,n,e);t.x<0&&t.x>-this._overlapSize.x&&(t.x=-r.x),t.y<0&&t.y>-this._overlapSize.y&&(t.y=-r.y)}}},{key:"alignByPage",value:function(e,i,s){var n;if(e>0)n=0;else if(e<-this._overlapSize[i])n=Math.ceil(this._contentSize[i]/this._pageSize[i])-1;else{n=Math.floor(-e/this._pageSize[i]);var r=s?e-this._containerPos[i]:e-this._container[i],a=Math.min(this._pageSize[i],this._contentSize[i]-(n+1)*this._pageSize[i]),o=-e-n*this._pageSize[i];Math.abs(r)>this._pageSize[i]?o>.5*a&&n++:o>a*(r<0?t.UIConfig.defaultScrollPagingThreshold:1-t.UIConfig.defaultScrollPagingThreshold)&&n++,(e=-n*this._pageSize[i])<-this._overlapSize[i]&&(e=-this._overlapSize[i])}if(s){var h,l=this._tweenStart[i];h=l>0?0:l<-this._overlapSize[i]?Math.ceil(this._contentSize[i]/this._pageSize[i])-1:Math.floor(-l/this._pageSize[i]);var u=Math.floor(-this._containerPos[i]/this._pageSize[i]);Math.abs(n-u)>1&&Math.abs(h-u)<=1&&(e=-(n=n>u?u+1:u-1)*this._pageSize[i])}return e}},{key:"updateTargetAndDuration",value:function(t,e){e.x=this.updateTargetAndDuration2(t.x,"x"),e.y=this.updateTargetAndDuration2(t.y,"y")}},{key:"updateTargetAndDuration2",value:function(e,i){var s=this._velocity[i],n=0;if(e>0)e=0;else if(e<-this._overlapSize[i])e=-this._overlapSize[i];else{var r=Math.abs(s)*this._velocityScale;t.Stage.touchScreen&&(r*=1136/Math.max(window.screen.width,window.screen.height));var a=0;if(this._pageMode||!t.Stage.touchScreen?r>500&&(a=Math.pow((r-500)/500,2)):r>1e3&&(a=Math.pow((r-1e3)/1e3,2)),0!=a)a>1&&(a=1),r*=a,s*=a,this._velocity[i]=s,n=Math.log(60/r)/Math.log(this._decelerationRate)/60,e+=Math.floor(s*n*.4)}return n<.3&&(n=.3),this._tweenDuration[i]=n,e}},{key:"fixDuration",value:function(t,e){if(!(0==this._tweenChange[t]||Math.abs(this._tweenChange[t])>=Math.abs(e))){var i=Math.abs(this._tweenChange[t]/e)*this._tweenDuration[t];i<.3&&(i=.3),this._tweenDuration[t]=i}}},{key:"startTween",value:function(e){this._tweenTime.set(0,0),this._tweening=e,t.Timers.addUpdate(this.tweenUpdate,this),this.updateScrollBarVisible()}},{key:"killTween",value:function(){1==this._tweening&&(this._container.setPosition(this._tweenStart.x+this._tweenChange.x,this._tweenStart.y+this._tweenChange.y),this._owner.dispatchEvent("scroll")),this._tweening=0,t.Timers.remove(this.tweenUpdate,this),this.updateScrollBarVisible(),this._owner.dispatchEvent("scroll_end")}},{key:"checkRefreshBar",value:function(){if(null!=this._header||null!=this._footer){var t=this._container[this._refreshBarAxis];if(this._header)if(t>0){null==this._header.displayObject.parent&&this._maskContainer.addChildAt(this._header.displayObject,0);var i=e;i.set(this._header.width,this._header.height),i[this._refreshBarAxis]=t,this._header.setSize(i.x,i.y)}else this._header.displayObject.parent&&this._maskContainer.removeChild(this._header.displayObject);if(this._footer){var s=this._overlapSize[this._refreshBarAxis];t<-s||0==s&&this._footerLockedSize>0?(null==this._footer.displayObject.parent&&this._maskContainer.addChildAt(this._footer.displayObject,0),(i=e).set(this._footer.x,this._footer.y),i[this._refreshBarAxis]=s>0?t+this._contentSize[this._refreshBarAxis]:Math.max(Math.min(t+this._viewSize[this._refreshBarAxis],this._viewSize[this._refreshBarAxis]-this._footerLockedSize),this._viewSize[this._refreshBarAxis]-this._contentSize[this._refreshBarAxis]),this._footer.setPosition(i.x,i.y),i.set(this._footer.width,this._footer.height),i[this._refreshBarAxis]=s>0?-s-t:this._viewSize[this._refreshBarAxis]-this._footer[this._refreshBarAxis],this._footer.setSize(i.x,i.y)):this._footer.displayObject.parent&&this._maskContainer.removeChild(this._footer.displayObject)}}}},{key:"tweenUpdate",value:function(){var e=this.runTween("x"),i=this.runTween("y");this._container.setPosition(e,i),2==this._tweening&&(this._overlapSize.x>0&&(this._xPos=t.clamp(-e,0,this._overlapSize.x)),this._overlapSize.y>0&&(this._yPos=t.clamp(-i,0,this._overlapSize.y)),this._pageMode&&this.updatePageController()),0==this._tweenChange.x&&0==this._tweenChange.y?(this._tweening=0,t.Timers.remove(this.tweenUpdate,this),this.loopCheckingCurrent(),this.updateScrollBarPos(),this.updateScrollBarVisible(),this._owner.dispatchEvent("scroll"),this._owner.dispatchEvent("scroll_end")):(this.updateScrollBarPos(),this._owner.dispatchEvent("scroll"))}},{key:"runTween",value:function(e){var i,s,n;if(0!=this._tweenChange[e]){if(this._tweenTime[e]+=t.Timers.deltaTime/1e3,this._tweenTime[e]>=this._tweenDuration[e])i=this._tweenStart[e]+this._tweenChange[e],this._tweenChange[e]=0;else{var r=(s=this._tweenTime[e],n=this._tweenDuration[e],(s=s/n-1)*s*s+1);i=this._tweenStart[e]+Math.floor(this._tweenChange[e]*r)}var a=0,o=-this._overlapSize[e];if(this._headerLockedSize>0&&this._refreshBarAxis==e&&(a=this._headerLockedSize),this._footerLockedSize>0&&this._refreshBarAxis==e){var h=this._overlapSize[this._refreshBarAxis];0==h?h=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):h+=this._footerLockedSize,o=-h}2==this._tweening&&this._bouncebackEffect?i>20+a&&this._tweenChange[e]>0||i>a&&0==this._tweenChange[e]?(this._tweenTime[e]=0,this._tweenDuration[e]=.3,this._tweenChange[e]=-i+a,this._tweenStart[e]=i):(i<o-20&&this._tweenChange[e]<0||i<o&&0==this._tweenChange[e])&&(this._tweenTime[e]=0,this._tweenDuration[e]=.3,this._tweenChange[e]=o-i,this._tweenStart[e]=i):i>a?(i=a,this._tweenChange[e]=0):i<o&&(i=o,this._tweenChange[e]=0)}else i=this._container[e];return i}},{key:"owner",get:function(){return this._owner}},{key:"hzScrollBar",get:function(){return this._hzScrollBar}},{key:"vtScrollBar",get:function(){return this._vtScrollBar}},{key:"header",get:function(){return this._header}},{key:"footer",get:function(){return this._footer}},{key:"bouncebackEffect",get:function(){return this._bouncebackEffect},set:function(t){this._bouncebackEffect=t}},{key:"touchEffect",get:function(){return this._touchEffect},set:function(t){this._touchEffect=t}},{key:"scrollStep",set:function(e){this._scrollStep=e,0==this._scrollStep&&(this._scrollStep=t.UIConfig.defaultScrollStep)},get:function(){return this._scrollStep}},{key:"snapToItem",get:function(){return this._snapToItem},set:function(t){this._snapToItem=t}},{key:"mouseWheelEnabled",get:function(){return this._mouseWheelEnabled},set:function(t){this._mouseWheelEnabled=t}},{key:"decelerationRate",get:function(){return this._decelerationRate},set:function(t){this._decelerationRate=t}},{key:"isDragged",get:function(){return this._dragged}},{key:"percX",get:function(){return 0==this._overlapSize.x?0:this._xPos/this._overlapSize.x},set:function(t){this.setPercX(t,!1)}},{key:"percY",get:function(){return 0==this._overlapSize.y?0:this._yPos/this._overlapSize.y},set:function(t){this.setPercY(t,!1)}},{key:"posX",get:function(){return this._xPos},set:function(t){this.setPosX(t,!1)}},{key:"posY",get:function(){return this._yPos},set:function(t){this.setPosY(t,!1)}},{key:"contentWidth",get:function(){return this._contentSize.x}},{key:"contentHeight",get:function(){return this._contentSize.y}},{key:"viewWidth",get:function(){return this._viewSize.x},set:function(t){t=t+this._owner.margin.left+this._owner.margin.right,this._vtScrollBar&&!this._floating&&(t+=this._vtScrollBar.width),this._owner.width=t}},{key:"viewHeight",get:function(){return this._viewSize.y},set:function(t){t=t+this._owner.margin.top+this._owner.margin.bottom,this._hzScrollBar&&!this._floating&&(t+=this._hzScrollBar.height),this._owner.height=t}},{key:"currentPageX",get:function(){if(!this._pageMode)return 0;var t=Math.floor(this._xPos/this._pageSize.x);return this._xPos-t*this._pageSize.x>.5*this._pageSize.x&&t++,t},set:function(t){this.setCurrentPageX(t,!1)}},{key:"currentPageY",get:function(){if(!this._pageMode)return 0;var t=Math.floor(this._yPos/this._pageSize.y);return this._yPos-t*this._pageSize.y>.5*this._pageSize.y&&t++,t},set:function(t){this.setCurrentPageY(t,!1)}},{key:"isBottomMost",get:function(){return this._yPos==this._overlapSize.y||0==this._overlapSize.y}},{key:"isRightMost",get:function(){return this._xPos==this._overlapSize.x||0==this._overlapSize.x}},{key:"pageController",get:function(){return this._pageController},set:function(t){this._pageController=t}},{key:"scrollingPosX",get:function(){return t.clamp(-this._container.x,0,this._overlapSize.x)}},{key:"scrollingPosY",get:function(){return t.clamp(-this._container.y,0,this._overlapSize.y)}}]),a}();t.ScrollPane=a}(fgui||(fgui={})),function(t){var e,i=function(){function i(t){_classCallCheck(this,i),this._owner=t,this._items=new Array,this._totalDuration=0,this._autoPlayTimes=1,this._autoPlayDelay=0,this._timeScale=1,this._startTime=0,this._endTime=0}return _createClass(i,[{key:"play",value:function(t,e,i,s,n){this._play(t,e,i,s,n,!1)}},{key:"playReverse",value:function(t,e,i,s,n){this._play(t,e,i,s,n,!0)}},{key:"changePlayTimes",value:function(t){this._totalTimes=t}},{key:"setAutoPlay",value:function(t,e,i){this._autoPlay!=t&&(this._autoPlay=t,this._autoPlayTimes=e||1,this._autoPlayDelay=i||0,this._autoPlay?this._owner.onStage&&this.play(null,null,this._autoPlayTimes,this._autoPlayDelay):this._owner.onStage||this.stop(!1,!0))}},{key:"_play",value:function(i,s,n,r,a,o){this.stop(!0,!0),n=n||0,this._totalTimes=s||1,this._reversed=o,this._startTime=r||0,this._endTime=a||-1,this._playing=!0,this._paused=!1,this._onComplete=i;for(var h=this._items.length,l=0;l<h;l++){var u=this._items[l];if(null==u.target?u.targetId?u.target=this._owner.getChildById(u.targetId):u.target=this._owner:u.target!=this._owner&&u.target.parent!=this._owner&&(u.target=null),u.target&&u.type==e.Transition){var c=u.target.getTransition(u.value.transName);if(c==this&&(c=null),c)if(0==u.value.playTimes){var _;for(_=l-1;_>=0;_--){var d=this._items[_];if(d.type==e.Transition&&d.value.trans==c){d.value.stopTime=u.time-d.time;break}}_<0?u.value.stopTime=0:c=null}else u.value.stopTime=-1;u.value.trans=c}}0==n?this.onDelayedPlay():t.GTween.delayedCall(n).onComplete(this.onDelayedPlay,this)}},{key:"stop",value:function(e,i){if(this._playing){null==e&&(e=!0),this._playing=!1,this._totalTasks=0,this._totalTimes=0;var s=this._onComplete;this._onComplete=null,t.GTween.kill(this);var n=this._items.length;if(this._reversed)for(var r=n-1;r>=0;r--){var a=this._items[r];null!=a.target&&this.stopItem(a,e)}else for(r=0;r<n;r++)null!=(a=this._items[r]).target&&this.stopItem(a,e);i&&s&&s()}}},{key:"stopItem",value:function(t,i){if(0!=t.displayLockToken&&(t.target.releaseDisplayLock(t.displayLockToken),t.displayLockToken=0),t.tweener&&(t.tweener.kill(i),t.tweener=null,t.type!=e.Shake||i||(t.target._gearLocked=!0,t.target.setPosition(t.target.x-t.value.lastOffsetX,t.target.y-t.value.lastOffsetY),t.target._gearLocked=!1)),t.type==e.Transition){var s=t.value.trans;s&&s.stop(i,!1)}}},{key:"setPaused",value:function(i){if(this._playing&&this._paused!=i){this._paused=i;var s=t.GTween.getTween(this);s&&s.setPaused(i);for(var n=this._items.length,r=0;r<n;r++){var a=this._items[r];null!=a.target&&(a.type==e.Transition?a.value.trans&&a.value.trans.setPaused(i):a.type==e.Animation&&(i?(a.value.flag=a.target.getProp(t.ObjectPropID.Playing),a.target.setProp(t.ObjectPropID.Playing,!1)):a.target.setProp(t.ObjectPropID.Playing,a.value.flag)),a.tweener&&a.tweener.setPaused(i))}}}},{key:"dispose",value:function(){this._playing&&t.GTween.kill(this);for(var e=this._items.length,i=0;i<e;i++){var s=this._items[i];s.tweener&&(s.tweener.kill(),s.tweener=null),s.target=null,s.hook=null,s.tweenConfig&&(s.tweenConfig.endHook=null)}this._items.length=0,this._playing=!1,this._onComplete=null}},{key:"setValue",value:function(t){for(var i,s=this._items.length,n=!1,r=0;r<s;r++){var a=this._items[r];if(a.label==t)i=a.tweenConfig?a.tweenConfig.startValue:a.value,n=!0;else{if(!a.tweenConfig||a.tweenConfig.endLabel!=t)continue;i=a.tweenConfig.endValue,n=!0}switch(a.type){case e.XY:case e.Size:case e.Pivot:case e.Scale:case e.Skew:i.b1=!0,i.b2=!0,i.f1=parseFloat(arguments.length<=1?void 0:arguments[1]),i.f2=parseFloat(arguments.length<=2?void 0:arguments[2]);break;case e.Alpha:case e.Rotation:case e.Color:i.f1=parseFloat(arguments.length<=1?void 0:arguments[1]);break;case e.Animation:i.frame=parseInt(arguments.length<=1?void 0:arguments[1]),(arguments.length<=1?0:arguments.length-1)>1&&(i.playing=arguments.length<=2?void 0:arguments[2]);break;case e.Visible:i.visible=arguments.length<=1?void 0:arguments[1];break;case e.Sound:i.sound=arguments.length<=1?void 0:arguments[1],(arguments.length<=1?0:arguments.length-1)>1&&(i.volume=parseFloat(arguments.length<=2?void 0:arguments[2]));break;case e.Transition:i.transName=arguments.length<=1?void 0:arguments[1],(arguments.length<=1?0:arguments.length-1)>1&&(i.playTimes=parseInt(arguments.length<=2?void 0:arguments[2]));break;case e.Shake:i.amplitude=parseFloat(arguments.length<=1?void 0:arguments[1]),(arguments.length<=1?0:arguments.length-1)>1&&(i.duration=parseFloat(arguments.length<=2?void 0:arguments[2]));break;case e.ColorFilter:i.f1=parseFloat(arguments.length<=1?void 0:arguments[1]),i.f2=parseFloat(arguments.length<=2?void 0:arguments[2]),i.f3=parseFloat(arguments.length<=3?void 0:arguments[3]),i.f4=parseFloat(arguments.length<=4?void 0:arguments[4]);break;case e.Text:case e.Icon:i.text=arguments.length<=1?void 0:arguments[1]}}if(!n)throw new Error("this.label not exists")}},{key:"setHook",value:function(t,e){for(var i=this._items.length,s=!1,n=0;n<i;n++){var r=this._items[n];if(r.label==t){r.hook=e,s=!0;break}if(r.tweenConfig&&r.tweenConfig.endLabel==t){r.tweenConfig.endHook=e,s=!0;break}}if(!s)throw new Error("this.label not exists")}},{key:"clearHooks",value:function(){for(var t=this._items.length,e=0;e<t;e++){var i=this._items[e];i.hook=null,i.tweenConfig&&(i.tweenConfig.endHook=null)}}},{key:"setTarget",value:function(t,e){for(var i=this._items.length,s=!1,n=0;n<i;n++){var r=this._items[n];r.label==t&&(r.targetId=e==this._owner||null==e?"":e.id,this._playing?r.targetId.length>0?r.target=this._owner.getChildById(r.targetId):r.target=this._owner:r.target=null,s=!0)}if(!s)throw new Error("this.label not exists")}},{key:"setDuration",value:function(t,e){for(var i=this._items.length,s=!1,n=0;n<i;n++){var r=this._items[n];r.tweenConfig&&r.label==t&&(r.tweenConfig.duration=e,s=!0)}if(!s)throw new Error("this.label not exists")}},{key:"getLabelTime",value:function(t){for(var e=this._items.length,i=0;i<e;i++){var s=this._items[i];if(s.label==t)return s.time;if(s.tweenConfig&&s.tweenConfig.endLabel==t)return s.time+s.tweenConfig.duration}return NaN}},{key:"updateFromRelations",value:function(t,i,s){var n=this._items.length;if(0!=n)for(var r=0;r<n;r++){var a=this._items[r];a.type==e.XY&&a.targetId==t&&(a.tweenConfig?(a.tweenConfig.startValue.b3||(a.tweenConfig.startValue.f1+=i,a.tweenConfig.startValue.f2+=s),a.tweenConfig.endValue.b3||(a.tweenConfig.endValue.f1+=i,a.tweenConfig.endValue.f2+=s)):a.value.b3||(a.value.f1+=i,a.value.f2+=s))}}},{key:"onOwnerAddedToStage",value:function(){this._autoPlay&&!this._playing&&this.play(null,this._autoPlayTimes,this._autoPlayDelay)}},{key:"onOwnerRemovedFromStage",value:function(){0==(2&this._options)&&this.stop(0!=(4&this._options),!1)}},{key:"onDelayedPlay",value:function(){if(this.internalPlay(),this._playing=this._totalTasks>0,this._playing){if(0!=(1&this._options))for(var t=this._items.length,e=0;e<t;e++){var i=this._items[e];i.target&&i.target!=this._owner&&(i.displayLockToken=i.target.addDisplayLock())}}else if(this._onComplete){var s=this._onComplete;this._onComplete=null,s()}}},{key:"internalPlay",value:function(){this._ownerBaseX=this._owner.x,this._ownerBaseY=this._owner.y,this._totalTasks=0;var t,i=this._items.length,s=!1;if(this._reversed)for(n=i-1;n>=0;n--)null!=(t=this._items[n]).target&&this.playItem(t);else for(var n=0;n<i;n++)null!=(t=this._items[n]).target&&(t.type==e.Animation&&0!=this._startTime&&t.time<=this._startTime?(s=!0,t.value.flag=!1):this.playItem(t));s&&this.skipAnimations()}},{key:"playItem",value:function(i){var s;if(i.tweenConfig){if(s=this._reversed?this._totalDuration-i.time-i.tweenConfig.duration:i.time,-1==this._endTime||s<=this._endTime){var n,r;switch(this._reversed?(n=i.tweenConfig.endValue,r=i.tweenConfig.startValue):(n=i.tweenConfig.startValue,r=i.tweenConfig.endValue),i.value.b1=n.b1||r.b1,i.value.b2=n.b2||r.b2,i.type){case e.XY:case e.Size:case e.Scale:case e.Skew:i.tweener=t.GTween.to2(n.f1,n.f2,r.f1,r.f2,i.tweenConfig.duration);break;case e.Alpha:case e.Rotation:i.tweener=t.GTween.to(n.f1,r.f1,i.tweenConfig.duration);break;case e.Color:i.tweener=t.GTween.toColor(n.f1,r.f1,i.tweenConfig.duration);break;case e.ColorFilter:i.tweener=t.GTween.to4(n.f1,n.f2,n.f3,n.f4,r.f1,r.f2,r.f3,r.f4,i.tweenConfig.duration)}i.tweener.setDelay(s).setEase(i.tweenConfig.easeType).setRepeat(i.tweenConfig.repeat,i.tweenConfig.yoyo).setTimeScale(this._timeScale).setTarget(i).onStart(this.onTweenStart,this).onUpdate(this.onTweenUpdate,this).onComplete(this.onTweenComplete,this),this._endTime>=0&&i.tweener.setBreakpoint(this._endTime-s),this._totalTasks++}}else i.type==e.Shake?(s=this._reversed?this._totalDuration-i.time-i.value.duration:i.time,i.value.offsetX=i.value.offsetY=0,i.value.lastOffsetX=i.value.lastOffsetY=0,i.tweener=t.GTween.shake(0,0,i.value.amplitude,i.value.duration).setDelay(s).setTimeScale(this._timeScale).setTarget(i).onUpdate(this.onTweenUpdate,this).onComplete(this.onTweenComplete,this),this._endTime>=0&&i.tweener.setBreakpoint(this._endTime-i.time),this._totalTasks++):(s=this._reversed?this._totalDuration-i.time:i.time)<=this._startTime?(this.applyValue(i),this.callHook(i,!1)):(-1==this._endTime||s<=this._endTime)&&(this._totalTasks++,i.tweener=t.GTween.delayedCall(s).setTimeScale(this._timeScale).setTarget(i).onComplete(this.onDelayedPlayItem,this));i.tweener&&i.tweener.seek(this._startTime)}},{key:"skipAnimations",value:function(){for(var i,s,n,r,a,o,h=this._items.length,l=0;l<h;l++)if(!((o=this._items[l]).type!=e.Animation||o.time>this._startTime||(r=o.value).flag)){i=(a=o.target).getProp(t.ObjectPropID.Frame),s=a.getProp(t.ObjectPropID.Playing)?0:-1,n=0;for(var u=l;u<h;u++)(o=this._items[u]).type!=e.Animation||o.target!=a||o.time>this._startTime||((r=o.value).flag=!0,-1!=r.frame?(i=r.frame,s=r.playing?o.time:-1,n=0):r.playing?s<0&&(s=o.time):(s>=0&&(n+=o.time-s),s=-1),this.callHook(o,!1));s>=0&&(n+=this._startTime-s),a.setProp(t.ObjectPropID.Playing,s>=0),a.setProp(t.ObjectPropID.Frame,i),n>0&&a.setProp(t.ObjectPropID.DeltaTime,1e3*n)}}},{key:"onDelayedPlayItem",value:function(t){var e=t.target;e.tweener=null,this._totalTasks--,this.applyValue(e),this.callHook(e,!1),this.checkAllComplete()}},{key:"onTweenStart",value:function(t){var i,s,n=t.target;n.type!=e.XY&&n.type!=e.Size||(this._reversed?(i=n.tweenConfig.endValue,s=n.tweenConfig.startValue):(i=n.tweenConfig.startValue,s=n.tweenConfig.endValue),n.type==e.XY?n.target!=this._owner?(i.b1?i.b3&&(t.startValue.x=i.f1*this._owner.width):t.startValue.x=n.target.x,i.b2?i.b3&&(t.startValue.y=i.f2*this._owner.height):t.startValue.y=n.target.y,s.b1?s.b3&&(t.endValue.x=s.f1*this._owner.width):t.endValue.x=t.startValue.x,s.b2?s.b3&&(t.endValue.y=s.f2*this._owner.height):t.endValue.y=t.startValue.y):(i.b1||(t.startValue.x=n.target.x-this._ownerBaseX),i.b2||(t.startValue.y=n.target.y-this._ownerBaseY),s.b1||(t.endValue.x=t.startValue.x),s.b2||(t.endValue.y=t.startValue.y)):(i.b1||(t.startValue.x=n.target.width),i.b2||(t.startValue.y=n.target.height),s.b1||(t.endValue.x=t.startValue.x),s.b2||(t.endValue.y=t.startValue.y)),n.tweenConfig.path&&(n.value.b1=n.value.b2=!0,t.setPath(n.tweenConfig.path)));this.callHook(n,!1)}},{key:"onTweenUpdate",value:function(t){var i=t.target;switch(i.type){case e.XY:case e.Size:case e.Scale:case e.Skew:i.value.f1=t.value.x,i.value.f2=t.value.y,i.tweenConfig.path&&(i.value.f1+=t.startValue.x,i.value.f2+=t.startValue.y);break;case e.Alpha:case e.Rotation:i.value.f1=t.value.x;break;case e.Color:i.value.f1=t.value.color;break;case e.ColorFilter:i.value.f1=t.value.x,i.value.f2=t.value.y,i.value.f3=t.value.z,i.value.f4=t.value.w;break;case e.Shake:i.value.offsetX=t.deltaValue.x,i.value.offsetY=t.deltaValue.y}this.applyValue(i)}},{key:"onTweenComplete",value:function(t){var e=t.target;e.tweener=null,this._totalTasks--,t.allCompleted&&this.callHook(e,!0),this.checkAllComplete()}},{key:"onPlayTransCompleted",value:function(t){this._totalTasks--,this.checkAllComplete()}},{key:"callHook",value:function(t,e){e?t.tweenConfig&&t.tweenConfig.endHook&&t.tweenConfig.endHook():t.time>=this._startTime&&t.hook&&t.hook()}},{key:"checkAllComplete",value:function(){if(this._playing&&0==this._totalTasks)if(this._totalTimes<0)this.internalPlay();else if(this._totalTimes--,this._totalTimes>0)this.internalPlay();else{this._playing=!1;for(var t=this._items.length,e=0;e<t;e++){var i=this._items[e];i.target&&0!=i.displayLockToken&&(i.target.releaseDisplayLock(i.displayLockToken),i.displayLockToken=0)}if(this._onComplete){var s=this._onComplete;this._onComplete=null,s()}}}},{key:"applyValue",value:function(i){i.target._gearLocked=!0;var s=i.value;switch(i.type){case e.XY:i.target==this._owner?s.b1&&s.b2?i.target.setPosition(s.f1+this._ownerBaseX,s.f2+this._ownerBaseY):s.b1?i.target.x=s.f1+this._ownerBaseX:i.target.y=s.f2+this._ownerBaseY:s.b3?s.b1&&s.b2?i.target.setPosition(s.f1*this._owner.width,s.f2*this._owner.height):s.b1?i.target.x=s.f1*this._owner.width:s.b2&&(i.target.y=s.f2*this._owner.height):s.b1&&s.b2?i.target.setPosition(s.f1,s.f2):s.b1?i.target.x=s.f1:s.b2&&(i.target.y=s.f2);break;case e.Size:s.b1||(s.f1=i.target.width),s.b2||(s.f2=i.target.height),i.target.setSize(s.f1,s.f2);break;case e.Pivot:i.target.setPivot(s.f1,s.f2,i.target.pivotAsAnchor);break;case e.Alpha:i.target.alpha=s.f1;break;case e.Rotation:i.target.rotation=s.f1;break;case e.Scale:i.target.setScale(s.f1,s.f2);break;case e.Skew:i.target.setSkew(s.f1,s.f2);break;case e.Color:i.target.setProp(t.ObjectPropID.Color,s.f1);break;case e.Animation:s.frame>=0&&i.target.setProp(t.ObjectPropID.Frame,s.frame),i.target.setProp(t.ObjectPropID.Playing,s.playing),i.target.setProp(t.ObjectPropID.TimeScale,this._timeScale);break;case e.Visible:i.target.visible=s.visible;break;case e.Transition:if(this._playing){var n=s.trans;if(n){this._totalTasks++;var r=this._startTime>i.time?this._startTime-i.time:0,a=this._endTime>=0?this._endTime-i.time:-1;s.stopTime>=0&&(a<0||a>s.stopTime)&&(a=s.stopTime),n.timeScale=this._timeScale,n._play(this.onPlayTransCompleted.bind(this,i),s.playTimes,0,r,a,this._reversed)}}break;case e.Sound:if(this._playing&&i.time>=this._startTime){if(null==s.audioClip){var o=t.UIPackage.getItemByURL(s.sound);s.audioClip=o?o.file:s.sound}s.audioClip&&t.Decls.GRoot.inst.playOneShotSound(s.audioClip,s.volume)}break;case e.Shake:i.target.setPosition(i.target.x-s.lastOffsetX+s.offsetX,i.target.y-s.lastOffsetY+s.offsetY),s.lastOffsetX=s.offsetX,s.lastOffsetY=s.offsetY;break;case e.ColorFilter:break;case e.Text:i.target.text=s.text;break;case e.Icon:i.target.icon=s.text}i.target._gearLocked=!1}},{key:"setup",value:function(e){this.name=e.readS(),this._options=e.readInt(),this._autoPlay=e.readBool(),this._autoPlayTimes=e.readInt(),this._autoPlayDelay=e.readFloat();for(var i=e.readShort(),r=0;r<i;r++){var a=e.readShort(),o=e.pos;e.seek(o,0);var h=new s(e.readByte());this._items[r]=h,h.time=e.readFloat();var l=e.readShort();if(h.targetId=l<0?"":this._owner.getChildAt(l).id,h.label=e.readS(),e.readBool()){if(e.seek(o,1),h.tweenConfig=new n,h.tweenConfig.duration=e.readFloat(),h.time+h.tweenConfig.duration>this._totalDuration&&(this._totalDuration=h.time+h.tweenConfig.duration),h.tweenConfig.easeType=e.readByte(),h.tweenConfig.repeat=e.readInt(),h.tweenConfig.yoyo=e.readBool(),h.tweenConfig.endLabel=e.readS(),e.seek(o,2),this.decodeValue(h,e,h.tweenConfig.startValue),e.seek(o,3),this.decodeValue(h,e,h.tweenConfig.endValue),e.version>=2){var u=e.readInt();if(u>0){h.tweenConfig.path=new t.GPath;for(var c=new Array,_=0;_<u;_++){var d=e.readByte();switch(d){case t.CurveType.Bezier:c.push(t.GPathPoint.newBezierPoint(e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat()));break;case t.CurveType.CubicBezier:c.push(t.GPathPoint.newCubicBezierPoint(e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat()));break;default:c.push(t.GPathPoint.newPoint(e.readFloat(),e.readFloat(),d))}}h.tweenConfig.path.create(c)}}}else h.time>this._totalDuration&&(this._totalDuration=h.time),e.seek(o,2),this.decodeValue(h,e,h.value);e.pos=o+a}}},{key:"decodeValue",value:function(t,i,s){switch(t.type){case e.XY:case e.Size:case e.Pivot:case e.Skew:s.b1=i.readBool(),s.b2=i.readBool(),s.f1=i.readFloat(),s.f2=i.readFloat(),i.version>=2&&t.type==e.XY&&(s.b3=i.readBool());break;case e.Alpha:case e.Rotation:s.b1=s.b2=!0,s.f1=i.readFloat();break;case e.Scale:s.b1=s.b2=!0,s.f1=i.readFloat(),s.f2=i.readFloat();break;case e.Color:s.b1=s.b2=!0,s.f1=i.readColor();break;case e.Animation:s.playing=i.readBool(),s.frame=i.readInt();break;case e.Visible:s.visible=i.readBool();break;case e.Sound:s.sound=i.readS(),s.volume=i.readFloat();break;case e.Transition:s.transName=i.readS(),s.playTimes=i.readInt();break;case e.Shake:s.amplitude=i.readFloat(),s.duration=i.readFloat();break;case e.ColorFilter:s.b1=s.b2=!0,s.f1=i.readFloat(),s.f2=i.readFloat(),s.f3=i.readFloat(),s.f4=i.readFloat();break;case e.Text:case e.Icon:s.text=i.readS()}}},{key:"playing",get:function(){return this._playing}},{key:"timeScale",get:function(){return this._timeScale},set:function(i){if(this._timeScale!=i&&(this._timeScale=i,this._playing))for(var s=this._items.length,n=0;n<s;n++){var r=this._items[n];r.tweener?r.tweener.setTimeScale(i):r.type==e.Transition?r.value.trans&&(r.value.trans.timeScale=i):r.type==e.Animation&&r.target&&r.target.setProp(t.ObjectPropID.TimeScale,i)}}}]),i}();t.Transition=i,function(t){t[t.XY=0]="XY",t[t.Size=1]="Size",t[t.Scale=2]="Scale",t[t.Pivot=3]="Pivot",t[t.Alpha=4]="Alpha",t[t.Rotation=5]="Rotation",t[t.Color=6]="Color",t[t.Animation=7]="Animation",t[t.Visible=8]="Visible",t[t.Sound=9]="Sound",t[t.Transition=10]="Transition",t[t.Shake=11]="Shake",t[t.ColorFilter=12]="ColorFilter",t[t.Skew=13]="Skew",t[t.Text=14]="Text",t[t.Icon=15]="Icon",t[t.Unknown=16]="Unknown"}(e||(e={}));var s=function t(e){_classCallCheck(this,t),this.type=e,this.value={},this.displayLockToken=0},n=function e(){_classCallCheck(this,e),this.easeType=t.EaseType.QuadOut,this.startValue={b1:!0,b2:!0},this.endValue={b1:!0,b2:!0}}}(fgui||(fgui={})),function(t){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"loadFromXML",value:function(t){var i={};e.strings=i,t.elements("string").forEach((function(t){var e=t.getAttrString("name"),s=t.text,n=e.indexOf("-");if(-1!=n){var r=e.substr(0,n),a=e.substr(n+1),o=i[r];o||(o={},i[r]=o),o[a]=s}}))}},{key:"translateComponent",value:function(i){if(null!=e.strings){var s=e.strings[i.owner.id+i.id];if(null!=s){var n,r,a,o,h,l,u,c,_,d=i.rawData;d.seek(0,2);var g=d.readShort();for(h=0;h<g;h++){u=d.readShort(),c=d.pos,d.seek(c,0);var f=d.readByte(),p=f;d.skip(4),n=d.readS(),p==t.ObjectType.Component&&d.seek(c,6)&&(p=d.readByte()),d.seek(c,1),null!=(r=s[n+"-tips"])&&d.writeS(r),d.seek(c,2);var y=d.readShort();for(l=0;l<y;l++){if(a=d.readShort(),a+=d.pos,6==d.readByte()){for(d.skip(2),_=d.readShort(),m=0;m<_;m++)null!=d.readS()&&(null!=(r=s[n+"-texts_"+m])?d.writeS(r):d.skip(2));d.readBool()&&null!=(r=s[n+"-texts_def"])&&d.writeS(r)}d.pos=a}if(f==t.ObjectType.Component&&d.version>=2){d.seek(c,4),d.skip(2),d.skip(4*d.readUshort());for(var v=d.readUshort(),m=0;m<v;m++){var w=d.readS();0==d.readUshort()&&null!=(r=s[n+"-cp-"+w])?d.writeS(r):d.skip(2)}}switch(p){case t.ObjectType.Text:case t.ObjectType.RichText:case t.ObjectType.InputText:null!=(r=s[n])&&(d.seek(c,6),d.writeS(r)),null!=(r=s[n+"-prompt"])&&(d.seek(c,4),d.writeS(r));break;case t.ObjectType.List:case t.ObjectType.Tree:for(d.seek(c,8),d.skip(2),o=d.readUshort(),l=0;l<o;l++){if(a=d.readUshort(),a+=d.pos,d.skip(2),p==t.ObjectType.Tree&&d.skip(2),null!=(r=s[n+"-"+l])?d.writeS(r):d.skip(2),null!=(r=s[n+"-"+l+"-0"])?d.writeS(r):d.skip(2),d.version>=2){d.skip(6),d.skip(4*d.readUshort());for(v=d.readUshort(),m=0;m<v;m++){w=d.readS();0==d.readUshort()&&null!=(r=s[n+"-"+l+"-"+w])?d.writeS(r):d.skip(2)}}d.pos=a}break;case t.ObjectType.Label:d.seek(c,6)&&d.readByte()==p&&(null!=(r=s[n])?d.writeS(r):d.skip(2),d.skip(2),d.readBool()&&d.skip(4),d.skip(4),d.readBool()&&null!=(r=s[n+"-prompt"])&&d.writeS(r));break;case t.ObjectType.Button:d.seek(c,6)&&d.readByte()==p&&(null!=(r=s[n])?d.writeS(r):d.skip(2),null!=(r=s[n+"-0"])&&d.writeS(r));break;case t.ObjectType.ComboBox:if(d.seek(c,6)&&d.readByte()==p){for(o=d.readShort(),l=0;l<o;l++)a=d.readShort(),a+=d.pos,null!=(r=s[n+"-"+l])&&d.writeS(r),d.pos=a;null!=(r=s[n])&&d.writeS(r)}}d.pos=c+u}}}}}]),e}();t.TranslationHelper=e}(fgui||(fgui={})),function(t){var e=function t(){_classCallCheck(this,t)};e.defaultFont="Arial",e.modalLayerColor=new t.Color4(3355443,.2),e.buttonSound=null,e.buttonSoundVolumeScale=1,e.horizontalScrollBar=null,e.verticalScrollBar=null,e.defaultScrollStep=25,e.defaultScrollDecelerationRate=.967,e.defaultScrollBarDisplay=t.ScrollBarDisplayType.Visible,e.defaultScrollTouchEffect=!0,e.defaultScrollBounceEffect=!0,e.defaultScrollSnappingThreshold=.1,e.defaultScrollPagingThreshold=.3,e.popupMenu=null,e.popupMenu_seperator=null,e.loaderErrorSign=null,e.tooltipsWin=null,e.defaultComboBoxVisibleItemCount=10,e.touchScrollSensitivity=20,e.touchDragSensitivity=10,e.clickDragSensitivity=2,e.bringWindowToFrontOnClick=!0,e.frameTimeForAsyncUIConstruction=2,e.packageFileExtension="fui",t.UIConfig=e}(fgui||(fgui={})),function(t){var e,i;!function(t){t[t.ConstantPixelSize=0]="ConstantPixelSize",t[t.ScaleWithScreenSize=1]="ScaleWithScreenSize",t[t.ConstantPhysicalSize=2]="ConstantPhysicalSize"}(e=t.ScaleMode||(t.ScaleMode={})),function(t){t[t.MatchWidthOrHeight=0]="MatchWidthOrHeight",t[t.MatchWidth=1]="MatchWidth",t[t.MatchHeight=2]="MatchHeight"}(i=t.ScreenMatchMode||(t.ScreenMatchMode={}));var s=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"scaleWithScreenSize",value:function(t,s,h){a=t,o=s,r=e.ScaleWithScreenSize,n=h||i.MatchWidthOrHeight,c()}},{key:"setConstant",value:function(t){r=e.ConstantPixelSize,h=t||1,c()}},{key:"_refresh",value:function(){c()}},{key:"scaleFactor",get:function(){return l}},{key:"scaleLevel",get:function(){return u}}]),t}();t.UIContentScaler=s;var n,r=e.ConstantPixelSize,a=1136,o=640,h=1,l=1,u=0;function c(){var s=t.Stage.width,c=t.Stage.height;if(r==e.ScaleWithScreenSize){if(0==a||0==o)return;var _=a,d=o;if(s>c&&_<d||s<c&&_>d){var g=_;_=d,d=g}if(n==i.MatchWidthOrHeight){var f=s/_,p=c/d;l=Math.min(f,p)}else l=n==i.MatchWidth?s/_:c/d}else r==e.ConstantPhysicalSize||(l=h);l>10&&(l=10),u=l>3?3:l>2?2:l>1?1:0,t.broadcastEvent(t.Stage.scene,"content_scale_factor_changed")}}(fgui||(fgui={})),function(t){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"setExtension",value:function(i,s){if(null==i)throw new Error("Invaild url: "+i);var n=t.UIPackage.getItemByURL(i);n&&(n.extensionType=s),e.extensions[i]=s}},{key:"setLoaderExtension",value:function(t){e.loaderType=t}},{key:"resolvePackageItemExtension",value:function(t){var i=e.extensions["ui://"+t.owner.id+t.id];i||(i=e.extensions["ui://"+t.owner.name+"/"+t.name]),i&&(t.extensionType=i)}},{key:"newObject",value:function(i,s){var n;if("number"==typeof i)switch(i){case t.ObjectType.Image:return new t.GImage;case t.ObjectType.MovieClip:return new t.GMovieClip;case t.ObjectType.Component:return new t.GComponent;case t.ObjectType.Text:return new t.GTextField;case t.ObjectType.RichText:return new t.GRichTextField;case t.ObjectType.InputText:return new t.GTextInput;case t.ObjectType.Group:return new t.GGroup;case t.ObjectType.List:return new t.GList;case t.ObjectType.Graph:return new t.GGraph;case t.ObjectType.Loader:return e.loaderType?new e.loaderType:new t.GLoader;case t.ObjectType.Button:return new t.GButton;case t.ObjectType.Label:return new t.GLabel;case t.ObjectType.ProgressBar:return new t.GProgressBar;case t.ObjectType.Slider:return new t.GSlider;case t.ObjectType.ScrollBar:return new t.GScrollBar;case t.ObjectType.ComboBox:return new t.GComboBox;case t.ObjectType.Tree:return new t.GTree;case t.ObjectType.Loader3D:return new t.GLoader3D;default:return null}else(n=i.type==t.PackageItemType.Component?s?new s:i.extensionType?new i.extensionType:e.newObject(i.objectType):e.newObject(i.objectType))&&(n.packageItem=i);return n}}]),e}();e.extensions={},t.UIObjectFactory=e,t.Decls.UIObjectFactory=e}(fgui||(fgui={})),function(t){var e=function(){function e(){_classCallCheck(this,e),this._items=[],this._itemsById={},this._itemsByName={},this._sprites={},this._dependencies=Array(),this._branches=Array(),this._branchIndex=-1}return _createClass(e,[{key:"loadPackage",value:function(e){if(1179080009!=e.readUint())throw new Error("old package format found in '"+this._resKey+"'");e.version=e.readInt();e.readBool();this._id=e.readString(),this._name=e.readString(),e.skip(20);var s,n,a,o,h,l=e.version>=2,u=e.pos;e.seek(u,4),s=e.readInt();var c,_=[];for(n=0;n<s;n++)_[n]=e.readString();for(e.stringTable=_,e.seek(u,0),s=e.readShort(),n=0;n<s;n++)this._dependencies.push({id:e.readS(),name:e.readS()});l&&((s=e.readShort())>0&&(this._branches=e.readSArray(s),r&&(this._branchIndex=this._branches.indexOf(r))),h=s>0),e.seek(u,1);var d=this._resKey+"_";for(s=e.readUshort(),n=0;n<s;n++){switch(a=e.readInt(),a+=e.pos,(c=new t.PackageItem).owner=this,c.type=e.readByte(),c.id=e.readS(),c.name=e.readS(),e.readS(),(o=e.readS())&&(c.file=o),e.readBool(),c.width=e.readInt(),c.height=e.readInt(),c.type){case t.PackageItemType.Image:c.objectType=t.ObjectType.Image;var g=e.readByte();1==g?(c.scale9Grid=new t.Rect,c.scale9Grid.x=e.readInt(),c.scale9Grid.y=e.readInt(),c.scale9Grid.width=e.readInt(),c.scale9Grid.height=e.readInt(),c.tileGridIndice=e.readInt()):2==g&&(c.scaleByTile=!0),c.smoothing=e.readBool();break;case t.PackageItemType.MovieClip:c.smoothing=e.readBool(),c.objectType=t.ObjectType.MovieClip,c.rawData=e.readBuffer();break;case t.PackageItemType.Font:c.rawData=e.readBuffer();break;case t.PackageItemType.Component:var f=e.readByte();c.objectType=f>0?f:t.ObjectType.Component,c.rawData=e.readBuffer(),t.Decls.UIObjectFactory.resolvePackageItemExtension(c);break;case t.PackageItemType.Atlas:case t.PackageItemType.Sound:case t.PackageItemType.Misc:c.file=d+c.file}if(l){(o=e.readS())&&(c.name=o+"/"+c.name);var p=e.readByte();p>0&&(h?c.branches=e.readSArray(p):this._itemsById[e.readS()]=c);var y=e.readByte();y>0&&(c.highResolution=e.readSArray(y))}this._items.push(c),this._itemsById[c.id]=c,null!=c.name&&(this._itemsByName[c.name]=c),e.pos=a}for(e.seek(u,2),s=e.readUshort(),n=0;n<s;n++){a=e.readUshort(),a+=e.pos;var v=e.readS();c=this._itemsById[e.readS()];var m=new i;m.atlas=c,m.rect.x=e.readInt(),m.rect.y=e.readInt(),m.rect.width=e.readInt(),m.rect.height=e.readInt(),m.rotated=e.readBool(),l&&e.readBool()?(m.offset.x=e.readInt(),m.offset.y=e.readInt(),m.originalSize.x=e.readInt(),m.originalSize.y=e.readInt()):(m.originalSize.x=m.rect.width,m.originalSize.y=m.rect.height),this._sprites[v]=m,e.pos=a}if(e.seek(u,3))for(s=e.readUshort(),n=0;n<s;n++)a=e.readInt(),a+=e.pos,(c=this._itemsById[e.readS()])&&c.type==t.PackageItemType.Image&&(c.pixelHitTestData=new t.PixelHitTestData,c.pixelHitTestData.load(e)),e.pos=a}},{key:"dispose",value:function(){for(var e=this._items.length,i=0;i<e;i++){var s=this._items[i];s.type==t.PackageItemType.Atlas?s.texture&&(s.texture.dispose(),s.texture=null):(s.type,t.PackageItemType.Sound)}}},{key:"createObject",value:function(t,e){var i=this._itemsByName[t];return i?this.internalCreateObject(i,e):null}},{key:"internalCreateObject",value:function(e,i){var s=t.Decls.UIObjectFactory.newObject(e,i);return null==s?null:(t.constructingDepth.n++,s.constructFromResource(),t.constructingDepth.n--,s)}},{key:"getItemById",value:function(t){return this._itemsById[t]}},{key:"getItemByName",value:function(t){return this._itemsByName[t]}},{key:"getItemAssetByName",value:function(t){var e=this._itemsByName[t];if(null==e)throw"Resource not found -"+t;return this.getItemAsset(e)}},{key:"getItemAsset",value:function(e){switch(e.type){case t.PackageItemType.Image:if(!e.decoded){e.decoded=!0;var i=this._sprites[e.id];if(i){var s=this.getItemAsset(i.atlas);e.texture=s.createSubTexture(i.rect,i.rotated,i.offset,i.originalSize)}else e.texture=null}return e.texture;case t.PackageItemType.Atlas:return e.texture;case t.PackageItemType.Font:return e.decoded||(e.decoded=!0,this.loadFont(e)),e.bitmapFont;case t.PackageItemType.MovieClip:return e.decoded||(e.decoded=!0,this.loadMovieClip(e)),e.frames;case t.PackageItemType.Component:return e.rawData;default:return null}}},{key:"loadMovieClip",value:function(t){var e=t.rawData;e.seek(0,0),t.interval=e.readInt(),t.swing=e.readBool(),t.repeatDelay=e.readInt(),e.seek(0,1);var i,s,n,r,a,o=e.readShort();t.frames=[];for(var h=0;h<o;h++){var l=e.readShort();if(l+=e.pos,s={texture:null},r=e.readInt(),a=e.readInt(),e.readInt(),e.readInt(),s.addDelay=e.readInt(),null!=(i=e.readS())&&null!=(n=this._sprites[i])){var u=this.getItemAsset(n.atlas);s.texture=u.createSubTexture(n.rect,n.rotated,new THREE.Vector2(r,a),new THREE.Vector2(t.width,t.height))}t.frames[h]=s,e.pos=l}}},{key:"loadFont",value:function(e){e=e.getBranch();var i=new t.BitmapFont;i.name="ui://"+this._id+e.id,e.bitmapFont=i;var s=e.rawData;s.seek(0,0);var n=s.readBool();i.tint=s.readBool(),i.resizable=s.readBool(),i.hasChannel=s.readBool();var r,a,o,h,l=s.readInt(),u=s.readInt(),c=s.readInt(),_=1,d=1,g=null,f=n?this._sprites[e.id]:null;f&&(_=(g=this.getItemAsset(f.atlas)).root.uvRect.width/g.width,d=g.root.uvRect.height/g.height),s.seek(0,1);for(var p=null,y=s.readInt(),v=0;v<y;v++){var m=s.readShort();m+=s.pos,p=new t.BMGlyph;var w=s.readChar();i.glyphs[w]=p;var k=s.readS(),x=s.readInt(),C=s.readInt();if(r=s.readInt(),a=s.readInt(),o=s.readInt(),h=s.readInt(),p.advance=s.readInt(),p.channel=s.readByte(),1==p.channel?p.channel=2:2==p.channel?p.channel=1:4==p.channel?p.channel=0:8==p.channel&&(p.channel=3),n)f.rotated?(p.uv[0].set((C+h+f.rect.x)*_,1-(f.rect.yMax-x)*d),p.uv[1].set(p.uv[0].x-h*_,p.uv[0].y),p.uv[2].set(p.uv[1].x,p.uv[0].y+o*d),p.uv[3].set(p.uv[0].x,p.uv[2].y)):(p.uv[0].set((x+f.rect.x)*_,1-(C+h+f.rect.y)*d),p.uv[1].set(p.uv[0].x,p.uv[0].y+h*d),p.uv[2].set(p.uv[0].x+o*_,p.uv[1].y),p.uv[3].set(p.uv[2].x,p.uv[0].y)),p.lineHeight=c,p.x=r,p.y=a,p.width=o,p.height=h;else{var b=this._itemsById[k];b&&(o=(b=b.getBranch()).width,h=b.height,b=b.getHighResolution(),this.getItemAsset(b),b.texture.getUV(p.uv),_=o/b.width,d=h/b.height,p.x=r+b.texture.offset.x*_,p.y=a+b.texture.offset.y*d,p.width=b.texture.width*_,p.height=b.texture.height*d,g||(g=b.texture.root)),0==l&&(l=h),0==p.advance&&(p.advance=0==u?r+o:u),p.lineHeight=a<0?h:a+h,p.lineHeight<i.size&&(p.lineHeight=i.size)}s.pos=m}i.size=l,i.mainTexture=g}},{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name}},{key:"customId",get:function(){return this._customId},set:function(t){null!=this._customId&&delete s[this._customId],this._customId=t,null!=this._customId&&(s[this._customId]=this)}}],[{key:"getVar",value:function(t){return a[t]}},{key:"setVar",value:function(t,e){a[t]=e}},{key:"getById",value:function(t){return s[t]}},{key:"getByName",value:function(t){return n[t]}},{key:"loadPackage",value:function(i,r){return new Promise((function(a){var l=s[i];if(l)a(l);else{var u=i+"."+t.UIConfig.packageFileExtension,c=new THREE.FileLoader;c.setResponseType("arraybuffer"),c.load(u,(function(u){(l=new e)._resKey=i,l.loadPackage(new t.ByteBuffer(u));for(var c=[],_=l._items.length,d=0;d<_;d++){var g=l._items[d];g.type==t.PackageItemType.Atlas?c.push(o(g,r)):g.type==t.PackageItemType.Sound&&c.push(h(g,r))}var f=function(){s[l.id]=l,n[l.name]=l,n[l._resKey]=l,a(l)};c.length>0?Promise.all(c).then(f):f()}))}}))}},{key:"removePackage",value:function(t){var e=s[t];if(e||(e=n[t]),!e)throw new Error("unknown package: "+t);e.dispose(),delete s[e.id],delete n[e.name],delete s[e._resKey],null!=e._customId&&delete s[e._customId]}},{key:"createObject",value:function(t,i,s){var n=e.getByName(t);return n?n.createObject(i,s):null}},{key:"createObjectFromURL",value:function(t,i){var s=e.getItemByURL(t);return s?s.owner.internalCreateObject(s,i):null}},{key:"getItemURL",value:function(t,i){var s=e.getByName(t);if(!s)return null;var n=s._itemsByName[i];return n?"ui://"+s.id+n.id:null}},{key:"getItemByURL",value:function(t){var i=t.indexOf("//");if(-1==i)return null;var s=t.indexOf("/",i+2);if(-1==s){if(t.length>13){var n=t.substr(5,8),r=e.getById(n);if(r){var a=t.substr(13);return r.getItemById(a)}}}else{var o=t.substr(i+2,s-i-2);if(r=e.getByName(o)){var h=t.substr(s+1);return r.getItemByName(h)}}return null}},{key:"getItemAssetByURL",value:function(t){var i=e.getItemByURL(t);return null==i?null:i.owner.getItemAsset(i)}},{key:"normalizeURL",value:function(t){if(null==t)return null;var i=t.indexOf("//");if(-1==i)return null;var s=t.indexOf("/",i+2);if(-1==s)return t;var n=t.substr(i+2,s-i-2),r=t.substr(s+1);return e.getItemURL(n,r)}},{key:"branch",get:function(){return r},set:function(t){for(var e in r=t,s){var i=s[e];i._branches&&(i._branchIndex=i._branches.indexOf(t))}}}]),e}();t.UIPackage=e;var i=function e(){_classCallCheck(this,e),this.rect=new t.Rect,this.offset=new THREE.Vector2,this.originalSize=new THREE.Vector2},s={},n={},r="",a={};function o(e,i){return new Promise((function(s,n){(new THREE.TextureLoader).load(e.file,(function(i){i.generateMipmaps=!1,i.magFilter=THREE.LinearFilter,i.minFilter=THREE.LinearFilter,e.texture=new t.NTexture(i),s()}),i,(function(t){n(t.message)}))}))}function h(t,e){return new Promise((function(i,s){(new THREE.AudioLoader).load(t.file,(function(e){t.audioBuffer=e,i()}),e,(function(t){s(t.message)}))}))}t.FontManager.packageFontGetter=function(t){return e.getItemAssetByURL(t)}}(fgui||(fgui={})),function(t){var e=function(e){_inherits(s,e);var i=_createSuper(s);function s(){var e;return _classCallCheck(this,s),(e=i.call(this))._requestingCmd=0,e._uiSources=[],e.bringToFontOnClick=t.UIConfig.bringWindowToFrontOnClick,e.on("added_to_stage",e.__onShown,_assertThisInitialized(e)),e.on("removed_from_stage",e.__onHidden,_assertThisInitialized(e)),e.on("touch_begin",e.__winTouchBegin,_assertThisInitialized(e)),e}return _createClass(s,[{key:"addUISource",value:function(t){this._uiSources.push(t)}},{key:"show",value:function(){t.GRoot.inst.showWindow(this)}},{key:"showOn",value:function(t){t.showWindow(this)}},{key:"hide",value:function(){this.isShowing&&this.doHideAnimation()}},{key:"hideImmediately",value:function(){var e=this.parent instanceof t.GRoot?this.parent:null;e||(e=t.GRoot.inst),e.hideWindowImmediately(this)}},{key:"centerOn",value:function(e,i){this.setPosition(Math.round((e.width-this.width)/2),Math.round((e.height-this.height)/2)),i&&(this.addRelation(e,t.RelationType.Center_Center),this.addRelation(e,t.RelationType.Middle_Middle))}},{key:"toggleStatus",value:function(){this.isTop?this.hide():this.show()}},{key:"bringToFront",value:function(){t.GRoot.findFor(this).bringToFront(this)}},{key:"showModalWait",value:function(e){e&&0!=e&&(this._requestingCmd=e),t.UIConfig.windowModalWaiting&&(this._modalWaitPane||(this._modalWaitPane=t.UIPackage.createObjectFromURL(t.UIConfig.windowModalWaiting)),this.layoutModalWaitPane(),this.addChild(this._modalWaitPane))}},{key:"layoutModalWaitPane",value:function(){if(this._contentArea){var t=this._frame.localToGlobal();t=this.globalToLocal(t.x,t.y,t),this._modalWaitPane.setPosition(t.x+this._contentArea.x,t.y+this._contentArea.y),this._modalWaitPane.setSize(this._contentArea.width,this._contentArea.height)}else this._modalWaitPane.setSize(this.width,this.height)}},{key:"closeModalWait",value:function(t){return(!t||0==t||this._requestingCmd==t)&&(this._requestingCmd=0,this.modalWaiting&&this.removeChild(this._modalWaitPane),!0)}},{key:"init",value:function(){if(!this._inited&&!this._loading)if(this._uiSources.length>0){this._loading=!1;for(var t=this._uiSources.length,e=0;e<t;e++){var i=this._uiSources[e];i.loaded||(i.load(this.__uiLoadComplete,this),this._loading=!0)}this._loading||this._init()}else this._init()}},{key:"onInit",value:function(){}},{key:"onShown",value:function(){}},{key:"onHide",value:function(){}},{key:"doShowAnimation",value:function(){this.onShown()}},{key:"doHideAnimation",value:function(){this.hideImmediately()}},{key:"__uiLoadComplete",value:function(){for(var t=this._uiSources.length,e=0;e<t;e++){if(!this._uiSources[e].loaded)return}this._loading=!1,this._init()}},{key:"_init",value:function(){this._inited=!0,this.onInit(),this.isShowing&&this.doShowAnimation()}},{key:"dispose",value:function(){this.parent&&this.hideImmediately(),_get(_getPrototypeOf(s.prototype),"dispose",this).call(this)}},{key:"closeEventHandler",value:function(){this.hide()}},{key:"__onShown",value:function(){this._inited?this.doShowAnimation():this.init()}},{key:"__onHidden",value:function(){this.closeModalWait(),this.onHide()}},{key:"__winTouchBegin",value:function(){this.isShowing&&this.bringToFontOnClick&&this.bringToFront()}},{key:"__dragStart",value:function(t){t.preventDefault(),this.startDrag()}},{key:"contentPane",set:function(e){this._contentPane!=e&&(this._contentPane&&this.removeChild(this._contentPane),this._contentPane=e,this._contentPane&&(this.addChild(this._contentPane),this.setSize(this._contentPane.width,this._contentPane.height),this._contentPane.addRelation(this,t.RelationType.Size),this._frame=this._contentPane.getChild("frame"),this._frame&&(this.closeButton=this._frame.getChild("closeButton"),this.dragArea=this._frame.getChild("dragArea"),this.contentArea=this._frame.getChild("contentArea"))))},get:function(){return this._contentPane}},{key:"frame",get:function(){return this._frame}},{key:"closeButton",get:function(){return this._closeButton},set:function(t){this._closeButton&&this._closeButton.offClick(this.closeEventHandler,this),this._closeButton=t,this._closeButton&&this._closeButton.onClick(this.closeEventHandler,this)}},{key:"dragArea",get:function(){return this._dragArea},set:function(e){this._dragArea!=e&&(this._dragArea&&(this._dragArea.draggable=!1,this._dragArea.off("drag_start",this.__dragStart,this)),this._dragArea=e,this._dragArea&&(this._dragArea instanceof t.GGraph&&this._dragArea.shape.drawRect(0,new t.Color4(0,0),new t.Color4(0,0)),this._dragArea.draggable=!0,this._dragArea.on("drag_start",this.__dragStart,this)))}},{key:"contentArea",get:function(){return this._contentArea},set:function(t){this._contentArea=t}},{key:"isShowing",get:function(){return null!=this.parent}},{key:"isTop",get:function(){return this.parent&&this.parent.getChildIndex(this)==this.parent.numChildren-1}},{key:"modal",get:function(){return this._modal},set:function(t){this._modal=t}},{key:"modalWaiting",get:function(){return null!=this._modalWaitPane&&null!=this._modalWaitPane.parent}}]),s}(t.GComponent);t.Window=e}(fgui||(fgui={})),function(t){var e=function(){function e(t,i,s){_classCallCheck(this,e),this.version=0,i=i||0,null!=s&&-1!=s||(s=t.byteLength-i),this._buffer=t,this._view=new DataView(this._buffer,i,s),this._pos=0,this._length=s}return _createClass(e,[{key:"skip",value:function(t){this._pos+=t}},{key:"validate",value:function(t){if(this._pos+t>this._length)throw"Out of bounds"}},{key:"readByte",value:function(){this.validate(1);var t=this._view.getUint8(this._pos);return this._pos++,t}},{key:"readBool",value:function(){return 1==this.readByte()}},{key:"readShort",value:function(){this.validate(2);var t=this._view.getInt16(this._pos,this.littleEndian);return this._pos+=2,t}},{key:"readUshort",value:function(){this.validate(2);var t=this._view.getUint16(this._pos,this.littleEndian);return this._pos+=2,t}},{key:"readInt",value:function(){this.validate(4);var t=this._view.getInt32(this._pos,this.littleEndian);return this._pos+=4,t}},{key:"readUint",value:function(){this.validate(4);var t=this._view.getUint32(this._pos,this.littleEndian);return this._pos+=4,t}},{key:"readFloat",value:function(){this.validate(4);var t=this._view.getFloat32(this._pos,this.littleEndian);return this._pos+=4,t}},{key:"readString",value:function(t){null==t&&(t=this.readUshort()),this.validate(t);var e=(new TextDecoder).decode(new DataView(this._buffer,this._view.byteOffset+this._pos,t));return this._pos+=t,e}},{key:"readS",value:function(){var t=this.readUshort();return 65534==t?null:65533==t?"":this.stringTable[t]}},{key:"readSArray",value:function(t){for(var e=new Array(t),i=0;i<t;i++)e[i]=this.readS();return e}},{key:"writeS",value:function(t){var e=this.readUshort();65534!=e&&65533!=e&&(this.stringTable[e]=t)}},{key:"readColor",value:function(){var t=this.readByte(),e=this.readByte(),i=this.readByte();return this.readByte(),(t<<16)+(e<<8)+i}},{key:"readFullColor",value:function(){var e=this.readByte(),i=this.readByte(),s=this.readByte(),n=this.readByte();return new t.Color4((e<<16)+(i<<8)+s,n/255)}},{key:"readChar",value:function(){var t=this.readUshort();return String.fromCharCode(t)}},{key:"readBuffer",value:function(){var t=this.readUint();this.validate(t);var i=new e(this._buffer,this._view.byteOffset+this._pos,t);return i.stringTable=this.stringTable,i.version=this.version,this._pos+=t,i}},{key:"seek",value:function(t,e){var i,s=this._pos;return this._pos=t,e<this.readByte()?(1==this.readByte()?(this._pos+=2*e,i=this.readUshort()):(this._pos+=4*e,i=this.readUint()),i>0?(this._pos=t+i,!0):(this._pos=s,!1)):(this._pos=s,!1)}},{key:"data",get:function(){return this._buffer}},{key:"pos",get:function(){return this._pos},set:function(t){if(t>this._length)throw"Out of bounds";this._pos=t}},{key:"length",get:function(){return this._length}}]),e}();t.ByteBuffer=e}(fgui||(fgui={})),function(t){var e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],i=e.length,s=function(){function t(){_classCallCheck(this,t),this.matrix=new Array(i),this.reset()}return _createClass(t,[{key:"reset",value:function(){for(var t=0;t<i;t++)this.matrix[t]=e[t]}},{key:"invert",value:function(){this.multiplyMatrix([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])}},{key:"adjustColor",value:function(t,e,i,s){this.adjustBrightness(t),this.adjustContrast(e),this.adjustSaturation(i),this.adjustHue(s)}},{key:"adjustBrightness",value:function(t){t=255*this.cleanValue(t,1),this.multiplyMatrix([1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0])}},{key:"adjustContrast",value:function(t){var e=(t=this.cleanValue(t,1))+1,i=128*(1-e);this.multiplyMatrix([e,0,0,0,i,0,e,0,0,i,0,0,e,0,i,0,0,0,1,0])}},{key:"adjustSaturation",value:function(t){t=this.cleanValue(t,1);var e=1-(t+=1),i=.299*e,s=.587*e,n=.114*e;this.multiplyMatrix([i+t,s,n,0,0,i,s+t,n,0,0,i,s,n+t,0,0,0,0,0,1,0])}},{key:"adjustHue",value:function(t){t=this.cleanValue(t,1),t*=Math.PI;var e=Math.cos(t),i=Math.sin(t);this.multiplyMatrix([.299+e*(1-.299)+-.299*i,.587+-.587*e+-.587*i,.114+-.114*e+.886*i,0,0,.299+-.299*e+.143*i,.587+e*(1-.587)+.14*i,.114+-.114*e+-.283*i,0,0,.299+-.299*e+i*-(1-.299),.587+-.587*e+.587*i,.114+.886*e+.114*i,0,0,0,0,0,1,0])}},{key:"concat",value:function(t){t.length==i&&this.multiplyMatrix(t)}},{key:"clone",value:function(){var e=new t;return e.copyMatrix(this.matrix),e}},{key:"copyMatrix",value:function(t){for(var e=i,s=0;s<e;s++)this.matrix[s]=t[s]}},{key:"multiplyMatrix",value:function(t){for(var e=[],i=0,s=0;s<4;++s){for(var n=0;n<5;++n)e[i+n]=t[i]*this.matrix[n]+t[i+1]*this.matrix[n+5]+t[i+2]*this.matrix[n+10]+t[i+3]*this.matrix[n+15]+(4==n?t[i+4]:0);i+=5}this.copyMatrix(e)}},{key:"cleanValue",value:function(t,e){return Math.min(e,Math.max(-e,t))}}],[{key:"create",value:function(e,i,s,n){var r=new t;return r.adjustColor(e,i,s,n),r}},{key:"getMatrix",value:function(e,s,r,a,o){o||(o=new Array(t.length));var h=n;h.reset(),h.adjustColor(e,s,r,a);for(var l=i,u=0;u<l;u++)o[u]=h.matrix[u];return o}}]),t}();t.ColorMatrix=s;var n=new s}(fgui||(fgui={})),function(t){var e=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"add",value:function(t,e,i,r,a){var o,h=s.findIndex((function(t){return t.target==r&&t.callback==i}));-1!=h?o=s[h]:((o=n.borrow()).callback=i,o.target=r,s.push(o)),o.delay=t,o.counter=0,o.repeat=e,o.param=a,o.end=!1}},{key:"callLater",value:function(t,e,i){this.add(0,1,t,e,i)}},{key:"callDelay",value:function(t,e,i,s){this.add(t,1,e,i,s)}},{key:"addUpdate",value:function(t,e,i){this.add(0,0,t,e,i)}},{key:"exists",value:function(t,e){return-1!=s.findIndex((function(i){return i.target==e&&i.callback==t}))}},{key:"remove",value:function(t,e){var i=s.findIndex((function(i){return i.target==e&&i.callback==t}));if(-1!=i){var o=s[i];s.splice(i,1),i<r&&r--,a--,n.returns(o)}}}]),t}();e.deltaTime=0,e.time=0,e.frameCount=0,t.Timers=e;var i=function(){function t(){_classCallCheck(this,t),this.delay=0,this.counter=0,this.repeat=0}return _createClass(t,[{key:"advance",value:function(t){return this.counter+=t,this.counter>=this.delay&&(this.counter-=this.delay,this.counter>this.delay&&(this.counter=this.delay),this.repeat>0&&(this.repeat--,0==this.repeat&&(this.end=!0)),!0)}},{key:"reset",value:function(){this.callback=null,this.target=null,this.param=null}}]),t}(),s=new Array,n=new t.Pool(i,(function(t){return t.reset()})),r=0,a=0,o=0;requestAnimationFrame((function t(i){requestAnimationFrame(t),e.frameCount++,e.time=i;var h=i-o;e.deltaTime=h,o=i,r=0,a=s.length;for(;r<a;){var l=s[r];r++,l.advance(h)&&(l.end&&(r--,a--,s.splice(r,1)),l.callback.call(l.target,l.param),l.end&&n.returns(l))}return!1}))}(fgui||(fgui={})),function(t){t.convertToHtmlColor=function(t,e){var i;i=e?(t>>24&255).toString(16):"";var s=(t>>16&255).toString(16),n=(t>>8&255).toString(16),r=(255&t).toString(16);return 1==i.length&&(i="0"+i),1==s.length&&(s="0"+s),1==n.length&&(n="0"+n),1==r.length&&(r="0"+r),"#"+i+s+n+r},t.convertFromHtmlColor=function(t,e){return t.length<1?0:("#"==t.charAt(0)&&(t=t.substr(1)),8==t.length?(parseInt(t.substr(0,2),16)<<24)+parseInt(t.substr(2),16):e?4278190080+parseInt(t,16):parseInt(t,16))},t.clamp=function(t,e,i){return t<e?t=e:t>i&&(t=i),t},t.clamp01=function(t){return isNaN(t)?t=0:t>1?t=1:t<0&&(t=0),t},t.lerp=function(t,e,i){return t+i*(e-t)},t.repeat=function(t,e){return t-Math.floor(t/e)*e},t.distance=function(t,e,i,s){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-s,2))}}(fgui||(fgui={})),function(t){var e=function(){function t(){_classCallCheck(this,t),this._readPos=0,this.defaultImgWidth=0,this.defaultImgHeight=0,this._handlers={},this._handlers.url=this.onTag_URL,this._handlers.img=this.onTag_IMG,this._handlers.b=this.onTag_B,this._handlers.i=this.onTag_I,this._handlers.u=this.onTag_U,this._handlers.sup=this.onTag_Simple,this._handlers.sub=this.onTag_Simple,this._handlers.color=this.onTag_COLOR,this._handlers.font=this.onTag_FONT,this._handlers.size=this.onTag_SIZE}return _createClass(t,[{key:"onTag_URL",value:function(t,e,i){return e?"</a>":null!=i?'<a href="'+i+'">':'<a href="'+this.getTagText()+'">'}},{key:"onTag_IMG",value:function(t,e,i){if(e)return null;var s=this.getTagText(!0);return s?this.defaultImgWidth?'<img src="'+s+'" width="'+this.defaultImgWidth+'" height="'+this.defaultImgHeight+'"/>':'<img src="'+s+'"/>':null}},{key:"onTag_B",value:function(t,e,i){return e?"</b>":"<b>"}},{key:"onTag_I",value:function(t,e,i){return e?"</i>":"<i>"}},{key:"onTag_U",value:function(t,e,i){return e?"</u>":"<u>"}},{key:"onTag_Simple",value:function(t,e,i){return e?"</"+t+">":"<"+t+">"}},{key:"onTag_COLOR",value:function(t,e,i){return e?"</font>":(this.lastColor=i,'<font color="'+i+'">')}},{key:"onTag_FONT",value:function(t,e,i){return e?"</font>":'<font face="'+i+'">'}},{key:"onTag_SIZE",value:function(t,e,i){return e?"</font>":(this.lastSize=i,'<font size="'+i+'">')}},{key:"getTagText",value:function(t){for(var e,i=this._readPos,s="";-1!=(e=this._text.indexOf("[",i));){if(92!=this._text.charCodeAt(e-1)){s+=this._text.substring(i,e);break}s+=this._text.substring(i,e-1),s+="[",i=e+1}return-1==e?null:(t&&(this._readPos=e),s)}},{key:"parse",value:function(t,e){this._text=t,this.lastColor=null,this.lastSize=null;for(var i,s,n,r,a,o,h,l=0,u="";-1!=(i=this._text.indexOf("[",l));)if(i>0&&92==this._text.charCodeAt(i-1))u+=this._text.substring(l,i-1),u+="[",l=i+1;else{if(u+=this._text.substring(l,i),l=i,-1==(i=this._text.indexOf("]",l)))break;n="/"==this._text.charAt(l+1),r=this._text.substring(n?l+2:l+1,i),this._readPos=i+1,a=null,o=null,-1!=(s=r.indexOf("="))&&(a=r.substring(s+1),r=r.substring(0,s)),r=r.toLowerCase(),null!=(h=this._handlers[r])?e||null!=(o=h.call(this,r,n,a))&&(u+=o):u+=this._text.substring(l,this._readPos),l=this._readPos}return l<this._text.length&&(u+=this._text.substr(l)),this._text=null,u}}]),t}();t.UBBParser=e,t.defaultParser=new e}(fgui||(fgui={})),function(t){var e;!function(t){t[t.Text=0]="Text",t[t.Link=1]="Link",t[t.Image=2]="Image",t[t.Input=3]="Input",t[t.Select=4]="Select",t[t.Object=5]="Object",t[t.LinkEnd=6]="LinkEnd"}(e=t.HtmlElementType||(t.HtmlElementType={}));var i=function(){function i(){_classCallCheck(this,i),this.format=new t.TextFormat,this.position=new THREE.Vector2}return _createClass(i,[{key:"getAttr",value:function(t){return null==this._attributes?null:this._attributes[t]}},{key:"setAttr",value:function(t,e){null==this._attributes&&(this._attributes={}),this._attributes[t]=e}},{key:"getAttrString",value:function(e,i){return t.XMLUtils.getString(this._attributes,e,i)}},{key:"getAttrInt",value:function(e,i){return t.XMLUtils.getInt(this._attributes,e,i)}},{key:"getAttrFloat",value:function(e,i){return t.XMLUtils.getFloat(this._attributes,e,i)}},{key:"getAttrBool",value:function(e,i){return t.XMLUtils.getBool(this._attributes,e,i)}},{key:"getAttrColor",value:function(e,i){return t.XMLUtils.getColor(this._attributes,e,i)}},{key:"fetchAttributes",value:function(){this._attributes=t.XMLIterator.getAttributes(this._attributes)}},{key:"reset",value:function(){this.name=null,this.text=null,this.htmlObject=null,this.status=0,this._attributes=null}},{key:"isEntity",get:function(){return this.type==e.Image||this.type==e.Select||this.type==e.Input||this.type==e.Object}}]),i}();t.HtmlElement=i,t.elementPool=new t.Pool(i,(function(t){t.type=arguments.length<=1?void 0:arguments[1],t.type!=e.Text&&null==t._attributes&&(t._attributes={})}),(function(t){return t.reset()}))}(fgui||(fgui={})),function(t){var e=function(){function e(){_classCallCheck(this,e),this.loader=t.UIObjectFactory.newObject(t.ObjectType.Loader),this.loader.fill=t.LoaderFillType.ScaleFree,this.loader.touchable=!1}return _createClass(e,[{key:"create",value:function(e,i){this._owner=e,this._element=i;var s=0,n=0,r=i.getAttrString("src");if(null!=r){var a=t.UIPackage.getItemByURL(r);a&&(s=a.width,n=a.height)}this.loader.url=r;var o=i.getAttrInt("width",s),h=i.getAttrInt("height",n);0==o&&(o=5),0==h&&(h=10),this.loader.setSize(o,h)}},{key:"setPosition",value:function(t,e){this.loader.setPosition(t,e)}},{key:"add",value:function(){this._owner.addChild(this.loader.displayObject)}},{key:"remove",value:function(){this.loader.displayObject.parent&&this._owner.removeChild(this.loader.displayObject)}},{key:"release",value:function(){this.loader.offAll(),this.loader.url=null,this._owner=null,this._element=null}},{key:"dispose",value:function(){this.loader.dispose()}},{key:"displayObject",get:function(){return this.loader.displayObject}},{key:"element",get:function(){return this._element}},{key:"width",get:function(){return this.loader.width}},{key:"height",get:function(){return this.loader.height}}]),e}();t.HtmlImage=e}(fgui||(fgui={})),function(t){var e=function(){function e(){var i=this;_classCallCheck(this,e),this._shape=new t.SelectionShape,this._shape.on("click",(function(){t.bubbleEvent(i._owner.obj3D,"click_link",i._element.getAttrString("href"))}))}return _createClass(e,[{key:"create",value:function(t,e){this._owner=t,this._element=e}},{key:"setArea",value:function(t,e,i,s){if(t==i&&e>s){var n=e;e=s,s=n}this._shape.rects.length=0,this._owner.getLinesShape(t,e,i,s,!0,this._shape.rects),this._shape.refresh()}},{key:"setPosition",value:function(t,e){this._shape.setPosition(t,e)}},{key:"add",value:function(){this._owner.addChild(this._shape)}},{key:"remove",value:function(){this._shape.parent&&this._owner.removeChild(this._shape)}},{key:"release",value:function(){this._shape.offAll(),this._owner=null,this._element=null}},{key:"dispose",value:function(){this._shape.dispose()}},{key:"displayObject",get:function(){return this._shape}},{key:"element",get:function(){return this._element}},{key:"width",get:function(){return 0}},{key:"height",get:function(){return 0}}]),e}();t.HtmlLink=e}(fgui||(fgui={})),function(t){var e=function(){function e(){_classCallCheck(this,e),this._imagePool=new t.Pool(t.HtmlImage),this._linkPool=new t.Pool(t.HtmlLink)}return _createClass(e,[{key:"createObject",value:function(e,i){var s=null;return i.type==t.HtmlElementType.Image?s=this._imagePool.borrow():i.type==t.HtmlElementType.Link&&(s=this._linkPool.borrow()),s&&s.create(e,i),s}},{key:"freeObject",value:function(e){e.release(),e instanceof t.HtmlImage?this._imagePool.returns(e):e instanceof t.HtmlLink&&this._linkPool.returns(e)}}]),e}();t.HtmlPageContext=e,t.defaultContext=new e}(fgui||(fgui={})),function(t){var e=function t(){_classCallCheck(this,t),this.linkUnderline=t.defaultLinkUnderline,this.linkColor=t.defaultLinkColor};e.defaultLinkUnderline=!0,e.defaultLinkColor=3827660,t.HtmlParseOptions=e}(fgui||(fgui={})),function(t){var e=new Array,i=new Array,s=function(){function s(){_classCallCheck(this,s),this._textFormatStack=new Array,this._format=new t.TextFormat,this._defaultOptions=new t.HtmlParseOptions}return _createClass(s,[{key:"parse",value:function(s,n,r,a){null==a&&(a=this._defaultOptions),this._elements=r,this._textFormatStackTop=0,this._format.copy(n),this._format.colorChanged=!1;var o,h=0,l=a.ignoreWhiteSpace,u=!1;for(t.XMLIterator.begin(s,!0);t.XMLIterator.nextTag();)switch(0==h&&(o=t.XMLIterator.getText(l)).length>0&&(u&&"\n"==o[0]&&(o=o.substr(1)),this.appendText(o)),u=!1,t.XMLIterator.tagName){case"b":t.XMLIterator.tagType==t.XMLTagType.Start?(this.pushTextFormat(),this._format.bold=!0):this.popTextFormat();break;case"i":t.XMLIterator.tagType==t.XMLTagType.Start?(this.pushTextFormat(),this._format.italic=!0):this.popTextFormat();break;case"u":t.XMLIterator.tagType==t.XMLTagType.Start?(this.pushTextFormat(),this._format.underline=!0):this.popTextFormat();break;case"strike":t.XMLIterator.tagType==t.XMLTagType.Start?(this.pushTextFormat(),this._format.strikethrough=!0):this.popTextFormat();break;case"font":if(t.XMLIterator.tagType==t.XMLTagType.Start){this.pushTextFormat(),this._format.size=t.XMLUtils.getInt(t.XMLIterator.attributes,"size",this._format.size);var c=t.XMLIterator.getAttribute("color");null!=c&&(this._format.color=t.convertFromHtmlColor(c))}else t.XMLIterator.tagType==t.XMLTagType.End&&this.popTextFormat();break;case"br":this.appendText("\n");break;case"img":if(t.XMLIterator.tagType==t.XMLTagType.Start||t.XMLIterator.tagType==t.XMLTagType.Void){var _=t.elementPool.borrow(t.HtmlElementType.Image);_.fetchAttributes(),_.name=_.getAttrString("name"),_.format.align=this._format.align,this._elements.push(_)}break;case"a":if(t.XMLIterator.tagType==t.XMLTagType.Start){this.pushTextFormat(),this._format.underline=this._format.underline||a.linkUnderline,this._format.colorChanged||(this._format.color=a.linkColor);var d=t.elementPool.borrow(t.HtmlElementType.Link);d.fetchAttributes(),d.name=d.getAttrString("name"),d.format.align=this._format.align,this._elements.push(d)}else if(t.XMLIterator.tagType==t.XMLTagType.End){this.popTextFormat();var g=t.elementPool.borrow(t.HtmlElementType.LinkEnd);this._elements.push(g)}break;case"input":var f=t.elementPool.borrow(t.HtmlElementType.Input);f.fetchAttributes(),f.name=f.getAttrString("name"),f.format.copy(this._format),this._elements.push(f);break;case"select":if(t.XMLIterator.tagType==t.XMLTagType.Start||t.XMLIterator.tagType==t.XMLTagType.Void){var p=t.elementPool.borrow(t.HtmlElementType.Select);if(p.fetchAttributes(),t.XMLIterator.tagType==t.XMLTagType.Start){for(e.length=0,i.length=0;t.XMLIterator.nextTag()&&"select"!=t.XMLIterator.tagName;)"option"==t.XMLIterator.tagName&&(t.XMLIterator.tagType==t.XMLTagType.Start||t.XMLIterator.tagType==t.XMLTagType.Void?i.push(t.XMLUtils.getString(t.XMLIterator.attributes,"value","")):e.push(t.XMLIterator.getText()));p.setAttr("items",e.slice()),p.setAttr("values",i.slice())}p.name=p.getAttrString("name"),p.format.copy(this._format),this._elements.push(p)}break;case"p":if(t.XMLIterator.tagType==t.XMLTagType.Start){switch(this.pushTextFormat(),t.XMLIterator.getAttribute("align")){case"center":this._format.align=t.AlignType.Center;break;case"right":this._format.align=t.AlignType.Right}this.isNewLine()||this.appendText("\n")}else t.XMLIterator.tagType==t.XMLTagType.End&&(this.appendText("\n"),u=!0,this.popTextFormat());break;case"ui":case"div":case"li":t.XMLIterator.tagType==t.XMLTagType.Start?this.isNewLine()||this.appendText("\n"):(this.appendText("\n"),u=!0);break;case"html":case"body":l=!0;break;case"head":case"style":case"script":case"form":t.XMLIterator.tagType==t.XMLTagType.Start?h++:t.XMLIterator.tagType==t.XMLTagType.End&&h--}0==h&&(o=t.XMLIterator.getText(l)).length>0&&(u&&"\n"==o[0]&&(o=o.substr(1)),this.appendText(o)),this._elements=null}},{key:"pushTextFormat",value:function(){var e;this._textFormatStack.length<=this._textFormatStackTop?(e=new t.TextFormat,this._textFormatStack.push(e)):e=this._textFormatStack[this._textFormatStackTop],e.copy(this._format),e.colorChanged=this._format.colorChanged,this._textFormatStackTop++}},{key:"popTextFormat",value:function(){if(this._textFormatStackTop>0){var t=this._textFormatStack[this._textFormatStackTop-1];this._format.copy(t),this._format.colorChanged=t.colorChanged,this._textFormatStackTop--}}},{key:"isNewLine",value:function(){if(this._elements.length>0){var e=this._elements[this._elements.length-1];return!(!e||e.type!=t.HtmlElementType.Text)&&e.text.endsWith("\n")}return!0}},{key:"appendText",value:function(e){var i;this._elements.length>0&&(i=this._elements[this._elements.length-1]).type==t.HtmlElementType.Text&&i.format.equalStyle(this._format)?i.text+=e:((i=t.elementPool.borrow(t.HtmlElementType.Text)).text=e,i.format.copy(this._format),this._elements.push(i))}}]),s}();t.HtmlParser=s,t.htmldefaultParser=new s}(fgui||(fgui={})),function(t){var e=function(){function e(t){_classCallCheck(this,e),t&&this.parse(t)}return _createClass(e,[{key:"getAttrString",value:function(e,i){return t.XMLUtils.getString(this._attributes,e,i)}},{key:"getAttrInt",value:function(e,i){return t.XMLUtils.getInt(this._attributes,e,i)}},{key:"getAttrFloat",value:function(e,i){return t.XMLUtils.getFloat(this._attributes,e,i)}},{key:"getAttrBool",value:function(e,i){return t.XMLUtils.getBool(this._attributes,e,i)}},{key:"getAttrColor",value:function(e,i){return t.XMLUtils.getColor(this._attributes,e,i)}},{key:"setAttribute",value:function(t,e){this._attributes||(this._attributes={}),this._attributes[t]=e}},{key:"getNode",value:function(t){if(!this._children)return null;this._children.find((function(e){return e.name==t}))}},{key:"elements",value:function(t){return this._children||(this._children=new Array),t?this._children.filter((function(e){return e.name==t})):this._children}},{key:"parse",value:function(i){var s;this.reset();var n=new Array;for(t.XMLIterator.begin(i);t.XMLIterator.nextTag();)if(t.XMLIterator.tagType==t.XMLTagType.Start||t.XMLIterator.tagType==t.XMLTagType.Void){var r=void 0;if(s)r=new e;else{if(null!=this.name)throw this.reset(),new Error("Invalid xml format - no root node.");r=this}r.name=t.XMLIterator.tagName,r._attributes=t.XMLIterator.getAttributes(r._attributes),s&&(t.XMLIterator.tagType!=t.XMLTagType.Void&&n.push(s),null==s._children&&(s._children=new Array),s._children.push(r)),t.XMLIterator.tagType!=t.XMLTagType.Void&&(s=r)}else if(t.XMLIterator.tagType==t.XMLTagType.End){if(null==s||s.name!=t.XMLIterator.tagName)throw this.reset(),new Error("Invalid xml format - <"+t.XMLIterator.tagName+"> dismatched.");null!=s._children&&0!=s._children.length||(s.text=t.XMLIterator.getText()),s=n.length>0?n.pop():null}}},{key:"reset",value:function(){this._attributes=null,null!=this._children&&this._children.length,this.text=null}},{key:"attributes",get:function(){return this._attributes||(this._attributes={}),this._attributes}}]),e}();t.XML=e}(fgui||(fgui={})),function(t){var e;!function(t){t[t.Start=0]="Start",t[t.End=1]="End",t[t.Void=2]="Void",t[t.CDATA=3]="CDATA",t[t.Comment=4]="Comment",t[t.Instruction=5]="Instruction"}(e=t.XMLTagType||(t.XMLTagType={}));var i=function(){function i(){_classCallCheck(this,i)}return _createClass(i,null,[{key:"begin",value:function(t,e){i.source=t,i.lowerCaseName=e,this.sourceLen=t.length,this.parsePos=0,this.lastTagEnd=0,this.tagPos=0,this.tagLength=0,this.tagName=null}},{key:"nextTag",value:function(){var t,i,s="";for(this.tagType=e.Start,this.lastTagEnd=this.parsePos,this.attrParsed=!1,this.lastTagName=this.tagName;-1!=(t=this.source.indexOf("<",this.parsePos))&&(this.parsePos=t,++t!=this.sourceLen);){if("!"==(i=this.source[t])){if(this.sourceLen>t+7&&"<![CDATA["==this.source.substr(t-1,9))return t=this.source.indexOf("]]>",t),this.tagType=e.CDATA,this.tagName="",this.tagPos=this.parsePos,this.tagLength=-1==t?this.sourceLen-this.parsePos:t+3-this.parsePos,this.parsePos+=this.tagLength,!0;if(this.sourceLen>t+2&&"\x3c!--"==this.source.substr(t-1,4))return t=this.source.indexOf("--\x3e",t),this.tagType=e.Comment,this.tagName="",this.tagPos=this.parsePos,this.tagLength=-1==t?this.sourceLen-this.parsePos:t+3-this.parsePos,this.parsePos+=this.tagLength,!0;t++,this.tagType=e.Instruction}else"/"==i?(t++,this.tagType=e.End):"?"==i&&(t++,this.tagType=e.Instruction);for(;t<this.sourceLen&&(i=this.source[t],-1==" \t\n\r\v".indexOf(i)&&">"!=i&&"/"!=i);t++);if(t==this.sourceLen)break;(s+=this.source.substr(this.parsePos+1,t-this.parsePos-1)).length>0&&"/"==s[0]&&(s=s.substr(1));for(var n=!1,r=!1,a=-1;t<this.sourceLen;t++)if('"'==(i=this.source[t])?n||(r=!r):"'"==i&&(r||(n=!n)),">"==i){if(!n&&!r){a=-1;break}a=t}else if("<"==i)break;if(-1!=a&&(t=a),t==this.sourceLen)break;return"/"==this.source[t-1]&&(this.tagType=e.Void),this.tagName=s,this.lowerCaseName&&(this.tagName=this.tagName.toLowerCase()),this.tagPos=this.parsePos,this.tagLength=t+1-this.parsePos,this.parsePos+=this.tagLength,!0}return this.tagPos=this.sourceLen,this.tagLength=0,this.tagName=null,!1}},{key:"getTagSource",value:function(){return this.source.substr(this.tagPos,this.tagLength)}},{key:"getRawText",value:function(t){if(this.lastTagEnd==this.tagPos)return"";if(t){for(var e=this.lastTagEnd;e<this.tagPos;e++){var i=this.source[e];if(-1==" \t\n\r\v".indexOf(i))break}return e==this.tagPos?"":this.source.substr(e,this.tagPos-e).trim()}return this.source.substr(this.lastTagEnd,this.tagPos-this.lastTagEnd)}},{key:"getText",value:function(e){if(this.lastTagEnd==this.tagPos)return"";if(e){for(var i=this.lastTagEnd;i<this.tagPos;i++){var s=this.source[i];if(-1==" \t\n\r\v".indexOf(s))break}return i==this.tagPos?"":t.XMLUtils.decodeString(this.source.substr(i,this.tagPos-i)).trimRight()}return t.XMLUtils.decodeString(this.source.substr(this.lastTagEnd,this.tagPos-this.lastTagEnd))}},{key:"getAttribute",value:function(t){if(!this.attrParsed){for(var e in this.attributes)delete this.attributes[e];this.parseAttributes(this.attributes),this.attrParsed=!0}return this.attributes[t]}},{key:"getAttributes",value:function(t){if(null==t&&(t={}),this.attrParsed)for(var e in this.attributes)t[e]=this.attributes[e];else this.parseAttributes(t);return t}},{key:"parseAttributes",value:function(e){var i,s=0,n=0,r=!1,a=0,o="",h=this.tagPos,l=this.tagPos+this.tagLength;if(h<l&&"<"==this.source[h])for(;h<l;h++){var u=this.source[h];if(-1!=" \t\n\r\v".indexOf(u)||">"==u||"/"==u)break}for(;h<l;h++){var c=this.source[h];if("="==c){s=-1,n=-1,a=0;for(var _=h+1;_<l;_++){var d=this.source[_];if(-1!=" \t\n\r\v".indexOf(d)){if(-1!=s&&0==a){n=_-1;break}}else if(">"==d){if(0==a){n=_-1;break}}else if('"'==d)if(-1!=s){if(1!=a){n=_-1;break}}else a=2,s=_+1;else if("'"==d)if(-1!=s){if(2!=a){n=_-1;break}}else a=1,s=_+1;else-1==s&&(s=_)}if(-1==s||-1==n)break;i=o,this.lowerCaseName&&(i=i.toLowerCase()),o="",e[i]=t.XMLUtils.decodeString(this.source.substr(s,n-s+1)),h=n+1}else-1==" \t\n\r\v".indexOf(c)?((r||"/"==c||">"==c)&&(o.length>0&&(i=o,this.lowerCaseName&&(i=i.toLowerCase()),e[i]="",o=""),r=!1),"/"!=c&&">"!=c&&(o+=c)):o.length>0&&(r=!0)}}}]),i}();i.attributes={},t.XMLIterator=i}(fgui||(fgui={})),function(t){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"decodeString",value:function(t){for(var e=t.length,i="",s=0,n=0;;){if(-1==(n=t.indexOf("&",s))){i+=t.substr(s);break}i+=t.substr(s,n-s),n=s=n+1;for(var r=Math.min(e,n+10);n<r&&";"!=t[n];n++);if(n<r&&n>s){var a=t.substr(s,n-s),o=0;if("#"==a[0])a.length>1?(o="x"==a[1]?parseInt(a.substr(2),16):parseInt(a.substr(1)),i+=String.fromCharCode(o),s=n+1):i+="&";else{switch(a){case"amp":o=38;break;case"apos":o=39;break;case"gt":o=62;break;case"lt":o=60;break;case"nbsp":o=32;break;case"quot":o=34}o>0?(i+=String.fromCharCode(o),s=n+1):i+="&"}}else i+="&"}return i}},{key:"encodeString",value:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")}},{key:"getString",value:function(t,e,i){if(null==t)return null==i?null:i;var s=t[e];return null!=s?""+s:null==i?null:i}},{key:"getInt",value:function(t,e,i){var s=this.getString(t,e);if(null==s||0==s.length)return null==i?0:i;if("%"==s[s.length-1]){var n=parseInt(s.substring(0,s.length-1));return Math.ceil(n/100*i)}return parseInt(s)}},{key:"getFloat",value:function(t,e,i){var s=this.getString(t,e);if(null==s||0==s.length)return null==i?0:i;var n=parseFloat(s);return isNaN(n)?null==i?0:i:n}},{key:"getBool",value:function(t,e,i){var s=this.getString(t,e);return null==s||0==s.length?null!=i&&i:"true"==s||"1"==s||"false"!=s&&"0"!=s&&(null!=i&&i)}},{key:"getColor",value:function(e,i,s){var n=this.getString(e,i);return null==n||0==n.length?null==s?0:s:t.convertFromHtmlColor(n)}}]),e}();t.XMLUtils=e}(fgui||(fgui={})),module.exports=window.fgui;
//# sourceMappingURL=fairygui.min.js.map
